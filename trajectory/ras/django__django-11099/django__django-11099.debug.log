2025-12-09 13:47:07,550 - INFO - rex-deploy-django__django-11099 - Building image docker.io/swebench/sweb.eval.x86_64.django_1776_django-11099:latest to install a standalone python to /root. This might take a while (but you only have to do it once). To skip this step, set `python_standalone_dir` to None.
2025-12-09 13:47:08,434 - DEBUG - free_port-django__django-11099 - Found free port 46693
2025-12-09 13:47:08,435 - INFO - rex-deploy-django__django-11099 - Starting container docker.ioswebenchsweb.eval.x86_64.django_1776_django-11099latest-6b9c005c-abda-417a-8eb0-dad6fbe10585 with image docker.io/swebench/sweb.eval.x86_64.django_1776_django-11099:latest serving on port 46693
2025-12-09 13:47:08,435 - DEBUG - rex-deploy-django__django-11099 - Command: "docker run --rm -p 46693:8000 --platform linux/amd64 --name docker.ioswebenchsweb.eval.x86_64.django_1776_django-11099latest-6b9c005c-abda-417a-8eb0-dad6fbe10585 sha256:2bd4fec2b14ada29ffd171720ceca0a2e83ac4b01b85f28905ac4745153a2e5c /bin/sh -c '/root/python3.11/bin/swerex-remote --auth-token 7d77dff9-09e2-43a6-bf9e-f254679c3048'"
2025-12-09 13:47:08,435 - INFO - rex-deploy-django__django-11099 - Starting runtime at 46693
2025-12-09 13:47:09,990 - INFO - rex-deploy-django__django-11099 - Runtime started in 1.55s
2025-12-09 13:47:10,895 - INFO - swea-env-django__django-11099 - Environment Initialized
2025-12-09 13:47:11,144 - DEBUG - swea-env-django__django-11099 - Resetting repository testbed to commit d26b2424437dabeeca94d7900b37d2df4410da0c
2025-12-09 13:47:11,954 - INFO - swea-agent-django__django-11099 - Setting up agent for instance django__django-11099
2025-12-09 13:47:11,954 - INFO - swea-agent-django__django-11099 - Trajectory will be saved to /home/tianpei/IdeaProjects/SWE-agent/trajectories/tianpei/default__gpt-4.1-mini__t-0.00__p-1.00__c-0.50___swe_bench_lite_test/django__django-11099/django__django-11099.traj
2025-12-09 13:47:12,193 - DEBUG - rex-runtime-django__django-11099 - Uploading file from /home/tianpei/IdeaProjects/SWE-agent/tools/registry to /root/tools/registry
2025-12-09 13:47:12,195 - DEBUG - rex-runtime-django__django-11099 - Created zip file at /tmp/tmpqsf4s6nw/zipped_transfer.zip
2025-12-09 13:47:12,195 - DEBUG - rex-runtime-django__django-11099 - Uploading file from /home/tianpei/IdeaProjects/SWE-agent/tools/edit_anthropic to /root/tools/edit_anthropic
2025-12-09 13:47:12,197 - DEBUG - rex-runtime-django__django-11099 - Created zip file at /tmp/tmpwx0y0zk7/zipped_transfer.zip
2025-12-09 13:47:12,197 - DEBUG - rex-runtime-django__django-11099 - Uploading file from /home/tianpei/IdeaProjects/SWE-agent/tools/review_on_submit_m to /root/tools/review_on_submit_m
2025-12-09 13:47:12,198 - DEBUG - rex-runtime-django__django-11099 - Created zip file at /tmp/tmphlmgvsr2/zipped_transfer.zip
2025-12-09 13:47:15,626 - INFO - swea-tools-django__django-11099 - Resetting tools
2025-12-09 13:47:15,999 - INFO - swea-agent-django__django-11099 - SYSTEM (main)
You are a helpful assistant that can interact with a computer to solve tasks.
2025-12-09 13:47:16,151 - DEBUG - swea-tools-django__django-11099 - Retrieved state from environment: {'working_dir': '/testbed'}
2025-12-09 13:47:16,155 - INFO - swea-agent-django__django-11099 - ðŸ¤– MODEL INPUT
<uploaded_files>
/testbed
</uploaded_files>

I have attached the below csv format content as history bug fix in order for you to understand the repo architecture:

<hist_bugfix>
base_commit,description_of_the_bug_fix,original_script_paths,modification
e3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"
11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model's ``save()`` method will not be called, and the ``pre_save`` and +* The model's ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"
a89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"
846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"
86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"
08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"
e8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"
09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"
a523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."
971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"
3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"
be0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["
7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"
8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."
5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field's custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"
ff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"
b1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"
ee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"
d9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."
14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"
07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\u007f"", ""\\u007F""), +            (""\u0080"", ""\\u0080""), +            (""\u009f"", ""\\u009F""),"
97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""'choices' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""'choices' must be a mapping (e.g. a diction"
e05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f'href=""{self.url}""'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", 'href=""/test.xsl"" type=""text/xsl"" media=""screen""'), -            (""/test.xslt"", 'href=""/test.xslt"" type=""text/xsl"" media=""screen""'), -            (""/test.css"", 'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), 'href=""test.css"" type=""text/css"" media=""screen""' +            str(stylesheet), 'href=""test.css"" media=""screen"" type=""text/css""' +"
b07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"
3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc'd that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"
1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"
5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName('p')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"
35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"
0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            '<legend for=""id_field"" class=""required"">Field:</legend>', +            '<legend class=""required"">Field:</legend>', -            '<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            '<legend for=""id_field_1"">field_1:</legend>', +            ""<legend>field_1:</legend>"", -            '<legend for=""field_2_id"">field_2:</legend>', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            '<div><fieldset><legend for=""id_field"">Field:</legend>' +            ""<div><fieldset><legend>Field:</legend>"" -            '<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            '<div><fieldset><legend for=""id_field_month"">Field:</legend>' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            '<legend for=""id_name"">Title:</legend>', +            ""<legend>Title:</legend>"", -            '<legend for=""id_url"">The URL:</legend>', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            '<legend for=""id_title"">Name:</legend>', +            ""<legend>Name:</legend>"", -            '<legend for=""id_title"">Name:</legend>',"
7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can't change those other methods' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can't chan"
3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, 'database'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"
96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"
1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("
abfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"
5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it's safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"
66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"
a1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"
c0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"
c60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"
6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($('#test').children().first().prop(""tagName""), ""DIV""); -    assert.equal($('#test').children().first().attr(""class""), ""selector""); +    assert.deepEqual("
2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."
fffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"
e78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"
01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""
c135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"
a4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"
c4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"
1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework's work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"
27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"
2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"
796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."
5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"
47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"
6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"
125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                '<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>',"
dfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""
c5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"
6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"
3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"
98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"
c880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"
74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"
e27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "
eaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don't fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don't fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"
8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"
05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"
601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"
340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"
3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"
7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."
348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("
be7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"
adc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"
ab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"
01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that's || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn't include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"
1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"
787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield 'NULL' and [] as its placeholder and params instead -        # of '%s' and [None]. The 'NULL' placeholder is produced earlier by +        # needs to yield 'NULL' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"
43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("
9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""
6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"
ea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("
0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."
c87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn't support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn't accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"
4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"
3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"
6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn't been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"
74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# ' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"
42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"
5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - '3.15-dev' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != 'win32' or python_version < '3.15'"
185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser's -        # output, so tests for particul"
b6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"
548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"
a0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"
9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"
5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"
344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"
ca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"
d506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"
0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"
b1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don't make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"
</hist_bugfix>

I've uploaded a python code repository in the directory /testbed. Consider the following PR description:
<pr_description>
UsernameValidator allows trailing newline in usernames
Description
	
ASCIIUsernameValidator and UnicodeUsernameValidator use the regex 
r'^[\w.@+-]+$'
The intent is to only allow alphanumeric characters as well as ., @, +, and -. However, a little known quirk of Python regexes is that $ will also match a trailing newline. Therefore, the user name validators will accept usernames which end with a newline. You can avoid this behavior by instead using \A and \Z to terminate regexes. For example, the validator regex could be changed to
r'\A[\w.@+-]+\Z'
in order to reject usernames that end with a newline.
I am not sure how to officially post a patch, but the required change is trivial - using the regex above in the two validators in contrib.auth.validators.

</pr_description>

Can you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?
I've already taken care of all changes to any of the test files described in the <pr_description>. This means you DON'T have to modify the testing logic or any of the tests in any way!
Your task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.
Follow these steps to resolve the issue:
1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>
2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error
3. Edit the sourcecode of the repo to resolve the issue
4. Rerun your reproduce script and confirm that the error is fixed!
5. Think about edgecases and make sure your fix handles them as well
Your thinking should be thorough and so it's fine if it's very long.
2025-12-09 13:47:16,157 - INFO - swea-agent-django__django-11099 - ========================= STEP 1 =========================
2025-12-09 13:47:16,157 - DEBUG - swea-lm-django__django-11099 - n_cache_control: 1
2025-12-09 13:47:16,962 - DEBUG - swea-lm-django__django-11099 - Response: ModelResponse(id='chatcmpl-Ckx1wFrsZIW2ndkWrsSLSVGHYbePl', created=1765306036, model='gpt-4.1-mini-2025-04-14', object='chat.completion', system_fingerprint='fp_7abc656409', choices=[Choices(finish_reason='tool_calls', index=0, message=Message(content=None, role='assistant', tool_calls=[ChatCompletionMessageToolCall(function=Function(arguments='{"command":"rg --json \'ASCIIUsernameValidator|UnicodeUsernameValidator\' -p /testbed --json-seq"}', name='bash'), id='call_J7GJ3oMYCbWDX5I8vdqMsgtO', type='function')], function_call=None, provider_specific_fields={'refusal': None}, annotations=[]), provider_specific_fields={})], usage=Usage(completion_tokens=34, prompt_tokens=27225, total_tokens=27259, completion_tokens_details=CompletionTokensDetailsWrapper(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0, text_tokens=None), prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=0, cached_tokens=26368, text_tokens=None, image_tokens=None)), service_tier='default')
2025-12-09 13:47:16,963 - DEBUG - swea-lm-django__django-11099 - input_tokens=26,647, output_tokens=0, instance_cost=0.00, cost=0.00
2025-12-09 13:47:16,963 - DEBUG - swea-lm-django__django-11099 - total_tokens_sent=26,647, total_tokens_received=0, total_cost=1.02, total_api_calls=1
2025-12-09 13:47:16,964 - INFO - swea-agent-django__django-11099 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
rg --json 'ASCIIUsernameValidator|UnicodeUsernameValidator' -p /testbed --json-seq
2025-12-09 13:47:17,238 - DEBUG - swea-tools-django__django-11099 - Retrieved state from environment: {'working_dir': '/testbed'}
2025-12-09 13:47:17,239 - INFO - swea-agent-django__django-11099 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nUsernameValidator allows trailing newline in usernames\nDescription\n\t\nASCIIUsernameValidator and UnicodeUsernameValidator use the regex \nr\'^[\\w.@+-]+$\'\nThe intent is to only allow alphanumeric characters as well as ., @, +, and -. However, a little known quirk of Python regexes is that $ will also match a trailing newline. Therefore, the user name validators will accept usernames which end with a newline. You can avoid this behavior by instead using \\A and \\Z to terminate regexes. For example, the validator regex could be changed to\nr\'\\A[\\w.@+-]+\\Z\'\nin order to reject usernames that end with a newline.\nI am not sure how to officially post a patch, but the required change is trivial - using the regex above in the two validators in contrib.auth.validators.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.', 'cache_control': {'type': 'ephemeral'}}], 'agent': 'main', 'message_type': 'observation'}]
2025-12-09 13:47:17,240 - INFO - swea-agent-django__django-11099 - ðŸ¤– MODEL INPUT
OBSERVATION:
bash: rg: command not found

2025-12-09 13:47:17,241 - INFO - swea-agent-django__django-11099 - ========================= STEP 2 =========================
2025-12-09 13:47:17,242 - DEBUG - swea-lm-django__django-11099 - n_cache_control: 2
2025-12-09 13:47:23,017 - DEBUG - swea-lm-django__django-11099 - Response: ModelResponse(id='chatcmpl-Ckx22dO00OswoNg6is98jbHWPgvwq', created=1765306042, model='gpt-4.1-mini-2025-04-14', object='chat.completion', system_fingerprint='fp_7abc656409', choices=[Choices(finish_reason='tool_calls', index=0, message=Message(content=None, role='assistant', tool_calls=[ChatCompletionMessageToolCall(function=Function(arguments='{"command":"grep -r \'ASCIIUsernameValidator\' /testbed"}', name='bash'), id='call_ZbjCFotvwa2sWaEWdJXNyJS5', type='function')], function_call=None, provider_specific_fields={'refusal': None}, annotations=[]), provider_specific_fields={})], usage=Usage(completion_tokens=24, prompt_tokens=27278, total_tokens=27302, completion_tokens_details=CompletionTokensDetailsWrapper(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0, text_tokens=None), prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=0, cached_tokens=27136, text_tokens=None, image_tokens=None)), service_tier='default')
2025-12-09 13:47:23,019 - DEBUG - swea-lm-django__django-11099 - input_tokens=26,711, output_tokens=0, instance_cost=0.01, cost=0.00
2025-12-09 13:47:23,019 - DEBUG - swea-lm-django__django-11099 - total_tokens_sent=53,358, total_tokens_received=0, total_cost=1.02, total_api_calls=2
2025-12-09 13:47:23,019 - INFO - swea-agent-django__django-11099 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
grep -r 'ASCIIUsernameValidator' /testbed
2025-12-09 13:47:23,796 - DEBUG - swea-tools-django__django-11099 - Retrieved state from environment: {'working_dir': '/testbed'}
2025-12-09 13:47:23,796 - INFO - swea-agent-django__django-11099 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nUsernameValidator allows trailing newline in usernames\nDescription\n\t\nASCIIUsernameValidator and UnicodeUsernameValidator use the regex \nr\'^[\\w.@+-]+$\'\nThe intent is to only allow alphanumeric characters as well as ., @, +, and -. However, a little known quirk of Python regexes is that $ will also match a trailing newline. Therefore, the user name validators will accept usernames which end with a newline. You can avoid this behavior by instead using \\A and \\Z to terminate regexes. For example, the validator regex could be changed to\nr\'\\A[\\w.@+-]+\\Z\'\nin order to reject usernames that end with a newline.\nI am not sure how to officially post a patch, but the required change is trivial - using the regex above in the two validators in contrib.auth.validators.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.', 'cache_control': {'type': 'ephemeral'}}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg --json 'ASCIIUsernameValidator|UnicodeUsernameValidator' -p /testbed --json-seq", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json \'ASCIIUsernameValidator|UnicodeUsernameValidator\' -p /testbed --json-seq"}', 'name': 'bash'}, 'id': 'call_J7GJ3oMYCbWDX5I8vdqMsgtO', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_J7GJ3oMYCbWDX5I8vdqMsgtO'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:47:23,798 - INFO - swea-agent-django__django-11099 - ðŸ¤– MODEL INPUT
OBSERVATION:
/testbed/docs/ref/contrib/auth.txt:            from django.contrib.auth.validators import ASCIIUsernameValidator
/testbed/docs/ref/contrib/auth.txt:                username_validator = ASCIIUsernameValidator()
/testbed/docs/ref/contrib/auth.txt:.. class:: validators.ASCIIUsernameValidator
/testbed/docs/releases/1.10.txt::class:`~django.contrib.auth.validators.ASCIIUsernameValidator` or
/testbed/django/contrib/auth/validators.py:class ASCIIUsernameValidator(validators.RegexValidator):
/testbed/tests/auth_tests/test_validators.py:        v = validators.ASCIIUsernameValidator()

2025-12-09 13:47:23,801 - INFO - swea-agent-django__django-11099 - ========================= STEP 3 =========================
2025-12-09 13:47:23,802 - DEBUG - swea-lm-django__django-11099 - n_cache_control: 2
2025-12-09 13:47:31,376 - DEBUG - swea-lm-django__django-11099 - Response: ModelResponse(id='chatcmpl-Ckx2A3ytAGfaV6FxzOWWkK2uJg5KX', created=1765306050, model='gpt-4.1-mini-2025-04-14', object='chat.completion', system_fingerprint='fp_7abc656409', choices=[Choices(finish_reason='tool_calls', index=0, message=Message(content=None, role='assistant', tool_calls=[ChatCompletionMessageToolCall(function=Function(arguments='{"command":"head -40 /testbed/django/contrib/auth/validators.py"}', name='bash'), id='call_SMj3oIloVNnrJznWZMPtfV2N', type='function')], function_call=None, provider_specific_fields={'refusal': None}, annotations=[]), provider_specific_fields={})], usage=Usage(completion_tokens=27, prompt_tokens=27433, total_tokens=27460, completion_tokens_details=CompletionTokensDetailsWrapper(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0, text_tokens=None), prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=0, cached_tokens=27264, text_tokens=None, image_tokens=None)), service_tier='default')
2025-12-09 13:47:31,378 - DEBUG - swea-lm-django__django-11099 - input_tokens=26,874, output_tokens=0, instance_cost=0.01, cost=0.00
2025-12-09 13:47:31,378 - DEBUG - swea-lm-django__django-11099 - total_tokens_sent=80,232, total_tokens_received=0, total_cost=1.02, total_api_calls=3
2025-12-09 13:47:31,378 - INFO - swea-agent-django__django-11099 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
head -40 /testbed/django/contrib/auth/validators.py
2025-12-09 13:47:31,655 - DEBUG - swea-tools-django__django-11099 - Retrieved state from environment: {'working_dir': '/testbed'}
2025-12-09 13:47:31,655 - INFO - swea-agent-django__django-11099 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nUsernameValidator allows trailing newline in usernames\nDescription\n\t\nASCIIUsernameValidator and UnicodeUsernameValidator use the regex \nr\'^[\\w.@+-]+$\'\nThe intent is to only allow alphanumeric characters as well as ., @, +, and -. However, a little known quirk of Python regexes is that $ will also match a trailing newline. Therefore, the user name validators will accept usernames which end with a newline. You can avoid this behavior by instead using \\A and \\Z to terminate regexes. For example, the validator regex could be changed to\nr\'\\A[\\w.@+-]+\\Z\'\nin order to reject usernames that end with a newline.\nI am not sure how to officially post a patch, but the required change is trivial - using the regex above in the two validators in contrib.auth.validators.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg --json 'ASCIIUsernameValidator|UnicodeUsernameValidator' -p /testbed --json-seq", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json \'ASCIIUsernameValidator|UnicodeUsernameValidator\' -p /testbed --json-seq"}', 'name': 'bash'}, 'id': 'call_J7GJ3oMYCbWDX5I8vdqMsgtO', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_J7GJ3oMYCbWDX5I8vdqMsgtO'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "grep -r 'ASCIIUsernameValidator' /testbed", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r \'ASCIIUsernameValidator\' /testbed"}', 'name': 'bash'}, 'id': 'call_ZbjCFotvwa2sWaEWdJXNyJS5', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n/testbed/docs/ref/contrib/auth.txt:            from django.contrib.auth.validators import ASCIIUsernameValidator\n/testbed/docs/ref/contrib/auth.txt:                username_validator = ASCIIUsernameValidator()\n/testbed/docs/ref/contrib/auth.txt:.. class:: validators.ASCIIUsernameValidator\n/testbed/docs/releases/1.10.txt::class:`~django.contrib.auth.validators.ASCIIUsernameValidator` or\n/testbed/django/contrib/auth/validators.py:class ASCIIUsernameValidator(validators.RegexValidator):\n/testbed/tests/auth_tests/test_validators.py:        v = validators.ASCIIUsernameValidator()\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_ZbjCFotvwa2sWaEWdJXNyJS5'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:47:31,656 - INFO - swea-agent-django__django-11099 - ðŸ¤– MODEL INPUT
OBSERVATION:
import re

from django.core import validators
from django.utils.deconstruct import deconstructible
from django.utils.translation import gettext_lazy as _


@deconstructible
class ASCIIUsernameValidator(validators.RegexValidator):
    regex = r'^[\w.@+-]+$'
    message = _(
        'Enter a valid username. This value may contain only English letters, '
        'numbers, and @/./+/-/_ characters.'
    )
    flags = re.ASCII


@deconstructible
class UnicodeUsernameValidator(validators.RegexValidator):
    regex = r'^[\w.@+-]+$'
    message = _(
        'Enter a valid username. This value may contain only letters, '
        'numbers, and @/./+/-/_ characters.'
    )
    flags = 0

2025-12-09 13:47:31,659 - INFO - swea-agent-django__django-11099 - ========================= STEP 4 =========================
2025-12-09 13:47:31,661 - DEBUG - swea-lm-django__django-11099 - n_cache_control: 2
2025-12-09 13:47:46,198 - DEBUG - swea-lm-django__django-11099 - Response: ModelResponse(id='chatcmpl-Ckx2JR6SCNzBHdC9Vvr5Qi7T3NbBv', created=1765306059, model='gpt-4.1-mini-2025-04-14', object='chat.completion', system_fingerprint='fp_7abc656409', choices=[Choices(finish_reason='tool_calls', index=0, message=Message(content="The issue described in the PR is that the regex used in ASCIIUsernameValidator and UnicodeUsernameValidator allows trailing newlines because the $ in regex matches the end of the string or just before the newline at the end of the string.\n\nThe fix is to replace the regex pattern from r'^[\\w.@+-]+$' to r'\\\\A[\\\\w.@+-]+\\\\Z' in both ASCIIUsernameValidator and UnicodeUsernameValidator classes.\n\nI will now proceed to make this change in the file /testbed/django/contrib/auth/validators.py.", role='assistant', tool_calls=[ChatCompletionMessageToolCall(function=Function(arguments='{"command":"str_replace","path":"/testbed/django/contrib/auth/validators.py","old_str":"class ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'^[\\\\w.@+-]+$\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only English letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = re.ASCII\\n\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'^[\\\\w.@+-]+$\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = 0","new_str":"class ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only English letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = re.ASCII\\n\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = 0"}', name='str_replace_editor'), id='call_JYqxO1MgLsIHZqR1qvM9AAut', type='function')], function_call=None, provider_specific_fields={'refusal': None}, annotations=[]), provider_specific_fields={})], usage=Usage(completion_tokens=462, prompt_tokens=27638, total_tokens=28100, completion_tokens_details=CompletionTokensDetailsWrapper(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0, text_tokens=None), prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=0, cached_tokens=27392, text_tokens=None, image_tokens=None)), service_tier='default')
2025-12-09 13:47:46,200 - DEBUG - swea-lm-django__django-11099 - input_tokens=27,089, output_tokens=113, instance_cost=0.01, cost=0.00
2025-12-09 13:47:46,200 - DEBUG - swea-lm-django__django-11099 - total_tokens_sent=107,321, total_tokens_received=113, total_cost=1.03, total_api_calls=4
2025-12-09 13:47:46,202 - INFO - swea-agent-django__django-11099 - ðŸ’­ THOUGHT
The issue described in the PR is that the regex used in ASCIIUsernameValidator and UnicodeUsernameValidator allows trailing newlines because the $ in regex matches the end of the string or just before the newline at the end of the string.

The fix is to replace the regex pattern from r'^[\w.@+-]+$' to r'\\A[\\w.@+-]+\\Z' in both ASCIIUsernameValidator and UnicodeUsernameValidator classes.

I will now proceed to make this change in the file /testbed/django/contrib/auth/validators.py.

ðŸŽ¬ ACTION
str_replace_editor str_replace /testbed/django/contrib/auth/validators.py   --old_str 'class ASCIIUsernameValidator(validators.RegexValidator):
    regex = r'"'"'^[\w.@+-]+$'"'"'
    message = _(
        '"'"'Enter a valid username. This value may contain only English letters, '"'"'
        '"'"'numbers, and @/./+/-/_ characters.'"'"'
    )
    flags = re.ASCII


@deconstructible
class UnicodeUsernameValidator(validators.RegexValidator):
    regex = r'"'"'^[\w.@+-]+$'"'"'
    message = _(
        '"'"'Enter a valid username. This value may contain only letters, '"'"'
        '"'"'numbers, and @/./+/-/_ characters.'"'"'
    )
    flags = 0' --new_str 'class ASCIIUsernameValidator(validators.RegexValidator):
    regex = r'"'"'\A[\w.@+-]+\Z'"'"'
    message = _(
        '"'"'Enter a valid username. This value may contain only English letters, '"'"'
        '"'"'numbers, and @/./+/-/_ characters.'"'"'
    )
    flags = re.ASCII


@deconstructible
class UnicodeUsernameValidator(validators.RegexValidator):
    regex = r'"'"'\A[\w.@+-]+\Z'"'"'
    message = _(
        '"'"'Enter a valid username. This value may contain only letters, '"'"'
        '"'"'numbers, and @/./+/-/_ characters.'"'"'
    )
    flags = 0'
2025-12-09 13:47:46,534 - DEBUG - swea-tools-django__django-11099 - Retrieved state from environment: {'working_dir': '/testbed'}
2025-12-09 13:47:46,535 - INFO - swea-agent-django__django-11099 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nUsernameValidator allows trailing newline in usernames\nDescription\n\t\nASCIIUsernameValidator and UnicodeUsernameValidator use the regex \nr\'^[\\w.@+-]+$\'\nThe intent is to only allow alphanumeric characters as well as ., @, +, and -. However, a little known quirk of Python regexes is that $ will also match a trailing newline. Therefore, the user name validators will accept usernames which end with a newline. You can avoid this behavior by instead using \\A and \\Z to terminate regexes. For example, the validator regex could be changed to\nr\'\\A[\\w.@+-]+\\Z\'\nin order to reject usernames that end with a newline.\nI am not sure how to officially post a patch, but the required change is trivial - using the regex above in the two validators in contrib.auth.validators.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg --json 'ASCIIUsernameValidator|UnicodeUsernameValidator' -p /testbed --json-seq", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json \'ASCIIUsernameValidator|UnicodeUsernameValidator\' -p /testbed --json-seq"}', 'name': 'bash'}, 'id': 'call_J7GJ3oMYCbWDX5I8vdqMsgtO', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_J7GJ3oMYCbWDX5I8vdqMsgtO']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "grep -r 'ASCIIUsernameValidator' /testbed", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r \'ASCIIUsernameValidator\' /testbed"}', 'name': 'bash'}, 'id': 'call_ZbjCFotvwa2sWaEWdJXNyJS5', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n/testbed/docs/ref/contrib/auth.txt:            from django.contrib.auth.validators import ASCIIUsernameValidator\n/testbed/docs/ref/contrib/auth.txt:                username_validator = ASCIIUsernameValidator()\n/testbed/docs/ref/contrib/auth.txt:.. class:: validators.ASCIIUsernameValidator\n/testbed/docs/releases/1.10.txt::class:`~django.contrib.auth.validators.ASCIIUsernameValidator` or\n/testbed/django/contrib/auth/validators.py:class ASCIIUsernameValidator(validators.RegexValidator):\n/testbed/tests/auth_tests/test_validators.py:        v = validators.ASCIIUsernameValidator()\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_ZbjCFotvwa2sWaEWdJXNyJS5'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/contrib/auth/validators.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/contrib/auth/validators.py"}', 'name': 'bash'}, 'id': 'call_SMj3oIloVNnrJznWZMPtfV2N', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nimport re\n\nfrom django.core import validators\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.translation import gettext_lazy as _\n\n\n@deconstructible\nclass ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r'^[\\w.@+-]+$'\n    message = _(\n        'Enter a valid username. This value may contain only English letters, '\n        'numbers, and @/./+/-/_ characters.'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r'^[\\w.@+-]+$'\n    message = _(\n        'Enter a valid username. This value may contain only letters, '\n        'numbers, and @/./+/-/_ characters.'\n    )\n    flags = 0\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_SMj3oIloVNnrJznWZMPtfV2N'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:47:46,536 - INFO - swea-agent-django__django-11099 - ðŸ¤– MODEL INPUT
OBSERVATION:
The file /testbed/django/contrib/auth/validators.py has been edited. Here's the result of running `cat -n` on a snippet of /testbed/django/contrib/auth/validators.py:
     4	from django.utils.deconstruct import deconstructible
     5	from django.utils.translation import gettext_lazy as _
     6	
     7	
     8	@deconstructible
     9	class ASCIIUsernameValidator(validators.RegexValidator):
    10	    regex = r'\A[\w.@+-]+\Z'
    11	    message = _(
    12	        'Enter a valid username. This value may contain only English letters, '
    13	        'numbers, and @/./+/-/_ characters.'
    14	    )
    15	    flags = re.ASCII
    16	
    17	
    18	@deconstructible
    19	class UnicodeUsernameValidator(validators.RegexValidator):
    20	    regex = r'\A[\w.@+-]+\Z'
    21	    message = _(
    22	        'Enter a valid username. This value may contain only letters, '
    23	        'numbers, and @/./+/-/_ characters.'
    24	    )
    25	    flags = 0
Review the changes and make sure they are as expected. Edit the file again if necessary.

2025-12-09 13:47:46,540 - INFO - swea-agent-django__django-11099 - ========================= STEP 5 =========================
2025-12-09 13:47:46,541 - DEBUG - swea-lm-django__django-11099 - n_cache_control: 2
2025-12-09 13:47:52,378 - DEBUG - swea-lm-django__django-11099 - Response: ModelResponse(id='chatcmpl-Ckx2QFUBnD2QSVZHyL69B7aI9eWrr', created=1765306066, model='gpt-4.1-mini-2025-04-14', object='chat.completion', system_fingerprint='fp_7abc656409', choices=[Choices(finish_reason='tool_calls', index=0, message=Message(content=None, role='assistant', tool_calls=[ChatCompletionMessageToolCall(function=Function(arguments='{"command":"echo \\"import re\\nfrom django.core import validators\\nfrom django.utils.deconstruct import deconstructible\\nfrom django.utils.translation import gettext_lazy as _\\n\\n@deconstructible\\nclass ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\'Enter a valid username. This value may contain only English letters, numbers, and @/./+/-/_ characters.\')\\n    flags = re.ASCII\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\'Enter a valid username. This value may contain only letters, numbers, and @/./+/-/_ characters.\')\\n    flags = 0\\n\\n# Test code to verify the regex behavior\\nif __name__ == \'__main__\':\\n    import re\\n\\n    ascii_validator = ASCIIUsernameValidator()\\n    unicode_validator = UnicodeUsernameValidator()\\n\\n    test_usernames = [\\n        \'validusername\',\\n        \'valid.username\',\\n        \'valid@username\',\\n        \'valid+username\',\\n        \'valid-username\',\\n        \'valid_username\',\\n        \'invalidusername\\\\n\',\\n        \'invalidusername\\\\r\\\\n\',\\n        \'invalidusername\\\\n \',\\n        \'invalidusername \',\\n    ]\\n\\n    print(\'Testing ASCIIUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\n    print(\'\\\\nTesting UnicodeUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\" > /testbed/test_username_validator.py"}', name='bash'), id='call_U2yq9YRzm9PEfOxxo9zlvpkv', type='function')], function_call=None, provider_specific_fields={'refusal': None}, annotations=[]), provider_specific_fields={})], usage=Usage(completion_tokens=469, prompt_tokens=28406, total_tokens=28875, completion_tokens_details=CompletionTokensDetailsWrapper(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0, text_tokens=None), prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=0, cached_tokens=28032, text_tokens=None, image_tokens=None)), service_tier='default')
2025-12-09 13:47:52,380 - DEBUG - swea-lm-django__django-11099 - input_tokens=27,861, output_tokens=0, instance_cost=0.02, cost=0.00
2025-12-09 13:47:52,380 - DEBUG - swea-lm-django__django-11099 - total_tokens_sent=135,182, total_tokens_received=113, total_cost=1.03, total_api_calls=5
2025-12-09 13:47:52,380 - INFO - swea-agent-django__django-11099 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
echo "import re
from django.core import validators
from django.utils.deconstruct import deconstructible
from django.utils.translation import gettext_lazy as _

@deconstructible
class ASCIIUsernameValidator(validators.RegexValidator):
    regex = r'\A[\w.@+-]+\Z'
    message = _('Enter a valid username. This value may contain only English letters, numbers, and @/./+/-/_ characters.')
    flags = re.ASCII

@deconstructible
class UnicodeUsernameValidator(validators.RegexValidator):
    regex = r'\A[\w.@+-]+\Z'
    message = _('Enter a valid username. This value may contain only letters, numbers, and @/./+/-/_ characters.')
    flags = 0

# Test code to verify the regex behavior
if __name__ == '__main__':
    import re

    ascii_validator = ASCIIUsernameValidator()
    unicode_validator = UnicodeUsernameValidator()

    test_usernames = [
        'validusername',
        'valid.username',
        'valid@username',
        'valid+username',
        'valid-username',
        'valid_username',
        'invalidusername\n',
        'invalidusername\r\n',
        'invalidusername\n ',
        'invalidusername ',
    ]

    print('Testing ASCIIUsernameValidator:')
    for username in test_usernames:
        if re.match(ascii_validator.regex, username, ascii_validator.flags):
            print(f'Valid: {repr(username)}')
        else:
            print(f'Invalid: {repr(username)}')

    print('\nTesting UnicodeUsernameValidator:')
    for username in test_usernames:
        if re.match(unicode_validator.regex, username, unicode_validator.flags):
            print(f'Valid: {repr(username)}')
        else:
            print(f'Invalid: {repr(username)}')
" > /testbed/test_username_validator.py
2025-12-09 13:47:52,656 - DEBUG - swea-tools-django__django-11099 - Retrieved state from environment: {'working_dir': '/testbed'}
2025-12-09 13:47:52,662 - INFO - swea-agent-django__django-11099 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nUsernameValidator allows trailing newline in usernames\nDescription\n\t\nASCIIUsernameValidator and UnicodeUsernameValidator use the regex \nr\'^[\\w.@+-]+$\'\nThe intent is to only allow alphanumeric characters as well as ., @, +, and -. However, a little known quirk of Python regexes is that $ will also match a trailing newline. Therefore, the user name validators will accept usernames which end with a newline. You can avoid this behavior by instead using \\A and \\Z to terminate regexes. For example, the validator regex could be changed to\nr\'\\A[\\w.@+-]+\\Z\'\nin order to reject usernames that end with a newline.\nI am not sure how to officially post a patch, but the required change is trivial - using the regex above in the two validators in contrib.auth.validators.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg --json 'ASCIIUsernameValidator|UnicodeUsernameValidator' -p /testbed --json-seq", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json \'ASCIIUsernameValidator|UnicodeUsernameValidator\' -p /testbed --json-seq"}', 'name': 'bash'}, 'id': 'call_J7GJ3oMYCbWDX5I8vdqMsgtO', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_J7GJ3oMYCbWDX5I8vdqMsgtO']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "grep -r 'ASCIIUsernameValidator' /testbed", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r \'ASCIIUsernameValidator\' /testbed"}', 'name': 'bash'}, 'id': 'call_ZbjCFotvwa2sWaEWdJXNyJS5', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n/testbed/docs/ref/contrib/auth.txt:            from django.contrib.auth.validators import ASCIIUsernameValidator\n/testbed/docs/ref/contrib/auth.txt:                username_validator = ASCIIUsernameValidator()\n/testbed/docs/ref/contrib/auth.txt:.. class:: validators.ASCIIUsernameValidator\n/testbed/docs/releases/1.10.txt::class:`~django.contrib.auth.validators.ASCIIUsernameValidator` or\n/testbed/django/contrib/auth/validators.py:class ASCIIUsernameValidator(validators.RegexValidator):\n/testbed/tests/auth_tests/test_validators.py:        v = validators.ASCIIUsernameValidator()\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_ZbjCFotvwa2sWaEWdJXNyJS5']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/contrib/auth/validators.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/contrib/auth/validators.py"}', 'name': 'bash'}, 'id': 'call_SMj3oIloVNnrJznWZMPtfV2N', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nimport re\n\nfrom django.core import validators\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.translation import gettext_lazy as _\n\n\n@deconstructible\nclass ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r'^[\\w.@+-]+$'\n    message = _(\n        'Enter a valid username. This value may contain only English letters, '\n        'numbers, and @/./+/-/_ characters.'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r'^[\\w.@+-]+$'\n    message = _(\n        'Enter a valid username. This value may contain only letters, '\n        'numbers, and @/./+/-/_ characters.'\n    )\n    flags = 0\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_SMj3oIloVNnrJznWZMPtfV2N'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': "The issue described in the PR is that the regex used in ASCIIUsernameValidator and UnicodeUsernameValidator allows trailing newlines because the $ in regex matches the end of the string or just before the newline at the end of the string.\n\nThe fix is to replace the regex pattern from r'^[\\w.@+-]+$' to r'\\\\A[\\\\w.@+-]+\\\\Z' in both ASCIIUsernameValidator and UnicodeUsernameValidator classes.\n\nI will now proceed to make this change in the file /testbed/django/contrib/auth/validators.py.", 'thought': "The issue described in the PR is that the regex used in ASCIIUsernameValidator and UnicodeUsernameValidator allows trailing newlines because the $ in regex matches the end of the string or just before the newline at the end of the string.\n\nThe fix is to replace the regex pattern from r'^[\\w.@+-]+$' to r'\\\\A[\\\\w.@+-]+\\\\Z' in both ASCIIUsernameValidator and UnicodeUsernameValidator classes.\n\nI will now proceed to make this change in the file /testbed/django/contrib/auth/validators.py.", 'action': 'str_replace_editor str_replace /testbed/django/contrib/auth/validators.py   --old_str \'class ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'^[\\w.@+-]+$\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only English letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'^[\\w.@+-]+$\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = 0\' --new_str \'class ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'\\A[\\w.@+-]+\\Z\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only English letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'\\A[\\w.@+-]+\\Z\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = 0\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/django/contrib/auth/validators.py","old_str":"class ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'^[\\\\w.@+-]+$\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only English letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = re.ASCII\\n\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'^[\\\\w.@+-]+$\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = 0","new_str":"class ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only English letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = re.ASCII\\n\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = 0"}', 'name': 'str_replace_editor'}, 'id': 'call_JYqxO1MgLsIHZqR1qvM9AAut', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/django/contrib/auth/validators.py has been edited. Here's the result of running `cat -n` on a snippet of /testbed/django/contrib/auth/validators.py:\n     4\tfrom django.utils.deconstruct import deconstructible\n     5\tfrom django.utils.translation import gettext_lazy as _\n     6\t\n     7\t\n     8\t@deconstructible\n     9\tclass ASCIIUsernameValidator(validators.RegexValidator):\n    10\t    regex = r'\\A[\\w.@+-]+\\Z'\n    11\t    message = _(\n    12\t        'Enter a valid username. This value may contain only English letters, '\n    13\t        'numbers, and @/./+/-/_ characters.'\n    14\t    )\n    15\t    flags = re.ASCII\n    16\t\n    17\t\n    18\t@deconstructible\n    19\tclass UnicodeUsernameValidator(validators.RegexValidator):\n    20\t    regex = r'\\A[\\w.@+-]+\\Z'\n    21\t    message = _(\n    22\t        'Enter a valid username. This value may contain only letters, '\n    23\t        'numbers, and @/./+/-/_ characters.'\n    24\t    )\n    25\t    flags = 0\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_JYqxO1MgLsIHZqR1qvM9AAut'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:47:52,663 - INFO - swea-agent-django__django-11099 - ðŸ¤– MODEL INPUT
Your command ran successfully and did not produce any output.
2025-12-09 13:47:52,667 - INFO - swea-agent-django__django-11099 - ========================= STEP 6 =========================
2025-12-09 13:47:52,668 - DEBUG - swea-lm-django__django-11099 - n_cache_control: 2
2025-12-09 13:47:56,772 - DEBUG - swea-lm-django__django-11099 - Response: ModelResponse(id='chatcmpl-Ckx2asBOfYp6PWbWc0KeZNZ2oevS8', created=1765306076, model='gpt-4.1-mini-2025-04-14', object='chat.completion', system_fingerprint='fp_7abc656409', choices=[Choices(finish_reason='tool_calls', index=0, message=Message(content=None, role='assistant', tool_calls=[ChatCompletionMessageToolCall(function=Function(arguments='{"command":"python3 /testbed/test_username_validator.py"}', name='bash'), id='call_hW1YxOF8W4LREApTv7LuKrOw', type='function')], function_call=None, provider_specific_fields={'refusal': None}, annotations=[]), provider_specific_fields={})], usage=Usage(completion_tokens=22, prompt_tokens=28893, total_tokens=28915, completion_tokens_details=CompletionTokensDetailsWrapper(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0, text_tokens=None), prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=0, cached_tokens=28800, text_tokens=None, image_tokens=None)), service_tier='default')
2025-12-09 13:47:56,774 - DEBUG - swea-lm-django__django-11099 - input_tokens=28,359, output_tokens=0, instance_cost=0.02, cost=0.00
2025-12-09 13:47:56,774 - DEBUG - swea-lm-django__django-11099 - total_tokens_sent=163,541, total_tokens_received=113, total_cost=1.03, total_api_calls=6
2025-12-09 13:47:56,774 - INFO - swea-agent-django__django-11099 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
python3 /testbed/test_username_validator.py
2025-12-09 13:47:57,150 - DEBUG - swea-tools-django__django-11099 - Retrieved state from environment: {'working_dir': '/testbed'}
2025-12-09 13:47:57,151 - INFO - swea-agent-django__django-11099 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nUsernameValidator allows trailing newline in usernames\nDescription\n\t\nASCIIUsernameValidator and UnicodeUsernameValidator use the regex \nr\'^[\\w.@+-]+$\'\nThe intent is to only allow alphanumeric characters as well as ., @, +, and -. However, a little known quirk of Python regexes is that $ will also match a trailing newline. Therefore, the user name validators will accept usernames which end with a newline. You can avoid this behavior by instead using \\A and \\Z to terminate regexes. For example, the validator regex could be changed to\nr\'\\A[\\w.@+-]+\\Z\'\nin order to reject usernames that end with a newline.\nI am not sure how to officially post a patch, but the required change is trivial - using the regex above in the two validators in contrib.auth.validators.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg --json 'ASCIIUsernameValidator|UnicodeUsernameValidator' -p /testbed --json-seq", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json \'ASCIIUsernameValidator|UnicodeUsernameValidator\' -p /testbed --json-seq"}', 'name': 'bash'}, 'id': 'call_J7GJ3oMYCbWDX5I8vdqMsgtO', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_J7GJ3oMYCbWDX5I8vdqMsgtO']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "grep -r 'ASCIIUsernameValidator' /testbed", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r \'ASCIIUsernameValidator\' /testbed"}', 'name': 'bash'}, 'id': 'call_ZbjCFotvwa2sWaEWdJXNyJS5', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n/testbed/docs/ref/contrib/auth.txt:            from django.contrib.auth.validators import ASCIIUsernameValidator\n/testbed/docs/ref/contrib/auth.txt:                username_validator = ASCIIUsernameValidator()\n/testbed/docs/ref/contrib/auth.txt:.. class:: validators.ASCIIUsernameValidator\n/testbed/docs/releases/1.10.txt::class:`~django.contrib.auth.validators.ASCIIUsernameValidator` or\n/testbed/django/contrib/auth/validators.py:class ASCIIUsernameValidator(validators.RegexValidator):\n/testbed/tests/auth_tests/test_validators.py:        v = validators.ASCIIUsernameValidator()\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_ZbjCFotvwa2sWaEWdJXNyJS5']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/contrib/auth/validators.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/contrib/auth/validators.py"}', 'name': 'bash'}, 'id': 'call_SMj3oIloVNnrJznWZMPtfV2N', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nimport re\n\nfrom django.core import validators\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.translation import gettext_lazy as _\n\n\n@deconstructible\nclass ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r'^[\\w.@+-]+$'\n    message = _(\n        'Enter a valid username. This value may contain only English letters, '\n        'numbers, and @/./+/-/_ characters.'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r'^[\\w.@+-]+$'\n    message = _(\n        'Enter a valid username. This value may contain only letters, '\n        'numbers, and @/./+/-/_ characters.'\n    )\n    flags = 0\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_SMj3oIloVNnrJznWZMPtfV2N']}, {'role': 'assistant', 'content': "The issue described in the PR is that the regex used in ASCIIUsernameValidator and UnicodeUsernameValidator allows trailing newlines because the $ in regex matches the end of the string or just before the newline at the end of the string.\n\nThe fix is to replace the regex pattern from r'^[\\w.@+-]+$' to r'\\\\A[\\\\w.@+-]+\\\\Z' in both ASCIIUsernameValidator and UnicodeUsernameValidator classes.\n\nI will now proceed to make this change in the file /testbed/django/contrib/auth/validators.py.", 'thought': "The issue described in the PR is that the regex used in ASCIIUsernameValidator and UnicodeUsernameValidator allows trailing newlines because the $ in regex matches the end of the string or just before the newline at the end of the string.\n\nThe fix is to replace the regex pattern from r'^[\\w.@+-]+$' to r'\\\\A[\\\\w.@+-]+\\\\Z' in both ASCIIUsernameValidator and UnicodeUsernameValidator classes.\n\nI will now proceed to make this change in the file /testbed/django/contrib/auth/validators.py.", 'action': 'str_replace_editor str_replace /testbed/django/contrib/auth/validators.py   --old_str \'class ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'^[\\w.@+-]+$\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only English letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'^[\\w.@+-]+$\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = 0\' --new_str \'class ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'\\A[\\w.@+-]+\\Z\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only English letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'\\A[\\w.@+-]+\\Z\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = 0\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/django/contrib/auth/validators.py","old_str":"class ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'^[\\\\w.@+-]+$\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only English letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = re.ASCII\\n\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'^[\\\\w.@+-]+$\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = 0","new_str":"class ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only English letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = re.ASCII\\n\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = 0"}', 'name': 'str_replace_editor'}, 'id': 'call_JYqxO1MgLsIHZqR1qvM9AAut', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/django/contrib/auth/validators.py has been edited. Here's the result of running `cat -n` on a snippet of /testbed/django/contrib/auth/validators.py:\n     4\tfrom django.utils.deconstruct import deconstructible\n     5\tfrom django.utils.translation import gettext_lazy as _\n     6\t\n     7\t\n     8\t@deconstructible\n     9\tclass ASCIIUsernameValidator(validators.RegexValidator):\n    10\t    regex = r'\\A[\\w.@+-]+\\Z'\n    11\t    message = _(\n    12\t        'Enter a valid username. This value may contain only English letters, '\n    13\t        'numbers, and @/./+/-/_ characters.'\n    14\t    )\n    15\t    flags = re.ASCII\n    16\t\n    17\t\n    18\t@deconstructible\n    19\tclass UnicodeUsernameValidator(validators.RegexValidator):\n    20\t    regex = r'\\A[\\w.@+-]+\\Z'\n    21\t    message = _(\n    22\t        'Enter a valid username. This value may contain only letters, '\n    23\t        'numbers, and @/./+/-/_ characters.'\n    24\t    )\n    25\t    flags = 0\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_JYqxO1MgLsIHZqR1qvM9AAut'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'echo "import re\nfrom django.core import validators\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.translation import gettext_lazy as _\n\n@deconstructible\nclass ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'\\A[\\w.@+-]+\\Z\'\n    message = _(\'Enter a valid username. This value may contain only English letters, numbers, and @/./+/-/_ characters.\')\n    flags = re.ASCII\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'\\A[\\w.@+-]+\\Z\'\n    message = _(\'Enter a valid username. This value may contain only letters, numbers, and @/./+/-/_ characters.\')\n    flags = 0\n\n# Test code to verify the regex behavior\nif __name__ == \'__main__\':\n    import re\n\n    ascii_validator = ASCIIUsernameValidator()\n    unicode_validator = UnicodeUsernameValidator()\n\n    test_usernames = [\n        \'validusername\',\n        \'valid.username\',\n        \'valid@username\',\n        \'valid+username\',\n        \'valid-username\',\n        \'valid_username\',\n        \'invalidusername\\n\',\n        \'invalidusername\\r\\n\',\n        \'invalidusername\\n \',\n        \'invalidusername \',\n    ]\n\n    print(\'Testing ASCIIUsernameValidator:\')\n    for username in test_usernames:\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\n            print(f\'Valid: {repr(username)}\')\n        else:\n            print(f\'Invalid: {repr(username)}\')\n\n    print(\'\\nTesting UnicodeUsernameValidator:\')\n    for username in test_usernames:\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\n            print(f\'Valid: {repr(username)}\')\n        else:\n            print(f\'Invalid: {repr(username)}\')\n" > /testbed/test_username_validator.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"echo \\"import re\\nfrom django.core import validators\\nfrom django.utils.deconstruct import deconstructible\\nfrom django.utils.translation import gettext_lazy as _\\n\\n@deconstructible\\nclass ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\'Enter a valid username. This value may contain only English letters, numbers, and @/./+/-/_ characters.\')\\n    flags = re.ASCII\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\'Enter a valid username. This value may contain only letters, numbers, and @/./+/-/_ characters.\')\\n    flags = 0\\n\\n# Test code to verify the regex behavior\\nif __name__ == \'__main__\':\\n    import re\\n\\n    ascii_validator = ASCIIUsernameValidator()\\n    unicode_validator = UnicodeUsernameValidator()\\n\\n    test_usernames = [\\n        \'validusername\',\\n        \'valid.username\',\\n        \'valid@username\',\\n        \'valid+username\',\\n        \'valid-username\',\\n        \'valid_username\',\\n        \'invalidusername\\\\n\',\\n        \'invalidusername\\\\r\\\\n\',\\n        \'invalidusername\\\\n \',\\n        \'invalidusername \',\\n    ]\\n\\n    print(\'Testing ASCIIUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\n    print(\'\\\\nTesting UnicodeUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\" > /testbed/test_username_validator.py"}', 'name': 'bash'}, 'id': 'call_U2yq9YRzm9PEfOxxo9zlvpkv', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'Your command ran successfully and did not produce any output.'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_U2yq9YRzm9PEfOxxo9zlvpkv'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:47:57,152 - INFO - swea-agent-django__django-11099 - ðŸ¤– MODEL INPUT
OBSERVATION:
Testing ASCIIUsernameValidator:
Traceback (most recent call last):
  File "/testbed/test_username_validator.py", line 40, in <module>
    if re.match(ascii_validator.regex, username, ascii_validator.flags):
  File "/opt/miniconda3/envs/testbed/lib/python3.6/re.py", line 172, in match
    return _compile(pattern, flags).match(string)
  File "/opt/miniconda3/envs/testbed/lib/python3.6/re.py", line 297, in _compile
    "cannot process flags argument with a compiled pattern")
ValueError: cannot process flags argument with a compiled pattern

2025-12-09 13:47:57,158 - INFO - swea-agent-django__django-11099 - ========================= STEP 7 =========================
2025-12-09 13:47:57,159 - DEBUG - swea-lm-django__django-11099 - n_cache_control: 2
2025-12-09 13:48:10,247 - DEBUG - swea-lm-django__django-11099 - Response: ModelResponse(id='chatcmpl-Ckx2j7Df5riqilegqwahglkdiF1xn', created=1765306085, model='gpt-4.1-mini-2025-04-14', object='chat.completion', system_fingerprint='fp_7abc656409', choices=[Choices(finish_reason='tool_calls', index=0, message=Message(content='The error "ValueError: cannot process flags argument with a compiled pattern" occurs because the regex attribute in the validators is already a compiled regex pattern (likely compiled by RegexValidator), and passing flags again to re.match is causing the error.\n\nTo fix this, I will modify the test code to use the validator\'s own validation method instead of directly using re.match with the regex and flags. The RegexValidator class has a __call__ method that can be used to validate a value.\n\nI will update the test script to use the validator instances directly to validate the usernames.', role='assistant', tool_calls=[ChatCompletionMessageToolCall(function=Function(arguments='{"command":"str_replace","path":"/testbed/test_username_validator.py","old_str":"    print(\'Testing ASCIIUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\n    print(\'\\\\nTesting UnicodeUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')","new_str":"    print(\'Testing ASCIIUsernameValidator:\')\\n    for username in test_usernames:\\n        try:\\n            ascii_validator(username)\\n            print(f\'Valid: {repr(username)}\')\\n        except Exception:\\n            print(f\'Invalid: {repr(username)}\')\\n\\n    print(\'\\\\nTesting UnicodeUsernameValidator:\')\\n    for username in test_usernames:\\n        try:\\n            unicode_validator(username)\\n            print(f\'Valid: {repr(username)}\')\\n        except Exception:\\n            print(f\'Invalid: {repr(username)}\')"}', name='str_replace_editor'), id='call_mVQy1JaQ1R1iJ3leHcNyOiMI', type='function')], function_call=None, provider_specific_fields={'refusal': None}, annotations=[]), provider_specific_fields={})], usage=Usage(completion_tokens=405, prompt_tokens=29061, total_tokens=29466, completion_tokens_details=CompletionTokensDetailsWrapper(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0, text_tokens=None), prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=0, cached_tokens=28800, text_tokens=None, image_tokens=None)), service_tier='default')
2025-12-09 13:48:10,248 - DEBUG - swea-lm-django__django-11099 - input_tokens=28,537, output_tokens=114, instance_cost=0.02, cost=0.00
2025-12-09 13:48:10,249 - DEBUG - swea-lm-django__django-11099 - total_tokens_sent=192,078, total_tokens_received=227, total_cost=1.04, total_api_calls=7
2025-12-09 13:48:10,250 - INFO - swea-agent-django__django-11099 - ðŸ’­ THOUGHT
The error "ValueError: cannot process flags argument with a compiled pattern" occurs because the regex attribute in the validators is already a compiled regex pattern (likely compiled by RegexValidator), and passing flags again to re.match is causing the error.

To fix this, I will modify the test code to use the validator's own validation method instead of directly using re.match with the regex and flags. The RegexValidator class has a __call__ method that can be used to validate a value.

I will update the test script to use the validator instances directly to validate the usernames.

ðŸŽ¬ ACTION
str_replace_editor str_replace /testbed/test_username_validator.py   --old_str '    print('"'"'Testing ASCIIUsernameValidator:'"'"')
    for username in test_usernames:
        if re.match(ascii_validator.regex, username, ascii_validator.flags):
            print(f'"'"'Valid: {repr(username)}'"'"')
        else:
            print(f'"'"'Invalid: {repr(username)}'"'"')

    print('"'"'\nTesting UnicodeUsernameValidator:'"'"')
    for username in test_usernames:
        if re.match(unicode_validator.regex, username, unicode_validator.flags):
            print(f'"'"'Valid: {repr(username)}'"'"')
        else:
            print(f'"'"'Invalid: {repr(username)}'"'"')' --new_str '    print('"'"'Testing ASCIIUsernameValidator:'"'"')
    for username in test_usernames:
        try:
            ascii_validator(username)
            print(f'"'"'Valid: {repr(username)}'"'"')
        except Exception:
            print(f'"'"'Invalid: {repr(username)}'"'"')

    print('"'"'\nTesting UnicodeUsernameValidator:'"'"')
    for username in test_usernames:
        try:
            unicode_validator(username)
            print(f'"'"'Valid: {repr(username)}'"'"')
        except Exception:
            print(f'"'"'Invalid: {repr(username)}'"'"')'
2025-12-09 13:48:10,595 - DEBUG - swea-tools-django__django-11099 - Retrieved state from environment: {'working_dir': '/testbed'}
2025-12-09 13:48:10,596 - INFO - swea-agent-django__django-11099 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nUsernameValidator allows trailing newline in usernames\nDescription\n\t\nASCIIUsernameValidator and UnicodeUsernameValidator use the regex \nr\'^[\\w.@+-]+$\'\nThe intent is to only allow alphanumeric characters as well as ., @, +, and -. However, a little known quirk of Python regexes is that $ will also match a trailing newline. Therefore, the user name validators will accept usernames which end with a newline. You can avoid this behavior by instead using \\A and \\Z to terminate regexes. For example, the validator regex could be changed to\nr\'\\A[\\w.@+-]+\\Z\'\nin order to reject usernames that end with a newline.\nI am not sure how to officially post a patch, but the required change is trivial - using the regex above in the two validators in contrib.auth.validators.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg --json 'ASCIIUsernameValidator|UnicodeUsernameValidator' -p /testbed --json-seq", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json \'ASCIIUsernameValidator|UnicodeUsernameValidator\' -p /testbed --json-seq"}', 'name': 'bash'}, 'id': 'call_J7GJ3oMYCbWDX5I8vdqMsgtO', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_J7GJ3oMYCbWDX5I8vdqMsgtO']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "grep -r 'ASCIIUsernameValidator' /testbed", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r \'ASCIIUsernameValidator\' /testbed"}', 'name': 'bash'}, 'id': 'call_ZbjCFotvwa2sWaEWdJXNyJS5', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n/testbed/docs/ref/contrib/auth.txt:            from django.contrib.auth.validators import ASCIIUsernameValidator\n/testbed/docs/ref/contrib/auth.txt:                username_validator = ASCIIUsernameValidator()\n/testbed/docs/ref/contrib/auth.txt:.. class:: validators.ASCIIUsernameValidator\n/testbed/docs/releases/1.10.txt::class:`~django.contrib.auth.validators.ASCIIUsernameValidator` or\n/testbed/django/contrib/auth/validators.py:class ASCIIUsernameValidator(validators.RegexValidator):\n/testbed/tests/auth_tests/test_validators.py:        v = validators.ASCIIUsernameValidator()\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_ZbjCFotvwa2sWaEWdJXNyJS5']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/contrib/auth/validators.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/contrib/auth/validators.py"}', 'name': 'bash'}, 'id': 'call_SMj3oIloVNnrJznWZMPtfV2N', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nimport re\n\nfrom django.core import validators\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.translation import gettext_lazy as _\n\n\n@deconstructible\nclass ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r'^[\\w.@+-]+$'\n    message = _(\n        'Enter a valid username. This value may contain only English letters, '\n        'numbers, and @/./+/-/_ characters.'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r'^[\\w.@+-]+$'\n    message = _(\n        'Enter a valid username. This value may contain only letters, '\n        'numbers, and @/./+/-/_ characters.'\n    )\n    flags = 0\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_SMj3oIloVNnrJznWZMPtfV2N']}, {'role': 'assistant', 'content': "The issue described in the PR is that the regex used in ASCIIUsernameValidator and UnicodeUsernameValidator allows trailing newlines because the $ in regex matches the end of the string or just before the newline at the end of the string.\n\nThe fix is to replace the regex pattern from r'^[\\w.@+-]+$' to r'\\\\A[\\\\w.@+-]+\\\\Z' in both ASCIIUsernameValidator and UnicodeUsernameValidator classes.\n\nI will now proceed to make this change in the file /testbed/django/contrib/auth/validators.py.", 'thought': "The issue described in the PR is that the regex used in ASCIIUsernameValidator and UnicodeUsernameValidator allows trailing newlines because the $ in regex matches the end of the string or just before the newline at the end of the string.\n\nThe fix is to replace the regex pattern from r'^[\\w.@+-]+$' to r'\\\\A[\\\\w.@+-]+\\\\Z' in both ASCIIUsernameValidator and UnicodeUsernameValidator classes.\n\nI will now proceed to make this change in the file /testbed/django/contrib/auth/validators.py.", 'action': 'str_replace_editor str_replace /testbed/django/contrib/auth/validators.py   --old_str \'class ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'^[\\w.@+-]+$\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only English letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'^[\\w.@+-]+$\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = 0\' --new_str \'class ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'\\A[\\w.@+-]+\\Z\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only English letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'\\A[\\w.@+-]+\\Z\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = 0\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/django/contrib/auth/validators.py","old_str":"class ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'^[\\\\w.@+-]+$\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only English letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = re.ASCII\\n\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'^[\\\\w.@+-]+$\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = 0","new_str":"class ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only English letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = re.ASCII\\n\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = 0"}', 'name': 'str_replace_editor'}, 'id': 'call_JYqxO1MgLsIHZqR1qvM9AAut', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/django/contrib/auth/validators.py has been edited. Here's the result of running `cat -n` on a snippet of /testbed/django/contrib/auth/validators.py:\n     4\tfrom django.utils.deconstruct import deconstructible\n     5\tfrom django.utils.translation import gettext_lazy as _\n     6\t\n     7\t\n     8\t@deconstructible\n     9\tclass ASCIIUsernameValidator(validators.RegexValidator):\n    10\t    regex = r'\\A[\\w.@+-]+\\Z'\n    11\t    message = _(\n    12\t        'Enter a valid username. This value may contain only English letters, '\n    13\t        'numbers, and @/./+/-/_ characters.'\n    14\t    )\n    15\t    flags = re.ASCII\n    16\t\n    17\t\n    18\t@deconstructible\n    19\tclass UnicodeUsernameValidator(validators.RegexValidator):\n    20\t    regex = r'\\A[\\w.@+-]+\\Z'\n    21\t    message = _(\n    22\t        'Enter a valid username. This value may contain only letters, '\n    23\t        'numbers, and @/./+/-/_ characters.'\n    24\t    )\n    25\t    flags = 0\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_JYqxO1MgLsIHZqR1qvM9AAut']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'echo "import re\nfrom django.core import validators\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.translation import gettext_lazy as _\n\n@deconstructible\nclass ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'\\A[\\w.@+-]+\\Z\'\n    message = _(\'Enter a valid username. This value may contain only English letters, numbers, and @/./+/-/_ characters.\')\n    flags = re.ASCII\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'\\A[\\w.@+-]+\\Z\'\n    message = _(\'Enter a valid username. This value may contain only letters, numbers, and @/./+/-/_ characters.\')\n    flags = 0\n\n# Test code to verify the regex behavior\nif __name__ == \'__main__\':\n    import re\n\n    ascii_validator = ASCIIUsernameValidator()\n    unicode_validator = UnicodeUsernameValidator()\n\n    test_usernames = [\n        \'validusername\',\n        \'valid.username\',\n        \'valid@username\',\n        \'valid+username\',\n        \'valid-username\',\n        \'valid_username\',\n        \'invalidusername\\n\',\n        \'invalidusername\\r\\n\',\n        \'invalidusername\\n \',\n        \'invalidusername \',\n    ]\n\n    print(\'Testing ASCIIUsernameValidator:\')\n    for username in test_usernames:\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\n            print(f\'Valid: {repr(username)}\')\n        else:\n            print(f\'Invalid: {repr(username)}\')\n\n    print(\'\\nTesting UnicodeUsernameValidator:\')\n    for username in test_usernames:\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\n            print(f\'Valid: {repr(username)}\')\n        else:\n            print(f\'Invalid: {repr(username)}\')\n" > /testbed/test_username_validator.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"echo \\"import re\\nfrom django.core import validators\\nfrom django.utils.deconstruct import deconstructible\\nfrom django.utils.translation import gettext_lazy as _\\n\\n@deconstructible\\nclass ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\'Enter a valid username. This value may contain only English letters, numbers, and @/./+/-/_ characters.\')\\n    flags = re.ASCII\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\'Enter a valid username. This value may contain only letters, numbers, and @/./+/-/_ characters.\')\\n    flags = 0\\n\\n# Test code to verify the regex behavior\\nif __name__ == \'__main__\':\\n    import re\\n\\n    ascii_validator = ASCIIUsernameValidator()\\n    unicode_validator = UnicodeUsernameValidator()\\n\\n    test_usernames = [\\n        \'validusername\',\\n        \'valid.username\',\\n        \'valid@username\',\\n        \'valid+username\',\\n        \'valid-username\',\\n        \'valid_username\',\\n        \'invalidusername\\\\n\',\\n        \'invalidusername\\\\r\\\\n\',\\n        \'invalidusername\\\\n \',\\n        \'invalidusername \',\\n    ]\\n\\n    print(\'Testing ASCIIUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\n    print(\'\\\\nTesting UnicodeUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\" > /testbed/test_username_validator.py"}', 'name': 'bash'}, 'id': 'call_U2yq9YRzm9PEfOxxo9zlvpkv', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'Your command ran successfully and did not produce any output.'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_U2yq9YRzm9PEfOxxo9zlvpkv'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/test_username_validator.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/test_username_validator.py"}', 'name': 'bash'}, 'id': 'call_hW1YxOF8W4LREApTv7LuKrOw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nTesting ASCIIUsernameValidator:\nTraceback (most recent call last):\n  File "/testbed/test_username_validator.py", line 40, in <module>\n    if re.match(ascii_validator.regex, username, ascii_validator.flags):\n  File "/opt/miniconda3/envs/testbed/lib/python3.6/re.py", line 172, in match\n    return _compile(pattern, flags).match(string)\n  File "/opt/miniconda3/envs/testbed/lib/python3.6/re.py", line 297, in _compile\n    "cannot process flags argument with a compiled pattern")\nValueError: cannot process flags argument with a compiled pattern\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_hW1YxOF8W4LREApTv7LuKrOw'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:48:10,597 - INFO - swea-agent-django__django-11099 - ðŸ¤– MODEL INPUT
OBSERVATION:
The file /testbed/test_username_validator.py has been edited. Here's the result of running `cat -n` on a snippet of /testbed/test_username_validator.py:
    33	        'invalidusername\r\n',
    34	        'invalidusername\n ',
    35	        'invalidusername ',
    36	    ]
    37	
    38	    print('Testing ASCIIUsernameValidator:')
    39	    for username in test_usernames:
    40	        try:
    41	            ascii_validator(username)
    42	            print(f'Valid: {repr(username)}')
    43	        except Exception:
    44	            print(f'Invalid: {repr(username)}')
    45	
    46	    print('\nTesting UnicodeUsernameValidator:')
    47	    for username in test_usernames:
    48	        try:
    49	            unicode_validator(username)
    50	            print(f'Valid: {repr(username)}')
    51	        except Exception:
    52	            print(f'Invalid: {repr(username)}')
    53	
Review the changes and make sure they are as expected. Edit the file again if necessary.

2025-12-09 13:48:10,607 - INFO - swea-agent-django__django-11099 - ========================= STEP 8 =========================
2025-12-09 13:48:10,608 - DEBUG - swea-lm-django__django-11099 - n_cache_control: 2
2025-12-09 13:48:15,071 - DEBUG - swea-lm-django__django-11099 - Response: ModelResponse(id='chatcmpl-Ckx2sLCBFihyhIXNsTOMGVz2TWI72', created=1765306094, model='gpt-4.1-mini-2025-04-14', object='chat.completion', system_fingerprint='fp_7abc656409', choices=[Choices(finish_reason='tool_calls', index=0, message=Message(content=None, role='assistant', tool_calls=[ChatCompletionMessageToolCall(function=Function(arguments='{"command":"python3 /testbed/test_username_validator.py"}', name='bash'), id='call_Otq90NHIfWbno62DI8o1UQN0', type='function')], function_call=None, provider_specific_fields={'refusal': None}, annotations=[]), provider_specific_fields={})], usage=Usage(completion_tokens=22, prompt_tokens=29722, total_tokens=29744, completion_tokens_details=CompletionTokensDetailsWrapper(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0, text_tokens=None), prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=0, cached_tokens=26368, text_tokens=None, image_tokens=None)), service_tier='default')
2025-12-09 13:48:15,073 - DEBUG - swea-lm-django__django-11099 - input_tokens=29,203, output_tokens=0, instance_cost=0.03, cost=0.00
2025-12-09 13:48:15,073 - DEBUG - swea-lm-django__django-11099 - total_tokens_sent=221,281, total_tokens_received=227, total_cost=1.04, total_api_calls=8
2025-12-09 13:48:15,073 - INFO - swea-agent-django__django-11099 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
python3 /testbed/test_username_validator.py
2025-12-09 13:48:15,437 - DEBUG - swea-tools-django__django-11099 - Retrieved state from environment: {'working_dir': '/testbed'}
2025-12-09 13:48:15,438 - INFO - swea-agent-django__django-11099 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nUsernameValidator allows trailing newline in usernames\nDescription\n\t\nASCIIUsernameValidator and UnicodeUsernameValidator use the regex \nr\'^[\\w.@+-]+$\'\nThe intent is to only allow alphanumeric characters as well as ., @, +, and -. However, a little known quirk of Python regexes is that $ will also match a trailing newline. Therefore, the user name validators will accept usernames which end with a newline. You can avoid this behavior by instead using \\A and \\Z to terminate regexes. For example, the validator regex could be changed to\nr\'\\A[\\w.@+-]+\\Z\'\nin order to reject usernames that end with a newline.\nI am not sure how to officially post a patch, but the required change is trivial - using the regex above in the two validators in contrib.auth.validators.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg --json 'ASCIIUsernameValidator|UnicodeUsernameValidator' -p /testbed --json-seq", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json \'ASCIIUsernameValidator|UnicodeUsernameValidator\' -p /testbed --json-seq"}', 'name': 'bash'}, 'id': 'call_J7GJ3oMYCbWDX5I8vdqMsgtO', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_J7GJ3oMYCbWDX5I8vdqMsgtO']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "grep -r 'ASCIIUsernameValidator' /testbed", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r \'ASCIIUsernameValidator\' /testbed"}', 'name': 'bash'}, 'id': 'call_ZbjCFotvwa2sWaEWdJXNyJS5', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n/testbed/docs/ref/contrib/auth.txt:            from django.contrib.auth.validators import ASCIIUsernameValidator\n/testbed/docs/ref/contrib/auth.txt:                username_validator = ASCIIUsernameValidator()\n/testbed/docs/ref/contrib/auth.txt:.. class:: validators.ASCIIUsernameValidator\n/testbed/docs/releases/1.10.txt::class:`~django.contrib.auth.validators.ASCIIUsernameValidator` or\n/testbed/django/contrib/auth/validators.py:class ASCIIUsernameValidator(validators.RegexValidator):\n/testbed/tests/auth_tests/test_validators.py:        v = validators.ASCIIUsernameValidator()\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_ZbjCFotvwa2sWaEWdJXNyJS5']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/contrib/auth/validators.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/contrib/auth/validators.py"}', 'name': 'bash'}, 'id': 'call_SMj3oIloVNnrJznWZMPtfV2N', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nimport re\n\nfrom django.core import validators\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.translation import gettext_lazy as _\n\n\n@deconstructible\nclass ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r'^[\\w.@+-]+$'\n    message = _(\n        'Enter a valid username. This value may contain only English letters, '\n        'numbers, and @/./+/-/_ characters.'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r'^[\\w.@+-]+$'\n    message = _(\n        'Enter a valid username. This value may contain only letters, '\n        'numbers, and @/./+/-/_ characters.'\n    )\n    flags = 0\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_SMj3oIloVNnrJznWZMPtfV2N']}, {'role': 'assistant', 'content': "The issue described in the PR is that the regex used in ASCIIUsernameValidator and UnicodeUsernameValidator allows trailing newlines because the $ in regex matches the end of the string or just before the newline at the end of the string.\n\nThe fix is to replace the regex pattern from r'^[\\w.@+-]+$' to r'\\\\A[\\\\w.@+-]+\\\\Z' in both ASCIIUsernameValidator and UnicodeUsernameValidator classes.\n\nI will now proceed to make this change in the file /testbed/django/contrib/auth/validators.py.", 'thought': "The issue described in the PR is that the regex used in ASCIIUsernameValidator and UnicodeUsernameValidator allows trailing newlines because the $ in regex matches the end of the string or just before the newline at the end of the string.\n\nThe fix is to replace the regex pattern from r'^[\\w.@+-]+$' to r'\\\\A[\\\\w.@+-]+\\\\Z' in both ASCIIUsernameValidator and UnicodeUsernameValidator classes.\n\nI will now proceed to make this change in the file /testbed/django/contrib/auth/validators.py.", 'action': 'str_replace_editor str_replace /testbed/django/contrib/auth/validators.py   --old_str \'class ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'^[\\w.@+-]+$\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only English letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'^[\\w.@+-]+$\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = 0\' --new_str \'class ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'\\A[\\w.@+-]+\\Z\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only English letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'\\A[\\w.@+-]+\\Z\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = 0\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/django/contrib/auth/validators.py","old_str":"class ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'^[\\\\w.@+-]+$\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only English letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = re.ASCII\\n\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'^[\\\\w.@+-]+$\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = 0","new_str":"class ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only English letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = re.ASCII\\n\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = 0"}', 'name': 'str_replace_editor'}, 'id': 'call_JYqxO1MgLsIHZqR1qvM9AAut', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/django/contrib/auth/validators.py has been edited. Here's the result of running `cat -n` on a snippet of /testbed/django/contrib/auth/validators.py:\n     4\tfrom django.utils.deconstruct import deconstructible\n     5\tfrom django.utils.translation import gettext_lazy as _\n     6\t\n     7\t\n     8\t@deconstructible\n     9\tclass ASCIIUsernameValidator(validators.RegexValidator):\n    10\t    regex = r'\\A[\\w.@+-]+\\Z'\n    11\t    message = _(\n    12\t        'Enter a valid username. This value may contain only English letters, '\n    13\t        'numbers, and @/./+/-/_ characters.'\n    14\t    )\n    15\t    flags = re.ASCII\n    16\t\n    17\t\n    18\t@deconstructible\n    19\tclass UnicodeUsernameValidator(validators.RegexValidator):\n    20\t    regex = r'\\A[\\w.@+-]+\\Z'\n    21\t    message = _(\n    22\t        'Enter a valid username. This value may contain only letters, '\n    23\t        'numbers, and @/./+/-/_ characters.'\n    24\t    )\n    25\t    flags = 0\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_JYqxO1MgLsIHZqR1qvM9AAut']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'echo "import re\nfrom django.core import validators\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.translation import gettext_lazy as _\n\n@deconstructible\nclass ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'\\A[\\w.@+-]+\\Z\'\n    message = _(\'Enter a valid username. This value may contain only English letters, numbers, and @/./+/-/_ characters.\')\n    flags = re.ASCII\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'\\A[\\w.@+-]+\\Z\'\n    message = _(\'Enter a valid username. This value may contain only letters, numbers, and @/./+/-/_ characters.\')\n    flags = 0\n\n# Test code to verify the regex behavior\nif __name__ == \'__main__\':\n    import re\n\n    ascii_validator = ASCIIUsernameValidator()\n    unicode_validator = UnicodeUsernameValidator()\n\n    test_usernames = [\n        \'validusername\',\n        \'valid.username\',\n        \'valid@username\',\n        \'valid+username\',\n        \'valid-username\',\n        \'valid_username\',\n        \'invalidusername\\n\',\n        \'invalidusername\\r\\n\',\n        \'invalidusername\\n \',\n        \'invalidusername \',\n    ]\n\n    print(\'Testing ASCIIUsernameValidator:\')\n    for username in test_usernames:\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\n            print(f\'Valid: {repr(username)}\')\n        else:\n            print(f\'Invalid: {repr(username)}\')\n\n    print(\'\\nTesting UnicodeUsernameValidator:\')\n    for username in test_usernames:\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\n            print(f\'Valid: {repr(username)}\')\n        else:\n            print(f\'Invalid: {repr(username)}\')\n" > /testbed/test_username_validator.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"echo \\"import re\\nfrom django.core import validators\\nfrom django.utils.deconstruct import deconstructible\\nfrom django.utils.translation import gettext_lazy as _\\n\\n@deconstructible\\nclass ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\'Enter a valid username. This value may contain only English letters, numbers, and @/./+/-/_ characters.\')\\n    flags = re.ASCII\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\'Enter a valid username. This value may contain only letters, numbers, and @/./+/-/_ characters.\')\\n    flags = 0\\n\\n# Test code to verify the regex behavior\\nif __name__ == \'__main__\':\\n    import re\\n\\n    ascii_validator = ASCIIUsernameValidator()\\n    unicode_validator = UnicodeUsernameValidator()\\n\\n    test_usernames = [\\n        \'validusername\',\\n        \'valid.username\',\\n        \'valid@username\',\\n        \'valid+username\',\\n        \'valid-username\',\\n        \'valid_username\',\\n        \'invalidusername\\\\n\',\\n        \'invalidusername\\\\r\\\\n\',\\n        \'invalidusername\\\\n \',\\n        \'invalidusername \',\\n    ]\\n\\n    print(\'Testing ASCIIUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\n    print(\'\\\\nTesting UnicodeUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\" > /testbed/test_username_validator.py"}', 'name': 'bash'}, 'id': 'call_U2yq9YRzm9PEfOxxo9zlvpkv', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'Your command ran successfully and did not produce any output.'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_U2yq9YRzm9PEfOxxo9zlvpkv']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/test_username_validator.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/test_username_validator.py"}', 'name': 'bash'}, 'id': 'call_hW1YxOF8W4LREApTv7LuKrOw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nTesting ASCIIUsernameValidator:\nTraceback (most recent call last):\n  File "/testbed/test_username_validator.py", line 40, in <module>\n    if re.match(ascii_validator.regex, username, ascii_validator.flags):\n  File "/opt/miniconda3/envs/testbed/lib/python3.6/re.py", line 172, in match\n    return _compile(pattern, flags).match(string)\n  File "/opt/miniconda3/envs/testbed/lib/python3.6/re.py", line 297, in _compile\n    "cannot process flags argument with a compiled pattern")\nValueError: cannot process flags argument with a compiled pattern\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_hW1YxOF8W4LREApTv7LuKrOw'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': 'The error "ValueError: cannot process flags argument with a compiled pattern" occurs because the regex attribute in the validators is already a compiled regex pattern (likely compiled by RegexValidator), and passing flags again to re.match is causing the error.\n\nTo fix this, I will modify the test code to use the validator\'s own validation method instead of directly using re.match with the regex and flags. The RegexValidator class has a __call__ method that can be used to validate a value.\n\nI will update the test script to use the validator instances directly to validate the usernames.', 'thought': 'The error "ValueError: cannot process flags argument with a compiled pattern" occurs because the regex attribute in the validators is already a compiled regex pattern (likely compiled by RegexValidator), and passing flags again to re.match is causing the error.\n\nTo fix this, I will modify the test code to use the validator\'s own validation method instead of directly using re.match with the regex and flags. The RegexValidator class has a __call__ method that can be used to validate a value.\n\nI will update the test script to use the validator instances directly to validate the usernames.', 'action': 'str_replace_editor str_replace /testbed/test_username_validator.py   --old_str \'    print(\'"\'"\'Testing ASCIIUsernameValidator:\'"\'"\')\n    for username in test_usernames:\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\n            print(f\'"\'"\'Valid: {repr(username)}\'"\'"\')\n        else:\n            print(f\'"\'"\'Invalid: {repr(username)}\'"\'"\')\n\n    print(\'"\'"\'\\nTesting UnicodeUsernameValidator:\'"\'"\')\n    for username in test_usernames:\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\n            print(f\'"\'"\'Valid: {repr(username)}\'"\'"\')\n        else:\n            print(f\'"\'"\'Invalid: {repr(username)}\'"\'"\')\' --new_str \'    print(\'"\'"\'Testing ASCIIUsernameValidator:\'"\'"\')\n    for username in test_usernames:\n        try:\n            ascii_validator(username)\n            print(f\'"\'"\'Valid: {repr(username)}\'"\'"\')\n        except Exception:\n            print(f\'"\'"\'Invalid: {repr(username)}\'"\'"\')\n\n    print(\'"\'"\'\\nTesting UnicodeUsernameValidator:\'"\'"\')\n    for username in test_usernames:\n        try:\n            unicode_validator(username)\n            print(f\'"\'"\'Valid: {repr(username)}\'"\'"\')\n        except Exception:\n            print(f\'"\'"\'Invalid: {repr(username)}\'"\'"\')\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/test_username_validator.py","old_str":"    print(\'Testing ASCIIUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\n    print(\'\\\\nTesting UnicodeUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')","new_str":"    print(\'Testing ASCIIUsernameValidator:\')\\n    for username in test_usernames:\\n        try:\\n            ascii_validator(username)\\n            print(f\'Valid: {repr(username)}\')\\n        except Exception:\\n            print(f\'Invalid: {repr(username)}\')\\n\\n    print(\'\\\\nTesting UnicodeUsernameValidator:\')\\n    for username in test_usernames:\\n        try:\\n            unicode_validator(username)\\n            print(f\'Valid: {repr(username)}\')\\n        except Exception:\\n            print(f\'Invalid: {repr(username)}\')"}', 'name': 'str_replace_editor'}, 'id': 'call_mVQy1JaQ1R1iJ3leHcNyOiMI', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/test_username_validator.py has been edited. Here's the result of running `cat -n` on a snippet of /testbed/test_username_validator.py:\n    33\t        'invalidusername\\r\\n',\n    34\t        'invalidusername\\n ',\n    35\t        'invalidusername ',\n    36\t    ]\n    37\t\n    38\t    print('Testing ASCIIUsernameValidator:')\n    39\t    for username in test_usernames:\n    40\t        try:\n    41\t            ascii_validator(username)\n    42\t            print(f'Valid: {repr(username)}')\n    43\t        except Exception:\n    44\t            print(f'Invalid: {repr(username)}')\n    45\t\n    46\t    print('\\nTesting UnicodeUsernameValidator:')\n    47\t    for username in test_usernames:\n    48\t        try:\n    49\t            unicode_validator(username)\n    50\t            print(f'Valid: {repr(username)}')\n    51\t        except Exception:\n    52\t            print(f'Invalid: {repr(username)}')\n    53\t\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mVQy1JaQ1R1iJ3leHcNyOiMI'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:48:15,440 - INFO - swea-agent-django__django-11099 - ðŸ¤– MODEL INPUT
OBSERVATION:
Testing ASCIIUsernameValidator:
Valid: 'validusername'
Valid: 'valid.username'
Valid: 'valid@username'
Valid: 'valid+username'
Valid: 'valid-username'
Valid: 'valid_username'
Invalid: 'invalidusername\n'
Invalid: 'invalidusername\r\n'
Invalid: 'invalidusername\n '
Invalid: 'invalidusername '

Testing UnicodeUsernameValidator:
Valid: 'validusername'
Valid: 'valid.username'
Valid: 'valid@username'
Valid: 'valid+username'
Valid: 'valid-username'
Valid: 'valid_username'
Invalid: 'invalidusername\n'
Invalid: 'invalidusername\r\n'
Invalid: 'invalidusername\n '
Invalid: 'invalidusername '

2025-12-09 13:48:15,446 - INFO - swea-agent-django__django-11099 - ========================= STEP 9 =========================
2025-12-09 13:48:15,447 - DEBUG - swea-lm-django__django-11099 - n_cache_control: 2
2025-12-09 13:48:25,261 - DEBUG - swea-lm-django__django-11099 - Response: ModelResponse(id='chatcmpl-Ckx311LjzAQIOATrzxfeZq4S0CwWw', created=1765306103, model='gpt-4.1-mini-2025-04-14', object='chat.completion', system_fingerprint='fp_7abc656409', choices=[Choices(finish_reason='stop', index=0, message=Message(content='The test script output shows that the ASCIIUsernameValidator and UnicodeUsernameValidator now correctly reject usernames with trailing newlines and spaces, while accepting valid usernames.\n\nThe fix has been successfully implemented by changing the regex patterns in the validators to use \\A and \\Z instead of ^ and $.\n\nIf you need any further assistance, please let me know!', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}, annotations=[]), provider_specific_fields={})], usage=Usage(completion_tokens=70, prompt_tokens=29899, total_tokens=29969, completion_tokens_details=CompletionTokensDetailsWrapper(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0, text_tokens=None), prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=0, cached_tokens=29056, text_tokens=None, image_tokens=None)), service_tier='default')
2025-12-09 13:48:25,262 - DEBUG - swea-lm-django__django-11099 - input_tokens=29,390, output_tokens=69, instance_cost=0.03, cost=0.00
2025-12-09 13:48:25,263 - DEBUG - swea-lm-django__django-11099 - total_tokens_sent=250,671, total_tokens_received=296, total_cost=1.04, total_api_calls=9
2025-12-09 13:48:25,263 - WARNING - swea-agent-django__django-11099 - Requerying model after FunctionCallingFormatError (1th requery)
2025-12-09 13:48:25,267 - WARNING - swea-agent-django__django-11099 - Your last output did not use any tool calls!
Please make sure your output includes exactly _ONE_ function call!
You must invoke the function directly using the function call format.
You cannot invoke commands with ```, you have to use the function call format.
If you think you have already resolved the issue, please submit your changes by running the `submit` command.
If you think you cannot solve the problem, please run `exit_forfeit` (if available) or `submit`.
Else, please continue with a new tool call!
2025-12-09 13:48:25,272 - DEBUG - swea-lm-django__django-11099 - n_cache_control: 2
2025-12-09 13:48:33,668 - DEBUG - swea-lm-django__django-11099 - Response: ModelResponse(id='chatcmpl-Ckx3ASriGPevYxdBfzNyOKPdZq8y4', created=1765306112, model='gpt-4.1-mini-2025-04-14', object='chat.completion', system_fingerprint='fp_7abc656409', choices=[Choices(finish_reason='tool_calls', index=0, message=Message(content=None, role='assistant', tool_calls=[ChatCompletionMessageToolCall(function=Function(arguments='{"command":"rm /testbed/test_username_validator.py"}', name='bash'), id='call_GcDRFQ8TIdEVdXxf8Oaefi8d', type='function')], function_call=None, provider_specific_fields={'refusal': None}, annotations=[]), provider_specific_fields={})], usage=Usage(completion_tokens=21, prompt_tokens=30083, total_tokens=30104, completion_tokens_details=CompletionTokensDetailsWrapper(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0, text_tokens=None), prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=0, cached_tokens=29952, text_tokens=None, image_tokens=None)), service_tier='default')
2025-12-09 13:48:33,670 - DEBUG - swea-lm-django__django-11099 - input_tokens=29,574, output_tokens=0, instance_cost=0.03, cost=0.00
2025-12-09 13:48:33,670 - DEBUG - swea-lm-django__django-11099 - total_tokens_sent=280,245, total_tokens_received=296, total_cost=1.05, total_api_calls=10
2025-12-09 13:48:33,671 - INFO - swea-agent-django__django-11099 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
rm /testbed/test_username_validator.py
2025-12-09 13:48:33,943 - DEBUG - swea-tools-django__django-11099 - Retrieved state from environment: {'working_dir': '/testbed'}
2025-12-09 13:48:33,948 - INFO - swea-agent-django__django-11099 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nUsernameValidator allows trailing newline in usernames\nDescription\n\t\nASCIIUsernameValidator and UnicodeUsernameValidator use the regex \nr\'^[\\w.@+-]+$\'\nThe intent is to only allow alphanumeric characters as well as ., @, +, and -. However, a little known quirk of Python regexes is that $ will also match a trailing newline. Therefore, the user name validators will accept usernames which end with a newline. You can avoid this behavior by instead using \\A and \\Z to terminate regexes. For example, the validator regex could be changed to\nr\'\\A[\\w.@+-]+\\Z\'\nin order to reject usernames that end with a newline.\nI am not sure how to officially post a patch, but the required change is trivial - using the regex above in the two validators in contrib.auth.validators.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg --json 'ASCIIUsernameValidator|UnicodeUsernameValidator' -p /testbed --json-seq", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json \'ASCIIUsernameValidator|UnicodeUsernameValidator\' -p /testbed --json-seq"}', 'name': 'bash'}, 'id': 'call_J7GJ3oMYCbWDX5I8vdqMsgtO', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_J7GJ3oMYCbWDX5I8vdqMsgtO']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "grep -r 'ASCIIUsernameValidator' /testbed", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r \'ASCIIUsernameValidator\' /testbed"}', 'name': 'bash'}, 'id': 'call_ZbjCFotvwa2sWaEWdJXNyJS5', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n/testbed/docs/ref/contrib/auth.txt:            from django.contrib.auth.validators import ASCIIUsernameValidator\n/testbed/docs/ref/contrib/auth.txt:                username_validator = ASCIIUsernameValidator()\n/testbed/docs/ref/contrib/auth.txt:.. class:: validators.ASCIIUsernameValidator\n/testbed/docs/releases/1.10.txt::class:`~django.contrib.auth.validators.ASCIIUsernameValidator` or\n/testbed/django/contrib/auth/validators.py:class ASCIIUsernameValidator(validators.RegexValidator):\n/testbed/tests/auth_tests/test_validators.py:        v = validators.ASCIIUsernameValidator()\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_ZbjCFotvwa2sWaEWdJXNyJS5']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/contrib/auth/validators.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/contrib/auth/validators.py"}', 'name': 'bash'}, 'id': 'call_SMj3oIloVNnrJznWZMPtfV2N', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nimport re\n\nfrom django.core import validators\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.translation import gettext_lazy as _\n\n\n@deconstructible\nclass ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r'^[\\w.@+-]+$'\n    message = _(\n        'Enter a valid username. This value may contain only English letters, '\n        'numbers, and @/./+/-/_ characters.'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r'^[\\w.@+-]+$'\n    message = _(\n        'Enter a valid username. This value may contain only letters, '\n        'numbers, and @/./+/-/_ characters.'\n    )\n    flags = 0\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_SMj3oIloVNnrJznWZMPtfV2N']}, {'role': 'assistant', 'content': "The issue described in the PR is that the regex used in ASCIIUsernameValidator and UnicodeUsernameValidator allows trailing newlines because the $ in regex matches the end of the string or just before the newline at the end of the string.\n\nThe fix is to replace the regex pattern from r'^[\\w.@+-]+$' to r'\\\\A[\\\\w.@+-]+\\\\Z' in both ASCIIUsernameValidator and UnicodeUsernameValidator classes.\n\nI will now proceed to make this change in the file /testbed/django/contrib/auth/validators.py.", 'thought': "The issue described in the PR is that the regex used in ASCIIUsernameValidator and UnicodeUsernameValidator allows trailing newlines because the $ in regex matches the end of the string or just before the newline at the end of the string.\n\nThe fix is to replace the regex pattern from r'^[\\w.@+-]+$' to r'\\\\A[\\\\w.@+-]+\\\\Z' in both ASCIIUsernameValidator and UnicodeUsernameValidator classes.\n\nI will now proceed to make this change in the file /testbed/django/contrib/auth/validators.py.", 'action': 'str_replace_editor str_replace /testbed/django/contrib/auth/validators.py   --old_str \'class ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'^[\\w.@+-]+$\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only English letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'^[\\w.@+-]+$\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = 0\' --new_str \'class ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'\\A[\\w.@+-]+\\Z\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only English letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'\\A[\\w.@+-]+\\Z\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = 0\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/django/contrib/auth/validators.py","old_str":"class ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'^[\\\\w.@+-]+$\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only English letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = re.ASCII\\n\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'^[\\\\w.@+-]+$\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = 0","new_str":"class ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only English letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = re.ASCII\\n\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = 0"}', 'name': 'str_replace_editor'}, 'id': 'call_JYqxO1MgLsIHZqR1qvM9AAut', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/django/contrib/auth/validators.py has been edited. Here's the result of running `cat -n` on a snippet of /testbed/django/contrib/auth/validators.py:\n     4\tfrom django.utils.deconstruct import deconstructible\n     5\tfrom django.utils.translation import gettext_lazy as _\n     6\t\n     7\t\n     8\t@deconstructible\n     9\tclass ASCIIUsernameValidator(validators.RegexValidator):\n    10\t    regex = r'\\A[\\w.@+-]+\\Z'\n    11\t    message = _(\n    12\t        'Enter a valid username. This value may contain only English letters, '\n    13\t        'numbers, and @/./+/-/_ characters.'\n    14\t    )\n    15\t    flags = re.ASCII\n    16\t\n    17\t\n    18\t@deconstructible\n    19\tclass UnicodeUsernameValidator(validators.RegexValidator):\n    20\t    regex = r'\\A[\\w.@+-]+\\Z'\n    21\t    message = _(\n    22\t        'Enter a valid username. This value may contain only letters, '\n    23\t        'numbers, and @/./+/-/_ characters.'\n    24\t    )\n    25\t    flags = 0\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_JYqxO1MgLsIHZqR1qvM9AAut']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'echo "import re\nfrom django.core import validators\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.translation import gettext_lazy as _\n\n@deconstructible\nclass ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'\\A[\\w.@+-]+\\Z\'\n    message = _(\'Enter a valid username. This value may contain only English letters, numbers, and @/./+/-/_ characters.\')\n    flags = re.ASCII\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'\\A[\\w.@+-]+\\Z\'\n    message = _(\'Enter a valid username. This value may contain only letters, numbers, and @/./+/-/_ characters.\')\n    flags = 0\n\n# Test code to verify the regex behavior\nif __name__ == \'__main__\':\n    import re\n\n    ascii_validator = ASCIIUsernameValidator()\n    unicode_validator = UnicodeUsernameValidator()\n\n    test_usernames = [\n        \'validusername\',\n        \'valid.username\',\n        \'valid@username\',\n        \'valid+username\',\n        \'valid-username\',\n        \'valid_username\',\n        \'invalidusername\\n\',\n        \'invalidusername\\r\\n\',\n        \'invalidusername\\n \',\n        \'invalidusername \',\n    ]\n\n    print(\'Testing ASCIIUsernameValidator:\')\n    for username in test_usernames:\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\n            print(f\'Valid: {repr(username)}\')\n        else:\n            print(f\'Invalid: {repr(username)}\')\n\n    print(\'\\nTesting UnicodeUsernameValidator:\')\n    for username in test_usernames:\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\n            print(f\'Valid: {repr(username)}\')\n        else:\n            print(f\'Invalid: {repr(username)}\')\n" > /testbed/test_username_validator.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"echo \\"import re\\nfrom django.core import validators\\nfrom django.utils.deconstruct import deconstructible\\nfrom django.utils.translation import gettext_lazy as _\\n\\n@deconstructible\\nclass ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\'Enter a valid username. This value may contain only English letters, numbers, and @/./+/-/_ characters.\')\\n    flags = re.ASCII\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\'Enter a valid username. This value may contain only letters, numbers, and @/./+/-/_ characters.\')\\n    flags = 0\\n\\n# Test code to verify the regex behavior\\nif __name__ == \'__main__\':\\n    import re\\n\\n    ascii_validator = ASCIIUsernameValidator()\\n    unicode_validator = UnicodeUsernameValidator()\\n\\n    test_usernames = [\\n        \'validusername\',\\n        \'valid.username\',\\n        \'valid@username\',\\n        \'valid+username\',\\n        \'valid-username\',\\n        \'valid_username\',\\n        \'invalidusername\\\\n\',\\n        \'invalidusername\\\\r\\\\n\',\\n        \'invalidusername\\\\n \',\\n        \'invalidusername \',\\n    ]\\n\\n    print(\'Testing ASCIIUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\n    print(\'\\\\nTesting UnicodeUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\" > /testbed/test_username_validator.py"}', 'name': 'bash'}, 'id': 'call_U2yq9YRzm9PEfOxxo9zlvpkv', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'Your command ran successfully and did not produce any output.'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_U2yq9YRzm9PEfOxxo9zlvpkv']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/test_username_validator.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/test_username_validator.py"}', 'name': 'bash'}, 'id': 'call_hW1YxOF8W4LREApTv7LuKrOw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nTesting ASCIIUsernameValidator:\nTraceback (most recent call last):\n  File "/testbed/test_username_validator.py", line 40, in <module>\n    if re.match(ascii_validator.regex, username, ascii_validator.flags):\n  File "/opt/miniconda3/envs/testbed/lib/python3.6/re.py", line 172, in match\n    return _compile(pattern, flags).match(string)\n  File "/opt/miniconda3/envs/testbed/lib/python3.6/re.py", line 297, in _compile\n    "cannot process flags argument with a compiled pattern")\nValueError: cannot process flags argument with a compiled pattern\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_hW1YxOF8W4LREApTv7LuKrOw']}, {'role': 'assistant', 'content': 'The error "ValueError: cannot process flags argument with a compiled pattern" occurs because the regex attribute in the validators is already a compiled regex pattern (likely compiled by RegexValidator), and passing flags again to re.match is causing the error.\n\nTo fix this, I will modify the test code to use the validator\'s own validation method instead of directly using re.match with the regex and flags. The RegexValidator class has a __call__ method that can be used to validate a value.\n\nI will update the test script to use the validator instances directly to validate the usernames.', 'thought': 'The error "ValueError: cannot process flags argument with a compiled pattern" occurs because the regex attribute in the validators is already a compiled regex pattern (likely compiled by RegexValidator), and passing flags again to re.match is causing the error.\n\nTo fix this, I will modify the test code to use the validator\'s own validation method instead of directly using re.match with the regex and flags. The RegexValidator class has a __call__ method that can be used to validate a value.\n\nI will update the test script to use the validator instances directly to validate the usernames.', 'action': 'str_replace_editor str_replace /testbed/test_username_validator.py   --old_str \'    print(\'"\'"\'Testing ASCIIUsernameValidator:\'"\'"\')\n    for username in test_usernames:\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\n            print(f\'"\'"\'Valid: {repr(username)}\'"\'"\')\n        else:\n            print(f\'"\'"\'Invalid: {repr(username)}\'"\'"\')\n\n    print(\'"\'"\'\\nTesting UnicodeUsernameValidator:\'"\'"\')\n    for username in test_usernames:\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\n            print(f\'"\'"\'Valid: {repr(username)}\'"\'"\')\n        else:\n            print(f\'"\'"\'Invalid: {repr(username)}\'"\'"\')\' --new_str \'    print(\'"\'"\'Testing ASCIIUsernameValidator:\'"\'"\')\n    for username in test_usernames:\n        try:\n            ascii_validator(username)\n            print(f\'"\'"\'Valid: {repr(username)}\'"\'"\')\n        except Exception:\n            print(f\'"\'"\'Invalid: {repr(username)}\'"\'"\')\n\n    print(\'"\'"\'\\nTesting UnicodeUsernameValidator:\'"\'"\')\n    for username in test_usernames:\n        try:\n            unicode_validator(username)\n            print(f\'"\'"\'Valid: {repr(username)}\'"\'"\')\n        except Exception:\n            print(f\'"\'"\'Invalid: {repr(username)}\'"\'"\')\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/test_username_validator.py","old_str":"    print(\'Testing ASCIIUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\n    print(\'\\\\nTesting UnicodeUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')","new_str":"    print(\'Testing ASCIIUsernameValidator:\')\\n    for username in test_usernames:\\n        try:\\n            ascii_validator(username)\\n            print(f\'Valid: {repr(username)}\')\\n        except Exception:\\n            print(f\'Invalid: {repr(username)}\')\\n\\n    print(\'\\\\nTesting UnicodeUsernameValidator:\')\\n    for username in test_usernames:\\n        try:\\n            unicode_validator(username)\\n            print(f\'Valid: {repr(username)}\')\\n        except Exception:\\n            print(f\'Invalid: {repr(username)}\')"}', 'name': 'str_replace_editor'}, 'id': 'call_mVQy1JaQ1R1iJ3leHcNyOiMI', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/test_username_validator.py has been edited. Here's the result of running `cat -n` on a snippet of /testbed/test_username_validator.py:\n    33\t        'invalidusername\\r\\n',\n    34\t        'invalidusername\\n ',\n    35\t        'invalidusername ',\n    36\t    ]\n    37\t\n    38\t    print('Testing ASCIIUsernameValidator:')\n    39\t    for username in test_usernames:\n    40\t        try:\n    41\t            ascii_validator(username)\n    42\t            print(f'Valid: {repr(username)}')\n    43\t        except Exception:\n    44\t            print(f'Invalid: {repr(username)}')\n    45\t\n    46\t    print('\\nTesting UnicodeUsernameValidator:')\n    47\t    for username in test_usernames:\n    48\t        try:\n    49\t            unicode_validator(username)\n    50\t            print(f'Valid: {repr(username)}')\n    51\t        except Exception:\n    52\t            print(f'Invalid: {repr(username)}')\n    53\t\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mVQy1JaQ1R1iJ3leHcNyOiMI'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/test_username_validator.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/test_username_validator.py"}', 'name': 'bash'}, 'id': 'call_Otq90NHIfWbno62DI8o1UQN0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nTesting ASCIIUsernameValidator:\nValid: 'validusername'\nValid: 'valid.username'\nValid: 'valid@username'\nValid: 'valid+username'\nValid: 'valid-username'\nValid: 'valid_username'\nInvalid: 'invalidusername\\n'\nInvalid: 'invalidusername\\r\\n'\nInvalid: 'invalidusername\\n '\nInvalid: 'invalidusername '\n\nTesting UnicodeUsernameValidator:\nValid: 'validusername'\nValid: 'valid.username'\nValid: 'valid@username'\nValid: 'valid+username'\nValid: 'valid-username'\nValid: 'valid_username'\nInvalid: 'invalidusername\\n'\nInvalid: 'invalidusername\\r\\n'\nInvalid: 'invalidusername\\n '\nInvalid: 'invalidusername '\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Otq90NHIfWbno62DI8o1UQN0'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:48:33,952 - INFO - swea-agent-django__django-11099 - ðŸ¤– MODEL INPUT
Your command ran successfully and did not produce any output.
2025-12-09 13:48:33,960 - INFO - swea-agent-django__django-11099 - ========================= STEP 11 =========================
2025-12-09 13:48:33,961 - DEBUG - swea-lm-django__django-11099 - n_cache_control: 2
2025-12-09 13:48:43,101 - DEBUG - swea-lm-django__django-11099 - Response: ModelResponse(id='chatcmpl-Ckx3J2uSaD5oqwnBzDCIFkLdcOJ7l', created=1765306121, model='gpt-4.1-mini-2025-04-14', object='chat.completion', system_fingerprint='fp_7abc656409', choices=[Choices(finish_reason='stop', index=0, message=Message(content="I have made the necessary changes to the regex patterns in the ASCIIUsernameValidator and UnicodeUsernameValidator classes in the file /testbed/django/contrib/auth/validators.py. The regex patterns were changed from r'^[\\\\w.@+-]+$' to r'\\\\A[\\\\w.@+-]+\\\\Z' to prevent trailing newlines from being accepted.\n\nI also created and ran a test script to verify that usernames with trailing newlines are now correctly rejected by both validators, while valid usernames are accepted.\n\nThe issue described in the PR is now fixed. If you need any further assistance, please let me know!", role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}, annotations=[]), provider_specific_fields={})], usage=Usage(completion_tokens=127, prompt_tokens=29938, total_tokens=30065, completion_tokens_details=CompletionTokensDetailsWrapper(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0, text_tokens=None), prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=0, cached_tokens=29568, text_tokens=None, image_tokens=None)), service_tier='default')
2025-12-09 13:48:43,103 - DEBUG - swea-lm-django__django-11099 - input_tokens=29,440, output_tokens=126, instance_cost=0.04, cost=0.00
2025-12-09 13:48:43,103 - DEBUG - swea-lm-django__django-11099 - total_tokens_sent=309,685, total_tokens_received=422, total_cost=1.05, total_api_calls=11
2025-12-09 13:48:43,103 - WARNING - swea-agent-django__django-11099 - Requerying model after FunctionCallingFormatError (1th requery)
2025-12-09 13:48:43,107 - WARNING - swea-agent-django__django-11099 - Your last output did not use any tool calls!
Please make sure your output includes exactly _ONE_ function call!
You must invoke the function directly using the function call format.
You cannot invoke commands with ```, you have to use the function call format.
If you think you have already resolved the issue, please submit your changes by running the `submit` command.
If you think you cannot solve the problem, please run `exit_forfeit` (if available) or `submit`.
Else, please continue with a new tool call!
2025-12-09 13:48:43,112 - DEBUG - swea-lm-django__django-11099 - n_cache_control: 2
2025-12-09 13:48:50,730 - DEBUG - swea-lm-django__django-11099 - Response: ModelResponse(id='chatcmpl-Ckx3S3dxekKqbZXZ4JhZj6hrQNbBz', created=1765306130, model='gpt-4.1-mini-2025-04-14', object='chat.completion', system_fingerprint='fp_7abc656409', choices=[Choices(finish_reason='tool_calls', index=0, message=Message(content=None, role='assistant', tool_calls=[ChatCompletionMessageToolCall(function=Function(arguments='{"command":"rg --json \'ASCIIUsernameValidator|UnicodeUsernameValidator\' -p /testbed --json-seq"}', name='bash'), id='call_9qz2KOj7XIrnniwR63tXUNFf', type='function')], function_call=None, provider_specific_fields={'refusal': None}, annotations=[]), provider_specific_fields={})], usage=Usage(completion_tokens=34, prompt_tokens=30179, total_tokens=30213, completion_tokens_details=CompletionTokensDetailsWrapper(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0, text_tokens=None), prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=0, cached_tokens=29952, text_tokens=None, image_tokens=None)), service_tier='default')
2025-12-09 13:48:50,731 - DEBUG - swea-lm-django__django-11099 - input_tokens=29,681, output_tokens=0, instance_cost=0.04, cost=0.00
2025-12-09 13:48:50,731 - DEBUG - swea-lm-django__django-11099 - total_tokens_sent=339,366, total_tokens_received=422, total_cost=1.05, total_api_calls=12
2025-12-09 13:48:50,732 - INFO - swea-agent-django__django-11099 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
rg --json 'ASCIIUsernameValidator|UnicodeUsernameValidator' -p /testbed --json-seq
2025-12-09 13:48:51,004 - DEBUG - swea-tools-django__django-11099 - Retrieved state from environment: {'working_dir': '/testbed'}
2025-12-09 13:48:51,005 - INFO - swea-agent-django__django-11099 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nUsernameValidator allows trailing newline in usernames\nDescription\n\t\nASCIIUsernameValidator and UnicodeUsernameValidator use the regex \nr\'^[\\w.@+-]+$\'\nThe intent is to only allow alphanumeric characters as well as ., @, +, and -. However, a little known quirk of Python regexes is that $ will also match a trailing newline. Therefore, the user name validators will accept usernames which end with a newline. You can avoid this behavior by instead using \\A and \\Z to terminate regexes. For example, the validator regex could be changed to\nr\'\\A[\\w.@+-]+\\Z\'\nin order to reject usernames that end with a newline.\nI am not sure how to officially post a patch, but the required change is trivial - using the regex above in the two validators in contrib.auth.validators.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg --json 'ASCIIUsernameValidator|UnicodeUsernameValidator' -p /testbed --json-seq", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json \'ASCIIUsernameValidator|UnicodeUsernameValidator\' -p /testbed --json-seq"}', 'name': 'bash'}, 'id': 'call_J7GJ3oMYCbWDX5I8vdqMsgtO', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_J7GJ3oMYCbWDX5I8vdqMsgtO']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "grep -r 'ASCIIUsernameValidator' /testbed", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r \'ASCIIUsernameValidator\' /testbed"}', 'name': 'bash'}, 'id': 'call_ZbjCFotvwa2sWaEWdJXNyJS5', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n/testbed/docs/ref/contrib/auth.txt:            from django.contrib.auth.validators import ASCIIUsernameValidator\n/testbed/docs/ref/contrib/auth.txt:                username_validator = ASCIIUsernameValidator()\n/testbed/docs/ref/contrib/auth.txt:.. class:: validators.ASCIIUsernameValidator\n/testbed/docs/releases/1.10.txt::class:`~django.contrib.auth.validators.ASCIIUsernameValidator` or\n/testbed/django/contrib/auth/validators.py:class ASCIIUsernameValidator(validators.RegexValidator):\n/testbed/tests/auth_tests/test_validators.py:        v = validators.ASCIIUsernameValidator()\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_ZbjCFotvwa2sWaEWdJXNyJS5']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/contrib/auth/validators.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/contrib/auth/validators.py"}', 'name': 'bash'}, 'id': 'call_SMj3oIloVNnrJznWZMPtfV2N', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nimport re\n\nfrom django.core import validators\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.translation import gettext_lazy as _\n\n\n@deconstructible\nclass ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r'^[\\w.@+-]+$'\n    message = _(\n        'Enter a valid username. This value may contain only English letters, '\n        'numbers, and @/./+/-/_ characters.'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r'^[\\w.@+-]+$'\n    message = _(\n        'Enter a valid username. This value may contain only letters, '\n        'numbers, and @/./+/-/_ characters.'\n    )\n    flags = 0\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_SMj3oIloVNnrJznWZMPtfV2N']}, {'role': 'assistant', 'content': "The issue described in the PR is that the regex used in ASCIIUsernameValidator and UnicodeUsernameValidator allows trailing newlines because the $ in regex matches the end of the string or just before the newline at the end of the string.\n\nThe fix is to replace the regex pattern from r'^[\\w.@+-]+$' to r'\\\\A[\\\\w.@+-]+\\\\Z' in both ASCIIUsernameValidator and UnicodeUsernameValidator classes.\n\nI will now proceed to make this change in the file /testbed/django/contrib/auth/validators.py.", 'thought': "The issue described in the PR is that the regex used in ASCIIUsernameValidator and UnicodeUsernameValidator allows trailing newlines because the $ in regex matches the end of the string or just before the newline at the end of the string.\n\nThe fix is to replace the regex pattern from r'^[\\w.@+-]+$' to r'\\\\A[\\\\w.@+-]+\\\\Z' in both ASCIIUsernameValidator and UnicodeUsernameValidator classes.\n\nI will now proceed to make this change in the file /testbed/django/contrib/auth/validators.py.", 'action': 'str_replace_editor str_replace /testbed/django/contrib/auth/validators.py   --old_str \'class ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'^[\\w.@+-]+$\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only English letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'^[\\w.@+-]+$\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = 0\' --new_str \'class ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'\\A[\\w.@+-]+\\Z\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only English letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'\\A[\\w.@+-]+\\Z\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = 0\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/django/contrib/auth/validators.py","old_str":"class ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'^[\\\\w.@+-]+$\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only English letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = re.ASCII\\n\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'^[\\\\w.@+-]+$\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = 0","new_str":"class ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only English letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = re.ASCII\\n\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = 0"}', 'name': 'str_replace_editor'}, 'id': 'call_JYqxO1MgLsIHZqR1qvM9AAut', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/django/contrib/auth/validators.py has been edited. Here's the result of running `cat -n` on a snippet of /testbed/django/contrib/auth/validators.py:\n     4\tfrom django.utils.deconstruct import deconstructible\n     5\tfrom django.utils.translation import gettext_lazy as _\n     6\t\n     7\t\n     8\t@deconstructible\n     9\tclass ASCIIUsernameValidator(validators.RegexValidator):\n    10\t    regex = r'\\A[\\w.@+-]+\\Z'\n    11\t    message = _(\n    12\t        'Enter a valid username. This value may contain only English letters, '\n    13\t        'numbers, and @/./+/-/_ characters.'\n    14\t    )\n    15\t    flags = re.ASCII\n    16\t\n    17\t\n    18\t@deconstructible\n    19\tclass UnicodeUsernameValidator(validators.RegexValidator):\n    20\t    regex = r'\\A[\\w.@+-]+\\Z'\n    21\t    message = _(\n    22\t        'Enter a valid username. This value may contain only letters, '\n    23\t        'numbers, and @/./+/-/_ characters.'\n    24\t    )\n    25\t    flags = 0\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_JYqxO1MgLsIHZqR1qvM9AAut']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'echo "import re\nfrom django.core import validators\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.translation import gettext_lazy as _\n\n@deconstructible\nclass ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'\\A[\\w.@+-]+\\Z\'\n    message = _(\'Enter a valid username. This value may contain only English letters, numbers, and @/./+/-/_ characters.\')\n    flags = re.ASCII\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'\\A[\\w.@+-]+\\Z\'\n    message = _(\'Enter a valid username. This value may contain only letters, numbers, and @/./+/-/_ characters.\')\n    flags = 0\n\n# Test code to verify the regex behavior\nif __name__ == \'__main__\':\n    import re\n\n    ascii_validator = ASCIIUsernameValidator()\n    unicode_validator = UnicodeUsernameValidator()\n\n    test_usernames = [\n        \'validusername\',\n        \'valid.username\',\n        \'valid@username\',\n        \'valid+username\',\n        \'valid-username\',\n        \'valid_username\',\n        \'invalidusername\\n\',\n        \'invalidusername\\r\\n\',\n        \'invalidusername\\n \',\n        \'invalidusername \',\n    ]\n\n    print(\'Testing ASCIIUsernameValidator:\')\n    for username in test_usernames:\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\n            print(f\'Valid: {repr(username)}\')\n        else:\n            print(f\'Invalid: {repr(username)}\')\n\n    print(\'\\nTesting UnicodeUsernameValidator:\')\n    for username in test_usernames:\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\n            print(f\'Valid: {repr(username)}\')\n        else:\n            print(f\'Invalid: {repr(username)}\')\n" > /testbed/test_username_validator.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"echo \\"import re\\nfrom django.core import validators\\nfrom django.utils.deconstruct import deconstructible\\nfrom django.utils.translation import gettext_lazy as _\\n\\n@deconstructible\\nclass ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\'Enter a valid username. This value may contain only English letters, numbers, and @/./+/-/_ characters.\')\\n    flags = re.ASCII\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\'Enter a valid username. This value may contain only letters, numbers, and @/./+/-/_ characters.\')\\n    flags = 0\\n\\n# Test code to verify the regex behavior\\nif __name__ == \'__main__\':\\n    import re\\n\\n    ascii_validator = ASCIIUsernameValidator()\\n    unicode_validator = UnicodeUsernameValidator()\\n\\n    test_usernames = [\\n        \'validusername\',\\n        \'valid.username\',\\n        \'valid@username\',\\n        \'valid+username\',\\n        \'valid-username\',\\n        \'valid_username\',\\n        \'invalidusername\\\\n\',\\n        \'invalidusername\\\\r\\\\n\',\\n        \'invalidusername\\\\n \',\\n        \'invalidusername \',\\n    ]\\n\\n    print(\'Testing ASCIIUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\n    print(\'\\\\nTesting UnicodeUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\" > /testbed/test_username_validator.py"}', 'name': 'bash'}, 'id': 'call_U2yq9YRzm9PEfOxxo9zlvpkv', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'Your command ran successfully and did not produce any output.'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_U2yq9YRzm9PEfOxxo9zlvpkv']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/test_username_validator.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/test_username_validator.py"}', 'name': 'bash'}, 'id': 'call_hW1YxOF8W4LREApTv7LuKrOw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nTesting ASCIIUsernameValidator:\nTraceback (most recent call last):\n  File "/testbed/test_username_validator.py", line 40, in <module>\n    if re.match(ascii_validator.regex, username, ascii_validator.flags):\n  File "/opt/miniconda3/envs/testbed/lib/python3.6/re.py", line 172, in match\n    return _compile(pattern, flags).match(string)\n  File "/opt/miniconda3/envs/testbed/lib/python3.6/re.py", line 297, in _compile\n    "cannot process flags argument with a compiled pattern")\nValueError: cannot process flags argument with a compiled pattern\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_hW1YxOF8W4LREApTv7LuKrOw']}, {'role': 'assistant', 'content': 'The error "ValueError: cannot process flags argument with a compiled pattern" occurs because the regex attribute in the validators is already a compiled regex pattern (likely compiled by RegexValidator), and passing flags again to re.match is causing the error.\n\nTo fix this, I will modify the test code to use the validator\'s own validation method instead of directly using re.match with the regex and flags. The RegexValidator class has a __call__ method that can be used to validate a value.\n\nI will update the test script to use the validator instances directly to validate the usernames.', 'thought': 'The error "ValueError: cannot process flags argument with a compiled pattern" occurs because the regex attribute in the validators is already a compiled regex pattern (likely compiled by RegexValidator), and passing flags again to re.match is causing the error.\n\nTo fix this, I will modify the test code to use the validator\'s own validation method instead of directly using re.match with the regex and flags. The RegexValidator class has a __call__ method that can be used to validate a value.\n\nI will update the test script to use the validator instances directly to validate the usernames.', 'action': 'str_replace_editor str_replace /testbed/test_username_validator.py   --old_str \'    print(\'"\'"\'Testing ASCIIUsernameValidator:\'"\'"\')\n    for username in test_usernames:\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\n            print(f\'"\'"\'Valid: {repr(username)}\'"\'"\')\n        else:\n            print(f\'"\'"\'Invalid: {repr(username)}\'"\'"\')\n\n    print(\'"\'"\'\\nTesting UnicodeUsernameValidator:\'"\'"\')\n    for username in test_usernames:\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\n            print(f\'"\'"\'Valid: {repr(username)}\'"\'"\')\n        else:\n            print(f\'"\'"\'Invalid: {repr(username)}\'"\'"\')\' --new_str \'    print(\'"\'"\'Testing ASCIIUsernameValidator:\'"\'"\')\n    for username in test_usernames:\n        try:\n            ascii_validator(username)\n            print(f\'"\'"\'Valid: {repr(username)}\'"\'"\')\n        except Exception:\n            print(f\'"\'"\'Invalid: {repr(username)}\'"\'"\')\n\n    print(\'"\'"\'\\nTesting UnicodeUsernameValidator:\'"\'"\')\n    for username in test_usernames:\n        try:\n            unicode_validator(username)\n            print(f\'"\'"\'Valid: {repr(username)}\'"\'"\')\n        except Exception:\n            print(f\'"\'"\'Invalid: {repr(username)}\'"\'"\')\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/test_username_validator.py","old_str":"    print(\'Testing ASCIIUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\n    print(\'\\\\nTesting UnicodeUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')","new_str":"    print(\'Testing ASCIIUsernameValidator:\')\\n    for username in test_usernames:\\n        try:\\n            ascii_validator(username)\\n            print(f\'Valid: {repr(username)}\')\\n        except Exception:\\n            print(f\'Invalid: {repr(username)}\')\\n\\n    print(\'\\\\nTesting UnicodeUsernameValidator:\')\\n    for username in test_usernames:\\n        try:\\n            unicode_validator(username)\\n            print(f\'Valid: {repr(username)}\')\\n        except Exception:\\n            print(f\'Invalid: {repr(username)}\')"}', 'name': 'str_replace_editor'}, 'id': 'call_mVQy1JaQ1R1iJ3leHcNyOiMI', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/test_username_validator.py has been edited. Here's the result of running `cat -n` on a snippet of /testbed/test_username_validator.py:\n    33\t        'invalidusername\\r\\n',\n    34\t        'invalidusername\\n ',\n    35\t        'invalidusername ',\n    36\t    ]\n    37\t\n    38\t    print('Testing ASCIIUsernameValidator:')\n    39\t    for username in test_usernames:\n    40\t        try:\n    41\t            ascii_validator(username)\n    42\t            print(f'Valid: {repr(username)}')\n    43\t        except Exception:\n    44\t            print(f'Invalid: {repr(username)}')\n    45\t\n    46\t    print('\\nTesting UnicodeUsernameValidator:')\n    47\t    for username in test_usernames:\n    48\t        try:\n    49\t            unicode_validator(username)\n    50\t            print(f'Valid: {repr(username)}')\n    51\t        except Exception:\n    52\t            print(f'Invalid: {repr(username)}')\n    53\t\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mVQy1JaQ1R1iJ3leHcNyOiMI']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/test_username_validator.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/test_username_validator.py"}', 'name': 'bash'}, 'id': 'call_Otq90NHIfWbno62DI8o1UQN0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nTesting ASCIIUsernameValidator:\nValid: 'validusername'\nValid: 'valid.username'\nValid: 'valid@username'\nValid: 'valid+username'\nValid: 'valid-username'\nValid: 'valid_username'\nInvalid: 'invalidusername\\n'\nInvalid: 'invalidusername\\r\\n'\nInvalid: 'invalidusername\\n '\nInvalid: 'invalidusername '\n\nTesting UnicodeUsernameValidator:\nValid: 'validusername'\nValid: 'valid.username'\nValid: 'valid@username'\nValid: 'valid+username'\nValid: 'valid-username'\nValid: 'valid_username'\nInvalid: 'invalidusername\\n'\nInvalid: 'invalidusername\\r\\n'\nInvalid: 'invalidusername\\n '\nInvalid: 'invalidusername '\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Otq90NHIfWbno62DI8o1UQN0'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rm /testbed/test_username_validator.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rm /testbed/test_username_validator.py"}', 'name': 'bash'}, 'id': 'call_GcDRFQ8TIdEVdXxf8Oaefi8d', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'Your command ran successfully and did not produce any output.'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_GcDRFQ8TIdEVdXxf8Oaefi8d'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:48:51,006 - INFO - swea-agent-django__django-11099 - ðŸ¤– MODEL INPUT
OBSERVATION:
bash: rg: command not found

2025-12-09 13:48:51,017 - INFO - swea-agent-django__django-11099 - ========================= STEP 13 =========================
2025-12-09 13:48:51,025 - DEBUG - swea-lm-django__django-11099 - n_cache_control: 2
2025-12-09 13:49:01,541 - DEBUG - swea-lm-django__django-11099 - Response: ModelResponse(id='chatcmpl-Ckx3bieN8HS2weNsU6iqhLuEqYwmz', created=1765306139, model='gpt-4.1-mini-2025-04-14', object='chat.completion', system_fingerprint='fp_7abc656409', choices=[Choices(finish_reason='stop', index=0, message=Message(content='I have made the required changes to the regex patterns in ASCIIUsernameValidator and UnicodeUsernameValidator classes in the file django/contrib/auth/validators.py to use \\\\A and \\\\Z instead of ^ and $ to prevent trailing newlines in usernames.\n\nI have also created and run a test script to verify that usernames with trailing newlines are now rejected by the validators, and usernames without trailing newlines are accepted.\n\nThe fix is complete and verified. If you want, I can submit the changes now.', role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}, annotations=[]), provider_specific_fields={})], usage=Usage(completion_tokens=101, prompt_tokens=29991, total_tokens=30092, completion_tokens_details=CompletionTokensDetailsWrapper(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0, text_tokens=None), prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=0, cached_tokens=29696, text_tokens=None, image_tokens=None)), service_tier='default')
2025-12-09 13:49:01,543 - DEBUG - swea-lm-django__django-11099 - input_tokens=29,506, output_tokens=100, instance_cost=0.04, cost=0.00
2025-12-09 13:49:01,543 - DEBUG - swea-lm-django__django-11099 - total_tokens_sent=368,872, total_tokens_received=522, total_cost=1.06, total_api_calls=13
2025-12-09 13:49:01,543 - WARNING - swea-agent-django__django-11099 - Requerying model after FunctionCallingFormatError (1th requery)
2025-12-09 13:49:01,552 - WARNING - swea-agent-django__django-11099 - Your last output did not use any tool calls!
Please make sure your output includes exactly _ONE_ function call!
You must invoke the function directly using the function call format.
You cannot invoke commands with ```, you have to use the function call format.
If you think you have already resolved the issue, please submit your changes by running the `submit` command.
If you think you cannot solve the problem, please run `exit_forfeit` (if available) or `submit`.
Else, please continue with a new tool call!
2025-12-09 13:49:01,563 - DEBUG - swea-lm-django__django-11099 - n_cache_control: 2
2025-12-09 13:49:08,518 - DEBUG - swea-lm-django__django-11099 - Response: ModelResponse(id='chatcmpl-Ckx3kYE4WE8T9BWevdRHQSHzMJpqd', created=1765306148, model='gpt-4.1-mini-2025-04-14', object='chat.completion', system_fingerprint='fp_7abc656409', choices=[Choices(finish_reason='tool_calls', index=0, message=Message(content=None, role='assistant', tool_calls=[ChatCompletionMessageToolCall(function=Function(arguments='{}', name='submit'), id='call_dhDSfpyZnttVrRAo7rJDS9Vu', type='function')], function_call=None, provider_specific_fields={'refusal': None}, annotations=[]), provider_specific_fields={})], usage=Usage(completion_tokens=9, prompt_tokens=30206, total_tokens=30215, completion_tokens_details=CompletionTokensDetailsWrapper(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0, text_tokens=None), prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=0, cached_tokens=29568, text_tokens=None, image_tokens=None)), service_tier='default')
2025-12-09 13:49:08,519 - DEBUG - swea-lm-django__django-11099 - input_tokens=29,721, output_tokens=0, instance_cost=0.05, cost=0.00
2025-12-09 13:49:08,520 - DEBUG - swea-lm-django__django-11099 - total_tokens_sent=398,593, total_tokens_received=522, total_cost=1.06, total_api_calls=14
2025-12-09 13:49:08,520 - INFO - swea-agent-django__django-11099 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
submit
2025-12-09 13:49:08,958 - DEBUG - swea-tools-django__django-11099 - Retrieved state from environment: {'working_dir': '/testbed'}
2025-12-09 13:49:08,959 - INFO - swea-agent-django__django-11099 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nUsernameValidator allows trailing newline in usernames\nDescription\n\t\nASCIIUsernameValidator and UnicodeUsernameValidator use the regex \nr\'^[\\w.@+-]+$\'\nThe intent is to only allow alphanumeric characters as well as ., @, +, and -. However, a little known quirk of Python regexes is that $ will also match a trailing newline. Therefore, the user name validators will accept usernames which end with a newline. You can avoid this behavior by instead using \\A and \\Z to terminate regexes. For example, the validator regex could be changed to\nr\'\\A[\\w.@+-]+\\Z\'\nin order to reject usernames that end with a newline.\nI am not sure how to officially post a patch, but the required change is trivial - using the regex above in the two validators in contrib.auth.validators.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg --json 'ASCIIUsernameValidator|UnicodeUsernameValidator' -p /testbed --json-seq", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json \'ASCIIUsernameValidator|UnicodeUsernameValidator\' -p /testbed --json-seq"}', 'name': 'bash'}, 'id': 'call_J7GJ3oMYCbWDX5I8vdqMsgtO', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_J7GJ3oMYCbWDX5I8vdqMsgtO']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "grep -r 'ASCIIUsernameValidator' /testbed", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r \'ASCIIUsernameValidator\' /testbed"}', 'name': 'bash'}, 'id': 'call_ZbjCFotvwa2sWaEWdJXNyJS5', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n/testbed/docs/ref/contrib/auth.txt:            from django.contrib.auth.validators import ASCIIUsernameValidator\n/testbed/docs/ref/contrib/auth.txt:                username_validator = ASCIIUsernameValidator()\n/testbed/docs/ref/contrib/auth.txt:.. class:: validators.ASCIIUsernameValidator\n/testbed/docs/releases/1.10.txt::class:`~django.contrib.auth.validators.ASCIIUsernameValidator` or\n/testbed/django/contrib/auth/validators.py:class ASCIIUsernameValidator(validators.RegexValidator):\n/testbed/tests/auth_tests/test_validators.py:        v = validators.ASCIIUsernameValidator()\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_ZbjCFotvwa2sWaEWdJXNyJS5']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/contrib/auth/validators.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/contrib/auth/validators.py"}', 'name': 'bash'}, 'id': 'call_SMj3oIloVNnrJznWZMPtfV2N', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nimport re\n\nfrom django.core import validators\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.translation import gettext_lazy as _\n\n\n@deconstructible\nclass ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r'^[\\w.@+-]+$'\n    message = _(\n        'Enter a valid username. This value may contain only English letters, '\n        'numbers, and @/./+/-/_ characters.'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r'^[\\w.@+-]+$'\n    message = _(\n        'Enter a valid username. This value may contain only letters, '\n        'numbers, and @/./+/-/_ characters.'\n    )\n    flags = 0\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_SMj3oIloVNnrJznWZMPtfV2N']}, {'role': 'assistant', 'content': "The issue described in the PR is that the regex used in ASCIIUsernameValidator and UnicodeUsernameValidator allows trailing newlines because the $ in regex matches the end of the string or just before the newline at the end of the string.\n\nThe fix is to replace the regex pattern from r'^[\\w.@+-]+$' to r'\\\\A[\\\\w.@+-]+\\\\Z' in both ASCIIUsernameValidator and UnicodeUsernameValidator classes.\n\nI will now proceed to make this change in the file /testbed/django/contrib/auth/validators.py.", 'thought': "The issue described in the PR is that the regex used in ASCIIUsernameValidator and UnicodeUsernameValidator allows trailing newlines because the $ in regex matches the end of the string or just before the newline at the end of the string.\n\nThe fix is to replace the regex pattern from r'^[\\w.@+-]+$' to r'\\\\A[\\\\w.@+-]+\\\\Z' in both ASCIIUsernameValidator and UnicodeUsernameValidator classes.\n\nI will now proceed to make this change in the file /testbed/django/contrib/auth/validators.py.", 'action': 'str_replace_editor str_replace /testbed/django/contrib/auth/validators.py   --old_str \'class ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'^[\\w.@+-]+$\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only English letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'^[\\w.@+-]+$\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = 0\' --new_str \'class ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'\\A[\\w.@+-]+\\Z\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only English letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'\\A[\\w.@+-]+\\Z\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = 0\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/django/contrib/auth/validators.py","old_str":"class ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'^[\\\\w.@+-]+$\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only English letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = re.ASCII\\n\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'^[\\\\w.@+-]+$\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = 0","new_str":"class ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only English letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = re.ASCII\\n\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = 0"}', 'name': 'str_replace_editor'}, 'id': 'call_JYqxO1MgLsIHZqR1qvM9AAut', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/django/contrib/auth/validators.py has been edited. Here's the result of running `cat -n` on a snippet of /testbed/django/contrib/auth/validators.py:\n     4\tfrom django.utils.deconstruct import deconstructible\n     5\tfrom django.utils.translation import gettext_lazy as _\n     6\t\n     7\t\n     8\t@deconstructible\n     9\tclass ASCIIUsernameValidator(validators.RegexValidator):\n    10\t    regex = r'\\A[\\w.@+-]+\\Z'\n    11\t    message = _(\n    12\t        'Enter a valid username. This value may contain only English letters, '\n    13\t        'numbers, and @/./+/-/_ characters.'\n    14\t    )\n    15\t    flags = re.ASCII\n    16\t\n    17\t\n    18\t@deconstructible\n    19\tclass UnicodeUsernameValidator(validators.RegexValidator):\n    20\t    regex = r'\\A[\\w.@+-]+\\Z'\n    21\t    message = _(\n    22\t        'Enter a valid username. This value may contain only letters, '\n    23\t        'numbers, and @/./+/-/_ characters.'\n    24\t    )\n    25\t    flags = 0\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_JYqxO1MgLsIHZqR1qvM9AAut']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'echo "import re\nfrom django.core import validators\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.translation import gettext_lazy as _\n\n@deconstructible\nclass ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'\\A[\\w.@+-]+\\Z\'\n    message = _(\'Enter a valid username. This value may contain only English letters, numbers, and @/./+/-/_ characters.\')\n    flags = re.ASCII\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'\\A[\\w.@+-]+\\Z\'\n    message = _(\'Enter a valid username. This value may contain only letters, numbers, and @/./+/-/_ characters.\')\n    flags = 0\n\n# Test code to verify the regex behavior\nif __name__ == \'__main__\':\n    import re\n\n    ascii_validator = ASCIIUsernameValidator()\n    unicode_validator = UnicodeUsernameValidator()\n\n    test_usernames = [\n        \'validusername\',\n        \'valid.username\',\n        \'valid@username\',\n        \'valid+username\',\n        \'valid-username\',\n        \'valid_username\',\n        \'invalidusername\\n\',\n        \'invalidusername\\r\\n\',\n        \'invalidusername\\n \',\n        \'invalidusername \',\n    ]\n\n    print(\'Testing ASCIIUsernameValidator:\')\n    for username in test_usernames:\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\n            print(f\'Valid: {repr(username)}\')\n        else:\n            print(f\'Invalid: {repr(username)}\')\n\n    print(\'\\nTesting UnicodeUsernameValidator:\')\n    for username in test_usernames:\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\n            print(f\'Valid: {repr(username)}\')\n        else:\n            print(f\'Invalid: {repr(username)}\')\n" > /testbed/test_username_validator.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"echo \\"import re\\nfrom django.core import validators\\nfrom django.utils.deconstruct import deconstructible\\nfrom django.utils.translation import gettext_lazy as _\\n\\n@deconstructible\\nclass ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\'Enter a valid username. This value may contain only English letters, numbers, and @/./+/-/_ characters.\')\\n    flags = re.ASCII\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\'Enter a valid username. This value may contain only letters, numbers, and @/./+/-/_ characters.\')\\n    flags = 0\\n\\n# Test code to verify the regex behavior\\nif __name__ == \'__main__\':\\n    import re\\n\\n    ascii_validator = ASCIIUsernameValidator()\\n    unicode_validator = UnicodeUsernameValidator()\\n\\n    test_usernames = [\\n        \'validusername\',\\n        \'valid.username\',\\n        \'valid@username\',\\n        \'valid+username\',\\n        \'valid-username\',\\n        \'valid_username\',\\n        \'invalidusername\\\\n\',\\n        \'invalidusername\\\\r\\\\n\',\\n        \'invalidusername\\\\n \',\\n        \'invalidusername \',\\n    ]\\n\\n    print(\'Testing ASCIIUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\n    print(\'\\\\nTesting UnicodeUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\" > /testbed/test_username_validator.py"}', 'name': 'bash'}, 'id': 'call_U2yq9YRzm9PEfOxxo9zlvpkv', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'Your command ran successfully and did not produce any output.'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_U2yq9YRzm9PEfOxxo9zlvpkv']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/test_username_validator.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/test_username_validator.py"}', 'name': 'bash'}, 'id': 'call_hW1YxOF8W4LREApTv7LuKrOw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nTesting ASCIIUsernameValidator:\nTraceback (most recent call last):\n  File "/testbed/test_username_validator.py", line 40, in <module>\n    if re.match(ascii_validator.regex, username, ascii_validator.flags):\n  File "/opt/miniconda3/envs/testbed/lib/python3.6/re.py", line 172, in match\n    return _compile(pattern, flags).match(string)\n  File "/opt/miniconda3/envs/testbed/lib/python3.6/re.py", line 297, in _compile\n    "cannot process flags argument with a compiled pattern")\nValueError: cannot process flags argument with a compiled pattern\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_hW1YxOF8W4LREApTv7LuKrOw']}, {'role': 'assistant', 'content': 'The error "ValueError: cannot process flags argument with a compiled pattern" occurs because the regex attribute in the validators is already a compiled regex pattern (likely compiled by RegexValidator), and passing flags again to re.match is causing the error.\n\nTo fix this, I will modify the test code to use the validator\'s own validation method instead of directly using re.match with the regex and flags. The RegexValidator class has a __call__ method that can be used to validate a value.\n\nI will update the test script to use the validator instances directly to validate the usernames.', 'thought': 'The error "ValueError: cannot process flags argument with a compiled pattern" occurs because the regex attribute in the validators is already a compiled regex pattern (likely compiled by RegexValidator), and passing flags again to re.match is causing the error.\n\nTo fix this, I will modify the test code to use the validator\'s own validation method instead of directly using re.match with the regex and flags. The RegexValidator class has a __call__ method that can be used to validate a value.\n\nI will update the test script to use the validator instances directly to validate the usernames.', 'action': 'str_replace_editor str_replace /testbed/test_username_validator.py   --old_str \'    print(\'"\'"\'Testing ASCIIUsernameValidator:\'"\'"\')\n    for username in test_usernames:\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\n            print(f\'"\'"\'Valid: {repr(username)}\'"\'"\')\n        else:\n            print(f\'"\'"\'Invalid: {repr(username)}\'"\'"\')\n\n    print(\'"\'"\'\\nTesting UnicodeUsernameValidator:\'"\'"\')\n    for username in test_usernames:\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\n            print(f\'"\'"\'Valid: {repr(username)}\'"\'"\')\n        else:\n            print(f\'"\'"\'Invalid: {repr(username)}\'"\'"\')\' --new_str \'    print(\'"\'"\'Testing ASCIIUsernameValidator:\'"\'"\')\n    for username in test_usernames:\n        try:\n            ascii_validator(username)\n            print(f\'"\'"\'Valid: {repr(username)}\'"\'"\')\n        except Exception:\n            print(f\'"\'"\'Invalid: {repr(username)}\'"\'"\')\n\n    print(\'"\'"\'\\nTesting UnicodeUsernameValidator:\'"\'"\')\n    for username in test_usernames:\n        try:\n            unicode_validator(username)\n            print(f\'"\'"\'Valid: {repr(username)}\'"\'"\')\n        except Exception:\n            print(f\'"\'"\'Invalid: {repr(username)}\'"\'"\')\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/test_username_validator.py","old_str":"    print(\'Testing ASCIIUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\n    print(\'\\\\nTesting UnicodeUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')","new_str":"    print(\'Testing ASCIIUsernameValidator:\')\\n    for username in test_usernames:\\n        try:\\n            ascii_validator(username)\\n            print(f\'Valid: {repr(username)}\')\\n        except Exception:\\n            print(f\'Invalid: {repr(username)}\')\\n\\n    print(\'\\\\nTesting UnicodeUsernameValidator:\')\\n    for username in test_usernames:\\n        try:\\n            unicode_validator(username)\\n            print(f\'Valid: {repr(username)}\')\\n        except Exception:\\n            print(f\'Invalid: {repr(username)}\')"}', 'name': 'str_replace_editor'}, 'id': 'call_mVQy1JaQ1R1iJ3leHcNyOiMI', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/test_username_validator.py has been edited. Here's the result of running `cat -n` on a snippet of /testbed/test_username_validator.py:\n    33\t        'invalidusername\\r\\n',\n    34\t        'invalidusername\\n ',\n    35\t        'invalidusername ',\n    36\t    ]\n    37\t\n    38\t    print('Testing ASCIIUsernameValidator:')\n    39\t    for username in test_usernames:\n    40\t        try:\n    41\t            ascii_validator(username)\n    42\t            print(f'Valid: {repr(username)}')\n    43\t        except Exception:\n    44\t            print(f'Invalid: {repr(username)}')\n    45\t\n    46\t    print('\\nTesting UnicodeUsernameValidator:')\n    47\t    for username in test_usernames:\n    48\t        try:\n    49\t            unicode_validator(username)\n    50\t            print(f'Valid: {repr(username)}')\n    51\t        except Exception:\n    52\t            print(f'Invalid: {repr(username)}')\n    53\t\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mVQy1JaQ1R1iJ3leHcNyOiMI']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/test_username_validator.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/test_username_validator.py"}', 'name': 'bash'}, 'id': 'call_Otq90NHIfWbno62DI8o1UQN0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nTesting ASCIIUsernameValidator:\nValid: 'validusername'\nValid: 'valid.username'\nValid: 'valid@username'\nValid: 'valid+username'\nValid: 'valid-username'\nValid: 'valid_username'\nInvalid: 'invalidusername\\n'\nInvalid: 'invalidusername\\r\\n'\nInvalid: 'invalidusername\\n '\nInvalid: 'invalidusername '\n\nTesting UnicodeUsernameValidator:\nValid: 'validusername'\nValid: 'valid.username'\nValid: 'valid@username'\nValid: 'valid+username'\nValid: 'valid-username'\nValid: 'valid_username'\nInvalid: 'invalidusername\\n'\nInvalid: 'invalidusername\\r\\n'\nInvalid: 'invalidusername\\n '\nInvalid: 'invalidusername '\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Otq90NHIfWbno62DI8o1UQN0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rm /testbed/test_username_validator.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rm /testbed/test_username_validator.py"}', 'name': 'bash'}, 'id': 'call_GcDRFQ8TIdEVdXxf8Oaefi8d', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'Your command ran successfully and did not produce any output.'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_GcDRFQ8TIdEVdXxf8Oaefi8d'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg --json 'ASCIIUsernameValidator|UnicodeUsernameValidator' -p /testbed --json-seq", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json \'ASCIIUsernameValidator|UnicodeUsernameValidator\' -p /testbed --json-seq"}', 'name': 'bash'}, 'id': 'call_9qz2KOj7XIrnniwR63tXUNFf', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9qz2KOj7XIrnniwR63tXUNFf'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:49:08,960 - INFO - swea-agent-django__django-11099 - ðŸ¤– MODEL INPUT
OBSERVATION:
Thank you for your work on this issue. Please carefully follow the steps below to help review your changes.

1. If you made any changes to your code after running the reproduction script, please run the reproduction script again.
  If the reproduction script is failing, please revisit your changes and make sure they are correct.
  If you have already removed your reproduction script, please ignore this step.
2. Remove your reproduction script (if you haven't done so already).
3. If you have modified any TEST files, please revert them to the state they had before you started fixing the issue.
  You can do this with `git checkout -- /path/to/test/file.py`. Use below <diff> to find the files you need to revert.
4. Run the submit command again to confirm.

Here is a list of all of your changes:

<diff>
diff --git a/django/contrib/auth/validators.py b/django/contrib/auth/validators.py
index b4878cfd45..1304f20a60 100644
--- a/django/contrib/auth/validators.py
+++ b/django/contrib/auth/validators.py
@@ -7,7 +7,7 @@ from django.utils.translation import gettext_lazy as _
 
 @deconstructible
 class ASCIIUsernameValidator(validators.RegexValidator):
-    regex = r'^[\w.@+-]+$'
+    regex = r'\A[\w.@+-]+\Z'
     message = _(
         'Enter a valid username. This value may contain only English letters, '
         'numbers, and @/./+/-/_ characters.'
@@ -17,7 +17,7 @@ class ASCIIUsernameValidator(validators.RegexValidator):
 
 @deconstructible
 class UnicodeUsernameValidator(validators.RegexValidator):
-    regex = r'^[\w.@+-]+$'
+    regex = r'\A[\w.@+-]+\Z'
     message = _(
         'Enter a valid username. This value may contain only letters, '
         'numbers, and @/./+/-/_ characters.'

</diff>


2025-12-09 13:49:08,981 - INFO - swea-agent-django__django-11099 - ========================= STEP 15 =========================
2025-12-09 13:49:08,982 - DEBUG - swea-lm-django__django-11099 - n_cache_control: 2
2025-12-09 13:49:20,119 - DEBUG - swea-lm-django__django-11099 - Response: ModelResponse(id='chatcmpl-Ckx3thQWXbdDwzXW2n1v29ziaLRtv', created=1765306157, model='gpt-4.1-mini-2025-04-14', object='chat.completion', system_fingerprint='fp_7abc656409', choices=[Choices(finish_reason='stop', index=0, message=Message(content="I have made the necessary changes to the regex patterns in the ASCIIUsernameValidator and UnicodeUsernameValidator classes in the file django/contrib/auth/validators.py. The regex patterns were changed from r'^[\\w.@+-]+$' to r'\\A[\\w.@+-]+\\Z' to prevent trailing newlines in usernames.\n\nI also created and ran a test script to verify that usernames with trailing newlines are now correctly rejected by the validators.\n\nThe changes are minimal and only affect the regex patterns in the two validator classes as requested. No test files were modified.\n\nThe issue should now be resolved. Please let me know if you need any further assistance.", role='assistant', tool_calls=None, function_call=None, provider_specific_fields={'refusal': None}, annotations=[]), provider_specific_fields={})], usage=Usage(completion_tokens=133, prompt_tokens=30438, total_tokens=30571, completion_tokens_details=CompletionTokensDetailsWrapper(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0, text_tokens=None), prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=0, cached_tokens=29952, text_tokens=None, image_tokens=None)), service_tier='default')
2025-12-09 13:49:20,120 - DEBUG - swea-lm-django__django-11099 - input_tokens=29,964, output_tokens=132, instance_cost=0.05, cost=0.00
2025-12-09 13:49:20,120 - DEBUG - swea-lm-django__django-11099 - total_tokens_sent=428,557, total_tokens_received=654, total_cost=1.06, total_api_calls=15
2025-12-09 13:49:20,121 - WARNING - swea-agent-django__django-11099 - Requerying model after FunctionCallingFormatError (1th requery)
2025-12-09 13:49:20,125 - WARNING - swea-agent-django__django-11099 - Your last output did not use any tool calls!
Please make sure your output includes exactly _ONE_ function call!
You must invoke the function directly using the function call format.
You cannot invoke commands with ```, you have to use the function call format.
If you think you have already resolved the issue, please submit your changes by running the `submit` command.
If you think you cannot solve the problem, please run `exit_forfeit` (if available) or `submit`.
Else, please continue with a new tool call!
2025-12-09 13:49:20,129 - DEBUG - swea-lm-django__django-11099 - n_cache_control: 2
2025-12-09 13:49:26,909 - DEBUG - swea-lm-django__django-11099 - Response: ModelResponse(id='chatcmpl-Ckx426AZGoo9qDpiUKUpO6wyW0gyh', created=1765306166, model='gpt-4.1-mini-2025-04-14', object='chat.completion', system_fingerprint='fp_7abc656409', choices=[Choices(finish_reason='tool_calls', index=0, message=Message(content=None, role='assistant', tool_calls=[ChatCompletionMessageToolCall(function=Function(arguments='{}', name='submit'), id='call_oeuDVPKkurGKk4DhIBdn6i6d', type='function')], function_call=None, provider_specific_fields={'refusal': None}, annotations=[]), provider_specific_fields={})], usage=Usage(completion_tokens=9, prompt_tokens=30685, total_tokens=30694, completion_tokens_details=CompletionTokensDetailsWrapper(accepted_prediction_tokens=0, audio_tokens=0, reasoning_tokens=0, rejected_prediction_tokens=0, text_tokens=None), prompt_tokens_details=PromptTokensDetailsWrapper(audio_tokens=0, cached_tokens=30464, text_tokens=None, image_tokens=None)), service_tier='default')
2025-12-09 13:49:26,911 - DEBUG - swea-lm-django__django-11099 - input_tokens=30,211, output_tokens=0, instance_cost=0.05, cost=0.00
2025-12-09 13:49:26,911 - DEBUG - swea-lm-django__django-11099 - total_tokens_sent=458,768, total_tokens_received=654, total_cost=1.07, total_api_calls=16
2025-12-09 13:49:26,911 - INFO - swea-agent-django__django-11099 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
submit
2025-12-09 13:49:27,311 - DEBUG - swea-tools-django__django-11099 - Retrieved state from environment: {'working_dir': '/testbed'}
2025-12-09 13:49:27,314 - INFO - swea-agent-django__django-11099 - Found submission: diff --git a/django/contrib/auth/validators.py b/django/contrib/auth/validators.py
index b4878cfd45..1304f20a60 100644
--- a/django/contrib/auth/validators.py
+++ b/django/contrib/auth/validators.py
@@ -7,7 +7,7 @@ from django.utils.translation import gettext_lazy as _
 
 @deconstructible
 class ASCIIUsernameValidator(validators.RegexValidator):
-    regex = r'^[\w.@+-]+$'
+    regex = r'\A[\w.@+-]+\Z'
     message = _(
         'Enter a valid username. This value may contain only English letters, '
         'numbers, and @/./+/-/_ characters.'
@@ -17,7 +17,7 @@ class ASCIIUsernameValidator(validators.RegexValidator):
 
 @deconstructible
 class UnicodeUsernameValidator(validators.RegexValidator):
-    regex = r'^[\w.@+-]+$'
+    regex = r'\A[\w.@+-]+\Z'
     message = _(
         'Enter a valid username. This value may contain only letters, '
         'numbers, and @/./+/-/_ characters.'

2025-12-09 13:49:27,315 - INFO - swea-agent-django__django-11099 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nUsernameValidator allows trailing newline in usernames\nDescription\n\t\nASCIIUsernameValidator and UnicodeUsernameValidator use the regex \nr\'^[\\w.@+-]+$\'\nThe intent is to only allow alphanumeric characters as well as ., @, +, and -. However, a little known quirk of Python regexes is that $ will also match a trailing newline. Therefore, the user name validators will accept usernames which end with a newline. You can avoid this behavior by instead using \\A and \\Z to terminate regexes. For example, the validator regex could be changed to\nr\'\\A[\\w.@+-]+\\Z\'\nin order to reject usernames that end with a newline.\nI am not sure how to officially post a patch, but the required change is trivial - using the regex above in the two validators in contrib.auth.validators.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg --json 'ASCIIUsernameValidator|UnicodeUsernameValidator' -p /testbed --json-seq", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json \'ASCIIUsernameValidator|UnicodeUsernameValidator\' -p /testbed --json-seq"}', 'name': 'bash'}, 'id': 'call_J7GJ3oMYCbWDX5I8vdqMsgtO', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_J7GJ3oMYCbWDX5I8vdqMsgtO']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "grep -r 'ASCIIUsernameValidator' /testbed", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r \'ASCIIUsernameValidator\' /testbed"}', 'name': 'bash'}, 'id': 'call_ZbjCFotvwa2sWaEWdJXNyJS5', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n/testbed/docs/ref/contrib/auth.txt:            from django.contrib.auth.validators import ASCIIUsernameValidator\n/testbed/docs/ref/contrib/auth.txt:                username_validator = ASCIIUsernameValidator()\n/testbed/docs/ref/contrib/auth.txt:.. class:: validators.ASCIIUsernameValidator\n/testbed/docs/releases/1.10.txt::class:`~django.contrib.auth.validators.ASCIIUsernameValidator` or\n/testbed/django/contrib/auth/validators.py:class ASCIIUsernameValidator(validators.RegexValidator):\n/testbed/tests/auth_tests/test_validators.py:        v = validators.ASCIIUsernameValidator()\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_ZbjCFotvwa2sWaEWdJXNyJS5']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/contrib/auth/validators.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/contrib/auth/validators.py"}', 'name': 'bash'}, 'id': 'call_SMj3oIloVNnrJznWZMPtfV2N', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nimport re\n\nfrom django.core import validators\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.translation import gettext_lazy as _\n\n\n@deconstructible\nclass ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r'^[\\w.@+-]+$'\n    message = _(\n        'Enter a valid username. This value may contain only English letters, '\n        'numbers, and @/./+/-/_ characters.'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r'^[\\w.@+-]+$'\n    message = _(\n        'Enter a valid username. This value may contain only letters, '\n        'numbers, and @/./+/-/_ characters.'\n    )\n    flags = 0\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_SMj3oIloVNnrJznWZMPtfV2N']}, {'role': 'assistant', 'content': "The issue described in the PR is that the regex used in ASCIIUsernameValidator and UnicodeUsernameValidator allows trailing newlines because the $ in regex matches the end of the string or just before the newline at the end of the string.\n\nThe fix is to replace the regex pattern from r'^[\\w.@+-]+$' to r'\\\\A[\\\\w.@+-]+\\\\Z' in both ASCIIUsernameValidator and UnicodeUsernameValidator classes.\n\nI will now proceed to make this change in the file /testbed/django/contrib/auth/validators.py.", 'thought': "The issue described in the PR is that the regex used in ASCIIUsernameValidator and UnicodeUsernameValidator allows trailing newlines because the $ in regex matches the end of the string or just before the newline at the end of the string.\n\nThe fix is to replace the regex pattern from r'^[\\w.@+-]+$' to r'\\\\A[\\\\w.@+-]+\\\\Z' in both ASCIIUsernameValidator and UnicodeUsernameValidator classes.\n\nI will now proceed to make this change in the file /testbed/django/contrib/auth/validators.py.", 'action': 'str_replace_editor str_replace /testbed/django/contrib/auth/validators.py   --old_str \'class ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'^[\\w.@+-]+$\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only English letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'^[\\w.@+-]+$\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = 0\' --new_str \'class ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'\\A[\\w.@+-]+\\Z\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only English letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = re.ASCII\n\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'"\'"\'\\A[\\w.@+-]+\\Z\'"\'"\'\n    message = _(\n        \'"\'"\'Enter a valid username. This value may contain only letters, \'"\'"\'\n        \'"\'"\'numbers, and @/./+/-/_ characters.\'"\'"\'\n    )\n    flags = 0\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/django/contrib/auth/validators.py","old_str":"class ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'^[\\\\w.@+-]+$\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only English letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = re.ASCII\\n\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'^[\\\\w.@+-]+$\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = 0","new_str":"class ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only English letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = re.ASCII\\n\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\\n        \'Enter a valid username. This value may contain only letters, \'\\n        \'numbers, and @/./+/-/_ characters.\'\\n    )\\n    flags = 0"}', 'name': 'str_replace_editor'}, 'id': 'call_JYqxO1MgLsIHZqR1qvM9AAut', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/django/contrib/auth/validators.py has been edited. Here's the result of running `cat -n` on a snippet of /testbed/django/contrib/auth/validators.py:\n     4\tfrom django.utils.deconstruct import deconstructible\n     5\tfrom django.utils.translation import gettext_lazy as _\n     6\t\n     7\t\n     8\t@deconstructible\n     9\tclass ASCIIUsernameValidator(validators.RegexValidator):\n    10\t    regex = r'\\A[\\w.@+-]+\\Z'\n    11\t    message = _(\n    12\t        'Enter a valid username. This value may contain only English letters, '\n    13\t        'numbers, and @/./+/-/_ characters.'\n    14\t    )\n    15\t    flags = re.ASCII\n    16\t\n    17\t\n    18\t@deconstructible\n    19\tclass UnicodeUsernameValidator(validators.RegexValidator):\n    20\t    regex = r'\\A[\\w.@+-]+\\Z'\n    21\t    message = _(\n    22\t        'Enter a valid username. This value may contain only letters, '\n    23\t        'numbers, and @/./+/-/_ characters.'\n    24\t    )\n    25\t    flags = 0\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_JYqxO1MgLsIHZqR1qvM9AAut']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'echo "import re\nfrom django.core import validators\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.translation import gettext_lazy as _\n\n@deconstructible\nclass ASCIIUsernameValidator(validators.RegexValidator):\n    regex = r\'\\A[\\w.@+-]+\\Z\'\n    message = _(\'Enter a valid username. This value may contain only English letters, numbers, and @/./+/-/_ characters.\')\n    flags = re.ASCII\n\n@deconstructible\nclass UnicodeUsernameValidator(validators.RegexValidator):\n    regex = r\'\\A[\\w.@+-]+\\Z\'\n    message = _(\'Enter a valid username. This value may contain only letters, numbers, and @/./+/-/_ characters.\')\n    flags = 0\n\n# Test code to verify the regex behavior\nif __name__ == \'__main__\':\n    import re\n\n    ascii_validator = ASCIIUsernameValidator()\n    unicode_validator = UnicodeUsernameValidator()\n\n    test_usernames = [\n        \'validusername\',\n        \'valid.username\',\n        \'valid@username\',\n        \'valid+username\',\n        \'valid-username\',\n        \'valid_username\',\n        \'invalidusername\\n\',\n        \'invalidusername\\r\\n\',\n        \'invalidusername\\n \',\n        \'invalidusername \',\n    ]\n\n    print(\'Testing ASCIIUsernameValidator:\')\n    for username in test_usernames:\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\n            print(f\'Valid: {repr(username)}\')\n        else:\n            print(f\'Invalid: {repr(username)}\')\n\n    print(\'\\nTesting UnicodeUsernameValidator:\')\n    for username in test_usernames:\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\n            print(f\'Valid: {repr(username)}\')\n        else:\n            print(f\'Invalid: {repr(username)}\')\n" > /testbed/test_username_validator.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"echo \\"import re\\nfrom django.core import validators\\nfrom django.utils.deconstruct import deconstructible\\nfrom django.utils.translation import gettext_lazy as _\\n\\n@deconstructible\\nclass ASCIIUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\'Enter a valid username. This value may contain only English letters, numbers, and @/./+/-/_ characters.\')\\n    flags = re.ASCII\\n\\n@deconstructible\\nclass UnicodeUsernameValidator(validators.RegexValidator):\\n    regex = r\'\\\\A[\\\\w.@+-]+\\\\Z\'\\n    message = _(\'Enter a valid username. This value may contain only letters, numbers, and @/./+/-/_ characters.\')\\n    flags = 0\\n\\n# Test code to verify the regex behavior\\nif __name__ == \'__main__\':\\n    import re\\n\\n    ascii_validator = ASCIIUsernameValidator()\\n    unicode_validator = UnicodeUsernameValidator()\\n\\n    test_usernames = [\\n        \'validusername\',\\n        \'valid.username\',\\n        \'valid@username\',\\n        \'valid+username\',\\n        \'valid-username\',\\n        \'valid_username\',\\n        \'invalidusername\\\\n\',\\n        \'invalidusername\\\\r\\\\n\',\\n        \'invalidusername\\\\n \',\\n        \'invalidusername \',\\n    ]\\n\\n    print(\'Testing ASCIIUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\n    print(\'\\\\nTesting UnicodeUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\" > /testbed/test_username_validator.py"}', 'name': 'bash'}, 'id': 'call_U2yq9YRzm9PEfOxxo9zlvpkv', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'Your command ran successfully and did not produce any output.'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_U2yq9YRzm9PEfOxxo9zlvpkv']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/test_username_validator.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/test_username_validator.py"}', 'name': 'bash'}, 'id': 'call_hW1YxOF8W4LREApTv7LuKrOw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nTesting ASCIIUsernameValidator:\nTraceback (most recent call last):\n  File "/testbed/test_username_validator.py", line 40, in <module>\n    if re.match(ascii_validator.regex, username, ascii_validator.flags):\n  File "/opt/miniconda3/envs/testbed/lib/python3.6/re.py", line 172, in match\n    return _compile(pattern, flags).match(string)\n  File "/opt/miniconda3/envs/testbed/lib/python3.6/re.py", line 297, in _compile\n    "cannot process flags argument with a compiled pattern")\nValueError: cannot process flags argument with a compiled pattern\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_hW1YxOF8W4LREApTv7LuKrOw']}, {'role': 'assistant', 'content': 'The error "ValueError: cannot process flags argument with a compiled pattern" occurs because the regex attribute in the validators is already a compiled regex pattern (likely compiled by RegexValidator), and passing flags again to re.match is causing the error.\n\nTo fix this, I will modify the test code to use the validator\'s own validation method instead of directly using re.match with the regex and flags. The RegexValidator class has a __call__ method that can be used to validate a value.\n\nI will update the test script to use the validator instances directly to validate the usernames.', 'thought': 'The error "ValueError: cannot process flags argument with a compiled pattern" occurs because the regex attribute in the validators is already a compiled regex pattern (likely compiled by RegexValidator), and passing flags again to re.match is causing the error.\n\nTo fix this, I will modify the test code to use the validator\'s own validation method instead of directly using re.match with the regex and flags. The RegexValidator class has a __call__ method that can be used to validate a value.\n\nI will update the test script to use the validator instances directly to validate the usernames.', 'action': 'str_replace_editor str_replace /testbed/test_username_validator.py   --old_str \'    print(\'"\'"\'Testing ASCIIUsernameValidator:\'"\'"\')\n    for username in test_usernames:\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\n            print(f\'"\'"\'Valid: {repr(username)}\'"\'"\')\n        else:\n            print(f\'"\'"\'Invalid: {repr(username)}\'"\'"\')\n\n    print(\'"\'"\'\\nTesting UnicodeUsernameValidator:\'"\'"\')\n    for username in test_usernames:\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\n            print(f\'"\'"\'Valid: {repr(username)}\'"\'"\')\n        else:\n            print(f\'"\'"\'Invalid: {repr(username)}\'"\'"\')\' --new_str \'    print(\'"\'"\'Testing ASCIIUsernameValidator:\'"\'"\')\n    for username in test_usernames:\n        try:\n            ascii_validator(username)\n            print(f\'"\'"\'Valid: {repr(username)}\'"\'"\')\n        except Exception:\n            print(f\'"\'"\'Invalid: {repr(username)}\'"\'"\')\n\n    print(\'"\'"\'\\nTesting UnicodeUsernameValidator:\'"\'"\')\n    for username in test_usernames:\n        try:\n            unicode_validator(username)\n            print(f\'"\'"\'Valid: {repr(username)}\'"\'"\')\n        except Exception:\n            print(f\'"\'"\'Invalid: {repr(username)}\'"\'"\')\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/test_username_validator.py","old_str":"    print(\'Testing ASCIIUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(ascii_validator.regex, username, ascii_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')\\n\\n    print(\'\\\\nTesting UnicodeUsernameValidator:\')\\n    for username in test_usernames:\\n        if re.match(unicode_validator.regex, username, unicode_validator.flags):\\n            print(f\'Valid: {repr(username)}\')\\n        else:\\n            print(f\'Invalid: {repr(username)}\')","new_str":"    print(\'Testing ASCIIUsernameValidator:\')\\n    for username in test_usernames:\\n        try:\\n            ascii_validator(username)\\n            print(f\'Valid: {repr(username)}\')\\n        except Exception:\\n            print(f\'Invalid: {repr(username)}\')\\n\\n    print(\'\\\\nTesting UnicodeUsernameValidator:\')\\n    for username in test_usernames:\\n        try:\\n            unicode_validator(username)\\n            print(f\'Valid: {repr(username)}\')\\n        except Exception:\\n            print(f\'Invalid: {repr(username)}\')"}', 'name': 'str_replace_editor'}, 'id': 'call_mVQy1JaQ1R1iJ3leHcNyOiMI', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/test_username_validator.py has been edited. Here's the result of running `cat -n` on a snippet of /testbed/test_username_validator.py:\n    33\t        'invalidusername\\r\\n',\n    34\t        'invalidusername\\n ',\n    35\t        'invalidusername ',\n    36\t    ]\n    37\t\n    38\t    print('Testing ASCIIUsernameValidator:')\n    39\t    for username in test_usernames:\n    40\t        try:\n    41\t            ascii_validator(username)\n    42\t            print(f'Valid: {repr(username)}')\n    43\t        except Exception:\n    44\t            print(f'Invalid: {repr(username)}')\n    45\t\n    46\t    print('\\nTesting UnicodeUsernameValidator:')\n    47\t    for username in test_usernames:\n    48\t        try:\n    49\t            unicode_validator(username)\n    50\t            print(f'Valid: {repr(username)}')\n    51\t        except Exception:\n    52\t            print(f'Invalid: {repr(username)}')\n    53\t\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mVQy1JaQ1R1iJ3leHcNyOiMI']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/test_username_validator.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/test_username_validator.py"}', 'name': 'bash'}, 'id': 'call_Otq90NHIfWbno62DI8o1UQN0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nTesting ASCIIUsernameValidator:\nValid: 'validusername'\nValid: 'valid.username'\nValid: 'valid@username'\nValid: 'valid+username'\nValid: 'valid-username'\nValid: 'valid_username'\nInvalid: 'invalidusername\\n'\nInvalid: 'invalidusername\\r\\n'\nInvalid: 'invalidusername\\n '\nInvalid: 'invalidusername '\n\nTesting UnicodeUsernameValidator:\nValid: 'validusername'\nValid: 'valid.username'\nValid: 'valid@username'\nValid: 'valid+username'\nValid: 'valid-username'\nValid: 'valid_username'\nInvalid: 'invalidusername\\n'\nInvalid: 'invalidusername\\r\\n'\nInvalid: 'invalidusername\\n '\nInvalid: 'invalidusername '\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Otq90NHIfWbno62DI8o1UQN0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rm /testbed/test_username_validator.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rm /testbed/test_username_validator.py"}', 'name': 'bash'}, 'id': 'call_GcDRFQ8TIdEVdXxf8Oaefi8d', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'Your command ran successfully and did not produce any output.'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_GcDRFQ8TIdEVdXxf8Oaefi8d']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg --json 'ASCIIUsernameValidator|UnicodeUsernameValidator' -p /testbed --json-seq", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json \'ASCIIUsernameValidator|UnicodeUsernameValidator\' -p /testbed --json-seq"}', 'name': 'bash'}, 'id': 'call_9qz2KOj7XIrnniwR63tXUNFf', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9qz2KOj7XIrnniwR63tXUNFf'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'submit', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{}', 'name': 'submit'}, 'id': 'call_dhDSfpyZnttVrRAo7rJDS9Vu', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThank you for your work on this issue. Please carefully follow the steps below to help review your changes.\n\n1. If you made any changes to your code after running the reproduction script, please run the reproduction script again.\n  If the reproduction script is failing, please revisit your changes and make sure they are correct.\n  If you have already removed your reproduction script, please ignore this step.\n2. Remove your reproduction script (if you haven't done so already).\n3. If you have modified any TEST files, please revert them to the state they had before you started fixing the issue.\n  You can do this with `git checkout -- /path/to/test/file.py`. Use below <diff> to find the files you need to revert.\n4. Run the submit command again to confirm.\n\nHere is a list of all of your changes:\n\n<diff>\ndiff --git a/django/contrib/auth/validators.py b/django/contrib/auth/validators.py\nindex b4878cfd45..1304f20a60 100644\n--- a/django/contrib/auth/validators.py\n+++ b/django/contrib/auth/validators.py\n@@ -7,7 +7,7 @@ from django.utils.translation import gettext_lazy as _\n \n @deconstructible\n class ASCIIUsernameValidator(validators.RegexValidator):\n-    regex = r'^[\\w.@+-]+$'\n+    regex = r'\\A[\\w.@+-]+\\Z'\n     message = _(\n         'Enter a valid username. This value may contain only English letters, '\n         'numbers, and @/./+/-/_ characters.'\n@@ -17,7 +17,7 @@ class ASCIIUsernameValidator(validators.RegexValidator):\n \n @deconstructible\n class UnicodeUsernameValidator(validators.RegexValidator):\n-    regex = r'^[\\w.@+-]+$'\n+    regex = r'\\A[\\w.@+-]+\\Z'\n     message = _(\n         'Enter a valid username. This value may contain only letters, '\n         'numbers, and @/./+/-/_ characters.'\n\n</diff>\n\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_dhDSfpyZnttVrRAo7rJDS9Vu'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:49:27,317 - INFO - swea-agent-django__django-11099 - ðŸ¤– MODEL INPUT
OBSERVATION:
diff --git a/django/contrib/auth/validators.py b/django/contrib/auth/validators.py
index b4878cfd45..1304f20a60 100644
--- a/django/contrib/auth/validators.py
+++ b/django/contrib/auth/validators.py
@@ -7,7 +7,7 @@ from django.utils.translation import gettext_lazy as _
 
 @deconstructible
 class ASCIIUsernameValidator(validators.RegexValidator):
-    regex = r'^[\w.@+-]+$'
+    regex = r'\A[\w.@+-]+\Z'
     message = _(
         'Enter a valid username. This value may contain only English letters, '
         'numbers, and @/./+/-/_ characters.'
@@ -17,7 +17,7 @@ class ASCIIUsernameValidator(validators.RegexValidator):
 
 @deconstructible
 class UnicodeUsernameValidator(validators.RegexValidator):
-    regex = r'^[\w.@+-]+$'
+    regex = r'\A[\w.@+-]+\Z'
     message = _(
         'Enter a valid username. This value may contain only letters, '
         'numbers, and @/./+/-/_ characters.'

2025-12-09 13:49:27,335 - INFO - swea-agent-django__django-11099 - Trajectory saved to /home/tianpei/IdeaProjects/SWE-agent/trajectories/tianpei/default__gpt-4.1-mini__t-0.00__p-1.00__c-0.50___swe_bench_lite_test/django__django-11099/django__django-11099.traj
2025-12-09 13:49:27,338 - INFO - swea-env-django__django-11099 - Beginning environment shutdown...
