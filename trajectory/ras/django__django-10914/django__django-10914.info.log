2025-12-09 13:04:38,492 - INFO - rex-deploy-django__django-10914 - Building image docker.io/swebench/sweb.eval.x86_64.django_1776_django-10914:latest to install a standalone python to /root. This might take a while (but you only have to do it once). To skip this step, set `python_standalone_dir` to None.
2025-12-09 13:04:39,516 - INFO - rex-deploy-django__django-10914 - Starting container docker.ioswebenchsweb.eval.x86_64.django_1776_django-10914latest-14d1b164-208a-46d3-a74f-47224eca23c6 with image docker.io/swebench/sweb.eval.x86_64.django_1776_django-10914:latest serving on port 57405
2025-12-09 13:04:39,518 - INFO - rex-deploy-django__django-10914 - Starting runtime at 57405
2025-12-09 13:04:41,299 - INFO - rex-deploy-django__django-10914 - Runtime started in 1.78s
2025-12-09 13:04:42,194 - INFO - swea-env-django__django-10914 - Environment Initialized
2025-12-09 13:04:47,315 - INFO - swea-agent-django__django-10914 - Setting up agent for instance django__django-10914
2025-12-09 13:04:47,315 - INFO - swea-agent-django__django-10914 - Trajectory will be saved to /home/tianpei/IdeaProjects/SWE-agent/trajectories/tianpei/default__gpt-4.1-mini__t-0.00__p-1.00__c-0.50___swe_bench_lite_test/django__django-10914/django__django-10914.traj
2025-12-09 13:04:50,835 - INFO - swea-tools-django__django-10914 - Resetting tools
2025-12-09 13:04:51,335 - INFO - swea-agent-django__django-10914 - SYSTEM (main)
You are a helpful assistant that can interact with a computer to solve tasks.
2025-12-09 13:04:51,494 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
<uploaded_files>
/testbed
</uploaded_files>

I have attached the below csv format content as history bug fix in order for you to understand the repo architecture:

<hist_bugfix>
base_commit,description_of_the_bug_fix,original_script_paths,modification
e3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"
11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model's ``save()`` method will not be called, and the ``pre_save`` and +* The model's ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"
a89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"
846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"
86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"
08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"
e8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"
09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"
a523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."
971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"
3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"
be0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["
7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"
8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."
5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field's custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"
ff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"
b1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"
ee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"
d9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."
14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"
07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\u007f"", ""\\u007F""), +            (""\u0080"", ""\\u0080""), +            (""\u009f"", ""\\u009F""),"
97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""'choices' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""'choices' must be a mapping (e.g. a diction"
e05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f'href=""{self.url}""'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", 'href=""/test.xsl"" type=""text/xsl"" media=""screen""'), -            (""/test.xslt"", 'href=""/test.xslt"" type=""text/xsl"" media=""screen""'), -            (""/test.css"", 'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), 'href=""test.css"" type=""text/css"" media=""screen""' +            str(stylesheet), 'href=""test.css"" media=""screen"" type=""text/css""' +"
b07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"
3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc'd that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"
1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"
5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName('p')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"
35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"
0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            '<legend for=""id_field"" class=""required"">Field:</legend>', +            '<legend class=""required"">Field:</legend>', -            '<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            '<legend for=""id_field_1"">field_1:</legend>', +            ""<legend>field_1:</legend>"", -            '<legend for=""field_2_id"">field_2:</legend>', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            '<div><fieldset><legend for=""id_field"">Field:</legend>' +            ""<div><fieldset><legend>Field:</legend>"" -            '<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            '<div><fieldset><legend for=""id_field_month"">Field:</legend>' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            '<legend for=""id_name"">Title:</legend>', +            ""<legend>Title:</legend>"", -            '<legend for=""id_url"">The URL:</legend>', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            '<legend for=""id_title"">Name:</legend>', +            ""<legend>Name:</legend>"", -            '<legend for=""id_title"">Name:</legend>',"
7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can't change those other methods' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can't chan"
3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, 'database'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"
96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"
1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("
abfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"
5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it's safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"
66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"
a1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"
c0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"
c60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"
6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($('#test').children().first().prop(""tagName""), ""DIV""); -    assert.equal($('#test').children().first().attr(""class""), ""selector""); +    assert.deepEqual("
2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."
fffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"
e78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"
01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""
c135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"
a4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"
c4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"
1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework's work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"
27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"
2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"
796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."
5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"
47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"
6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"
125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                '<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>',"
dfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""
c5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"
6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"
3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"
98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"
c880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"
74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"
e27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "
eaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don't fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don't fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"
8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"
05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"
601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"
340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"
3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"
7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."
348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("
be7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"
adc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"
ab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"
01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that's || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn't include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"
1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"
787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield 'NULL' and [] as its placeholder and params instead -        # of '%s' and [None]. The 'NULL' placeholder is produced earlier by +        # needs to yield 'NULL' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"
43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("
9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""
6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"
ea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("
0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."
c87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn't support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn't accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"
4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"
3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"
6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn't been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"
74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# ' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"
42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"
5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - '3.15-dev' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != 'win32' or python_version < '3.15'"
185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser's -        # output, so tests for particul"
b6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"
548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"
a0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"
9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"
5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"
344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"
ca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"
d506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"
0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"
b1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don't make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"
</hist_bugfix>

I've uploaded a python code repository in the directory /testbed. Consider the following PR description:
<pr_description>
Set default FILE_UPLOAD_PERMISSION to 0o644.
Description
	
Hello,
As far as I can see, the â€‹File Uploads documentation page does not mention any permission issues.
What I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).
The tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python's built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.
I found mentions of this issue â€‹on GitHub, but did not manage to find any existing bug report in Django's bug tracker.

</pr_description>

Can you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?
I've already taken care of all changes to any of the test files described in the <pr_description>. This means you DON'T have to modify the testing logic or any of the tests in any way!
Your task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.
Follow these steps to resolve the issue:
1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>
2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error
3. Edit the sourcecode of the repo to resolve the issue
4. Rerun your reproduce script and confirm that the error is fixed!
5. Think about edgecases and make sure your fix handles them as well
Your thinking should be thorough and so it's fine if it's very long.
2025-12-09 13:04:51,496 - INFO - swea-agent-django__django-10914 - ========================= STEP 1 =========================
2025-12-09 13:04:52,654 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
rg --json-path '.data.lines[0].text' --json-seq --json-seq-path '.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")' /testbed
2025-12-09 13:04:52,918 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.', 'cache_control': {'type': 'ephemeral'}}], 'agent': 'main', 'message_type': 'observation'}]
2025-12-09 13:04:52,919 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
bash: rg: command not found

2025-12-09 13:04:52,920 - INFO - swea-agent-django__django-10914 - ========================= STEP 2 =========================
2025-12-09 13:04:54,510 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
grep -r FILE_UPLOAD_PERMISSIONS /testbed
2025-12-09 13:04:59,128 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.', 'cache_control': {'type': 'ephemeral'}}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:04:59,128 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.
/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS
/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``
/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`
/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.
/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions
/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need
/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your
/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.
/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`
/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.
/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with
/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':
/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)
/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None
/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in
/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):
/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,
/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,
/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])
/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)
/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)
/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,
/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,
/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,

2025-12-09 13:04:59,134 - INFO - swea-agent-django__django-10914 - ========================= STEP 3 =========================
2025-12-09 13:05:00,556 - WARNING - swea-agent-django__django-10914 - Requerying model after FunctionCallingFormatError (1th requery)
2025-12-09 13:05:00,560 - WARNING - swea-agent-django__django-10914 - Your last output included multiple tool calls!
Please make sure your output includes a thought and exactly _ONE_ function call.
2025-12-09 13:05:01,498 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
head -40 /testbed/django/conf/global_settings.py
2025-12-09 13:05:01,766 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:05:01,767 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
"""
Default Django settings. Override these with settings in the module pointed to
by the DJANGO_SETTINGS_MODULE environment variable.
"""


# This is defined here as a do-nothing function because we can't import
# django.utils.translation -- that module depends on the settings.
def gettext_noop(s):
    return s


####################
# CORE             #
####################

DEBUG = False

# Whether the framework should propagate raw exceptions rather than catching
# them. This is useful under some testing situations and should never be used
# on a live site.
DEBUG_PROPAGATE_EXCEPTIONS = False

# People who get code error notifications.
# In the format [('Full Name', 'email@example.com'), ('Full Name', 'anotheremail@example.com')]
ADMINS = []

# List of IP addresses, as strings, that:
#   * See debug comments, when DEBUG is true
#   * Receive x-headers
INTERNAL_IPS = []

# Hosts/domain names that are valid for this site.
# "*" matches anything, ".example.com" matches example.com and all subdomains
ALLOWED_HOSTS = []

# Local time zone for this installation. All choices can be found here:
# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all
# systems may support all possibilities). When USE_TZ is True, this is
# interpreted as the default user time zone.

2025-12-09 13:05:01,771 - INFO - swea-agent-django__django-10914 - ========================= STEP 5 =========================
2025-12-09 13:05:02,936 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1
2025-12-09 13:05:03,203 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:05:03,204 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
bash: rg: command not found

2025-12-09 13:05:03,208 - INFO - swea-agent-django__django-10914 - ========================= STEP 6 =========================
2025-12-09 13:05:16,501 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py
2025-12-09 13:05:16,763 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:05:16,764 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
FILE_UPLOAD_PERMISSIONS = None

2025-12-09 13:05:16,768 - INFO - swea-agent-django__django-10914 - ========================= STEP 7 =========================
2025-12-09 13:05:33,262 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
head -40 /testbed/django/core/files/storage.py
2025-12-09 13:05:33,524 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:05:33,525 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
import os
from datetime import datetime
from urllib.parse import urljoin

from django.conf import settings
from django.core.exceptions import SuspiciousFileOperation
from django.core.files import File, locks
from django.core.files.move import file_move_safe
from django.core.signals import setting_changed
from django.utils import timezone
from django.utils._os import safe_join
from django.utils.crypto import get_random_string
from django.utils.deconstruct import deconstructible
from django.utils.encoding import filepath_to_uri
from django.utils.functional import LazyObject, cached_property
from django.utils.module_loading import import_string
from django.utils.text import get_valid_filename

__all__ = (
    'Storage', 'FileSystemStorage', 'DefaultStorage', 'default_storage',
    'get_storage_class',
)


class Storage:
    """
    A base storage class, providing some default behaviors that all other
    storage systems can inherit or override, as necessary.
    """

    # The following methods represent a public interface to private methods.
    # These shouldn't be overridden by subclasses unless absolutely necessary.

    def open(self, name, mode='rb'):
        """Retrieve the specified file from storage."""
        return self._open(name, mode)

    def save(self, name, content, max_length=None):
        """
        Save new content to the file specified by name. The content should be

2025-12-09 13:05:33,533 - INFO - swea-agent-django__django-10914 - ========================= STEP 8 =========================
2025-12-09 13:05:49,782 - WARNING - swea-lm-django__django-10914 - Retrying LM query: attempt 1 (slept for 10.00s) due to RateLimitError: litellm.RateLimitError: RateLimitError: OpenAIException - Rate limit reached for gpt-4.1-mini in organization org-X455j81VhQNdfQv1oTeGAtxa on tokens per min (TPM): Limit 200000, Used 174111, Requested 26482. Please try again in 177ms. Visit https://platform.openai.com/account/rate-limits to learn more.
2025-12-09 13:06:00,644 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py
2025-12-09 13:06:00,908 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:06:00,909 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
bash: rg: command not found

2025-12-09 13:06:00,915 - INFO - swea-agent-django__django-10914 - ========================= STEP 9 =========================
2025-12-09 13:06:08,428 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py
2025-12-09 13:06:08,699 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:06:08,701 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':
217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)

2025-12-09 13:06:08,708 - INFO - swea-agent-django__django-10914 - ========================= STEP 10 =========================
2025-12-09 13:06:17,062 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
head -40 -n 40 /testbed/django/core/files/storage.py
2025-12-09 13:06:17,332 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_uUwM82lrbSPkD1CovRUg95fF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_uUwM82lrbSPkD1CovRUg95fF'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:06:17,334 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
import os
from datetime import datetime
from urllib.parse import urljoin

from django.conf import settings
from django.core.exceptions import SuspiciousFileOperation
from django.core.files import File, locks
from django.core.files.move import file_move_safe
from django.core.signals import setting_changed
from django.utils import timezone
from django.utils._os import safe_join
from django.utils.crypto import get_random_string
from django.utils.deconstruct import deconstructible
from django.utils.encoding import filepath_to_uri
from django.utils.functional import LazyObject, cached_property
from django.utils.module_loading import import_string
from django.utils.text import get_valid_filename

__all__ = (
    'Storage', 'FileSystemStorage', 'DefaultStorage', 'default_storage',
    'get_storage_class',
)


class Storage:
    """
    A base storage class, providing some default behaviors that all other
    storage systems can inherit or override, as necessary.
    """

    # The following methods represent a public interface to private methods.
    # These shouldn't be overridden by subclasses unless absolutely necessary.

    def open(self, name, mode='rb'):
        """Retrieve the specified file from storage."""
        return self._open(name, mode)

    def save(self, name, content, max_length=None):
        """
        Save new content to the file specified by name. The content should be

2025-12-09 13:06:17,341 - INFO - swea-agent-django__django-10914 - ========================= STEP 11 =========================
2025-12-09 13:06:18,202 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
sed -n 180,220p /testbed/django/core/files/storage.py
2025-12-09 13:06:18,477 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_uUwM82lrbSPkD1CovRUg95fF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_uUwM82lrbSPkD1CovRUg95fF'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 -n 40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 -n 40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_Hr4Btg38nkLy1v8N1BffgUal', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Hr4Btg38nkLy1v8N1BffgUal'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:06:18,478 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
        self._location = location
        self._base_url = base_url
        self._file_permissions_mode = file_permissions_mode
        self._directory_permissions_mode = directory_permissions_mode
        setting_changed.connect(self._clear_cached_properties)

    def _clear_cached_properties(self, setting, **kwargs):
        """Reset setting based property values."""
        if setting == 'MEDIA_ROOT':
            self.__dict__.pop('base_location', None)
            self.__dict__.pop('location', None)
        elif setting == 'MEDIA_URL':
            self.__dict__.pop('base_url', None)
        elif setting == 'FILE_UPLOAD_PERMISSIONS':
            self.__dict__.pop('file_permissions_mode', None)
        elif setting == 'FILE_UPLOAD_DIRECTORY_PERMISSIONS':
            self.__dict__.pop('directory_permissions_mode', None)

    def _value_or_setting(self, value, setting):
        return setting if value is None else value

    @cached_property
    def base_location(self):
        return self._value_or_setting(self._location, settings.MEDIA_ROOT)

    @cached_property
    def location(self):
        return os.path.abspath(self.base_location)

    @cached_property
    def base_url(self):
        if self._base_url is not None and not self._base_url.endswith('/'):
            self._base_url += '/'
        return self._value_or_setting(self._base_url, settings.MEDIA_URL)

    @cached_property
    def file_permissions_mode(self):
        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)

    @cached_property
    def directory_permissions_mode(self):

2025-12-09 13:06:18,486 - INFO - swea-agent-django__django-10914 - ========================= STEP 12 =========================
2025-12-09 13:06:33,627 - WARNING - swea-lm-django__django-10914 - Retrying LM query: attempt 1 (slept for 10.00s) due to RateLimitError: litellm.RateLimitError: RateLimitError: OpenAIException - Rate limit reached for gpt-4.1-mini in organization org-X455j81VhQNdfQv1oTeGAtxa on tokens per min (TPM): Limit 200000, Used 173479, Requested 27305. Please try again in 235ms. Visit https://platform.openai.com/account/rate-limits to learn more.
2025-12-09 13:06:49,123 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w -j 1
2025-12-09 13:06:49,387 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_uUwM82lrbSPkD1CovRUg95fF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_uUwM82lrbSPkD1CovRUg95fF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 -n 40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 -n 40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_Hr4Btg38nkLy1v8N1BffgUal', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Hr4Btg38nkLy1v8N1BffgUal'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 180,220p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 180,220p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_mytKsnCpzP9Fg8vyGKiRGJcW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n        elif setting == \'MEDIA_URL\':\n            self.__dict__.pop(\'base_url\', None)\n        elif setting == \'FILE_UPLOAD_PERMISSIONS\':\n            self.__dict__.pop(\'file_permissions_mode\', None)\n        elif setting == \'FILE_UPLOAD_DIRECTORY_PERMISSIONS\':\n            self.__dict__.pop(\'directory_permissions_mode\', None)\n\n    def _value_or_setting(self, value, setting):\n        return setting if value is None else value\n\n    @cached_property\n    def base_location(self):\n        return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n\n    @cached_property\n    def location(self):\n        return os.path.abspath(self.base_location)\n\n    @cached_property\n    def base_url(self):\n        if self._base_url is not None and not self._base_url.endswith(\'/\'):\n            self._base_url += \'/\'\n        return self._value_or_setting(self._base_url, settings.MEDIA_URL)\n\n    @cached_property\n    def file_permissions_mode(self):\n        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n\n    @cached_property\n    def directory_permissions_mode(self):\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mytKsnCpzP9Fg8vyGKiRGJcW'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:06:49,387 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
bash: rg: command not found

2025-12-09 13:06:49,398 - INFO - swea-agent-django__django-10914 - ========================= STEP 13 =========================
2025-12-09 13:07:02,342 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
grep -n file_permissions_mode /testbed/django/core/files/storage.py
2025-12-09 13:07:02,606 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_uUwM82lrbSPkD1CovRUg95fF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_uUwM82lrbSPkD1CovRUg95fF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 -n 40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 -n 40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_Hr4Btg38nkLy1v8N1BffgUal', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Hr4Btg38nkLy1v8N1BffgUal']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 180,220p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 180,220p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_mytKsnCpzP9Fg8vyGKiRGJcW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n        elif setting == \'MEDIA_URL\':\n            self.__dict__.pop(\'base_url\', None)\n        elif setting == \'FILE_UPLOAD_PERMISSIONS\':\n            self.__dict__.pop(\'file_permissions_mode\', None)\n        elif setting == \'FILE_UPLOAD_DIRECTORY_PERMISSIONS\':\n            self.__dict__.pop(\'directory_permissions_mode\', None)\n\n    def _value_or_setting(self, value, setting):\n        return setting if value is None else value\n\n    @cached_property\n    def base_location(self):\n        return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n\n    @cached_property\n    def location(self):\n        return os.path.abspath(self.base_location)\n\n    @cached_property\n    def base_url(self):\n        if self._base_url is not None and not self._base_url.endswith(\'/\'):\n            self._base_url += \'/\'\n        return self._value_or_setting(self._base_url, settings.MEDIA_URL)\n\n    @cached_property\n    def file_permissions_mode(self):\n        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n\n    @cached_property\n    def directory_permissions_mode(self):\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mytKsnCpzP9Fg8vyGKiRGJcW'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w -j 1", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w -j 1"}', 'name': 'bash'}, 'id': 'call_9OMGnmqRUoiQ7umCBOMsT1NC', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9OMGnmqRUoiQ7umCBOMsT1NC'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:07:02,607 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
178:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,
182:        self._file_permissions_mode = file_permissions_mode
194:            self.__dict__.pop('file_permissions_mode', None)
216:    def file_permissions_mode(self):
217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)
234:                # for consistency with file_permissions_mode behavior.
283:        if self.file_permissions_mode is not None:
284:            os.chmod(full_path, self.file_permissions_mode)

2025-12-09 13:07:02,617 - INFO - swea-agent-django__django-10914 - ========================= STEP 14 =========================
2025-12-09 13:07:18,919 - WARNING - swea-lm-django__django-10914 - Retrying LM query: attempt 1 (slept for 10.00s) due to RateLimitError: litellm.RateLimitError: RateLimitError: OpenAIException - Rate limit reached for gpt-4.1-mini in organization org-X455j81VhQNdfQv1oTeGAtxa on tokens per min (TPM): Limit 200000, Used 176254, Requested 27461. Please try again in 1.114s. Visit https://platform.openai.com/account/rate-limits to learn more.
2025-12-09 13:07:31,035 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
sed -n 170,190p /testbed/django/core/files/storage.py
2025-12-09 13:07:31,302 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_uUwM82lrbSPkD1CovRUg95fF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_uUwM82lrbSPkD1CovRUg95fF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 -n 40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 -n 40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_Hr4Btg38nkLy1v8N1BffgUal', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Hr4Btg38nkLy1v8N1BffgUal']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 180,220p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 180,220p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_mytKsnCpzP9Fg8vyGKiRGJcW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n        elif setting == \'MEDIA_URL\':\n            self.__dict__.pop(\'base_url\', None)\n        elif setting == \'FILE_UPLOAD_PERMISSIONS\':\n            self.__dict__.pop(\'file_permissions_mode\', None)\n        elif setting == \'FILE_UPLOAD_DIRECTORY_PERMISSIONS\':\n            self.__dict__.pop(\'directory_permissions_mode\', None)\n\n    def _value_or_setting(self, value, setting):\n        return setting if value is None else value\n\n    @cached_property\n    def base_location(self):\n        return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n\n    @cached_property\n    def location(self):\n        return os.path.abspath(self.base_location)\n\n    @cached_property\n    def base_url(self):\n        if self._base_url is not None and not self._base_url.endswith(\'/\'):\n            self._base_url += \'/\'\n        return self._value_or_setting(self._base_url, settings.MEDIA_URL)\n\n    @cached_property\n    def file_permissions_mode(self):\n        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n\n    @cached_property\n    def directory_permissions_mode(self):\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mytKsnCpzP9Fg8vyGKiRGJcW']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w -j 1", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w -j 1"}', 'name': 'bash'}, 'id': 'call_9OMGnmqRUoiQ7umCBOMsT1NC', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9OMGnmqRUoiQ7umCBOMsT1NC'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n file_permissions_mode /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n file_permissions_mode /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_lrIsYmEFlRXo3J9U9DSiAR1r', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n178:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n182:        self._file_permissions_mode = file_permissions_mode\n194:            self.__dict__.pop('file_permissions_mode', None)\n216:    def file_permissions_mode(self):\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n234:                # for consistency with file_permissions_mode behavior.\n283:        if self.file_permissions_mode is not None:\n284:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_lrIsYmEFlRXo3J9U9DSiAR1r'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:07:31,303 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
class FileSystemStorage(Storage):
    """
    Standard filesystem storage
    """
    # The combination of O_CREAT and O_EXCL makes os.open() raise OSError if
    # the file already exists before it's opened.
    OS_OPEN_FLAGS = os.O_WRONLY | os.O_CREAT | os.O_EXCL | getattr(os, 'O_BINARY', 0)

    def __init__(self, location=None, base_url=None, file_permissions_mode=None,
                 directory_permissions_mode=None):
        self._location = location
        self._base_url = base_url
        self._file_permissions_mode = file_permissions_mode
        self._directory_permissions_mode = directory_permissions_mode
        setting_changed.connect(self._clear_cached_properties)

    def _clear_cached_properties(self, setting, **kwargs):
        """Reset setting based property values."""
        if setting == 'MEDIA_ROOT':
            self.__dict__.pop('base_location', None)
            self.__dict__.pop('location', None)

2025-12-09 13:07:31,314 - INFO - swea-agent-django__django-10914 - ========================= STEP 15 =========================
2025-12-09 13:07:41,980 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
sed -n 270,290p /testbed/django/core/files/storage.py
2025-12-09 13:07:42,242 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_uUwM82lrbSPkD1CovRUg95fF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_uUwM82lrbSPkD1CovRUg95fF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 -n 40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 -n 40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_Hr4Btg38nkLy1v8N1BffgUal', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Hr4Btg38nkLy1v8N1BffgUal']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 180,220p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 180,220p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_mytKsnCpzP9Fg8vyGKiRGJcW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n        elif setting == \'MEDIA_URL\':\n            self.__dict__.pop(\'base_url\', None)\n        elif setting == \'FILE_UPLOAD_PERMISSIONS\':\n            self.__dict__.pop(\'file_permissions_mode\', None)\n        elif setting == \'FILE_UPLOAD_DIRECTORY_PERMISSIONS\':\n            self.__dict__.pop(\'directory_permissions_mode\', None)\n\n    def _value_or_setting(self, value, setting):\n        return setting if value is None else value\n\n    @cached_property\n    def base_location(self):\n        return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n\n    @cached_property\n    def location(self):\n        return os.path.abspath(self.base_location)\n\n    @cached_property\n    def base_url(self):\n        if self._base_url is not None and not self._base_url.endswith(\'/\'):\n            self._base_url += \'/\'\n        return self._value_or_setting(self._base_url, settings.MEDIA_URL)\n\n    @cached_property\n    def file_permissions_mode(self):\n        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n\n    @cached_property\n    def directory_permissions_mode(self):\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mytKsnCpzP9Fg8vyGKiRGJcW']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w -j 1", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w -j 1"}', 'name': 'bash'}, 'id': 'call_9OMGnmqRUoiQ7umCBOMsT1NC', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9OMGnmqRUoiQ7umCBOMsT1NC']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n file_permissions_mode /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n file_permissions_mode /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_lrIsYmEFlRXo3J9U9DSiAR1r', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n178:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n182:        self._file_permissions_mode = file_permissions_mode\n194:            self.__dict__.pop('file_permissions_mode', None)\n216:    def file_permissions_mode(self):\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n234:                # for consistency with file_permissions_mode behavior.\n283:        if self.file_permissions_mode is not None:\n284:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_lrIsYmEFlRXo3J9U9DSiAR1r'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 170,190p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 170,190p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_iJcLRaUXMVr0ks33JFKxW9iX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nclass FileSystemStorage(Storage):\n    """\n    Standard filesystem storage\n    """\n    # The combination of O_CREAT and O_EXCL makes os.open() raise OSError if\n    # the file already exists before it\'s opened.\n    OS_OPEN_FLAGS = os.O_WRONLY | os.O_CREAT | os.O_EXCL | getattr(os, \'O_BINARY\', 0)\n\n    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n                 directory_permissions_mode=None):\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_iJcLRaUXMVr0ks33JFKxW9iX'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:07:42,243 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
                        locks.unlock(fd)
                        if _file is not None:
                            _file.close()
                        else:
                            os.close(fd)
            except FileExistsError:
                # A new name is needed if the file exists.
                name = self.get_available_name(name)
                full_path = self.path(name)
            else:
                # OK, the file save worked. Break out of the loop.
                break

        if self.file_permissions_mode is not None:
            os.chmod(full_path, self.file_permissions_mode)

        # Store filenames with forward slashes, even on Windows.
        return name.replace('\\', '/')

    def delete(self, name):
        assert name, "The name argument is not allowed to be empty."

2025-12-09 13:07:42,362 - INFO - swea-agent-django__django-10914 - ========================= STEP 16 =========================
2025-12-09 13:07:49,169 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w
2025-12-09 13:07:49,433 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_uUwM82lrbSPkD1CovRUg95fF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_uUwM82lrbSPkD1CovRUg95fF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 -n 40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 -n 40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_Hr4Btg38nkLy1v8N1BffgUal', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Hr4Btg38nkLy1v8N1BffgUal']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 180,220p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 180,220p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_mytKsnCpzP9Fg8vyGKiRGJcW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n        elif setting == \'MEDIA_URL\':\n            self.__dict__.pop(\'base_url\', None)\n        elif setting == \'FILE_UPLOAD_PERMISSIONS\':\n            self.__dict__.pop(\'file_permissions_mode\', None)\n        elif setting == \'FILE_UPLOAD_DIRECTORY_PERMISSIONS\':\n            self.__dict__.pop(\'directory_permissions_mode\', None)\n\n    def _value_or_setting(self, value, setting):\n        return setting if value is None else value\n\n    @cached_property\n    def base_location(self):\n        return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n\n    @cached_property\n    def location(self):\n        return os.path.abspath(self.base_location)\n\n    @cached_property\n    def base_url(self):\n        if self._base_url is not None and not self._base_url.endswith(\'/\'):\n            self._base_url += \'/\'\n        return self._value_or_setting(self._base_url, settings.MEDIA_URL)\n\n    @cached_property\n    def file_permissions_mode(self):\n        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n\n    @cached_property\n    def directory_permissions_mode(self):\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mytKsnCpzP9Fg8vyGKiRGJcW']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w -j 1", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w -j 1"}', 'name': 'bash'}, 'id': 'call_9OMGnmqRUoiQ7umCBOMsT1NC', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9OMGnmqRUoiQ7umCBOMsT1NC']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n file_permissions_mode /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n file_permissions_mode /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_lrIsYmEFlRXo3J9U9DSiAR1r', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n178:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n182:        self._file_permissions_mode = file_permissions_mode\n194:            self.__dict__.pop('file_permissions_mode', None)\n216:    def file_permissions_mode(self):\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n234:                # for consistency with file_permissions_mode behavior.\n283:        if self.file_permissions_mode is not None:\n284:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_lrIsYmEFlRXo3J9U9DSiAR1r']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 170,190p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 170,190p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_iJcLRaUXMVr0ks33JFKxW9iX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nclass FileSystemStorage(Storage):\n    """\n    Standard filesystem storage\n    """\n    # The combination of O_CREAT and O_EXCL makes os.open() raise OSError if\n    # the file already exists before it\'s opened.\n    OS_OPEN_FLAGS = os.O_WRONLY | os.O_CREAT | os.O_EXCL | getattr(os, \'O_BINARY\', 0)\n\n    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n                 directory_permissions_mode=None):\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_iJcLRaUXMVr0ks33JFKxW9iX'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 270,290p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 270,290p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_A6fcKyZ2N1gnEJ8DLQel59IH', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n                        locks.unlock(fd)\n                        if _file is not None:\n                            _file.close()\n                        else:\n                            os.close(fd)\n            except FileExistsError:\n                # A new name is needed if the file exists.\n                name = self.get_available_name(name)\n                full_path = self.path(name)\n            else:\n                # OK, the file save worked. Break out of the loop.\n                break\n\n        if self.file_permissions_mode is not None:\n            os.chmod(full_path, self.file_permissions_mode)\n\n        # Store filenames with forward slashes, even on Windows.\n        return name.replace(\'\\\\\', \'/\')\n\n    def delete(self, name):\n        assert name, "The name argument is not allowed to be empty."\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_A6fcKyZ2N1gnEJ8DLQel59IH'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:07:49,434 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
bash: rg: command not found

2025-12-09 13:07:49,446 - INFO - swea-agent-django__django-10914 - ========================= STEP 17 =========================
2025-12-09 13:07:59,831 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
grep -r file_permissions_mode /testbed/django/core/files/
2025-12-09 13:08:00,094 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_uUwM82lrbSPkD1CovRUg95fF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_uUwM82lrbSPkD1CovRUg95fF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 -n 40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 -n 40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_Hr4Btg38nkLy1v8N1BffgUal', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Hr4Btg38nkLy1v8N1BffgUal']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 180,220p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 180,220p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_mytKsnCpzP9Fg8vyGKiRGJcW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n        elif setting == \'MEDIA_URL\':\n            self.__dict__.pop(\'base_url\', None)\n        elif setting == \'FILE_UPLOAD_PERMISSIONS\':\n            self.__dict__.pop(\'file_permissions_mode\', None)\n        elif setting == \'FILE_UPLOAD_DIRECTORY_PERMISSIONS\':\n            self.__dict__.pop(\'directory_permissions_mode\', None)\n\n    def _value_or_setting(self, value, setting):\n        return setting if value is None else value\n\n    @cached_property\n    def base_location(self):\n        return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n\n    @cached_property\n    def location(self):\n        return os.path.abspath(self.base_location)\n\n    @cached_property\n    def base_url(self):\n        if self._base_url is not None and not self._base_url.endswith(\'/\'):\n            self._base_url += \'/\'\n        return self._value_or_setting(self._base_url, settings.MEDIA_URL)\n\n    @cached_property\n    def file_permissions_mode(self):\n        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n\n    @cached_property\n    def directory_permissions_mode(self):\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mytKsnCpzP9Fg8vyGKiRGJcW']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w -j 1", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w -j 1"}', 'name': 'bash'}, 'id': 'call_9OMGnmqRUoiQ7umCBOMsT1NC', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9OMGnmqRUoiQ7umCBOMsT1NC']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n file_permissions_mode /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n file_permissions_mode /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_lrIsYmEFlRXo3J9U9DSiAR1r', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n178:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n182:        self._file_permissions_mode = file_permissions_mode\n194:            self.__dict__.pop('file_permissions_mode', None)\n216:    def file_permissions_mode(self):\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n234:                # for consistency with file_permissions_mode behavior.\n283:        if self.file_permissions_mode is not None:\n284:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_lrIsYmEFlRXo3J9U9DSiAR1r']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 170,190p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 170,190p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_iJcLRaUXMVr0ks33JFKxW9iX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nclass FileSystemStorage(Storage):\n    """\n    Standard filesystem storage\n    """\n    # The combination of O_CREAT and O_EXCL makes os.open() raise OSError if\n    # the file already exists before it\'s opened.\n    OS_OPEN_FLAGS = os.O_WRONLY | os.O_CREAT | os.O_EXCL | getattr(os, \'O_BINARY\', 0)\n\n    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n                 directory_permissions_mode=None):\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_iJcLRaUXMVr0ks33JFKxW9iX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 270,290p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 270,290p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_A6fcKyZ2N1gnEJ8DLQel59IH', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n                        locks.unlock(fd)\n                        if _file is not None:\n                            _file.close()\n                        else:\n                            os.close(fd)\n            except FileExistsError:\n                # A new name is needed if the file exists.\n                name = self.get_available_name(name)\n                full_path = self.path(name)\n            else:\n                # OK, the file save worked. Break out of the loop.\n                break\n\n        if self.file_permissions_mode is not None:\n            os.chmod(full_path, self.file_permissions_mode)\n\n        # Store filenames with forward slashes, even on Windows.\n        return name.replace(\'\\\\\', \'/\')\n\n    def delete(self, name):\n        assert name, "The name argument is not allowed to be empty."\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_A6fcKyZ2N1gnEJ8DLQel59IH'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_AOyoZmjwZoQnZPmGRGXylvgA', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_AOyoZmjwZoQnZPmGRGXylvgA'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:08:00,095 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
/testbed/django/core/files/storage.py:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,
/testbed/django/core/files/storage.py:        self._file_permissions_mode = file_permissions_mode
/testbed/django/core/files/storage.py:            self.__dict__.pop('file_permissions_mode', None)
/testbed/django/core/files/storage.py:    def file_permissions_mode(self):
/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)
/testbed/django/core/files/storage.py:                # for consistency with file_permissions_mode behavior.
/testbed/django/core/files/storage.py:        if self.file_permissions_mode is not None:
/testbed/django/core/files/storage.py:            os.chmod(full_path, self.file_permissions_mode)

2025-12-09 13:08:00,109 - INFO - swea-agent-django__django-10914 - ========================= STEP 18 =========================
2025-12-09 13:08:07,291 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
head -40 /testbed/django/core/files/storage.py
2025-12-09 13:08:07,557 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_uUwM82lrbSPkD1CovRUg95fF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_uUwM82lrbSPkD1CovRUg95fF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 -n 40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 -n 40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_Hr4Btg38nkLy1v8N1BffgUal', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Hr4Btg38nkLy1v8N1BffgUal']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 180,220p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 180,220p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_mytKsnCpzP9Fg8vyGKiRGJcW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n        elif setting == \'MEDIA_URL\':\n            self.__dict__.pop(\'base_url\', None)\n        elif setting == \'FILE_UPLOAD_PERMISSIONS\':\n            self.__dict__.pop(\'file_permissions_mode\', None)\n        elif setting == \'FILE_UPLOAD_DIRECTORY_PERMISSIONS\':\n            self.__dict__.pop(\'directory_permissions_mode\', None)\n\n    def _value_or_setting(self, value, setting):\n        return setting if value is None else value\n\n    @cached_property\n    def base_location(self):\n        return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n\n    @cached_property\n    def location(self):\n        return os.path.abspath(self.base_location)\n\n    @cached_property\n    def base_url(self):\n        if self._base_url is not None and not self._base_url.endswith(\'/\'):\n            self._base_url += \'/\'\n        return self._value_or_setting(self._base_url, settings.MEDIA_URL)\n\n    @cached_property\n    def file_permissions_mode(self):\n        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n\n    @cached_property\n    def directory_permissions_mode(self):\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mytKsnCpzP9Fg8vyGKiRGJcW']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w -j 1", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w -j 1"}', 'name': 'bash'}, 'id': 'call_9OMGnmqRUoiQ7umCBOMsT1NC', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9OMGnmqRUoiQ7umCBOMsT1NC']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n file_permissions_mode /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n file_permissions_mode /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_lrIsYmEFlRXo3J9U9DSiAR1r', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n178:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n182:        self._file_permissions_mode = file_permissions_mode\n194:            self.__dict__.pop('file_permissions_mode', None)\n216:    def file_permissions_mode(self):\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n234:                # for consistency with file_permissions_mode behavior.\n283:        if self.file_permissions_mode is not None:\n284:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_lrIsYmEFlRXo3J9U9DSiAR1r']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 170,190p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 170,190p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_iJcLRaUXMVr0ks33JFKxW9iX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nclass FileSystemStorage(Storage):\n    """\n    Standard filesystem storage\n    """\n    # The combination of O_CREAT and O_EXCL makes os.open() raise OSError if\n    # the file already exists before it\'s opened.\n    OS_OPEN_FLAGS = os.O_WRONLY | os.O_CREAT | os.O_EXCL | getattr(os, \'O_BINARY\', 0)\n\n    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n                 directory_permissions_mode=None):\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_iJcLRaUXMVr0ks33JFKxW9iX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 270,290p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 270,290p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_A6fcKyZ2N1gnEJ8DLQel59IH', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n                        locks.unlock(fd)\n                        if _file is not None:\n                            _file.close()\n                        else:\n                            os.close(fd)\n            except FileExistsError:\n                # A new name is needed if the file exists.\n                name = self.get_available_name(name)\n                full_path = self.path(name)\n            else:\n                # OK, the file save worked. Break out of the loop.\n                break\n\n        if self.file_permissions_mode is not None:\n            os.chmod(full_path, self.file_permissions_mode)\n\n        # Store filenames with forward slashes, even on Windows.\n        return name.replace(\'\\\\\', \'/\')\n\n    def delete(self, name):\n        assert name, "The name argument is not allowed to be empty."\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_A6fcKyZ2N1gnEJ8DLQel59IH']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_AOyoZmjwZoQnZPmGRGXylvgA', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_AOyoZmjwZoQnZPmGRGXylvgA'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r file_permissions_mode /testbed/django/core/files/', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r file_permissions_mode /testbed/django/core/files/"}', 'name': 'bash'}, 'id': 'call_E3R6QqNlATZKqNW4hBHBqncQ', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/django/core/files/storage.py:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n/testbed/django/core/files/storage.py:        self._file_permissions_mode = file_permissions_mode\n/testbed/django/core/files/storage.py:            self.__dict__.pop('file_permissions_mode', None)\n/testbed/django/core/files/storage.py:    def file_permissions_mode(self):\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/core/files/storage.py:                # for consistency with file_permissions_mode behavior.\n/testbed/django/core/files/storage.py:        if self.file_permissions_mode is not None:\n/testbed/django/core/files/storage.py:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_E3R6QqNlATZKqNW4hBHBqncQ'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:08:07,558 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
import os
from datetime import datetime
from urllib.parse import urljoin

from django.conf import settings
from django.core.exceptions import SuspiciousFileOperation
from django.core.files import File, locks
from django.core.files.move import file_move_safe
from django.core.signals import setting_changed
from django.utils import timezone
from django.utils._os import safe_join
from django.utils.crypto import get_random_string
from django.utils.deconstruct import deconstructible
from django.utils.encoding import filepath_to_uri
from django.utils.functional import LazyObject, cached_property
from django.utils.module_loading import import_string
from django.utils.text import get_valid_filename

__all__ = (
    'Storage', 'FileSystemStorage', 'DefaultStorage', 'default_storage',
    'get_storage_class',
)


class Storage:
    """
    A base storage class, providing some default behaviors that all other
    storage systems can inherit or override, as necessary.
    """

    # The following methods represent a public interface to private methods.
    # These shouldn't be overridden by subclasses unless absolutely necessary.

    def open(self, name, mode='rb'):
        """Retrieve the specified file from storage."""
        return self._open(name, mode)

    def save(self, name, content, max_length=None):
        """
        Save new content to the file specified by name. The content should be

2025-12-09 13:08:07,574 - INFO - swea-agent-django__django-10914 - ========================= STEP 19 =========================
2025-12-09 13:08:16,424 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w
2025-12-09 13:08:16,693 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_uUwM82lrbSPkD1CovRUg95fF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_uUwM82lrbSPkD1CovRUg95fF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 -n 40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 -n 40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_Hr4Btg38nkLy1v8N1BffgUal', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Hr4Btg38nkLy1v8N1BffgUal']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 180,220p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 180,220p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_mytKsnCpzP9Fg8vyGKiRGJcW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n        elif setting == \'MEDIA_URL\':\n            self.__dict__.pop(\'base_url\', None)\n        elif setting == \'FILE_UPLOAD_PERMISSIONS\':\n            self.__dict__.pop(\'file_permissions_mode\', None)\n        elif setting == \'FILE_UPLOAD_DIRECTORY_PERMISSIONS\':\n            self.__dict__.pop(\'directory_permissions_mode\', None)\n\n    def _value_or_setting(self, value, setting):\n        return setting if value is None else value\n\n    @cached_property\n    def base_location(self):\n        return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n\n    @cached_property\n    def location(self):\n        return os.path.abspath(self.base_location)\n\n    @cached_property\n    def base_url(self):\n        if self._base_url is not None and not self._base_url.endswith(\'/\'):\n            self._base_url += \'/\'\n        return self._value_or_setting(self._base_url, settings.MEDIA_URL)\n\n    @cached_property\n    def file_permissions_mode(self):\n        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n\n    @cached_property\n    def directory_permissions_mode(self):\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mytKsnCpzP9Fg8vyGKiRGJcW']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w -j 1", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w -j 1"}', 'name': 'bash'}, 'id': 'call_9OMGnmqRUoiQ7umCBOMsT1NC', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9OMGnmqRUoiQ7umCBOMsT1NC']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n file_permissions_mode /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n file_permissions_mode /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_lrIsYmEFlRXo3J9U9DSiAR1r', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n178:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n182:        self._file_permissions_mode = file_permissions_mode\n194:            self.__dict__.pop('file_permissions_mode', None)\n216:    def file_permissions_mode(self):\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n234:                # for consistency with file_permissions_mode behavior.\n283:        if self.file_permissions_mode is not None:\n284:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_lrIsYmEFlRXo3J9U9DSiAR1r']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 170,190p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 170,190p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_iJcLRaUXMVr0ks33JFKxW9iX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nclass FileSystemStorage(Storage):\n    """\n    Standard filesystem storage\n    """\n    # The combination of O_CREAT and O_EXCL makes os.open() raise OSError if\n    # the file already exists before it\'s opened.\n    OS_OPEN_FLAGS = os.O_WRONLY | os.O_CREAT | os.O_EXCL | getattr(os, \'O_BINARY\', 0)\n\n    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n                 directory_permissions_mode=None):\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_iJcLRaUXMVr0ks33JFKxW9iX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 270,290p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 270,290p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_A6fcKyZ2N1gnEJ8DLQel59IH', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n                        locks.unlock(fd)\n                        if _file is not None:\n                            _file.close()\n                        else:\n                            os.close(fd)\n            except FileExistsError:\n                # A new name is needed if the file exists.\n                name = self.get_available_name(name)\n                full_path = self.path(name)\n            else:\n                # OK, the file save worked. Break out of the loop.\n                break\n\n        if self.file_permissions_mode is not None:\n            os.chmod(full_path, self.file_permissions_mode)\n\n        # Store filenames with forward slashes, even on Windows.\n        return name.replace(\'\\\\\', \'/\')\n\n    def delete(self, name):\n        assert name, "The name argument is not allowed to be empty."\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_A6fcKyZ2N1gnEJ8DLQel59IH']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_AOyoZmjwZoQnZPmGRGXylvgA', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_AOyoZmjwZoQnZPmGRGXylvgA']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r file_permissions_mode /testbed/django/core/files/', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r file_permissions_mode /testbed/django/core/files/"}', 'name': 'bash'}, 'id': 'call_E3R6QqNlATZKqNW4hBHBqncQ', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/django/core/files/storage.py:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n/testbed/django/core/files/storage.py:        self._file_permissions_mode = file_permissions_mode\n/testbed/django/core/files/storage.py:            self.__dict__.pop('file_permissions_mode', None)\n/testbed/django/core/files/storage.py:    def file_permissions_mode(self):\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/core/files/storage.py:                # for consistency with file_permissions_mode behavior.\n/testbed/django/core/files/storage.py:        if self.file_permissions_mode is not None:\n/testbed/django/core/files/storage.py:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_E3R6QqNlATZKqNW4hBHBqncQ'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_qGjSkLbXXIs66dWiPY0grfHe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_qGjSkLbXXIs66dWiPY0grfHe'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:08:16,694 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
bash: rg: command not found

2025-12-09 13:08:16,711 - INFO - swea-agent-django__django-10914 - ========================= STEP 20 =========================
2025-12-09 13:08:32,478 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT
The relevant code for file upload permissions is in the FileSystemStorage class in django/core/files/storage.py. The file_permissions_mode attribute is set from the constructor argument or from the FILE_UPLOAD_PERMISSIONS setting. The file permissions are applied with os.chmod after the file is saved.

The problem described in the PR is that when a file is uploaded, the temporary file created by tempfile.NamedTemporaryFile has restrictive permissions (0o600), and when it is renamed to the final location, the permissions remain restrictive. The PR wants to set a default FILE_UPLOAD_PERMISSIONS to 0o644 to avoid this issue.

Currently, in django/conf/global_settings.py, FILE_UPLOAD_PERMISSIONS is set to None by default.

Plan:
1. Change the default value of FILE_UPLOAD_PERMISSIONS in django/conf/global_settings.py from None to 0o644.
2. Add a warning or note in the documentation about the permission inconsistency issue when FILE_UPLOAD_PERMISSIONS is not set explicitly.

I will first edit django/conf/global_settings.py to set FILE_UPLOAD_PERMISSIONS = 0o644.

ðŸŽ¬ ACTION
str_replace_editor str_replace /testbed/django/conf/global_settings.py   --old_str 'FILE_UPLOAD_PERMISSIONS = None' --new_str 'FILE_UPLOAD_PERMISSIONS = 0o644'
2025-12-09 13:08:32,797 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_uUwM82lrbSPkD1CovRUg95fF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_uUwM82lrbSPkD1CovRUg95fF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 -n 40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 -n 40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_Hr4Btg38nkLy1v8N1BffgUal', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Hr4Btg38nkLy1v8N1BffgUal']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 180,220p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 180,220p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_mytKsnCpzP9Fg8vyGKiRGJcW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n        elif setting == \'MEDIA_URL\':\n            self.__dict__.pop(\'base_url\', None)\n        elif setting == \'FILE_UPLOAD_PERMISSIONS\':\n            self.__dict__.pop(\'file_permissions_mode\', None)\n        elif setting == \'FILE_UPLOAD_DIRECTORY_PERMISSIONS\':\n            self.__dict__.pop(\'directory_permissions_mode\', None)\n\n    def _value_or_setting(self, value, setting):\n        return setting if value is None else value\n\n    @cached_property\n    def base_location(self):\n        return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n\n    @cached_property\n    def location(self):\n        return os.path.abspath(self.base_location)\n\n    @cached_property\n    def base_url(self):\n        if self._base_url is not None and not self._base_url.endswith(\'/\'):\n            self._base_url += \'/\'\n        return self._value_or_setting(self._base_url, settings.MEDIA_URL)\n\n    @cached_property\n    def file_permissions_mode(self):\n        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n\n    @cached_property\n    def directory_permissions_mode(self):\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mytKsnCpzP9Fg8vyGKiRGJcW']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w -j 1", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w -j 1"}', 'name': 'bash'}, 'id': 'call_9OMGnmqRUoiQ7umCBOMsT1NC', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9OMGnmqRUoiQ7umCBOMsT1NC']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n file_permissions_mode /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n file_permissions_mode /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_lrIsYmEFlRXo3J9U9DSiAR1r', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n178:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n182:        self._file_permissions_mode = file_permissions_mode\n194:            self.__dict__.pop('file_permissions_mode', None)\n216:    def file_permissions_mode(self):\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n234:                # for consistency with file_permissions_mode behavior.\n283:        if self.file_permissions_mode is not None:\n284:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_lrIsYmEFlRXo3J9U9DSiAR1r']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 170,190p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 170,190p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_iJcLRaUXMVr0ks33JFKxW9iX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nclass FileSystemStorage(Storage):\n    """\n    Standard filesystem storage\n    """\n    # The combination of O_CREAT and O_EXCL makes os.open() raise OSError if\n    # the file already exists before it\'s opened.\n    OS_OPEN_FLAGS = os.O_WRONLY | os.O_CREAT | os.O_EXCL | getattr(os, \'O_BINARY\', 0)\n\n    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n                 directory_permissions_mode=None):\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_iJcLRaUXMVr0ks33JFKxW9iX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 270,290p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 270,290p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_A6fcKyZ2N1gnEJ8DLQel59IH', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n                        locks.unlock(fd)\n                        if _file is not None:\n                            _file.close()\n                        else:\n                            os.close(fd)\n            except FileExistsError:\n                # A new name is needed if the file exists.\n                name = self.get_available_name(name)\n                full_path = self.path(name)\n            else:\n                # OK, the file save worked. Break out of the loop.\n                break\n\n        if self.file_permissions_mode is not None:\n            os.chmod(full_path, self.file_permissions_mode)\n\n        # Store filenames with forward slashes, even on Windows.\n        return name.replace(\'\\\\\', \'/\')\n\n    def delete(self, name):\n        assert name, "The name argument is not allowed to be empty."\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_A6fcKyZ2N1gnEJ8DLQel59IH']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_AOyoZmjwZoQnZPmGRGXylvgA', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_AOyoZmjwZoQnZPmGRGXylvgA']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r file_permissions_mode /testbed/django/core/files/', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r file_permissions_mode /testbed/django/core/files/"}', 'name': 'bash'}, 'id': 'call_E3R6QqNlATZKqNW4hBHBqncQ', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/django/core/files/storage.py:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n/testbed/django/core/files/storage.py:        self._file_permissions_mode = file_permissions_mode\n/testbed/django/core/files/storage.py:            self.__dict__.pop('file_permissions_mode', None)\n/testbed/django/core/files/storage.py:    def file_permissions_mode(self):\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/core/files/storage.py:                # for consistency with file_permissions_mode behavior.\n/testbed/django/core/files/storage.py:        if self.file_permissions_mode is not None:\n/testbed/django/core/files/storage.py:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_E3R6QqNlATZKqNW4hBHBqncQ']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_qGjSkLbXXIs66dWiPY0grfHe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_qGjSkLbXXIs66dWiPY0grfHe'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_0tZWDFGyJm8gfZyftEgVuJOW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_0tZWDFGyJm8gfZyftEgVuJOW'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:08:32,798 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
The file /testbed/django/conf/global_settings.py has been edited. Here's the result of running `cat -n` on a snippet of /testbed/django/conf/global_settings.py:
   302	# (i.e. "/tmp" on *nix systems).
   303	FILE_UPLOAD_TEMP_DIR = None
   304	
   305	# The numeric mode to set newly-uploaded files to. The value should be a mode
   306	# you'd pass directly to os.chmod; see https://docs.python.org/library/os.html#files-and-directories.
   307	FILE_UPLOAD_PERMISSIONS = 0o644
   308	
   309	# The numeric mode to assign to newly-created directories, when uploading files.
   310	# The value should be a mode as you'd pass to os.chmod;
Review the changes and make sure they are as expected. Edit the file again if necessary.

2025-12-09 13:08:32,816 - INFO - swea-agent-django__django-10914 - ========================= STEP 21 =========================
2025-12-09 13:08:47,650 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
str_replace_editor str_replace /testbed/docs/ref/settings.txt   --old_str '.. setting:: FILE_UPLOAD_PERMISSIONS' --new_str '.. setting:: FILE_UPLOAD_PERMISSIONS

    .. warning::

        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.
'
2025-12-09 13:08:48,008 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_uUwM82lrbSPkD1CovRUg95fF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_uUwM82lrbSPkD1CovRUg95fF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 -n 40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 -n 40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_Hr4Btg38nkLy1v8N1BffgUal', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Hr4Btg38nkLy1v8N1BffgUal']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 180,220p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 180,220p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_mytKsnCpzP9Fg8vyGKiRGJcW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n        elif setting == \'MEDIA_URL\':\n            self.__dict__.pop(\'base_url\', None)\n        elif setting == \'FILE_UPLOAD_PERMISSIONS\':\n            self.__dict__.pop(\'file_permissions_mode\', None)\n        elif setting == \'FILE_UPLOAD_DIRECTORY_PERMISSIONS\':\n            self.__dict__.pop(\'directory_permissions_mode\', None)\n\n    def _value_or_setting(self, value, setting):\n        return setting if value is None else value\n\n    @cached_property\n    def base_location(self):\n        return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n\n    @cached_property\n    def location(self):\n        return os.path.abspath(self.base_location)\n\n    @cached_property\n    def base_url(self):\n        if self._base_url is not None and not self._base_url.endswith(\'/\'):\n            self._base_url += \'/\'\n        return self._value_or_setting(self._base_url, settings.MEDIA_URL)\n\n    @cached_property\n    def file_permissions_mode(self):\n        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n\n    @cached_property\n    def directory_permissions_mode(self):\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mytKsnCpzP9Fg8vyGKiRGJcW']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w -j 1", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w -j 1"}', 'name': 'bash'}, 'id': 'call_9OMGnmqRUoiQ7umCBOMsT1NC', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9OMGnmqRUoiQ7umCBOMsT1NC']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n file_permissions_mode /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n file_permissions_mode /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_lrIsYmEFlRXo3J9U9DSiAR1r', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n178:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n182:        self._file_permissions_mode = file_permissions_mode\n194:            self.__dict__.pop('file_permissions_mode', None)\n216:    def file_permissions_mode(self):\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n234:                # for consistency with file_permissions_mode behavior.\n283:        if self.file_permissions_mode is not None:\n284:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_lrIsYmEFlRXo3J9U9DSiAR1r']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 170,190p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 170,190p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_iJcLRaUXMVr0ks33JFKxW9iX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nclass FileSystemStorage(Storage):\n    """\n    Standard filesystem storage\n    """\n    # The combination of O_CREAT and O_EXCL makes os.open() raise OSError if\n    # the file already exists before it\'s opened.\n    OS_OPEN_FLAGS = os.O_WRONLY | os.O_CREAT | os.O_EXCL | getattr(os, \'O_BINARY\', 0)\n\n    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n                 directory_permissions_mode=None):\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_iJcLRaUXMVr0ks33JFKxW9iX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 270,290p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 270,290p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_A6fcKyZ2N1gnEJ8DLQel59IH', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n                        locks.unlock(fd)\n                        if _file is not None:\n                            _file.close()\n                        else:\n                            os.close(fd)\n            except FileExistsError:\n                # A new name is needed if the file exists.\n                name = self.get_available_name(name)\n                full_path = self.path(name)\n            else:\n                # OK, the file save worked. Break out of the loop.\n                break\n\n        if self.file_permissions_mode is not None:\n            os.chmod(full_path, self.file_permissions_mode)\n\n        # Store filenames with forward slashes, even on Windows.\n        return name.replace(\'\\\\\', \'/\')\n\n    def delete(self, name):\n        assert name, "The name argument is not allowed to be empty."\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_A6fcKyZ2N1gnEJ8DLQel59IH']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_AOyoZmjwZoQnZPmGRGXylvgA', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_AOyoZmjwZoQnZPmGRGXylvgA']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r file_permissions_mode /testbed/django/core/files/', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r file_permissions_mode /testbed/django/core/files/"}', 'name': 'bash'}, 'id': 'call_E3R6QqNlATZKqNW4hBHBqncQ', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/django/core/files/storage.py:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n/testbed/django/core/files/storage.py:        self._file_permissions_mode = file_permissions_mode\n/testbed/django/core/files/storage.py:            self.__dict__.pop('file_permissions_mode', None)\n/testbed/django/core/files/storage.py:    def file_permissions_mode(self):\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/core/files/storage.py:                # for consistency with file_permissions_mode behavior.\n/testbed/django/core/files/storage.py:        if self.file_permissions_mode is not None:\n/testbed/django/core/files/storage.py:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_E3R6QqNlATZKqNW4hBHBqncQ']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_qGjSkLbXXIs66dWiPY0grfHe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_qGjSkLbXXIs66dWiPY0grfHe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_0tZWDFGyJm8gfZyftEgVuJOW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_0tZWDFGyJm8gfZyftEgVuJOW'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': 'The relevant code for file upload permissions is in the FileSystemStorage class in django/core/files/storage.py. The file_permissions_mode attribute is set from the constructor argument or from the FILE_UPLOAD_PERMISSIONS setting. The file permissions are applied with os.chmod after the file is saved.\n\nThe problem described in the PR is that when a file is uploaded, the temporary file created by tempfile.NamedTemporaryFile has restrictive permissions (0o600), and when it is renamed to the final location, the permissions remain restrictive. The PR wants to set a default FILE_UPLOAD_PERMISSIONS to 0o644 to avoid this issue.\n\nCurrently, in django/conf/global_settings.py, FILE_UPLOAD_PERMISSIONS is set to None by default.\n\nPlan:\n1. Change the default value of FILE_UPLOAD_PERMISSIONS in django/conf/global_settings.py from None to 0o644.\n2. Add a warning or note in the documentation about the permission inconsistency issue when FILE_UPLOAD_PERMISSIONS is not set explicitly.\n\nI will first edit django/conf/global_settings.py to set FILE_UPLOAD_PERMISSIONS = 0o644.', 'thought': 'The relevant code for file upload permissions is in the FileSystemStorage class in django/core/files/storage.py. The file_permissions_mode attribute is set from the constructor argument or from the FILE_UPLOAD_PERMISSIONS setting. The file permissions are applied with os.chmod after the file is saved.\n\nThe problem described in the PR is that when a file is uploaded, the temporary file created by tempfile.NamedTemporaryFile has restrictive permissions (0o600), and when it is renamed to the final location, the permissions remain restrictive. The PR wants to set a default FILE_UPLOAD_PERMISSIONS to 0o644 to avoid this issue.\n\nCurrently, in django/conf/global_settings.py, FILE_UPLOAD_PERMISSIONS is set to None by default.\n\nPlan:\n1. Change the default value of FILE_UPLOAD_PERMISSIONS in django/conf/global_settings.py from None to 0o644.\n2. Add a warning or note in the documentation about the permission inconsistency issue when FILE_UPLOAD_PERMISSIONS is not set explicitly.\n\nI will first edit django/conf/global_settings.py to set FILE_UPLOAD_PERMISSIONS = 0o644.', 'action': "str_replace_editor str_replace /testbed/django/conf/global_settings.py   --old_str 'FILE_UPLOAD_PERMISSIONS = None' --new_str 'FILE_UPLOAD_PERMISSIONS = 0o644'", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/django/conf/global_settings.py","old_str":"FILE_UPLOAD_PERMISSIONS = None","new_str":"FILE_UPLOAD_PERMISSIONS = 0o644"}', 'name': 'str_replace_editor'}, 'id': 'call_z71YEQLDNzhWRWJTHy5EhfSw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nThe file /testbed/django/conf/global_settings.py has been edited. Here\'s the result of running `cat -n` on a snippet of /testbed/django/conf/global_settings.py:\n   302\t# (i.e. "/tmp" on *nix systems).\n   303\tFILE_UPLOAD_TEMP_DIR = None\n   304\t\n   305\t# The numeric mode to set newly-uploaded files to. The value should be a mode\n   306\t# you\'d pass directly to os.chmod; see https://docs.python.org/library/os.html#files-and-directories.\n   307\tFILE_UPLOAD_PERMISSIONS = 0o644\n   308\t\n   309\t# The numeric mode to assign to newly-created directories, when uploading files.\n   310\t# The value should be a mode as you\'d pass to os.chmod;\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_z71YEQLDNzhWRWJTHy5EhfSw'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:08:48,009 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
The file /testbed/docs/ref/settings.txt has been edited. Here's the result of running `cat -n` on a snippet of /testbed/docs/ref/settings.txt:
  1477	:djadmin:`collectstatic` for details on overriding it.
  1478	
  1479	This value mirrors the functionality and caveats of the
  1480	:setting:`FILE_UPLOAD_PERMISSIONS` setting.
  1481	
  1482	.. setting:: FILE_UPLOAD_PERMISSIONS
  1483	
  1484	    .. warning::
  1485	
  1486	        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.
  1487	
  1488	
  1489	``FILE_UPLOAD_PERMISSIONS``
  1490	---------------------------
Review the changes and make sure they are as expected. Edit the file again if necessary.

2025-12-09 13:08:48,037 - INFO - swea-agent-django__django-10914 - ========================= STEP 22 =========================
2025-12-09 13:08:58,744 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
cat > /testbed/scripts/reproduce_upload_permission_issue.py << 'EOF'
import os
import tempfile

# Simulate file upload saving with tempfile.NamedTemporaryFile and os.rename

def simulate_file_upload():
    # Create a temporary file with NamedTemporaryFile
    with tempfile.NamedTemporaryFile(delete=False) as tmp:
        tmp.write(b"Test content")
        tmp_path = tmp.name

    # Check permissions of the temporary file
    tmp_stat = os.stat(tmp_path)
    print(f"Temporary file permissions: {oct(tmp_stat.st_mode & 0o777)}")

    # Simulate renaming to final destination
    final_path = tmp_path + "_final"
    os.rename(tmp_path, final_path)

    # Check permissions of the final file
    final_stat = os.stat(final_path)
    print(f"Final file permissions: {oct(final_stat.st_mode & 0o777)}")

    # Clean up
    os.remove(final_path)

if __name__ == "__main__":
    simulate_file_upload()
EOF
2025-12-09 13:08:59,133 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_uUwM82lrbSPkD1CovRUg95fF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_uUwM82lrbSPkD1CovRUg95fF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 -n 40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 -n 40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_Hr4Btg38nkLy1v8N1BffgUal', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Hr4Btg38nkLy1v8N1BffgUal']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 180,220p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 180,220p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_mytKsnCpzP9Fg8vyGKiRGJcW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n        elif setting == \'MEDIA_URL\':\n            self.__dict__.pop(\'base_url\', None)\n        elif setting == \'FILE_UPLOAD_PERMISSIONS\':\n            self.__dict__.pop(\'file_permissions_mode\', None)\n        elif setting == \'FILE_UPLOAD_DIRECTORY_PERMISSIONS\':\n            self.__dict__.pop(\'directory_permissions_mode\', None)\n\n    def _value_or_setting(self, value, setting):\n        return setting if value is None else value\n\n    @cached_property\n    def base_location(self):\n        return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n\n    @cached_property\n    def location(self):\n        return os.path.abspath(self.base_location)\n\n    @cached_property\n    def base_url(self):\n        if self._base_url is not None and not self._base_url.endswith(\'/\'):\n            self._base_url += \'/\'\n        return self._value_or_setting(self._base_url, settings.MEDIA_URL)\n\n    @cached_property\n    def file_permissions_mode(self):\n        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n\n    @cached_property\n    def directory_permissions_mode(self):\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mytKsnCpzP9Fg8vyGKiRGJcW']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w -j 1", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w -j 1"}', 'name': 'bash'}, 'id': 'call_9OMGnmqRUoiQ7umCBOMsT1NC', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9OMGnmqRUoiQ7umCBOMsT1NC']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n file_permissions_mode /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n file_permissions_mode /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_lrIsYmEFlRXo3J9U9DSiAR1r', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n178:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n182:        self._file_permissions_mode = file_permissions_mode\n194:            self.__dict__.pop('file_permissions_mode', None)\n216:    def file_permissions_mode(self):\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n234:                # for consistency with file_permissions_mode behavior.\n283:        if self.file_permissions_mode is not None:\n284:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_lrIsYmEFlRXo3J9U9DSiAR1r']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 170,190p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 170,190p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_iJcLRaUXMVr0ks33JFKxW9iX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nclass FileSystemStorage(Storage):\n    """\n    Standard filesystem storage\n    """\n    # The combination of O_CREAT and O_EXCL makes os.open() raise OSError if\n    # the file already exists before it\'s opened.\n    OS_OPEN_FLAGS = os.O_WRONLY | os.O_CREAT | os.O_EXCL | getattr(os, \'O_BINARY\', 0)\n\n    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n                 directory_permissions_mode=None):\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_iJcLRaUXMVr0ks33JFKxW9iX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 270,290p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 270,290p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_A6fcKyZ2N1gnEJ8DLQel59IH', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n                        locks.unlock(fd)\n                        if _file is not None:\n                            _file.close()\n                        else:\n                            os.close(fd)\n            except FileExistsError:\n                # A new name is needed if the file exists.\n                name = self.get_available_name(name)\n                full_path = self.path(name)\n            else:\n                # OK, the file save worked. Break out of the loop.\n                break\n\n        if self.file_permissions_mode is not None:\n            os.chmod(full_path, self.file_permissions_mode)\n\n        # Store filenames with forward slashes, even on Windows.\n        return name.replace(\'\\\\\', \'/\')\n\n    def delete(self, name):\n        assert name, "The name argument is not allowed to be empty."\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_A6fcKyZ2N1gnEJ8DLQel59IH']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_AOyoZmjwZoQnZPmGRGXylvgA', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_AOyoZmjwZoQnZPmGRGXylvgA']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r file_permissions_mode /testbed/django/core/files/', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r file_permissions_mode /testbed/django/core/files/"}', 'name': 'bash'}, 'id': 'call_E3R6QqNlATZKqNW4hBHBqncQ', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/django/core/files/storage.py:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n/testbed/django/core/files/storage.py:        self._file_permissions_mode = file_permissions_mode\n/testbed/django/core/files/storage.py:            self.__dict__.pop('file_permissions_mode', None)\n/testbed/django/core/files/storage.py:    def file_permissions_mode(self):\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/core/files/storage.py:                # for consistency with file_permissions_mode behavior.\n/testbed/django/core/files/storage.py:        if self.file_permissions_mode is not None:\n/testbed/django/core/files/storage.py:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_E3R6QqNlATZKqNW4hBHBqncQ']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_qGjSkLbXXIs66dWiPY0grfHe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_qGjSkLbXXIs66dWiPY0grfHe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_0tZWDFGyJm8gfZyftEgVuJOW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_0tZWDFGyJm8gfZyftEgVuJOW']}, {'role': 'assistant', 'content': 'The relevant code for file upload permissions is in the FileSystemStorage class in django/core/files/storage.py. The file_permissions_mode attribute is set from the constructor argument or from the FILE_UPLOAD_PERMISSIONS setting. The file permissions are applied with os.chmod after the file is saved.\n\nThe problem described in the PR is that when a file is uploaded, the temporary file created by tempfile.NamedTemporaryFile has restrictive permissions (0o600), and when it is renamed to the final location, the permissions remain restrictive. The PR wants to set a default FILE_UPLOAD_PERMISSIONS to 0o644 to avoid this issue.\n\nCurrently, in django/conf/global_settings.py, FILE_UPLOAD_PERMISSIONS is set to None by default.\n\nPlan:\n1. Change the default value of FILE_UPLOAD_PERMISSIONS in django/conf/global_settings.py from None to 0o644.\n2. Add a warning or note in the documentation about the permission inconsistency issue when FILE_UPLOAD_PERMISSIONS is not set explicitly.\n\nI will first edit django/conf/global_settings.py to set FILE_UPLOAD_PERMISSIONS = 0o644.', 'thought': 'The relevant code for file upload permissions is in the FileSystemStorage class in django/core/files/storage.py. The file_permissions_mode attribute is set from the constructor argument or from the FILE_UPLOAD_PERMISSIONS setting. The file permissions are applied with os.chmod after the file is saved.\n\nThe problem described in the PR is that when a file is uploaded, the temporary file created by tempfile.NamedTemporaryFile has restrictive permissions (0o600), and when it is renamed to the final location, the permissions remain restrictive. The PR wants to set a default FILE_UPLOAD_PERMISSIONS to 0o644 to avoid this issue.\n\nCurrently, in django/conf/global_settings.py, FILE_UPLOAD_PERMISSIONS is set to None by default.\n\nPlan:\n1. Change the default value of FILE_UPLOAD_PERMISSIONS in django/conf/global_settings.py from None to 0o644.\n2. Add a warning or note in the documentation about the permission inconsistency issue when FILE_UPLOAD_PERMISSIONS is not set explicitly.\n\nI will first edit django/conf/global_settings.py to set FILE_UPLOAD_PERMISSIONS = 0o644.', 'action': "str_replace_editor str_replace /testbed/django/conf/global_settings.py   --old_str 'FILE_UPLOAD_PERMISSIONS = None' --new_str 'FILE_UPLOAD_PERMISSIONS = 0o644'", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/django/conf/global_settings.py","old_str":"FILE_UPLOAD_PERMISSIONS = None","new_str":"FILE_UPLOAD_PERMISSIONS = 0o644"}', 'name': 'str_replace_editor'}, 'id': 'call_z71YEQLDNzhWRWJTHy5EhfSw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nThe file /testbed/django/conf/global_settings.py has been edited. Here\'s the result of running `cat -n` on a snippet of /testbed/django/conf/global_settings.py:\n   302\t# (i.e. "/tmp" on *nix systems).\n   303\tFILE_UPLOAD_TEMP_DIR = None\n   304\t\n   305\t# The numeric mode to set newly-uploaded files to. The value should be a mode\n   306\t# you\'d pass directly to os.chmod; see https://docs.python.org/library/os.html#files-and-directories.\n   307\tFILE_UPLOAD_PERMISSIONS = 0o644\n   308\t\n   309\t# The numeric mode to assign to newly-created directories, when uploading files.\n   310\t# The value should be a mode as you\'d pass to os.chmod;\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_z71YEQLDNzhWRWJTHy5EhfSw'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "str_replace_editor str_replace /testbed/docs/ref/settings.txt   --old_str '.. setting:: FILE_UPLOAD_PERMISSIONS' --new_str '.. setting:: FILE_UPLOAD_PERMISSIONS\n\n    .. warning::\n\n        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\n'", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/docs/ref/settings.txt","old_str":".. setting:: FILE_UPLOAD_PERMISSIONS","new_str":".. setting:: FILE_UPLOAD_PERMISSIONS\\n\\n    .. warning::\\n\\n        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\\n"}', 'name': 'str_replace_editor'}, 'id': 'call_WYOiqDN5Jss5Jfv6gAXYv2It', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/docs/ref/settings.txt has been edited. Here's the result of running `cat -n` on a snippet of /testbed/docs/ref/settings.txt:\n  1477\t:djadmin:`collectstatic` for details on overriding it.\n  1478\t\n  1479\tThis value mirrors the functionality and caveats of the\n  1480\t:setting:`FILE_UPLOAD_PERMISSIONS` setting.\n  1481\t\n  1482\t.. setting:: FILE_UPLOAD_PERMISSIONS\n  1483\t\n  1484\t    .. warning::\n  1485\t\n  1486\t        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\n  1487\t\n  1488\t\n  1489\t``FILE_UPLOAD_PERMISSIONS``\n  1490\t---------------------------\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_WYOiqDN5Jss5Jfv6gAXYv2It'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:08:59,137 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
Your command ran successfully and did not produce any output.
2025-12-09 13:08:59,158 - INFO - swea-agent-django__django-10914 - ========================= STEP 23 =========================
2025-12-09 13:09:04,186 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
python3 /testbed/scripts/reproduce_upload_permission_issue.py
2025-12-09 13:09:04,506 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_uUwM82lrbSPkD1CovRUg95fF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_uUwM82lrbSPkD1CovRUg95fF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 -n 40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 -n 40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_Hr4Btg38nkLy1v8N1BffgUal', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Hr4Btg38nkLy1v8N1BffgUal']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 180,220p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 180,220p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_mytKsnCpzP9Fg8vyGKiRGJcW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n        elif setting == \'MEDIA_URL\':\n            self.__dict__.pop(\'base_url\', None)\n        elif setting == \'FILE_UPLOAD_PERMISSIONS\':\n            self.__dict__.pop(\'file_permissions_mode\', None)\n        elif setting == \'FILE_UPLOAD_DIRECTORY_PERMISSIONS\':\n            self.__dict__.pop(\'directory_permissions_mode\', None)\n\n    def _value_or_setting(self, value, setting):\n        return setting if value is None else value\n\n    @cached_property\n    def base_location(self):\n        return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n\n    @cached_property\n    def location(self):\n        return os.path.abspath(self.base_location)\n\n    @cached_property\n    def base_url(self):\n        if self._base_url is not None and not self._base_url.endswith(\'/\'):\n            self._base_url += \'/\'\n        return self._value_or_setting(self._base_url, settings.MEDIA_URL)\n\n    @cached_property\n    def file_permissions_mode(self):\n        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n\n    @cached_property\n    def directory_permissions_mode(self):\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mytKsnCpzP9Fg8vyGKiRGJcW']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w -j 1", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w -j 1"}', 'name': 'bash'}, 'id': 'call_9OMGnmqRUoiQ7umCBOMsT1NC', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9OMGnmqRUoiQ7umCBOMsT1NC']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n file_permissions_mode /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n file_permissions_mode /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_lrIsYmEFlRXo3J9U9DSiAR1r', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n178:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n182:        self._file_permissions_mode = file_permissions_mode\n194:            self.__dict__.pop('file_permissions_mode', None)\n216:    def file_permissions_mode(self):\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n234:                # for consistency with file_permissions_mode behavior.\n283:        if self.file_permissions_mode is not None:\n284:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_lrIsYmEFlRXo3J9U9DSiAR1r']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 170,190p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 170,190p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_iJcLRaUXMVr0ks33JFKxW9iX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nclass FileSystemStorage(Storage):\n    """\n    Standard filesystem storage\n    """\n    # The combination of O_CREAT and O_EXCL makes os.open() raise OSError if\n    # the file already exists before it\'s opened.\n    OS_OPEN_FLAGS = os.O_WRONLY | os.O_CREAT | os.O_EXCL | getattr(os, \'O_BINARY\', 0)\n\n    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n                 directory_permissions_mode=None):\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_iJcLRaUXMVr0ks33JFKxW9iX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 270,290p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 270,290p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_A6fcKyZ2N1gnEJ8DLQel59IH', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n                        locks.unlock(fd)\n                        if _file is not None:\n                            _file.close()\n                        else:\n                            os.close(fd)\n            except FileExistsError:\n                # A new name is needed if the file exists.\n                name = self.get_available_name(name)\n                full_path = self.path(name)\n            else:\n                # OK, the file save worked. Break out of the loop.\n                break\n\n        if self.file_permissions_mode is not None:\n            os.chmod(full_path, self.file_permissions_mode)\n\n        # Store filenames with forward slashes, even on Windows.\n        return name.replace(\'\\\\\', \'/\')\n\n    def delete(self, name):\n        assert name, "The name argument is not allowed to be empty."\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_A6fcKyZ2N1gnEJ8DLQel59IH']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_AOyoZmjwZoQnZPmGRGXylvgA', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_AOyoZmjwZoQnZPmGRGXylvgA']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r file_permissions_mode /testbed/django/core/files/', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r file_permissions_mode /testbed/django/core/files/"}', 'name': 'bash'}, 'id': 'call_E3R6QqNlATZKqNW4hBHBqncQ', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/django/core/files/storage.py:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n/testbed/django/core/files/storage.py:        self._file_permissions_mode = file_permissions_mode\n/testbed/django/core/files/storage.py:            self.__dict__.pop('file_permissions_mode', None)\n/testbed/django/core/files/storage.py:    def file_permissions_mode(self):\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/core/files/storage.py:                # for consistency with file_permissions_mode behavior.\n/testbed/django/core/files/storage.py:        if self.file_permissions_mode is not None:\n/testbed/django/core/files/storage.py:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_E3R6QqNlATZKqNW4hBHBqncQ']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_qGjSkLbXXIs66dWiPY0grfHe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_qGjSkLbXXIs66dWiPY0grfHe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_0tZWDFGyJm8gfZyftEgVuJOW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_0tZWDFGyJm8gfZyftEgVuJOW']}, {'role': 'assistant', 'content': 'The relevant code for file upload permissions is in the FileSystemStorage class in django/core/files/storage.py. The file_permissions_mode attribute is set from the constructor argument or from the FILE_UPLOAD_PERMISSIONS setting. The file permissions are applied with os.chmod after the file is saved.\n\nThe problem described in the PR is that when a file is uploaded, the temporary file created by tempfile.NamedTemporaryFile has restrictive permissions (0o600), and when it is renamed to the final location, the permissions remain restrictive. The PR wants to set a default FILE_UPLOAD_PERMISSIONS to 0o644 to avoid this issue.\n\nCurrently, in django/conf/global_settings.py, FILE_UPLOAD_PERMISSIONS is set to None by default.\n\nPlan:\n1. Change the default value of FILE_UPLOAD_PERMISSIONS in django/conf/global_settings.py from None to 0o644.\n2. Add a warning or note in the documentation about the permission inconsistency issue when FILE_UPLOAD_PERMISSIONS is not set explicitly.\n\nI will first edit django/conf/global_settings.py to set FILE_UPLOAD_PERMISSIONS = 0o644.', 'thought': 'The relevant code for file upload permissions is in the FileSystemStorage class in django/core/files/storage.py. The file_permissions_mode attribute is set from the constructor argument or from the FILE_UPLOAD_PERMISSIONS setting. The file permissions are applied with os.chmod after the file is saved.\n\nThe problem described in the PR is that when a file is uploaded, the temporary file created by tempfile.NamedTemporaryFile has restrictive permissions (0o600), and when it is renamed to the final location, the permissions remain restrictive. The PR wants to set a default FILE_UPLOAD_PERMISSIONS to 0o644 to avoid this issue.\n\nCurrently, in django/conf/global_settings.py, FILE_UPLOAD_PERMISSIONS is set to None by default.\n\nPlan:\n1. Change the default value of FILE_UPLOAD_PERMISSIONS in django/conf/global_settings.py from None to 0o644.\n2. Add a warning or note in the documentation about the permission inconsistency issue when FILE_UPLOAD_PERMISSIONS is not set explicitly.\n\nI will first edit django/conf/global_settings.py to set FILE_UPLOAD_PERMISSIONS = 0o644.', 'action': "str_replace_editor str_replace /testbed/django/conf/global_settings.py   --old_str 'FILE_UPLOAD_PERMISSIONS = None' --new_str 'FILE_UPLOAD_PERMISSIONS = 0o644'", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/django/conf/global_settings.py","old_str":"FILE_UPLOAD_PERMISSIONS = None","new_str":"FILE_UPLOAD_PERMISSIONS = 0o644"}', 'name': 'str_replace_editor'}, 'id': 'call_z71YEQLDNzhWRWJTHy5EhfSw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nThe file /testbed/django/conf/global_settings.py has been edited. Here\'s the result of running `cat -n` on a snippet of /testbed/django/conf/global_settings.py:\n   302\t# (i.e. "/tmp" on *nix systems).\n   303\tFILE_UPLOAD_TEMP_DIR = None\n   304\t\n   305\t# The numeric mode to set newly-uploaded files to. The value should be a mode\n   306\t# you\'d pass directly to os.chmod; see https://docs.python.org/library/os.html#files-and-directories.\n   307\tFILE_UPLOAD_PERMISSIONS = 0o644\n   308\t\n   309\t# The numeric mode to assign to newly-created directories, when uploading files.\n   310\t# The value should be a mode as you\'d pass to os.chmod;\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_z71YEQLDNzhWRWJTHy5EhfSw']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "str_replace_editor str_replace /testbed/docs/ref/settings.txt   --old_str '.. setting:: FILE_UPLOAD_PERMISSIONS' --new_str '.. setting:: FILE_UPLOAD_PERMISSIONS\n\n    .. warning::\n\n        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\n'", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/docs/ref/settings.txt","old_str":".. setting:: FILE_UPLOAD_PERMISSIONS","new_str":".. setting:: FILE_UPLOAD_PERMISSIONS\\n\\n    .. warning::\\n\\n        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\\n"}', 'name': 'str_replace_editor'}, 'id': 'call_WYOiqDN5Jss5Jfv6gAXYv2It', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/docs/ref/settings.txt has been edited. Here's the result of running `cat -n` on a snippet of /testbed/docs/ref/settings.txt:\n  1477\t:djadmin:`collectstatic` for details on overriding it.\n  1478\t\n  1479\tThis value mirrors the functionality and caveats of the\n  1480\t:setting:`FILE_UPLOAD_PERMISSIONS` setting.\n  1481\t\n  1482\t.. setting:: FILE_UPLOAD_PERMISSIONS\n  1483\t\n  1484\t    .. warning::\n  1485\t\n  1486\t        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\n  1487\t\n  1488\t\n  1489\t``FILE_UPLOAD_PERMISSIONS``\n  1490\t---------------------------\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_WYOiqDN5Jss5Jfv6gAXYv2It'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'cat > /testbed/scripts/reproduce_upload_permission_issue.py << \'EOF\'\nimport os\nimport tempfile\n\n# Simulate file upload saving with tempfile.NamedTemporaryFile and os.rename\n\ndef simulate_file_upload():\n    # Create a temporary file with NamedTemporaryFile\n    with tempfile.NamedTemporaryFile(delete=False) as tmp:\n        tmp.write(b"Test content")\n        tmp_path = tmp.name\n\n    # Check permissions of the temporary file\n    tmp_stat = os.stat(tmp_path)\n    print(f"Temporary file permissions: {oct(tmp_stat.st_mode & 0o777)}")\n\n    # Simulate renaming to final destination\n    final_path = tmp_path + "_final"\n    os.rename(tmp_path, final_path)\n\n    # Check permissions of the final file\n    final_stat = os.stat(final_path)\n    print(f"Final file permissions: {oct(final_stat.st_mode & 0o777)}")\n\n    # Clean up\n    os.remove(final_path)\n\nif __name__ == "__main__":\n    simulate_file_upload()\nEOF', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"cat > /testbed/scripts/reproduce_upload_permission_issue.py << \'EOF\'\\nimport os\\nimport tempfile\\n\\n# Simulate file upload saving with tempfile.NamedTemporaryFile and os.rename\\n\\ndef simulate_file_upload():\\n    # Create a temporary file with NamedTemporaryFile\\n    with tempfile.NamedTemporaryFile(delete=False) as tmp:\\n        tmp.write(b\\"Test content\\")\\n        tmp_path = tmp.name\\n\\n    # Check permissions of the temporary file\\n    tmp_stat = os.stat(tmp_path)\\n    print(f\\"Temporary file permissions: {oct(tmp_stat.st_mode & 0o777)}\\")\\n\\n    # Simulate renaming to final destination\\n    final_path = tmp_path + \\"_final\\"\\n    os.rename(tmp_path, final_path)\\n\\n    # Check permissions of the final file\\n    final_stat = os.stat(final_path)\\n    print(f\\"Final file permissions: {oct(final_stat.st_mode & 0o777)}\\")\\n\\n    # Clean up\\n    os.remove(final_path)\\n\\nif __name__ == \\"__main__\\":\\n    simulate_file_upload()\\nEOF\\n"}', 'name': 'bash'}, 'id': 'call_39r62n9LLklnjClqIyaw3IvF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'Your command ran successfully and did not produce any output.'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_39r62n9LLklnjClqIyaw3IvF'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:09:04,507 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
Temporary file permissions: 0o600
Final file permissions: 0o600

2025-12-09 13:09:04,532 - INFO - swea-agent-django__django-10914 - ========================= STEP 24 =========================
2025-12-09 13:09:19,097 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT
The reproduce script shows that the temporary file created by tempfile.NamedTemporaryFile has permissions 0o600, and after renaming, the final file also has permissions 0o600. This confirms the issue described in the PR.

Now, with the change made to set FILE_UPLOAD_PERMISSIONS to 0o644 by default in global_settings.py, the FileSystemStorage class should apply these permissions to the saved file using os.chmod.

To confirm the fix, I will create a small test script that uses Django's FileSystemStorage to save a file and check the permissions of the saved file. This will verify that the file permissions are set to 0o644 by default.

I will create and run this test script next.

ðŸŽ¬ ACTION
str_replace_editor create /testbed/scripts/test_filesystemstorage_permissions.py --file_text 'import os
from django.core.files.storage import FileSystemStorage
from django.core.files.base import ContentFile

# Setup a FileSystemStorage instance
storage = FileSystemStorage()

# Save a file
file_name = '"'"'test_file.txt'"'"'
content = ContentFile(b'"'"'Test content'"'"')
saved_name = storage.save(file_name, content)

# Get the full path
full_path = storage.path(saved_name)

# Check the permissions
file_stat = os.stat(full_path)
print(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")

# Clean up
os.remove(full_path)
'
2025-12-09 13:09:19,423 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_uUwM82lrbSPkD1CovRUg95fF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_uUwM82lrbSPkD1CovRUg95fF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 -n 40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 -n 40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_Hr4Btg38nkLy1v8N1BffgUal', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Hr4Btg38nkLy1v8N1BffgUal']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 180,220p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 180,220p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_mytKsnCpzP9Fg8vyGKiRGJcW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n        elif setting == \'MEDIA_URL\':\n            self.__dict__.pop(\'base_url\', None)\n        elif setting == \'FILE_UPLOAD_PERMISSIONS\':\n            self.__dict__.pop(\'file_permissions_mode\', None)\n        elif setting == \'FILE_UPLOAD_DIRECTORY_PERMISSIONS\':\n            self.__dict__.pop(\'directory_permissions_mode\', None)\n\n    def _value_or_setting(self, value, setting):\n        return setting if value is None else value\n\n    @cached_property\n    def base_location(self):\n        return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n\n    @cached_property\n    def location(self):\n        return os.path.abspath(self.base_location)\n\n    @cached_property\n    def base_url(self):\n        if self._base_url is not None and not self._base_url.endswith(\'/\'):\n            self._base_url += \'/\'\n        return self._value_or_setting(self._base_url, settings.MEDIA_URL)\n\n    @cached_property\n    def file_permissions_mode(self):\n        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n\n    @cached_property\n    def directory_permissions_mode(self):\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mytKsnCpzP9Fg8vyGKiRGJcW']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w -j 1", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w -j 1"}', 'name': 'bash'}, 'id': 'call_9OMGnmqRUoiQ7umCBOMsT1NC', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9OMGnmqRUoiQ7umCBOMsT1NC']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n file_permissions_mode /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n file_permissions_mode /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_lrIsYmEFlRXo3J9U9DSiAR1r', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n178:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n182:        self._file_permissions_mode = file_permissions_mode\n194:            self.__dict__.pop('file_permissions_mode', None)\n216:    def file_permissions_mode(self):\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n234:                # for consistency with file_permissions_mode behavior.\n283:        if self.file_permissions_mode is not None:\n284:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_lrIsYmEFlRXo3J9U9DSiAR1r']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 170,190p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 170,190p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_iJcLRaUXMVr0ks33JFKxW9iX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nclass FileSystemStorage(Storage):\n    """\n    Standard filesystem storage\n    """\n    # The combination of O_CREAT and O_EXCL makes os.open() raise OSError if\n    # the file already exists before it\'s opened.\n    OS_OPEN_FLAGS = os.O_WRONLY | os.O_CREAT | os.O_EXCL | getattr(os, \'O_BINARY\', 0)\n\n    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n                 directory_permissions_mode=None):\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_iJcLRaUXMVr0ks33JFKxW9iX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 270,290p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 270,290p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_A6fcKyZ2N1gnEJ8DLQel59IH', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n                        locks.unlock(fd)\n                        if _file is not None:\n                            _file.close()\n                        else:\n                            os.close(fd)\n            except FileExistsError:\n                # A new name is needed if the file exists.\n                name = self.get_available_name(name)\n                full_path = self.path(name)\n            else:\n                # OK, the file save worked. Break out of the loop.\n                break\n\n        if self.file_permissions_mode is not None:\n            os.chmod(full_path, self.file_permissions_mode)\n\n        # Store filenames with forward slashes, even on Windows.\n        return name.replace(\'\\\\\', \'/\')\n\n    def delete(self, name):\n        assert name, "The name argument is not allowed to be empty."\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_A6fcKyZ2N1gnEJ8DLQel59IH']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_AOyoZmjwZoQnZPmGRGXylvgA', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_AOyoZmjwZoQnZPmGRGXylvgA']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r file_permissions_mode /testbed/django/core/files/', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r file_permissions_mode /testbed/django/core/files/"}', 'name': 'bash'}, 'id': 'call_E3R6QqNlATZKqNW4hBHBqncQ', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/django/core/files/storage.py:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n/testbed/django/core/files/storage.py:        self._file_permissions_mode = file_permissions_mode\n/testbed/django/core/files/storage.py:            self.__dict__.pop('file_permissions_mode', None)\n/testbed/django/core/files/storage.py:    def file_permissions_mode(self):\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/core/files/storage.py:                # for consistency with file_permissions_mode behavior.\n/testbed/django/core/files/storage.py:        if self.file_permissions_mode is not None:\n/testbed/django/core/files/storage.py:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_E3R6QqNlATZKqNW4hBHBqncQ']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_qGjSkLbXXIs66dWiPY0grfHe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_qGjSkLbXXIs66dWiPY0grfHe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_0tZWDFGyJm8gfZyftEgVuJOW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_0tZWDFGyJm8gfZyftEgVuJOW']}, {'role': 'assistant', 'content': 'The relevant code for file upload permissions is in the FileSystemStorage class in django/core/files/storage.py. The file_permissions_mode attribute is set from the constructor argument or from the FILE_UPLOAD_PERMISSIONS setting. The file permissions are applied with os.chmod after the file is saved.\n\nThe problem described in the PR is that when a file is uploaded, the temporary file created by tempfile.NamedTemporaryFile has restrictive permissions (0o600), and when it is renamed to the final location, the permissions remain restrictive. The PR wants to set a default FILE_UPLOAD_PERMISSIONS to 0o644 to avoid this issue.\n\nCurrently, in django/conf/global_settings.py, FILE_UPLOAD_PERMISSIONS is set to None by default.\n\nPlan:\n1. Change the default value of FILE_UPLOAD_PERMISSIONS in django/conf/global_settings.py from None to 0o644.\n2. Add a warning or note in the documentation about the permission inconsistency issue when FILE_UPLOAD_PERMISSIONS is not set explicitly.\n\nI will first edit django/conf/global_settings.py to set FILE_UPLOAD_PERMISSIONS = 0o644.', 'thought': 'The relevant code for file upload permissions is in the FileSystemStorage class in django/core/files/storage.py. The file_permissions_mode attribute is set from the constructor argument or from the FILE_UPLOAD_PERMISSIONS setting. The file permissions are applied with os.chmod after the file is saved.\n\nThe problem described in the PR is that when a file is uploaded, the temporary file created by tempfile.NamedTemporaryFile has restrictive permissions (0o600), and when it is renamed to the final location, the permissions remain restrictive. The PR wants to set a default FILE_UPLOAD_PERMISSIONS to 0o644 to avoid this issue.\n\nCurrently, in django/conf/global_settings.py, FILE_UPLOAD_PERMISSIONS is set to None by default.\n\nPlan:\n1. Change the default value of FILE_UPLOAD_PERMISSIONS in django/conf/global_settings.py from None to 0o644.\n2. Add a warning or note in the documentation about the permission inconsistency issue when FILE_UPLOAD_PERMISSIONS is not set explicitly.\n\nI will first edit django/conf/global_settings.py to set FILE_UPLOAD_PERMISSIONS = 0o644.', 'action': "str_replace_editor str_replace /testbed/django/conf/global_settings.py   --old_str 'FILE_UPLOAD_PERMISSIONS = None' --new_str 'FILE_UPLOAD_PERMISSIONS = 0o644'", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/django/conf/global_settings.py","old_str":"FILE_UPLOAD_PERMISSIONS = None","new_str":"FILE_UPLOAD_PERMISSIONS = 0o644"}', 'name': 'str_replace_editor'}, 'id': 'call_z71YEQLDNzhWRWJTHy5EhfSw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nThe file /testbed/django/conf/global_settings.py has been edited. Here\'s the result of running `cat -n` on a snippet of /testbed/django/conf/global_settings.py:\n   302\t# (i.e. "/tmp" on *nix systems).\n   303\tFILE_UPLOAD_TEMP_DIR = None\n   304\t\n   305\t# The numeric mode to set newly-uploaded files to. The value should be a mode\n   306\t# you\'d pass directly to os.chmod; see https://docs.python.org/library/os.html#files-and-directories.\n   307\tFILE_UPLOAD_PERMISSIONS = 0o644\n   308\t\n   309\t# The numeric mode to assign to newly-created directories, when uploading files.\n   310\t# The value should be a mode as you\'d pass to os.chmod;\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_z71YEQLDNzhWRWJTHy5EhfSw']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "str_replace_editor str_replace /testbed/docs/ref/settings.txt   --old_str '.. setting:: FILE_UPLOAD_PERMISSIONS' --new_str '.. setting:: FILE_UPLOAD_PERMISSIONS\n\n    .. warning::\n\n        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\n'", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/docs/ref/settings.txt","old_str":".. setting:: FILE_UPLOAD_PERMISSIONS","new_str":".. setting:: FILE_UPLOAD_PERMISSIONS\\n\\n    .. warning::\\n\\n        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\\n"}', 'name': 'str_replace_editor'}, 'id': 'call_WYOiqDN5Jss5Jfv6gAXYv2It', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/docs/ref/settings.txt has been edited. Here's the result of running `cat -n` on a snippet of /testbed/docs/ref/settings.txt:\n  1477\t:djadmin:`collectstatic` for details on overriding it.\n  1478\t\n  1479\tThis value mirrors the functionality and caveats of the\n  1480\t:setting:`FILE_UPLOAD_PERMISSIONS` setting.\n  1481\t\n  1482\t.. setting:: FILE_UPLOAD_PERMISSIONS\n  1483\t\n  1484\t    .. warning::\n  1485\t\n  1486\t        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\n  1487\t\n  1488\t\n  1489\t``FILE_UPLOAD_PERMISSIONS``\n  1490\t---------------------------\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_WYOiqDN5Jss5Jfv6gAXYv2It']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'cat > /testbed/scripts/reproduce_upload_permission_issue.py << \'EOF\'\nimport os\nimport tempfile\n\n# Simulate file upload saving with tempfile.NamedTemporaryFile and os.rename\n\ndef simulate_file_upload():\n    # Create a temporary file with NamedTemporaryFile\n    with tempfile.NamedTemporaryFile(delete=False) as tmp:\n        tmp.write(b"Test content")\n        tmp_path = tmp.name\n\n    # Check permissions of the temporary file\n    tmp_stat = os.stat(tmp_path)\n    print(f"Temporary file permissions: {oct(tmp_stat.st_mode & 0o777)}")\n\n    # Simulate renaming to final destination\n    final_path = tmp_path + "_final"\n    os.rename(tmp_path, final_path)\n\n    # Check permissions of the final file\n    final_stat = os.stat(final_path)\n    print(f"Final file permissions: {oct(final_stat.st_mode & 0o777)}")\n\n    # Clean up\n    os.remove(final_path)\n\nif __name__ == "__main__":\n    simulate_file_upload()\nEOF', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"cat > /testbed/scripts/reproduce_upload_permission_issue.py << \'EOF\'\\nimport os\\nimport tempfile\\n\\n# Simulate file upload saving with tempfile.NamedTemporaryFile and os.rename\\n\\ndef simulate_file_upload():\\n    # Create a temporary file with NamedTemporaryFile\\n    with tempfile.NamedTemporaryFile(delete=False) as tmp:\\n        tmp.write(b\\"Test content\\")\\n        tmp_path = tmp.name\\n\\n    # Check permissions of the temporary file\\n    tmp_stat = os.stat(tmp_path)\\n    print(f\\"Temporary file permissions: {oct(tmp_stat.st_mode & 0o777)}\\")\\n\\n    # Simulate renaming to final destination\\n    final_path = tmp_path + \\"_final\\"\\n    os.rename(tmp_path, final_path)\\n\\n    # Check permissions of the final file\\n    final_stat = os.stat(final_path)\\n    print(f\\"Final file permissions: {oct(final_stat.st_mode & 0o777)}\\")\\n\\n    # Clean up\\n    os.remove(final_path)\\n\\nif __name__ == \\"__main__\\":\\n    simulate_file_upload()\\nEOF\\n"}', 'name': 'bash'}, 'id': 'call_39r62n9LLklnjClqIyaw3IvF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'Your command ran successfully and did not produce any output.'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_39r62n9LLklnjClqIyaw3IvF'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/scripts/reproduce_upload_permission_issue.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/scripts/reproduce_upload_permission_issue.py"}', 'name': 'bash'}, 'id': 'call_McVJw3znpWncbF2vlukScLA9', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nTemporary file permissions: 0o600\nFinal file permissions: 0o600\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_McVJw3znpWncbF2vlukScLA9'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:09:19,424 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
File created successfully at: /testbed/scripts/test_filesystemstorage_permissions.py

2025-12-09 13:09:19,453 - INFO - swea-agent-django__django-10914 - ========================= STEP 25 =========================
2025-12-09 13:09:23,395 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
python3 /testbed/scripts/test_filesystemstorage_permissions.py
2025-12-09 13:09:23,812 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_uUwM82lrbSPkD1CovRUg95fF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_uUwM82lrbSPkD1CovRUg95fF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 -n 40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 -n 40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_Hr4Btg38nkLy1v8N1BffgUal', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Hr4Btg38nkLy1v8N1BffgUal']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 180,220p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 180,220p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_mytKsnCpzP9Fg8vyGKiRGJcW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n        elif setting == \'MEDIA_URL\':\n            self.__dict__.pop(\'base_url\', None)\n        elif setting == \'FILE_UPLOAD_PERMISSIONS\':\n            self.__dict__.pop(\'file_permissions_mode\', None)\n        elif setting == \'FILE_UPLOAD_DIRECTORY_PERMISSIONS\':\n            self.__dict__.pop(\'directory_permissions_mode\', None)\n\n    def _value_or_setting(self, value, setting):\n        return setting if value is None else value\n\n    @cached_property\n    def base_location(self):\n        return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n\n    @cached_property\n    def location(self):\n        return os.path.abspath(self.base_location)\n\n    @cached_property\n    def base_url(self):\n        if self._base_url is not None and not self._base_url.endswith(\'/\'):\n            self._base_url += \'/\'\n        return self._value_or_setting(self._base_url, settings.MEDIA_URL)\n\n    @cached_property\n    def file_permissions_mode(self):\n        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n\n    @cached_property\n    def directory_permissions_mode(self):\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mytKsnCpzP9Fg8vyGKiRGJcW']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w -j 1", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w -j 1"}', 'name': 'bash'}, 'id': 'call_9OMGnmqRUoiQ7umCBOMsT1NC', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9OMGnmqRUoiQ7umCBOMsT1NC']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n file_permissions_mode /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n file_permissions_mode /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_lrIsYmEFlRXo3J9U9DSiAR1r', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n178:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n182:        self._file_permissions_mode = file_permissions_mode\n194:            self.__dict__.pop('file_permissions_mode', None)\n216:    def file_permissions_mode(self):\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n234:                # for consistency with file_permissions_mode behavior.\n283:        if self.file_permissions_mode is not None:\n284:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_lrIsYmEFlRXo3J9U9DSiAR1r']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 170,190p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 170,190p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_iJcLRaUXMVr0ks33JFKxW9iX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nclass FileSystemStorage(Storage):\n    """\n    Standard filesystem storage\n    """\n    # The combination of O_CREAT and O_EXCL makes os.open() raise OSError if\n    # the file already exists before it\'s opened.\n    OS_OPEN_FLAGS = os.O_WRONLY | os.O_CREAT | os.O_EXCL | getattr(os, \'O_BINARY\', 0)\n\n    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n                 directory_permissions_mode=None):\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_iJcLRaUXMVr0ks33JFKxW9iX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 270,290p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 270,290p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_A6fcKyZ2N1gnEJ8DLQel59IH', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n                        locks.unlock(fd)\n                        if _file is not None:\n                            _file.close()\n                        else:\n                            os.close(fd)\n            except FileExistsError:\n                # A new name is needed if the file exists.\n                name = self.get_available_name(name)\n                full_path = self.path(name)\n            else:\n                # OK, the file save worked. Break out of the loop.\n                break\n\n        if self.file_permissions_mode is not None:\n            os.chmod(full_path, self.file_permissions_mode)\n\n        # Store filenames with forward slashes, even on Windows.\n        return name.replace(\'\\\\\', \'/\')\n\n    def delete(self, name):\n        assert name, "The name argument is not allowed to be empty."\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_A6fcKyZ2N1gnEJ8DLQel59IH']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_AOyoZmjwZoQnZPmGRGXylvgA', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_AOyoZmjwZoQnZPmGRGXylvgA']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r file_permissions_mode /testbed/django/core/files/', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r file_permissions_mode /testbed/django/core/files/"}', 'name': 'bash'}, 'id': 'call_E3R6QqNlATZKqNW4hBHBqncQ', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/django/core/files/storage.py:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n/testbed/django/core/files/storage.py:        self._file_permissions_mode = file_permissions_mode\n/testbed/django/core/files/storage.py:            self.__dict__.pop('file_permissions_mode', None)\n/testbed/django/core/files/storage.py:    def file_permissions_mode(self):\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/core/files/storage.py:                # for consistency with file_permissions_mode behavior.\n/testbed/django/core/files/storage.py:        if self.file_permissions_mode is not None:\n/testbed/django/core/files/storage.py:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_E3R6QqNlATZKqNW4hBHBqncQ']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_qGjSkLbXXIs66dWiPY0grfHe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_qGjSkLbXXIs66dWiPY0grfHe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_0tZWDFGyJm8gfZyftEgVuJOW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_0tZWDFGyJm8gfZyftEgVuJOW']}, {'role': 'assistant', 'content': 'The relevant code for file upload permissions is in the FileSystemStorage class in django/core/files/storage.py. The file_permissions_mode attribute is set from the constructor argument or from the FILE_UPLOAD_PERMISSIONS setting. The file permissions are applied with os.chmod after the file is saved.\n\nThe problem described in the PR is that when a file is uploaded, the temporary file created by tempfile.NamedTemporaryFile has restrictive permissions (0o600), and when it is renamed to the final location, the permissions remain restrictive. The PR wants to set a default FILE_UPLOAD_PERMISSIONS to 0o644 to avoid this issue.\n\nCurrently, in django/conf/global_settings.py, FILE_UPLOAD_PERMISSIONS is set to None by default.\n\nPlan:\n1. Change the default value of FILE_UPLOAD_PERMISSIONS in django/conf/global_settings.py from None to 0o644.\n2. Add a warning or note in the documentation about the permission inconsistency issue when FILE_UPLOAD_PERMISSIONS is not set explicitly.\n\nI will first edit django/conf/global_settings.py to set FILE_UPLOAD_PERMISSIONS = 0o644.', 'thought': 'The relevant code for file upload permissions is in the FileSystemStorage class in django/core/files/storage.py. The file_permissions_mode attribute is set from the constructor argument or from the FILE_UPLOAD_PERMISSIONS setting. The file permissions are applied with os.chmod after the file is saved.\n\nThe problem described in the PR is that when a file is uploaded, the temporary file created by tempfile.NamedTemporaryFile has restrictive permissions (0o600), and when it is renamed to the final location, the permissions remain restrictive. The PR wants to set a default FILE_UPLOAD_PERMISSIONS to 0o644 to avoid this issue.\n\nCurrently, in django/conf/global_settings.py, FILE_UPLOAD_PERMISSIONS is set to None by default.\n\nPlan:\n1. Change the default value of FILE_UPLOAD_PERMISSIONS in django/conf/global_settings.py from None to 0o644.\n2. Add a warning or note in the documentation about the permission inconsistency issue when FILE_UPLOAD_PERMISSIONS is not set explicitly.\n\nI will first edit django/conf/global_settings.py to set FILE_UPLOAD_PERMISSIONS = 0o644.', 'action': "str_replace_editor str_replace /testbed/django/conf/global_settings.py   --old_str 'FILE_UPLOAD_PERMISSIONS = None' --new_str 'FILE_UPLOAD_PERMISSIONS = 0o644'", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/django/conf/global_settings.py","old_str":"FILE_UPLOAD_PERMISSIONS = None","new_str":"FILE_UPLOAD_PERMISSIONS = 0o644"}', 'name': 'str_replace_editor'}, 'id': 'call_z71YEQLDNzhWRWJTHy5EhfSw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nThe file /testbed/django/conf/global_settings.py has been edited. Here\'s the result of running `cat -n` on a snippet of /testbed/django/conf/global_settings.py:\n   302\t# (i.e. "/tmp" on *nix systems).\n   303\tFILE_UPLOAD_TEMP_DIR = None\n   304\t\n   305\t# The numeric mode to set newly-uploaded files to. The value should be a mode\n   306\t# you\'d pass directly to os.chmod; see https://docs.python.org/library/os.html#files-and-directories.\n   307\tFILE_UPLOAD_PERMISSIONS = 0o644\n   308\t\n   309\t# The numeric mode to assign to newly-created directories, when uploading files.\n   310\t# The value should be a mode as you\'d pass to os.chmod;\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_z71YEQLDNzhWRWJTHy5EhfSw']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "str_replace_editor str_replace /testbed/docs/ref/settings.txt   --old_str '.. setting:: FILE_UPLOAD_PERMISSIONS' --new_str '.. setting:: FILE_UPLOAD_PERMISSIONS\n\n    .. warning::\n\n        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\n'", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/docs/ref/settings.txt","old_str":".. setting:: FILE_UPLOAD_PERMISSIONS","new_str":".. setting:: FILE_UPLOAD_PERMISSIONS\\n\\n    .. warning::\\n\\n        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\\n"}', 'name': 'str_replace_editor'}, 'id': 'call_WYOiqDN5Jss5Jfv6gAXYv2It', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/docs/ref/settings.txt has been edited. Here's the result of running `cat -n` on a snippet of /testbed/docs/ref/settings.txt:\n  1477\t:djadmin:`collectstatic` for details on overriding it.\n  1478\t\n  1479\tThis value mirrors the functionality and caveats of the\n  1480\t:setting:`FILE_UPLOAD_PERMISSIONS` setting.\n  1481\t\n  1482\t.. setting:: FILE_UPLOAD_PERMISSIONS\n  1483\t\n  1484\t    .. warning::\n  1485\t\n  1486\t        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\n  1487\t\n  1488\t\n  1489\t``FILE_UPLOAD_PERMISSIONS``\n  1490\t---------------------------\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_WYOiqDN5Jss5Jfv6gAXYv2It']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'cat > /testbed/scripts/reproduce_upload_permission_issue.py << \'EOF\'\nimport os\nimport tempfile\n\n# Simulate file upload saving with tempfile.NamedTemporaryFile and os.rename\n\ndef simulate_file_upload():\n    # Create a temporary file with NamedTemporaryFile\n    with tempfile.NamedTemporaryFile(delete=False) as tmp:\n        tmp.write(b"Test content")\n        tmp_path = tmp.name\n\n    # Check permissions of the temporary file\n    tmp_stat = os.stat(tmp_path)\n    print(f"Temporary file permissions: {oct(tmp_stat.st_mode & 0o777)}")\n\n    # Simulate renaming to final destination\n    final_path = tmp_path + "_final"\n    os.rename(tmp_path, final_path)\n\n    # Check permissions of the final file\n    final_stat = os.stat(final_path)\n    print(f"Final file permissions: {oct(final_stat.st_mode & 0o777)}")\n\n    # Clean up\n    os.remove(final_path)\n\nif __name__ == "__main__":\n    simulate_file_upload()\nEOF', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"cat > /testbed/scripts/reproduce_upload_permission_issue.py << \'EOF\'\\nimport os\\nimport tempfile\\n\\n# Simulate file upload saving with tempfile.NamedTemporaryFile and os.rename\\n\\ndef simulate_file_upload():\\n    # Create a temporary file with NamedTemporaryFile\\n    with tempfile.NamedTemporaryFile(delete=False) as tmp:\\n        tmp.write(b\\"Test content\\")\\n        tmp_path = tmp.name\\n\\n    # Check permissions of the temporary file\\n    tmp_stat = os.stat(tmp_path)\\n    print(f\\"Temporary file permissions: {oct(tmp_stat.st_mode & 0o777)}\\")\\n\\n    # Simulate renaming to final destination\\n    final_path = tmp_path + \\"_final\\"\\n    os.rename(tmp_path, final_path)\\n\\n    # Check permissions of the final file\\n    final_stat = os.stat(final_path)\\n    print(f\\"Final file permissions: {oct(final_stat.st_mode & 0o777)}\\")\\n\\n    # Clean up\\n    os.remove(final_path)\\n\\nif __name__ == \\"__main__\\":\\n    simulate_file_upload()\\nEOF\\n"}', 'name': 'bash'}, 'id': 'call_39r62n9LLklnjClqIyaw3IvF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'Your command ran successfully and did not produce any output.'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_39r62n9LLklnjClqIyaw3IvF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/scripts/reproduce_upload_permission_issue.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/scripts/reproduce_upload_permission_issue.py"}', 'name': 'bash'}, 'id': 'call_McVJw3znpWncbF2vlukScLA9', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nTemporary file permissions: 0o600\nFinal file permissions: 0o600\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_McVJw3znpWncbF2vlukScLA9'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': "The reproduce script shows that the temporary file created by tempfile.NamedTemporaryFile has permissions 0o600, and after renaming, the final file also has permissions 0o600. This confirms the issue described in the PR.\n\nNow, with the change made to set FILE_UPLOAD_PERMISSIONS to 0o644 by default in global_settings.py, the FileSystemStorage class should apply these permissions to the saved file using os.chmod.\n\nTo confirm the fix, I will create a small test script that uses Django's FileSystemStorage to save a file and check the permissions of the saved file. This will verify that the file permissions are set to 0o644 by default.\n\nI will create and run this test script next.", 'thought': "The reproduce script shows that the temporary file created by tempfile.NamedTemporaryFile has permissions 0o600, and after renaming, the final file also has permissions 0o600. This confirms the issue described in the PR.\n\nNow, with the change made to set FILE_UPLOAD_PERMISSIONS to 0o644 by default in global_settings.py, the FileSystemStorage class should apply these permissions to the saved file using os.chmod.\n\nTo confirm the fix, I will create a small test script that uses Django's FileSystemStorage to save a file and check the permissions of the saved file. This will verify that the file permissions are set to 0o644 by default.\n\nI will create and run this test script next.", 'action': 'str_replace_editor create /testbed/scripts/test_filesystemstorage_permissions.py --file_text \'import os\nfrom django.core.files.storage import FileSystemStorage\nfrom django.core.files.base import ContentFile\n\n# Setup a FileSystemStorage instance\nstorage = FileSystemStorage()\n\n# Save a file\nfile_name = \'"\'"\'test_file.txt\'"\'"\'\ncontent = ContentFile(b\'"\'"\'Test content\'"\'"\')\nsaved_name = storage.save(file_name, content)\n\n# Get the full path\nfull_path = storage.path(saved_name)\n\n# Check the permissions\nfile_stat = os.stat(full_path)\nprint(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")\n\n# Clean up\nos.remove(full_path)\n\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"create","path":"/testbed/scripts/test_filesystemstorage_permissions.py","file_text":"import os\\nfrom django.core.files.storage import FileSystemStorage\\nfrom django.core.files.base import ContentFile\\n\\n# Setup a FileSystemStorage instance\\nstorage = FileSystemStorage()\\n\\n# Save a file\\nfile_name = \'test_file.txt\'\\ncontent = ContentFile(b\'Test content\')\\nsaved_name = storage.save(file_name, content)\\n\\n# Get the full path\\nfull_path = storage.path(saved_name)\\n\\n# Check the permissions\\nfile_stat = os.stat(full_path)\\nprint(f\\"Saved file permissions: {oct(file_stat.st_mode & 0o777)}\\")\\n\\n# Clean up\\nos.remove(full_path)\\n"}', 'name': 'str_replace_editor'}, 'id': 'call_fpmpDWr8f38w9VOD6CmkrElw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFile created successfully at: /testbed/scripts/test_filesystemstorage_permissions.py\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_fpmpDWr8f38w9VOD6CmkrElw'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:09:23,813 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
Traceback (most recent call last):
  File "/testbed/scripts/test_filesystemstorage_permissions.py", line 11, in <module>
    saved_name = storage.save(file_name, content)
  File "/testbed/django/core/files/storage.py", line 51, in save
    name = self.get_available_name(name, max_length=max_length)
  File "/testbed/django/core/files/storage.py", line 75, in get_available_name
    while self.exists(name) or (max_length and len(name) > max_length):
  File "/testbed/django/core/files/storage.py", line 304, in exists
    return os.path.exists(self.path(name))
  File "/testbed/django/core/files/storage.py", line 317, in path
    return safe_join(self.location, name)
  File "/testbed/django/utils/functional.py", line 48, in __get__
    res = instance.__dict__[self.name] = self.func(instance)
  File "/testbed/django/core/files/storage.py", line 207, in location
    return os.path.abspath(self.base_location)
  File "/testbed/django/utils/functional.py", line 48, in __get__
    res = instance.__dict__[self.name] = self.func(instance)
  File "/testbed/django/core/files/storage.py", line 203, in base_location
    return self._value_or_setting(self._location, settings.MEDIA_ROOT)
  File "/testbed/django/conf/__init__.py", line 76, in __getattr__
    self._setup(name)
  File "/testbed/django/conf/__init__.py", line 61, in _setup
    % (desc, ENVIRONMENT_VARIABLE))
django.core.exceptions.ImproperlyConfigured: Requested setting MEDIA_ROOT, but settings are not configured. You must either define the environment variable DJANGO_SETTINGS_MODULE or call settings.configure() before accessing settings.

2025-12-09 13:09:23,848 - INFO - swea-agent-django__django-10914 - ========================= STEP 26 =========================
2025-12-09 13:09:40,900 - WARNING - swea-lm-django__django-10914 - Retrying LM query: attempt 1 (slept for 10.00s) due to RateLimitError: litellm.RateLimitError: RateLimitError: OpenAIException - Rate limit reached for gpt-4.1-mini in organization org-X455j81VhQNdfQv1oTeGAtxa on tokens per min (TPM): Limit 200000, Used 176136, Requested 29845. Please try again in 1.794s. Visit https://platform.openai.com/account/rate-limits to learn more.
2025-12-09 13:10:06,933 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT
The test script failed because Django settings are not configured. To run this test script, we need to configure Django settings properly, including setting MEDIA_ROOT to a writable directory.

I will modify the test script to configure Django settings programmatically with a temporary directory as MEDIA_ROOT, then run the test again.

ðŸŽ¬ ACTION
str_replace_editor str_replace /testbed/scripts/test_filesystemstorage_permissions.py   --old_str 'import os
from django.core.files.storage import FileSystemStorage
from django.core.files.base import ContentFile

# Setup a FileSystemStorage instance
storage = FileSystemStorage()

# Save a file
file_name = '"'"'test_file.txt'"'"'
content = ContentFile(b'"'"'Test content'"'"')
saved_name = storage.save(file_name, content)

# Get the full path
full_path = storage.path(saved_name)

# Check the permissions
file_stat = os.stat(full_path)
print(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")

# Clean up
os.remove(full_path)
' --new_str 'import os
import tempfile
from django.conf import settings
from django.core.files.storage import FileSystemStorage
from django.core.files.base import ContentFile

# Configure Django settings
if not settings.configured:
    settings.configure(
        MEDIA_ROOT=tempfile.mkdtemp(),
        FILE_UPLOAD_PERMISSIONS=0o644,
    )

# Setup a FileSystemStorage instance
storage = FileSystemStorage()

# Save a file
file_name = '"'"'test_file.txt'"'"'
content = ContentFile(b'"'"'Test content'"'"')
saved_name = storage.save(file_name, content)

# Get the full path
full_path = storage.path(saved_name)

# Check the permissions
file_stat = os.stat(full_path)
print(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")

# Clean up
os.remove(full_path)
'
2025-12-09 13:10:07,254 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_uUwM82lrbSPkD1CovRUg95fF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_uUwM82lrbSPkD1CovRUg95fF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 -n 40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 -n 40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_Hr4Btg38nkLy1v8N1BffgUal', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Hr4Btg38nkLy1v8N1BffgUal']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 180,220p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 180,220p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_mytKsnCpzP9Fg8vyGKiRGJcW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n        elif setting == \'MEDIA_URL\':\n            self.__dict__.pop(\'base_url\', None)\n        elif setting == \'FILE_UPLOAD_PERMISSIONS\':\n            self.__dict__.pop(\'file_permissions_mode\', None)\n        elif setting == \'FILE_UPLOAD_DIRECTORY_PERMISSIONS\':\n            self.__dict__.pop(\'directory_permissions_mode\', None)\n\n    def _value_or_setting(self, value, setting):\n        return setting if value is None else value\n\n    @cached_property\n    def base_location(self):\n        return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n\n    @cached_property\n    def location(self):\n        return os.path.abspath(self.base_location)\n\n    @cached_property\n    def base_url(self):\n        if self._base_url is not None and not self._base_url.endswith(\'/\'):\n            self._base_url += \'/\'\n        return self._value_or_setting(self._base_url, settings.MEDIA_URL)\n\n    @cached_property\n    def file_permissions_mode(self):\n        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n\n    @cached_property\n    def directory_permissions_mode(self):\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mytKsnCpzP9Fg8vyGKiRGJcW']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w -j 1", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w -j 1"}', 'name': 'bash'}, 'id': 'call_9OMGnmqRUoiQ7umCBOMsT1NC', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9OMGnmqRUoiQ7umCBOMsT1NC']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n file_permissions_mode /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n file_permissions_mode /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_lrIsYmEFlRXo3J9U9DSiAR1r', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n178:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n182:        self._file_permissions_mode = file_permissions_mode\n194:            self.__dict__.pop('file_permissions_mode', None)\n216:    def file_permissions_mode(self):\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n234:                # for consistency with file_permissions_mode behavior.\n283:        if self.file_permissions_mode is not None:\n284:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_lrIsYmEFlRXo3J9U9DSiAR1r']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 170,190p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 170,190p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_iJcLRaUXMVr0ks33JFKxW9iX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nclass FileSystemStorage(Storage):\n    """\n    Standard filesystem storage\n    """\n    # The combination of O_CREAT and O_EXCL makes os.open() raise OSError if\n    # the file already exists before it\'s opened.\n    OS_OPEN_FLAGS = os.O_WRONLY | os.O_CREAT | os.O_EXCL | getattr(os, \'O_BINARY\', 0)\n\n    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n                 directory_permissions_mode=None):\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_iJcLRaUXMVr0ks33JFKxW9iX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 270,290p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 270,290p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_A6fcKyZ2N1gnEJ8DLQel59IH', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n                        locks.unlock(fd)\n                        if _file is not None:\n                            _file.close()\n                        else:\n                            os.close(fd)\n            except FileExistsError:\n                # A new name is needed if the file exists.\n                name = self.get_available_name(name)\n                full_path = self.path(name)\n            else:\n                # OK, the file save worked. Break out of the loop.\n                break\n\n        if self.file_permissions_mode is not None:\n            os.chmod(full_path, self.file_permissions_mode)\n\n        # Store filenames with forward slashes, even on Windows.\n        return name.replace(\'\\\\\', \'/\')\n\n    def delete(self, name):\n        assert name, "The name argument is not allowed to be empty."\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_A6fcKyZ2N1gnEJ8DLQel59IH']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_AOyoZmjwZoQnZPmGRGXylvgA', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_AOyoZmjwZoQnZPmGRGXylvgA']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r file_permissions_mode /testbed/django/core/files/', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r file_permissions_mode /testbed/django/core/files/"}', 'name': 'bash'}, 'id': 'call_E3R6QqNlATZKqNW4hBHBqncQ', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/django/core/files/storage.py:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n/testbed/django/core/files/storage.py:        self._file_permissions_mode = file_permissions_mode\n/testbed/django/core/files/storage.py:            self.__dict__.pop('file_permissions_mode', None)\n/testbed/django/core/files/storage.py:    def file_permissions_mode(self):\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/core/files/storage.py:                # for consistency with file_permissions_mode behavior.\n/testbed/django/core/files/storage.py:        if self.file_permissions_mode is not None:\n/testbed/django/core/files/storage.py:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_E3R6QqNlATZKqNW4hBHBqncQ']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_qGjSkLbXXIs66dWiPY0grfHe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_qGjSkLbXXIs66dWiPY0grfHe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_0tZWDFGyJm8gfZyftEgVuJOW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_0tZWDFGyJm8gfZyftEgVuJOW']}, {'role': 'assistant', 'content': 'The relevant code for file upload permissions is in the FileSystemStorage class in django/core/files/storage.py. The file_permissions_mode attribute is set from the constructor argument or from the FILE_UPLOAD_PERMISSIONS setting. The file permissions are applied with os.chmod after the file is saved.\n\nThe problem described in the PR is that when a file is uploaded, the temporary file created by tempfile.NamedTemporaryFile has restrictive permissions (0o600), and when it is renamed to the final location, the permissions remain restrictive. The PR wants to set a default FILE_UPLOAD_PERMISSIONS to 0o644 to avoid this issue.\n\nCurrently, in django/conf/global_settings.py, FILE_UPLOAD_PERMISSIONS is set to None by default.\n\nPlan:\n1. Change the default value of FILE_UPLOAD_PERMISSIONS in django/conf/global_settings.py from None to 0o644.\n2. Add a warning or note in the documentation about the permission inconsistency issue when FILE_UPLOAD_PERMISSIONS is not set explicitly.\n\nI will first edit django/conf/global_settings.py to set FILE_UPLOAD_PERMISSIONS = 0o644.', 'thought': 'The relevant code for file upload permissions is in the FileSystemStorage class in django/core/files/storage.py. The file_permissions_mode attribute is set from the constructor argument or from the FILE_UPLOAD_PERMISSIONS setting. The file permissions are applied with os.chmod after the file is saved.\n\nThe problem described in the PR is that when a file is uploaded, the temporary file created by tempfile.NamedTemporaryFile has restrictive permissions (0o600), and when it is renamed to the final location, the permissions remain restrictive. The PR wants to set a default FILE_UPLOAD_PERMISSIONS to 0o644 to avoid this issue.\n\nCurrently, in django/conf/global_settings.py, FILE_UPLOAD_PERMISSIONS is set to None by default.\n\nPlan:\n1. Change the default value of FILE_UPLOAD_PERMISSIONS in django/conf/global_settings.py from None to 0o644.\n2. Add a warning or note in the documentation about the permission inconsistency issue when FILE_UPLOAD_PERMISSIONS is not set explicitly.\n\nI will first edit django/conf/global_settings.py to set FILE_UPLOAD_PERMISSIONS = 0o644.', 'action': "str_replace_editor str_replace /testbed/django/conf/global_settings.py   --old_str 'FILE_UPLOAD_PERMISSIONS = None' --new_str 'FILE_UPLOAD_PERMISSIONS = 0o644'", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/django/conf/global_settings.py","old_str":"FILE_UPLOAD_PERMISSIONS = None","new_str":"FILE_UPLOAD_PERMISSIONS = 0o644"}', 'name': 'str_replace_editor'}, 'id': 'call_z71YEQLDNzhWRWJTHy5EhfSw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nThe file /testbed/django/conf/global_settings.py has been edited. Here\'s the result of running `cat -n` on a snippet of /testbed/django/conf/global_settings.py:\n   302\t# (i.e. "/tmp" on *nix systems).\n   303\tFILE_UPLOAD_TEMP_DIR = None\n   304\t\n   305\t# The numeric mode to set newly-uploaded files to. The value should be a mode\n   306\t# you\'d pass directly to os.chmod; see https://docs.python.org/library/os.html#files-and-directories.\n   307\tFILE_UPLOAD_PERMISSIONS = 0o644\n   308\t\n   309\t# The numeric mode to assign to newly-created directories, when uploading files.\n   310\t# The value should be a mode as you\'d pass to os.chmod;\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_z71YEQLDNzhWRWJTHy5EhfSw']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "str_replace_editor str_replace /testbed/docs/ref/settings.txt   --old_str '.. setting:: FILE_UPLOAD_PERMISSIONS' --new_str '.. setting:: FILE_UPLOAD_PERMISSIONS\n\n    .. warning::\n\n        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\n'", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/docs/ref/settings.txt","old_str":".. setting:: FILE_UPLOAD_PERMISSIONS","new_str":".. setting:: FILE_UPLOAD_PERMISSIONS\\n\\n    .. warning::\\n\\n        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\\n"}', 'name': 'str_replace_editor'}, 'id': 'call_WYOiqDN5Jss5Jfv6gAXYv2It', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/docs/ref/settings.txt has been edited. Here's the result of running `cat -n` on a snippet of /testbed/docs/ref/settings.txt:\n  1477\t:djadmin:`collectstatic` for details on overriding it.\n  1478\t\n  1479\tThis value mirrors the functionality and caveats of the\n  1480\t:setting:`FILE_UPLOAD_PERMISSIONS` setting.\n  1481\t\n  1482\t.. setting:: FILE_UPLOAD_PERMISSIONS\n  1483\t\n  1484\t    .. warning::\n  1485\t\n  1486\t        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\n  1487\t\n  1488\t\n  1489\t``FILE_UPLOAD_PERMISSIONS``\n  1490\t---------------------------\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_WYOiqDN5Jss5Jfv6gAXYv2It']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'cat > /testbed/scripts/reproduce_upload_permission_issue.py << \'EOF\'\nimport os\nimport tempfile\n\n# Simulate file upload saving with tempfile.NamedTemporaryFile and os.rename\n\ndef simulate_file_upload():\n    # Create a temporary file with NamedTemporaryFile\n    with tempfile.NamedTemporaryFile(delete=False) as tmp:\n        tmp.write(b"Test content")\n        tmp_path = tmp.name\n\n    # Check permissions of the temporary file\n    tmp_stat = os.stat(tmp_path)\n    print(f"Temporary file permissions: {oct(tmp_stat.st_mode & 0o777)}")\n\n    # Simulate renaming to final destination\n    final_path = tmp_path + "_final"\n    os.rename(tmp_path, final_path)\n\n    # Check permissions of the final file\n    final_stat = os.stat(final_path)\n    print(f"Final file permissions: {oct(final_stat.st_mode & 0o777)}")\n\n    # Clean up\n    os.remove(final_path)\n\nif __name__ == "__main__":\n    simulate_file_upload()\nEOF', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"cat > /testbed/scripts/reproduce_upload_permission_issue.py << \'EOF\'\\nimport os\\nimport tempfile\\n\\n# Simulate file upload saving with tempfile.NamedTemporaryFile and os.rename\\n\\ndef simulate_file_upload():\\n    # Create a temporary file with NamedTemporaryFile\\n    with tempfile.NamedTemporaryFile(delete=False) as tmp:\\n        tmp.write(b\\"Test content\\")\\n        tmp_path = tmp.name\\n\\n    # Check permissions of the temporary file\\n    tmp_stat = os.stat(tmp_path)\\n    print(f\\"Temporary file permissions: {oct(tmp_stat.st_mode & 0o777)}\\")\\n\\n    # Simulate renaming to final destination\\n    final_path = tmp_path + \\"_final\\"\\n    os.rename(tmp_path, final_path)\\n\\n    # Check permissions of the final file\\n    final_stat = os.stat(final_path)\\n    print(f\\"Final file permissions: {oct(final_stat.st_mode & 0o777)}\\")\\n\\n    # Clean up\\n    os.remove(final_path)\\n\\nif __name__ == \\"__main__\\":\\n    simulate_file_upload()\\nEOF\\n"}', 'name': 'bash'}, 'id': 'call_39r62n9LLklnjClqIyaw3IvF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'Your command ran successfully and did not produce any output.'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_39r62n9LLklnjClqIyaw3IvF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/scripts/reproduce_upload_permission_issue.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/scripts/reproduce_upload_permission_issue.py"}', 'name': 'bash'}, 'id': 'call_McVJw3znpWncbF2vlukScLA9', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nTemporary file permissions: 0o600\nFinal file permissions: 0o600\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_McVJw3znpWncbF2vlukScLA9']}, {'role': 'assistant', 'content': "The reproduce script shows that the temporary file created by tempfile.NamedTemporaryFile has permissions 0o600, and after renaming, the final file also has permissions 0o600. This confirms the issue described in the PR.\n\nNow, with the change made to set FILE_UPLOAD_PERMISSIONS to 0o644 by default in global_settings.py, the FileSystemStorage class should apply these permissions to the saved file using os.chmod.\n\nTo confirm the fix, I will create a small test script that uses Django's FileSystemStorage to save a file and check the permissions of the saved file. This will verify that the file permissions are set to 0o644 by default.\n\nI will create and run this test script next.", 'thought': "The reproduce script shows that the temporary file created by tempfile.NamedTemporaryFile has permissions 0o600, and after renaming, the final file also has permissions 0o600. This confirms the issue described in the PR.\n\nNow, with the change made to set FILE_UPLOAD_PERMISSIONS to 0o644 by default in global_settings.py, the FileSystemStorage class should apply these permissions to the saved file using os.chmod.\n\nTo confirm the fix, I will create a small test script that uses Django's FileSystemStorage to save a file and check the permissions of the saved file. This will verify that the file permissions are set to 0o644 by default.\n\nI will create and run this test script next.", 'action': 'str_replace_editor create /testbed/scripts/test_filesystemstorage_permissions.py --file_text \'import os\nfrom django.core.files.storage import FileSystemStorage\nfrom django.core.files.base import ContentFile\n\n# Setup a FileSystemStorage instance\nstorage = FileSystemStorage()\n\n# Save a file\nfile_name = \'"\'"\'test_file.txt\'"\'"\'\ncontent = ContentFile(b\'"\'"\'Test content\'"\'"\')\nsaved_name = storage.save(file_name, content)\n\n# Get the full path\nfull_path = storage.path(saved_name)\n\n# Check the permissions\nfile_stat = os.stat(full_path)\nprint(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")\n\n# Clean up\nos.remove(full_path)\n\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"create","path":"/testbed/scripts/test_filesystemstorage_permissions.py","file_text":"import os\\nfrom django.core.files.storage import FileSystemStorage\\nfrom django.core.files.base import ContentFile\\n\\n# Setup a FileSystemStorage instance\\nstorage = FileSystemStorage()\\n\\n# Save a file\\nfile_name = \'test_file.txt\'\\ncontent = ContentFile(b\'Test content\')\\nsaved_name = storage.save(file_name, content)\\n\\n# Get the full path\\nfull_path = storage.path(saved_name)\\n\\n# Check the permissions\\nfile_stat = os.stat(full_path)\\nprint(f\\"Saved file permissions: {oct(file_stat.st_mode & 0o777)}\\")\\n\\n# Clean up\\nos.remove(full_path)\\n"}', 'name': 'str_replace_editor'}, 'id': 'call_fpmpDWr8f38w9VOD6CmkrElw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFile created successfully at: /testbed/scripts/test_filesystemstorage_permissions.py\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_fpmpDWr8f38w9VOD6CmkrElw'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/scripts/test_filesystemstorage_permissions.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/scripts/test_filesystemstorage_permissions.py"}', 'name': 'bash'}, 'id': 'call_X0KIFcoR3SYIfWc1JfYNTY2z', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nTraceback (most recent call last):\n  File "/testbed/scripts/test_filesystemstorage_permissions.py", line 11, in <module>\n    saved_name = storage.save(file_name, content)\n  File "/testbed/django/core/files/storage.py", line 51, in save\n    name = self.get_available_name(name, max_length=max_length)\n  File "/testbed/django/core/files/storage.py", line 75, in get_available_name\n    while self.exists(name) or (max_length and len(name) > max_length):\n  File "/testbed/django/core/files/storage.py", line 304, in exists\n    return os.path.exists(self.path(name))\n  File "/testbed/django/core/files/storage.py", line 317, in path\n    return safe_join(self.location, name)\n  File "/testbed/django/utils/functional.py", line 48, in __get__\n    res = instance.__dict__[self.name] = self.func(instance)\n  File "/testbed/django/core/files/storage.py", line 207, in location\n    return os.path.abspath(self.base_location)\n  File "/testbed/django/utils/functional.py", line 48, in __get__\n    res = instance.__dict__[self.name] = self.func(instance)\n  File "/testbed/django/core/files/storage.py", line 203, in base_location\n    return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n  File "/testbed/django/conf/__init__.py", line 76, in __getattr__\n    self._setup(name)\n  File "/testbed/django/conf/__init__.py", line 61, in _setup\n    % (desc, ENVIRONMENT_VARIABLE))\ndjango.core.exceptions.ImproperlyConfigured: Requested setting MEDIA_ROOT, but settings are not configured. You must either define the environment variable DJANGO_SETTINGS_MODULE or call settings.configure() before accessing settings.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_X0KIFcoR3SYIfWc1JfYNTY2z'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:10:07,255 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
The file /testbed/scripts/test_filesystemstorage_permissions.py has been edited. Here's the result of running `cat -n` on a snippet of /testbed/scripts/test_filesystemstorage_permissions.py:
     1	import os
     2	import tempfile
     3	from django.conf import settings
     4	from django.core.files.storage import FileSystemStorage
     5	from django.core.files.base import ContentFile
     6	
     7	# Configure Django settings
     8	if not settings.configured:
     9	    settings.configure(
    10	        MEDIA_ROOT=tempfile.mkdtemp(),
    11	        FILE_UPLOAD_PERMISSIONS=0o644,
    12	    )
    13	
    14	# Setup a FileSystemStorage instance
    15	storage = FileSystemStorage()
    16	
    17	# Save a file
    18	file_name = 'test_file.txt'
    19	content = ContentFile(b'Test content')
    20	saved_name = storage.save(file_name, content)
    21	
    22	# Get the full path
    23	full_path = storage.path(saved_name)
    24	
    25	# Check the permissions
    26	file_stat = os.stat(full_path)
    27	print(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")
    28	
    29	# Clean up
    30	os.remove(full_path)
Review the changes and make sure they are as expected. Edit the file again if necessary.

2025-12-09 13:10:07,289 - INFO - swea-agent-django__django-10914 - ========================= STEP 27 =========================
2025-12-09 13:10:15,669 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
python3 /testbed/scripts/test_filesystemstorage_permissions.py
2025-12-09 13:10:16,032 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_uUwM82lrbSPkD1CovRUg95fF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_uUwM82lrbSPkD1CovRUg95fF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 -n 40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 -n 40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_Hr4Btg38nkLy1v8N1BffgUal', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Hr4Btg38nkLy1v8N1BffgUal']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 180,220p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 180,220p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_mytKsnCpzP9Fg8vyGKiRGJcW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n        elif setting == \'MEDIA_URL\':\n            self.__dict__.pop(\'base_url\', None)\n        elif setting == \'FILE_UPLOAD_PERMISSIONS\':\n            self.__dict__.pop(\'file_permissions_mode\', None)\n        elif setting == \'FILE_UPLOAD_DIRECTORY_PERMISSIONS\':\n            self.__dict__.pop(\'directory_permissions_mode\', None)\n\n    def _value_or_setting(self, value, setting):\n        return setting if value is None else value\n\n    @cached_property\n    def base_location(self):\n        return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n\n    @cached_property\n    def location(self):\n        return os.path.abspath(self.base_location)\n\n    @cached_property\n    def base_url(self):\n        if self._base_url is not None and not self._base_url.endswith(\'/\'):\n            self._base_url += \'/\'\n        return self._value_or_setting(self._base_url, settings.MEDIA_URL)\n\n    @cached_property\n    def file_permissions_mode(self):\n        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n\n    @cached_property\n    def directory_permissions_mode(self):\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mytKsnCpzP9Fg8vyGKiRGJcW']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w -j 1", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w -j 1"}', 'name': 'bash'}, 'id': 'call_9OMGnmqRUoiQ7umCBOMsT1NC', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9OMGnmqRUoiQ7umCBOMsT1NC']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n file_permissions_mode /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n file_permissions_mode /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_lrIsYmEFlRXo3J9U9DSiAR1r', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n178:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n182:        self._file_permissions_mode = file_permissions_mode\n194:            self.__dict__.pop('file_permissions_mode', None)\n216:    def file_permissions_mode(self):\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n234:                # for consistency with file_permissions_mode behavior.\n283:        if self.file_permissions_mode is not None:\n284:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_lrIsYmEFlRXo3J9U9DSiAR1r']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 170,190p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 170,190p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_iJcLRaUXMVr0ks33JFKxW9iX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nclass FileSystemStorage(Storage):\n    """\n    Standard filesystem storage\n    """\n    # The combination of O_CREAT and O_EXCL makes os.open() raise OSError if\n    # the file already exists before it\'s opened.\n    OS_OPEN_FLAGS = os.O_WRONLY | os.O_CREAT | os.O_EXCL | getattr(os, \'O_BINARY\', 0)\n\n    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n                 directory_permissions_mode=None):\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_iJcLRaUXMVr0ks33JFKxW9iX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 270,290p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 270,290p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_A6fcKyZ2N1gnEJ8DLQel59IH', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n                        locks.unlock(fd)\n                        if _file is not None:\n                            _file.close()\n                        else:\n                            os.close(fd)\n            except FileExistsError:\n                # A new name is needed if the file exists.\n                name = self.get_available_name(name)\n                full_path = self.path(name)\n            else:\n                # OK, the file save worked. Break out of the loop.\n                break\n\n        if self.file_permissions_mode is not None:\n            os.chmod(full_path, self.file_permissions_mode)\n\n        # Store filenames with forward slashes, even on Windows.\n        return name.replace(\'\\\\\', \'/\')\n\n    def delete(self, name):\n        assert name, "The name argument is not allowed to be empty."\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_A6fcKyZ2N1gnEJ8DLQel59IH']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_AOyoZmjwZoQnZPmGRGXylvgA', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_AOyoZmjwZoQnZPmGRGXylvgA']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r file_permissions_mode /testbed/django/core/files/', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r file_permissions_mode /testbed/django/core/files/"}', 'name': 'bash'}, 'id': 'call_E3R6QqNlATZKqNW4hBHBqncQ', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/django/core/files/storage.py:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n/testbed/django/core/files/storage.py:        self._file_permissions_mode = file_permissions_mode\n/testbed/django/core/files/storage.py:            self.__dict__.pop('file_permissions_mode', None)\n/testbed/django/core/files/storage.py:    def file_permissions_mode(self):\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/core/files/storage.py:                # for consistency with file_permissions_mode behavior.\n/testbed/django/core/files/storage.py:        if self.file_permissions_mode is not None:\n/testbed/django/core/files/storage.py:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_E3R6QqNlATZKqNW4hBHBqncQ']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_qGjSkLbXXIs66dWiPY0grfHe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_qGjSkLbXXIs66dWiPY0grfHe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_0tZWDFGyJm8gfZyftEgVuJOW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_0tZWDFGyJm8gfZyftEgVuJOW']}, {'role': 'assistant', 'content': 'The relevant code for file upload permissions is in the FileSystemStorage class in django/core/files/storage.py. The file_permissions_mode attribute is set from the constructor argument or from the FILE_UPLOAD_PERMISSIONS setting. The file permissions are applied with os.chmod after the file is saved.\n\nThe problem described in the PR is that when a file is uploaded, the temporary file created by tempfile.NamedTemporaryFile has restrictive permissions (0o600), and when it is renamed to the final location, the permissions remain restrictive. The PR wants to set a default FILE_UPLOAD_PERMISSIONS to 0o644 to avoid this issue.\n\nCurrently, in django/conf/global_settings.py, FILE_UPLOAD_PERMISSIONS is set to None by default.\n\nPlan:\n1. Change the default value of FILE_UPLOAD_PERMISSIONS in django/conf/global_settings.py from None to 0o644.\n2. Add a warning or note in the documentation about the permission inconsistency issue when FILE_UPLOAD_PERMISSIONS is not set explicitly.\n\nI will first edit django/conf/global_settings.py to set FILE_UPLOAD_PERMISSIONS = 0o644.', 'thought': 'The relevant code for file upload permissions is in the FileSystemStorage class in django/core/files/storage.py. The file_permissions_mode attribute is set from the constructor argument or from the FILE_UPLOAD_PERMISSIONS setting. The file permissions are applied with os.chmod after the file is saved.\n\nThe problem described in the PR is that when a file is uploaded, the temporary file created by tempfile.NamedTemporaryFile has restrictive permissions (0o600), and when it is renamed to the final location, the permissions remain restrictive. The PR wants to set a default FILE_UPLOAD_PERMISSIONS to 0o644 to avoid this issue.\n\nCurrently, in django/conf/global_settings.py, FILE_UPLOAD_PERMISSIONS is set to None by default.\n\nPlan:\n1. Change the default value of FILE_UPLOAD_PERMISSIONS in django/conf/global_settings.py from None to 0o644.\n2. Add a warning or note in the documentation about the permission inconsistency issue when FILE_UPLOAD_PERMISSIONS is not set explicitly.\n\nI will first edit django/conf/global_settings.py to set FILE_UPLOAD_PERMISSIONS = 0o644.', 'action': "str_replace_editor str_replace /testbed/django/conf/global_settings.py   --old_str 'FILE_UPLOAD_PERMISSIONS = None' --new_str 'FILE_UPLOAD_PERMISSIONS = 0o644'", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/django/conf/global_settings.py","old_str":"FILE_UPLOAD_PERMISSIONS = None","new_str":"FILE_UPLOAD_PERMISSIONS = 0o644"}', 'name': 'str_replace_editor'}, 'id': 'call_z71YEQLDNzhWRWJTHy5EhfSw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nThe file /testbed/django/conf/global_settings.py has been edited. Here\'s the result of running `cat -n` on a snippet of /testbed/django/conf/global_settings.py:\n   302\t# (i.e. "/tmp" on *nix systems).\n   303\tFILE_UPLOAD_TEMP_DIR = None\n   304\t\n   305\t# The numeric mode to set newly-uploaded files to. The value should be a mode\n   306\t# you\'d pass directly to os.chmod; see https://docs.python.org/library/os.html#files-and-directories.\n   307\tFILE_UPLOAD_PERMISSIONS = 0o644\n   308\t\n   309\t# The numeric mode to assign to newly-created directories, when uploading files.\n   310\t# The value should be a mode as you\'d pass to os.chmod;\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_z71YEQLDNzhWRWJTHy5EhfSw']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "str_replace_editor str_replace /testbed/docs/ref/settings.txt   --old_str '.. setting:: FILE_UPLOAD_PERMISSIONS' --new_str '.. setting:: FILE_UPLOAD_PERMISSIONS\n\n    .. warning::\n\n        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\n'", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/docs/ref/settings.txt","old_str":".. setting:: FILE_UPLOAD_PERMISSIONS","new_str":".. setting:: FILE_UPLOAD_PERMISSIONS\\n\\n    .. warning::\\n\\n        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\\n"}', 'name': 'str_replace_editor'}, 'id': 'call_WYOiqDN5Jss5Jfv6gAXYv2It', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/docs/ref/settings.txt has been edited. Here's the result of running `cat -n` on a snippet of /testbed/docs/ref/settings.txt:\n  1477\t:djadmin:`collectstatic` for details on overriding it.\n  1478\t\n  1479\tThis value mirrors the functionality and caveats of the\n  1480\t:setting:`FILE_UPLOAD_PERMISSIONS` setting.\n  1481\t\n  1482\t.. setting:: FILE_UPLOAD_PERMISSIONS\n  1483\t\n  1484\t    .. warning::\n  1485\t\n  1486\t        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\n  1487\t\n  1488\t\n  1489\t``FILE_UPLOAD_PERMISSIONS``\n  1490\t---------------------------\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_WYOiqDN5Jss5Jfv6gAXYv2It']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'cat > /testbed/scripts/reproduce_upload_permission_issue.py << \'EOF\'\nimport os\nimport tempfile\n\n# Simulate file upload saving with tempfile.NamedTemporaryFile and os.rename\n\ndef simulate_file_upload():\n    # Create a temporary file with NamedTemporaryFile\n    with tempfile.NamedTemporaryFile(delete=False) as tmp:\n        tmp.write(b"Test content")\n        tmp_path = tmp.name\n\n    # Check permissions of the temporary file\n    tmp_stat = os.stat(tmp_path)\n    print(f"Temporary file permissions: {oct(tmp_stat.st_mode & 0o777)}")\n\n    # Simulate renaming to final destination\n    final_path = tmp_path + "_final"\n    os.rename(tmp_path, final_path)\n\n    # Check permissions of the final file\n    final_stat = os.stat(final_path)\n    print(f"Final file permissions: {oct(final_stat.st_mode & 0o777)}")\n\n    # Clean up\n    os.remove(final_path)\n\nif __name__ == "__main__":\n    simulate_file_upload()\nEOF', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"cat > /testbed/scripts/reproduce_upload_permission_issue.py << \'EOF\'\\nimport os\\nimport tempfile\\n\\n# Simulate file upload saving with tempfile.NamedTemporaryFile and os.rename\\n\\ndef simulate_file_upload():\\n    # Create a temporary file with NamedTemporaryFile\\n    with tempfile.NamedTemporaryFile(delete=False) as tmp:\\n        tmp.write(b\\"Test content\\")\\n        tmp_path = tmp.name\\n\\n    # Check permissions of the temporary file\\n    tmp_stat = os.stat(tmp_path)\\n    print(f\\"Temporary file permissions: {oct(tmp_stat.st_mode & 0o777)}\\")\\n\\n    # Simulate renaming to final destination\\n    final_path = tmp_path + \\"_final\\"\\n    os.rename(tmp_path, final_path)\\n\\n    # Check permissions of the final file\\n    final_stat = os.stat(final_path)\\n    print(f\\"Final file permissions: {oct(final_stat.st_mode & 0o777)}\\")\\n\\n    # Clean up\\n    os.remove(final_path)\\n\\nif __name__ == \\"__main__\\":\\n    simulate_file_upload()\\nEOF\\n"}', 'name': 'bash'}, 'id': 'call_39r62n9LLklnjClqIyaw3IvF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'Your command ran successfully and did not produce any output.'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_39r62n9LLklnjClqIyaw3IvF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/scripts/reproduce_upload_permission_issue.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/scripts/reproduce_upload_permission_issue.py"}', 'name': 'bash'}, 'id': 'call_McVJw3znpWncbF2vlukScLA9', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nTemporary file permissions: 0o600\nFinal file permissions: 0o600\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_McVJw3znpWncbF2vlukScLA9']}, {'role': 'assistant', 'content': "The reproduce script shows that the temporary file created by tempfile.NamedTemporaryFile has permissions 0o600, and after renaming, the final file also has permissions 0o600. This confirms the issue described in the PR.\n\nNow, with the change made to set FILE_UPLOAD_PERMISSIONS to 0o644 by default in global_settings.py, the FileSystemStorage class should apply these permissions to the saved file using os.chmod.\n\nTo confirm the fix, I will create a small test script that uses Django's FileSystemStorage to save a file and check the permissions of the saved file. This will verify that the file permissions are set to 0o644 by default.\n\nI will create and run this test script next.", 'thought': "The reproduce script shows that the temporary file created by tempfile.NamedTemporaryFile has permissions 0o600, and after renaming, the final file also has permissions 0o600. This confirms the issue described in the PR.\n\nNow, with the change made to set FILE_UPLOAD_PERMISSIONS to 0o644 by default in global_settings.py, the FileSystemStorage class should apply these permissions to the saved file using os.chmod.\n\nTo confirm the fix, I will create a small test script that uses Django's FileSystemStorage to save a file and check the permissions of the saved file. This will verify that the file permissions are set to 0o644 by default.\n\nI will create and run this test script next.", 'action': 'str_replace_editor create /testbed/scripts/test_filesystemstorage_permissions.py --file_text \'import os\nfrom django.core.files.storage import FileSystemStorage\nfrom django.core.files.base import ContentFile\n\n# Setup a FileSystemStorage instance\nstorage = FileSystemStorage()\n\n# Save a file\nfile_name = \'"\'"\'test_file.txt\'"\'"\'\ncontent = ContentFile(b\'"\'"\'Test content\'"\'"\')\nsaved_name = storage.save(file_name, content)\n\n# Get the full path\nfull_path = storage.path(saved_name)\n\n# Check the permissions\nfile_stat = os.stat(full_path)\nprint(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")\n\n# Clean up\nos.remove(full_path)\n\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"create","path":"/testbed/scripts/test_filesystemstorage_permissions.py","file_text":"import os\\nfrom django.core.files.storage import FileSystemStorage\\nfrom django.core.files.base import ContentFile\\n\\n# Setup a FileSystemStorage instance\\nstorage = FileSystemStorage()\\n\\n# Save a file\\nfile_name = \'test_file.txt\'\\ncontent = ContentFile(b\'Test content\')\\nsaved_name = storage.save(file_name, content)\\n\\n# Get the full path\\nfull_path = storage.path(saved_name)\\n\\n# Check the permissions\\nfile_stat = os.stat(full_path)\\nprint(f\\"Saved file permissions: {oct(file_stat.st_mode & 0o777)}\\")\\n\\n# Clean up\\nos.remove(full_path)\\n"}', 'name': 'str_replace_editor'}, 'id': 'call_fpmpDWr8f38w9VOD6CmkrElw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFile created successfully at: /testbed/scripts/test_filesystemstorage_permissions.py\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_fpmpDWr8f38w9VOD6CmkrElw']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/scripts/test_filesystemstorage_permissions.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/scripts/test_filesystemstorage_permissions.py"}', 'name': 'bash'}, 'id': 'call_X0KIFcoR3SYIfWc1JfYNTY2z', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nTraceback (most recent call last):\n  File "/testbed/scripts/test_filesystemstorage_permissions.py", line 11, in <module>\n    saved_name = storage.save(file_name, content)\n  File "/testbed/django/core/files/storage.py", line 51, in save\n    name = self.get_available_name(name, max_length=max_length)\n  File "/testbed/django/core/files/storage.py", line 75, in get_available_name\n    while self.exists(name) or (max_length and len(name) > max_length):\n  File "/testbed/django/core/files/storage.py", line 304, in exists\n    return os.path.exists(self.path(name))\n  File "/testbed/django/core/files/storage.py", line 317, in path\n    return safe_join(self.location, name)\n  File "/testbed/django/utils/functional.py", line 48, in __get__\n    res = instance.__dict__[self.name] = self.func(instance)\n  File "/testbed/django/core/files/storage.py", line 207, in location\n    return os.path.abspath(self.base_location)\n  File "/testbed/django/utils/functional.py", line 48, in __get__\n    res = instance.__dict__[self.name] = self.func(instance)\n  File "/testbed/django/core/files/storage.py", line 203, in base_location\n    return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n  File "/testbed/django/conf/__init__.py", line 76, in __getattr__\n    self._setup(name)\n  File "/testbed/django/conf/__init__.py", line 61, in _setup\n    % (desc, ENVIRONMENT_VARIABLE))\ndjango.core.exceptions.ImproperlyConfigured: Requested setting MEDIA_ROOT, but settings are not configured. You must either define the environment variable DJANGO_SETTINGS_MODULE or call settings.configure() before accessing settings.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_X0KIFcoR3SYIfWc1JfYNTY2z'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': 'The test script failed because Django settings are not configured. To run this test script, we need to configure Django settings properly, including setting MEDIA_ROOT to a writable directory.\n\nI will modify the test script to configure Django settings programmatically with a temporary directory as MEDIA_ROOT, then run the test again.', 'thought': 'The test script failed because Django settings are not configured. To run this test script, we need to configure Django settings properly, including setting MEDIA_ROOT to a writable directory.\n\nI will modify the test script to configure Django settings programmatically with a temporary directory as MEDIA_ROOT, then run the test again.', 'action': 'str_replace_editor str_replace /testbed/scripts/test_filesystemstorage_permissions.py   --old_str \'import os\nfrom django.core.files.storage import FileSystemStorage\nfrom django.core.files.base import ContentFile\n\n# Setup a FileSystemStorage instance\nstorage = FileSystemStorage()\n\n# Save a file\nfile_name = \'"\'"\'test_file.txt\'"\'"\'\ncontent = ContentFile(b\'"\'"\'Test content\'"\'"\')\nsaved_name = storage.save(file_name, content)\n\n# Get the full path\nfull_path = storage.path(saved_name)\n\n# Check the permissions\nfile_stat = os.stat(full_path)\nprint(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")\n\n# Clean up\nos.remove(full_path)\n\' --new_str \'import os\nimport tempfile\nfrom django.conf import settings\nfrom django.core.files.storage import FileSystemStorage\nfrom django.core.files.base import ContentFile\n\n# Configure Django settings\nif not settings.configured:\n    settings.configure(\n        MEDIA_ROOT=tempfile.mkdtemp(),\n        FILE_UPLOAD_PERMISSIONS=0o644,\n    )\n\n# Setup a FileSystemStorage instance\nstorage = FileSystemStorage()\n\n# Save a file\nfile_name = \'"\'"\'test_file.txt\'"\'"\'\ncontent = ContentFile(b\'"\'"\'Test content\'"\'"\')\nsaved_name = storage.save(file_name, content)\n\n# Get the full path\nfull_path = storage.path(saved_name)\n\n# Check the permissions\nfile_stat = os.stat(full_path)\nprint(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")\n\n# Clean up\nos.remove(full_path)\n\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/scripts/test_filesystemstorage_permissions.py","old_str":"import os\\nfrom django.core.files.storage import FileSystemStorage\\nfrom django.core.files.base import ContentFile\\n\\n# Setup a FileSystemStorage instance\\nstorage = FileSystemStorage()\\n\\n# Save a file\\nfile_name = \'test_file.txt\'\\ncontent = ContentFile(b\'Test content\')\\nsaved_name = storage.save(file_name, content)\\n\\n# Get the full path\\nfull_path = storage.path(saved_name)\\n\\n# Check the permissions\\nfile_stat = os.stat(full_path)\\nprint(f\\"Saved file permissions: {oct(file_stat.st_mode & 0o777)}\\")\\n\\n# Clean up\\nos.remove(full_path)\\n","new_str":"import os\\nimport tempfile\\nfrom django.conf import settings\\nfrom django.core.files.storage import FileSystemStorage\\nfrom django.core.files.base import ContentFile\\n\\n# Configure Django settings\\nif not settings.configured:\\n    settings.configure(\\n        MEDIA_ROOT=tempfile.mkdtemp(),\\n        FILE_UPLOAD_PERMISSIONS=0o644,\\n    )\\n\\n# Setup a FileSystemStorage instance\\nstorage = FileSystemStorage()\\n\\n# Save a file\\nfile_name = \'test_file.txt\'\\ncontent = ContentFile(b\'Test content\')\\nsaved_name = storage.save(file_name, content)\\n\\n# Get the full path\\nfull_path = storage.path(saved_name)\\n\\n# Check the permissions\\nfile_stat = os.stat(full_path)\\nprint(f\\"Saved file permissions: {oct(file_stat.st_mode & 0o777)}\\")\\n\\n# Clean up\\nos.remove(full_path)\\n"}', 'name': 'str_replace_editor'}, 'id': 'call_okl99E5Cff8LP6cFAvNB4FC2', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nThe file /testbed/scripts/test_filesystemstorage_permissions.py has been edited. Here\'s the result of running `cat -n` on a snippet of /testbed/scripts/test_filesystemstorage_permissions.py:\n     1\timport os\n     2\timport tempfile\n     3\tfrom django.conf import settings\n     4\tfrom django.core.files.storage import FileSystemStorage\n     5\tfrom django.core.files.base import ContentFile\n     6\t\n     7\t# Configure Django settings\n     8\tif not settings.configured:\n     9\t    settings.configure(\n    10\t        MEDIA_ROOT=tempfile.mkdtemp(),\n    11\t        FILE_UPLOAD_PERMISSIONS=0o644,\n    12\t    )\n    13\t\n    14\t# Setup a FileSystemStorage instance\n    15\tstorage = FileSystemStorage()\n    16\t\n    17\t# Save a file\n    18\tfile_name = \'test_file.txt\'\n    19\tcontent = ContentFile(b\'Test content\')\n    20\tsaved_name = storage.save(file_name, content)\n    21\t\n    22\t# Get the full path\n    23\tfull_path = storage.path(saved_name)\n    24\t\n    25\t# Check the permissions\n    26\tfile_stat = os.stat(full_path)\n    27\tprint(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")\n    28\t\n    29\t# Clean up\n    30\tos.remove(full_path)\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_okl99E5Cff8LP6cFAvNB4FC2'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:10:16,033 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
Saved file permissions: 0o644

2025-12-09 13:10:16,094 - INFO - swea-agent-django__django-10914 - ========================= STEP 28 =========================
2025-12-09 13:10:26,926 - WARNING - swea-agent-django__django-10914 - Requerying model after FunctionCallingFormatError (1th requery)
2025-12-09 13:10:26,931 - WARNING - swea-agent-django__django-10914 - Your last output did not use any tool calls!
Please make sure your output includes exactly _ONE_ function call!
You must invoke the function directly using the function call format.
You cannot invoke commands with ```, you have to use the function call format.
If you think you have already resolved the issue, please submit your changes by running the `submit` command.
If you think you cannot solve the problem, please run `exit_forfeit` (if available) or `submit`.
Else, please continue with a new tool call!
2025-12-09 13:10:35,192 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
submit
2025-12-09 13:10:36,057 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_uUwM82lrbSPkD1CovRUg95fF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_uUwM82lrbSPkD1CovRUg95fF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 -n 40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 -n 40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_Hr4Btg38nkLy1v8N1BffgUal', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Hr4Btg38nkLy1v8N1BffgUal']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 180,220p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 180,220p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_mytKsnCpzP9Fg8vyGKiRGJcW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n        elif setting == \'MEDIA_URL\':\n            self.__dict__.pop(\'base_url\', None)\n        elif setting == \'FILE_UPLOAD_PERMISSIONS\':\n            self.__dict__.pop(\'file_permissions_mode\', None)\n        elif setting == \'FILE_UPLOAD_DIRECTORY_PERMISSIONS\':\n            self.__dict__.pop(\'directory_permissions_mode\', None)\n\n    def _value_or_setting(self, value, setting):\n        return setting if value is None else value\n\n    @cached_property\n    def base_location(self):\n        return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n\n    @cached_property\n    def location(self):\n        return os.path.abspath(self.base_location)\n\n    @cached_property\n    def base_url(self):\n        if self._base_url is not None and not self._base_url.endswith(\'/\'):\n            self._base_url += \'/\'\n        return self._value_or_setting(self._base_url, settings.MEDIA_URL)\n\n    @cached_property\n    def file_permissions_mode(self):\n        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n\n    @cached_property\n    def directory_permissions_mode(self):\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mytKsnCpzP9Fg8vyGKiRGJcW']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w -j 1", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w -j 1"}', 'name': 'bash'}, 'id': 'call_9OMGnmqRUoiQ7umCBOMsT1NC', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9OMGnmqRUoiQ7umCBOMsT1NC']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n file_permissions_mode /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n file_permissions_mode /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_lrIsYmEFlRXo3J9U9DSiAR1r', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n178:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n182:        self._file_permissions_mode = file_permissions_mode\n194:            self.__dict__.pop('file_permissions_mode', None)\n216:    def file_permissions_mode(self):\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n234:                # for consistency with file_permissions_mode behavior.\n283:        if self.file_permissions_mode is not None:\n284:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_lrIsYmEFlRXo3J9U9DSiAR1r']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 170,190p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 170,190p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_iJcLRaUXMVr0ks33JFKxW9iX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nclass FileSystemStorage(Storage):\n    """\n    Standard filesystem storage\n    """\n    # The combination of O_CREAT and O_EXCL makes os.open() raise OSError if\n    # the file already exists before it\'s opened.\n    OS_OPEN_FLAGS = os.O_WRONLY | os.O_CREAT | os.O_EXCL | getattr(os, \'O_BINARY\', 0)\n\n    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n                 directory_permissions_mode=None):\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_iJcLRaUXMVr0ks33JFKxW9iX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 270,290p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 270,290p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_A6fcKyZ2N1gnEJ8DLQel59IH', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n                        locks.unlock(fd)\n                        if _file is not None:\n                            _file.close()\n                        else:\n                            os.close(fd)\n            except FileExistsError:\n                # A new name is needed if the file exists.\n                name = self.get_available_name(name)\n                full_path = self.path(name)\n            else:\n                # OK, the file save worked. Break out of the loop.\n                break\n\n        if self.file_permissions_mode is not None:\n            os.chmod(full_path, self.file_permissions_mode)\n\n        # Store filenames with forward slashes, even on Windows.\n        return name.replace(\'\\\\\', \'/\')\n\n    def delete(self, name):\n        assert name, "The name argument is not allowed to be empty."\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_A6fcKyZ2N1gnEJ8DLQel59IH']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_AOyoZmjwZoQnZPmGRGXylvgA', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_AOyoZmjwZoQnZPmGRGXylvgA']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r file_permissions_mode /testbed/django/core/files/', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r file_permissions_mode /testbed/django/core/files/"}', 'name': 'bash'}, 'id': 'call_E3R6QqNlATZKqNW4hBHBqncQ', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/django/core/files/storage.py:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n/testbed/django/core/files/storage.py:        self._file_permissions_mode = file_permissions_mode\n/testbed/django/core/files/storage.py:            self.__dict__.pop('file_permissions_mode', None)\n/testbed/django/core/files/storage.py:    def file_permissions_mode(self):\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/core/files/storage.py:                # for consistency with file_permissions_mode behavior.\n/testbed/django/core/files/storage.py:        if self.file_permissions_mode is not None:\n/testbed/django/core/files/storage.py:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_E3R6QqNlATZKqNW4hBHBqncQ']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_qGjSkLbXXIs66dWiPY0grfHe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_qGjSkLbXXIs66dWiPY0grfHe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_0tZWDFGyJm8gfZyftEgVuJOW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_0tZWDFGyJm8gfZyftEgVuJOW']}, {'role': 'assistant', 'content': 'The relevant code for file upload permissions is in the FileSystemStorage class in django/core/files/storage.py. The file_permissions_mode attribute is set from the constructor argument or from the FILE_UPLOAD_PERMISSIONS setting. The file permissions are applied with os.chmod after the file is saved.\n\nThe problem described in the PR is that when a file is uploaded, the temporary file created by tempfile.NamedTemporaryFile has restrictive permissions (0o600), and when it is renamed to the final location, the permissions remain restrictive. The PR wants to set a default FILE_UPLOAD_PERMISSIONS to 0o644 to avoid this issue.\n\nCurrently, in django/conf/global_settings.py, FILE_UPLOAD_PERMISSIONS is set to None by default.\n\nPlan:\n1. Change the default value of FILE_UPLOAD_PERMISSIONS in django/conf/global_settings.py from None to 0o644.\n2. Add a warning or note in the documentation about the permission inconsistency issue when FILE_UPLOAD_PERMISSIONS is not set explicitly.\n\nI will first edit django/conf/global_settings.py to set FILE_UPLOAD_PERMISSIONS = 0o644.', 'thought': 'The relevant code for file upload permissions is in the FileSystemStorage class in django/core/files/storage.py. The file_permissions_mode attribute is set from the constructor argument or from the FILE_UPLOAD_PERMISSIONS setting. The file permissions are applied with os.chmod after the file is saved.\n\nThe problem described in the PR is that when a file is uploaded, the temporary file created by tempfile.NamedTemporaryFile has restrictive permissions (0o600), and when it is renamed to the final location, the permissions remain restrictive. The PR wants to set a default FILE_UPLOAD_PERMISSIONS to 0o644 to avoid this issue.\n\nCurrently, in django/conf/global_settings.py, FILE_UPLOAD_PERMISSIONS is set to None by default.\n\nPlan:\n1. Change the default value of FILE_UPLOAD_PERMISSIONS in django/conf/global_settings.py from None to 0o644.\n2. Add a warning or note in the documentation about the permission inconsistency issue when FILE_UPLOAD_PERMISSIONS is not set explicitly.\n\nI will first edit django/conf/global_settings.py to set FILE_UPLOAD_PERMISSIONS = 0o644.', 'action': "str_replace_editor str_replace /testbed/django/conf/global_settings.py   --old_str 'FILE_UPLOAD_PERMISSIONS = None' --new_str 'FILE_UPLOAD_PERMISSIONS = 0o644'", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/django/conf/global_settings.py","old_str":"FILE_UPLOAD_PERMISSIONS = None","new_str":"FILE_UPLOAD_PERMISSIONS = 0o644"}', 'name': 'str_replace_editor'}, 'id': 'call_z71YEQLDNzhWRWJTHy5EhfSw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nThe file /testbed/django/conf/global_settings.py has been edited. Here\'s the result of running `cat -n` on a snippet of /testbed/django/conf/global_settings.py:\n   302\t# (i.e. "/tmp" on *nix systems).\n   303\tFILE_UPLOAD_TEMP_DIR = None\n   304\t\n   305\t# The numeric mode to set newly-uploaded files to. The value should be a mode\n   306\t# you\'d pass directly to os.chmod; see https://docs.python.org/library/os.html#files-and-directories.\n   307\tFILE_UPLOAD_PERMISSIONS = 0o644\n   308\t\n   309\t# The numeric mode to assign to newly-created directories, when uploading files.\n   310\t# The value should be a mode as you\'d pass to os.chmod;\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_z71YEQLDNzhWRWJTHy5EhfSw']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "str_replace_editor str_replace /testbed/docs/ref/settings.txt   --old_str '.. setting:: FILE_UPLOAD_PERMISSIONS' --new_str '.. setting:: FILE_UPLOAD_PERMISSIONS\n\n    .. warning::\n\n        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\n'", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/docs/ref/settings.txt","old_str":".. setting:: FILE_UPLOAD_PERMISSIONS","new_str":".. setting:: FILE_UPLOAD_PERMISSIONS\\n\\n    .. warning::\\n\\n        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\\n"}', 'name': 'str_replace_editor'}, 'id': 'call_WYOiqDN5Jss5Jfv6gAXYv2It', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/docs/ref/settings.txt has been edited. Here's the result of running `cat -n` on a snippet of /testbed/docs/ref/settings.txt:\n  1477\t:djadmin:`collectstatic` for details on overriding it.\n  1478\t\n  1479\tThis value mirrors the functionality and caveats of the\n  1480\t:setting:`FILE_UPLOAD_PERMISSIONS` setting.\n  1481\t\n  1482\t.. setting:: FILE_UPLOAD_PERMISSIONS\n  1483\t\n  1484\t    .. warning::\n  1485\t\n  1486\t        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\n  1487\t\n  1488\t\n  1489\t``FILE_UPLOAD_PERMISSIONS``\n  1490\t---------------------------\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_WYOiqDN5Jss5Jfv6gAXYv2It']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'cat > /testbed/scripts/reproduce_upload_permission_issue.py << \'EOF\'\nimport os\nimport tempfile\n\n# Simulate file upload saving with tempfile.NamedTemporaryFile and os.rename\n\ndef simulate_file_upload():\n    # Create a temporary file with NamedTemporaryFile\n    with tempfile.NamedTemporaryFile(delete=False) as tmp:\n        tmp.write(b"Test content")\n        tmp_path = tmp.name\n\n    # Check permissions of the temporary file\n    tmp_stat = os.stat(tmp_path)\n    print(f"Temporary file permissions: {oct(tmp_stat.st_mode & 0o777)}")\n\n    # Simulate renaming to final destination\n    final_path = tmp_path + "_final"\n    os.rename(tmp_path, final_path)\n\n    # Check permissions of the final file\n    final_stat = os.stat(final_path)\n    print(f"Final file permissions: {oct(final_stat.st_mode & 0o777)}")\n\n    # Clean up\n    os.remove(final_path)\n\nif __name__ == "__main__":\n    simulate_file_upload()\nEOF', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"cat > /testbed/scripts/reproduce_upload_permission_issue.py << \'EOF\'\\nimport os\\nimport tempfile\\n\\n# Simulate file upload saving with tempfile.NamedTemporaryFile and os.rename\\n\\ndef simulate_file_upload():\\n    # Create a temporary file with NamedTemporaryFile\\n    with tempfile.NamedTemporaryFile(delete=False) as tmp:\\n        tmp.write(b\\"Test content\\")\\n        tmp_path = tmp.name\\n\\n    # Check permissions of the temporary file\\n    tmp_stat = os.stat(tmp_path)\\n    print(f\\"Temporary file permissions: {oct(tmp_stat.st_mode & 0o777)}\\")\\n\\n    # Simulate renaming to final destination\\n    final_path = tmp_path + \\"_final\\"\\n    os.rename(tmp_path, final_path)\\n\\n    # Check permissions of the final file\\n    final_stat = os.stat(final_path)\\n    print(f\\"Final file permissions: {oct(final_stat.st_mode & 0o777)}\\")\\n\\n    # Clean up\\n    os.remove(final_path)\\n\\nif __name__ == \\"__main__\\":\\n    simulate_file_upload()\\nEOF\\n"}', 'name': 'bash'}, 'id': 'call_39r62n9LLklnjClqIyaw3IvF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'Your command ran successfully and did not produce any output.'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_39r62n9LLklnjClqIyaw3IvF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/scripts/reproduce_upload_permission_issue.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/scripts/reproduce_upload_permission_issue.py"}', 'name': 'bash'}, 'id': 'call_McVJw3znpWncbF2vlukScLA9', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nTemporary file permissions: 0o600\nFinal file permissions: 0o600\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_McVJw3znpWncbF2vlukScLA9']}, {'role': 'assistant', 'content': "The reproduce script shows that the temporary file created by tempfile.NamedTemporaryFile has permissions 0o600, and after renaming, the final file also has permissions 0o600. This confirms the issue described in the PR.\n\nNow, with the change made to set FILE_UPLOAD_PERMISSIONS to 0o644 by default in global_settings.py, the FileSystemStorage class should apply these permissions to the saved file using os.chmod.\n\nTo confirm the fix, I will create a small test script that uses Django's FileSystemStorage to save a file and check the permissions of the saved file. This will verify that the file permissions are set to 0o644 by default.\n\nI will create and run this test script next.", 'thought': "The reproduce script shows that the temporary file created by tempfile.NamedTemporaryFile has permissions 0o600, and after renaming, the final file also has permissions 0o600. This confirms the issue described in the PR.\n\nNow, with the change made to set FILE_UPLOAD_PERMISSIONS to 0o644 by default in global_settings.py, the FileSystemStorage class should apply these permissions to the saved file using os.chmod.\n\nTo confirm the fix, I will create a small test script that uses Django's FileSystemStorage to save a file and check the permissions of the saved file. This will verify that the file permissions are set to 0o644 by default.\n\nI will create and run this test script next.", 'action': 'str_replace_editor create /testbed/scripts/test_filesystemstorage_permissions.py --file_text \'import os\nfrom django.core.files.storage import FileSystemStorage\nfrom django.core.files.base import ContentFile\n\n# Setup a FileSystemStorage instance\nstorage = FileSystemStorage()\n\n# Save a file\nfile_name = \'"\'"\'test_file.txt\'"\'"\'\ncontent = ContentFile(b\'"\'"\'Test content\'"\'"\')\nsaved_name = storage.save(file_name, content)\n\n# Get the full path\nfull_path = storage.path(saved_name)\n\n# Check the permissions\nfile_stat = os.stat(full_path)\nprint(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")\n\n# Clean up\nos.remove(full_path)\n\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"create","path":"/testbed/scripts/test_filesystemstorage_permissions.py","file_text":"import os\\nfrom django.core.files.storage import FileSystemStorage\\nfrom django.core.files.base import ContentFile\\n\\n# Setup a FileSystemStorage instance\\nstorage = FileSystemStorage()\\n\\n# Save a file\\nfile_name = \'test_file.txt\'\\ncontent = ContentFile(b\'Test content\')\\nsaved_name = storage.save(file_name, content)\\n\\n# Get the full path\\nfull_path = storage.path(saved_name)\\n\\n# Check the permissions\\nfile_stat = os.stat(full_path)\\nprint(f\\"Saved file permissions: {oct(file_stat.st_mode & 0o777)}\\")\\n\\n# Clean up\\nos.remove(full_path)\\n"}', 'name': 'str_replace_editor'}, 'id': 'call_fpmpDWr8f38w9VOD6CmkrElw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFile created successfully at: /testbed/scripts/test_filesystemstorage_permissions.py\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_fpmpDWr8f38w9VOD6CmkrElw']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/scripts/test_filesystemstorage_permissions.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/scripts/test_filesystemstorage_permissions.py"}', 'name': 'bash'}, 'id': 'call_X0KIFcoR3SYIfWc1JfYNTY2z', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nTraceback (most recent call last):\n  File "/testbed/scripts/test_filesystemstorage_permissions.py", line 11, in <module>\n    saved_name = storage.save(file_name, content)\n  File "/testbed/django/core/files/storage.py", line 51, in save\n    name = self.get_available_name(name, max_length=max_length)\n  File "/testbed/django/core/files/storage.py", line 75, in get_available_name\n    while self.exists(name) or (max_length and len(name) > max_length):\n  File "/testbed/django/core/files/storage.py", line 304, in exists\n    return os.path.exists(self.path(name))\n  File "/testbed/django/core/files/storage.py", line 317, in path\n    return safe_join(self.location, name)\n  File "/testbed/django/utils/functional.py", line 48, in __get__\n    res = instance.__dict__[self.name] = self.func(instance)\n  File "/testbed/django/core/files/storage.py", line 207, in location\n    return os.path.abspath(self.base_location)\n  File "/testbed/django/utils/functional.py", line 48, in __get__\n    res = instance.__dict__[self.name] = self.func(instance)\n  File "/testbed/django/core/files/storage.py", line 203, in base_location\n    return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n  File "/testbed/django/conf/__init__.py", line 76, in __getattr__\n    self._setup(name)\n  File "/testbed/django/conf/__init__.py", line 61, in _setup\n    % (desc, ENVIRONMENT_VARIABLE))\ndjango.core.exceptions.ImproperlyConfigured: Requested setting MEDIA_ROOT, but settings are not configured. You must either define the environment variable DJANGO_SETTINGS_MODULE or call settings.configure() before accessing settings.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_X0KIFcoR3SYIfWc1JfYNTY2z']}, {'role': 'assistant', 'content': 'The test script failed because Django settings are not configured. To run this test script, we need to configure Django settings properly, including setting MEDIA_ROOT to a writable directory.\n\nI will modify the test script to configure Django settings programmatically with a temporary directory as MEDIA_ROOT, then run the test again.', 'thought': 'The test script failed because Django settings are not configured. To run this test script, we need to configure Django settings properly, including setting MEDIA_ROOT to a writable directory.\n\nI will modify the test script to configure Django settings programmatically with a temporary directory as MEDIA_ROOT, then run the test again.', 'action': 'str_replace_editor str_replace /testbed/scripts/test_filesystemstorage_permissions.py   --old_str \'import os\nfrom django.core.files.storage import FileSystemStorage\nfrom django.core.files.base import ContentFile\n\n# Setup a FileSystemStorage instance\nstorage = FileSystemStorage()\n\n# Save a file\nfile_name = \'"\'"\'test_file.txt\'"\'"\'\ncontent = ContentFile(b\'"\'"\'Test content\'"\'"\')\nsaved_name = storage.save(file_name, content)\n\n# Get the full path\nfull_path = storage.path(saved_name)\n\n# Check the permissions\nfile_stat = os.stat(full_path)\nprint(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")\n\n# Clean up\nos.remove(full_path)\n\' --new_str \'import os\nimport tempfile\nfrom django.conf import settings\nfrom django.core.files.storage import FileSystemStorage\nfrom django.core.files.base import ContentFile\n\n# Configure Django settings\nif not settings.configured:\n    settings.configure(\n        MEDIA_ROOT=tempfile.mkdtemp(),\n        FILE_UPLOAD_PERMISSIONS=0o644,\n    )\n\n# Setup a FileSystemStorage instance\nstorage = FileSystemStorage()\n\n# Save a file\nfile_name = \'"\'"\'test_file.txt\'"\'"\'\ncontent = ContentFile(b\'"\'"\'Test content\'"\'"\')\nsaved_name = storage.save(file_name, content)\n\n# Get the full path\nfull_path = storage.path(saved_name)\n\n# Check the permissions\nfile_stat = os.stat(full_path)\nprint(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")\n\n# Clean up\nos.remove(full_path)\n\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/scripts/test_filesystemstorage_permissions.py","old_str":"import os\\nfrom django.core.files.storage import FileSystemStorage\\nfrom django.core.files.base import ContentFile\\n\\n# Setup a FileSystemStorage instance\\nstorage = FileSystemStorage()\\n\\n# Save a file\\nfile_name = \'test_file.txt\'\\ncontent = ContentFile(b\'Test content\')\\nsaved_name = storage.save(file_name, content)\\n\\n# Get the full path\\nfull_path = storage.path(saved_name)\\n\\n# Check the permissions\\nfile_stat = os.stat(full_path)\\nprint(f\\"Saved file permissions: {oct(file_stat.st_mode & 0o777)}\\")\\n\\n# Clean up\\nos.remove(full_path)\\n","new_str":"import os\\nimport tempfile\\nfrom django.conf import settings\\nfrom django.core.files.storage import FileSystemStorage\\nfrom django.core.files.base import ContentFile\\n\\n# Configure Django settings\\nif not settings.configured:\\n    settings.configure(\\n        MEDIA_ROOT=tempfile.mkdtemp(),\\n        FILE_UPLOAD_PERMISSIONS=0o644,\\n    )\\n\\n# Setup a FileSystemStorage instance\\nstorage = FileSystemStorage()\\n\\n# Save a file\\nfile_name = \'test_file.txt\'\\ncontent = ContentFile(b\'Test content\')\\nsaved_name = storage.save(file_name, content)\\n\\n# Get the full path\\nfull_path = storage.path(saved_name)\\n\\n# Check the permissions\\nfile_stat = os.stat(full_path)\\nprint(f\\"Saved file permissions: {oct(file_stat.st_mode & 0o777)}\\")\\n\\n# Clean up\\nos.remove(full_path)\\n"}', 'name': 'str_replace_editor'}, 'id': 'call_okl99E5Cff8LP6cFAvNB4FC2', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nThe file /testbed/scripts/test_filesystemstorage_permissions.py has been edited. Here\'s the result of running `cat -n` on a snippet of /testbed/scripts/test_filesystemstorage_permissions.py:\n     1\timport os\n     2\timport tempfile\n     3\tfrom django.conf import settings\n     4\tfrom django.core.files.storage import FileSystemStorage\n     5\tfrom django.core.files.base import ContentFile\n     6\t\n     7\t# Configure Django settings\n     8\tif not settings.configured:\n     9\t    settings.configure(\n    10\t        MEDIA_ROOT=tempfile.mkdtemp(),\n    11\t        FILE_UPLOAD_PERMISSIONS=0o644,\n    12\t    )\n    13\t\n    14\t# Setup a FileSystemStorage instance\n    15\tstorage = FileSystemStorage()\n    16\t\n    17\t# Save a file\n    18\tfile_name = \'test_file.txt\'\n    19\tcontent = ContentFile(b\'Test content\')\n    20\tsaved_name = storage.save(file_name, content)\n    21\t\n    22\t# Get the full path\n    23\tfull_path = storage.path(saved_name)\n    24\t\n    25\t# Check the permissions\n    26\tfile_stat = os.stat(full_path)\n    27\tprint(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")\n    28\t\n    29\t# Clean up\n    30\tos.remove(full_path)\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_okl99E5Cff8LP6cFAvNB4FC2'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/scripts/test_filesystemstorage_permissions.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/scripts/test_filesystemstorage_permissions.py"}', 'name': 'bash'}, 'id': 'call_G4KjSpBM3IwlHq1zV6pUcIqi', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nSaved file permissions: 0o644\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_G4KjSpBM3IwlHq1zV6pUcIqi'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:10:36,059 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
Thank you for your work on this issue. Please carefully follow the steps below to help review your changes.

1. If you made any changes to your code after running the reproduction script, please run the reproduction script again.
  If the reproduction script is failing, please revisit your changes and make sure they are correct.
  If you have already removed your reproduction script, please ignore this step.
2. Remove your reproduction script (if you haven't done so already).
3. If you have modified any TEST files, please revert them to the state they had before you started fixing the issue.
  You can do this with `git checkout -- /path/to/test/file.py`. Use below <diff> to find the files you need to revert.
4. Run the submit command again to confirm.

Here is a list of all of your changes:

<diff>
diff --git a/django/conf/global_settings.py b/django/conf/global_settings.py
index acee9887d2..bdeec80610 100644
--- a/django/conf/global_settings.py
+++ b/django/conf/global_settings.py
@@ -304,7 +304,7 @@ FILE_UPLOAD_TEMP_DIR = None
 
 # The numeric mode to set newly-uploaded files to. The value should be a mode
 # you'd pass directly to os.chmod; see https://docs.python.org/library/os.html#files-and-directories.
-FILE_UPLOAD_PERMISSIONS = None
+FILE_UPLOAD_PERMISSIONS = 0o644
 
 # The numeric mode to assign to newly-created directories, when uploading files.
 # The value should be a mode as you'd pass to os.chmod;
diff --git a/docs/ref/settings.txt b/docs/ref/settings.txt
index 46e99af993..f965269215 100644
--- a/docs/ref/settings.txt
+++ b/docs/ref/settings.txt
@@ -1481,6 +1481,11 @@ This value mirrors the functionality and caveats of the
 
 .. setting:: FILE_UPLOAD_PERMISSIONS
 
+    .. warning::
+
+        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.
+
+
 ``FILE_UPLOAD_PERMISSIONS``
 ---------------------------
 
diff --git a/scripts/reproduce_upload_permission_issue.py b/scripts/reproduce_upload_permission_issue.py
new file mode 100644
index 0000000000..84b7668055
--- /dev/null
+++ b/scripts/reproduce_upload_permission_issue.py
@@ -0,0 +1,28 @@
+import os
+import tempfile
+
+# Simulate file upload saving with tempfile.NamedTemporaryFile and os.rename
+
+def simulate_file_upload():
+    # Create a temporary file with NamedTemporaryFile
+    with tempfile.NamedTemporaryFile(delete=False) as tmp:
+        tmp.write(b"Test content")
+        tmp_path = tmp.name
+
+    # Check permissions of the temporary file
+    tmp_stat = os.stat(tmp_path)
+    print(f"Temporary file permissions: {oct(tmp_stat.st_mode & 0o777)}")
+
+    # Simulate renaming to final destination
+    final_path = tmp_path + "_final"
+    os.rename(tmp_path, final_path)
+
+    # Check permissions of the final file
+    final_stat = os.stat(final_path)
+    print(f"Final file permissions: {oct(final_stat.st_mode & 0o777)}")
+
+    # Clean up
+    os.remove(final_path)
+
+if __name__ == "__main__":
+    simulate_file_upload()
diff --git a/scripts/test_filesystemstorage_permissions.py b/scripts/test_filesystemstorage_permissions.py
new file mode 100644
index 0000000000..3eba3390de
--- /dev/null
+++ b/scripts/test_filesystemstorage_permissions.py
@@ -0,0 +1,30 @@
+import os
+import tempfile
+from django.conf import settings
+from django.core.files.storage import FileSystemStorage
+from django.core.files.base import ContentFile
+
+# Configure Django settings
+if not settings.configured:
+    settings.configure(
+        MEDIA_ROOT=tempfile.mkdtemp(),
+        FILE_UPLOAD_PERMISSIONS=0o644,
+    )
+
+# Setup a FileSystemStorage instance
+storage = FileSystemStorage()
+
+# Save a file
+file_name = 'test_file.txt'
+content = ContentFile(b'Test content')
+saved_name = storage.save(file_name, content)
+
+# Get the full path
+full_path = storage.path(saved_name)
+
+# Check the permissions
+file_stat = os.stat(full_path)
+print(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")
+
+# Clean up
+os.remove(full_path)

</diff>


2025-12-09 13:10:36,109 - INFO - swea-agent-django__django-10914 - ========================= STEP 30 =========================
2025-12-09 13:10:46,168 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
rm /testbed/scripts/reproduce_upload_permission_issue.py /testbed/scripts/test_filesystemstorage_permissions.py
2025-12-09 13:10:46,445 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_uUwM82lrbSPkD1CovRUg95fF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_uUwM82lrbSPkD1CovRUg95fF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 -n 40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 -n 40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_Hr4Btg38nkLy1v8N1BffgUal', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Hr4Btg38nkLy1v8N1BffgUal']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 180,220p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 180,220p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_mytKsnCpzP9Fg8vyGKiRGJcW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n        elif setting == \'MEDIA_URL\':\n            self.__dict__.pop(\'base_url\', None)\n        elif setting == \'FILE_UPLOAD_PERMISSIONS\':\n            self.__dict__.pop(\'file_permissions_mode\', None)\n        elif setting == \'FILE_UPLOAD_DIRECTORY_PERMISSIONS\':\n            self.__dict__.pop(\'directory_permissions_mode\', None)\n\n    def _value_or_setting(self, value, setting):\n        return setting if value is None else value\n\n    @cached_property\n    def base_location(self):\n        return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n\n    @cached_property\n    def location(self):\n        return os.path.abspath(self.base_location)\n\n    @cached_property\n    def base_url(self):\n        if self._base_url is not None and not self._base_url.endswith(\'/\'):\n            self._base_url += \'/\'\n        return self._value_or_setting(self._base_url, settings.MEDIA_URL)\n\n    @cached_property\n    def file_permissions_mode(self):\n        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n\n    @cached_property\n    def directory_permissions_mode(self):\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mytKsnCpzP9Fg8vyGKiRGJcW']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w -j 1", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w -j 1"}', 'name': 'bash'}, 'id': 'call_9OMGnmqRUoiQ7umCBOMsT1NC', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9OMGnmqRUoiQ7umCBOMsT1NC']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n file_permissions_mode /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n file_permissions_mode /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_lrIsYmEFlRXo3J9U9DSiAR1r', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n178:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n182:        self._file_permissions_mode = file_permissions_mode\n194:            self.__dict__.pop('file_permissions_mode', None)\n216:    def file_permissions_mode(self):\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n234:                # for consistency with file_permissions_mode behavior.\n283:        if self.file_permissions_mode is not None:\n284:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_lrIsYmEFlRXo3J9U9DSiAR1r']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 170,190p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 170,190p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_iJcLRaUXMVr0ks33JFKxW9iX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nclass FileSystemStorage(Storage):\n    """\n    Standard filesystem storage\n    """\n    # The combination of O_CREAT and O_EXCL makes os.open() raise OSError if\n    # the file already exists before it\'s opened.\n    OS_OPEN_FLAGS = os.O_WRONLY | os.O_CREAT | os.O_EXCL | getattr(os, \'O_BINARY\', 0)\n\n    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n                 directory_permissions_mode=None):\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_iJcLRaUXMVr0ks33JFKxW9iX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 270,290p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 270,290p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_A6fcKyZ2N1gnEJ8DLQel59IH', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n                        locks.unlock(fd)\n                        if _file is not None:\n                            _file.close()\n                        else:\n                            os.close(fd)\n            except FileExistsError:\n                # A new name is needed if the file exists.\n                name = self.get_available_name(name)\n                full_path = self.path(name)\n            else:\n                # OK, the file save worked. Break out of the loop.\n                break\n\n        if self.file_permissions_mode is not None:\n            os.chmod(full_path, self.file_permissions_mode)\n\n        # Store filenames with forward slashes, even on Windows.\n        return name.replace(\'\\\\\', \'/\')\n\n    def delete(self, name):\n        assert name, "The name argument is not allowed to be empty."\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_A6fcKyZ2N1gnEJ8DLQel59IH']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_AOyoZmjwZoQnZPmGRGXylvgA', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_AOyoZmjwZoQnZPmGRGXylvgA']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r file_permissions_mode /testbed/django/core/files/', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r file_permissions_mode /testbed/django/core/files/"}', 'name': 'bash'}, 'id': 'call_E3R6QqNlATZKqNW4hBHBqncQ', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/django/core/files/storage.py:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n/testbed/django/core/files/storage.py:        self._file_permissions_mode = file_permissions_mode\n/testbed/django/core/files/storage.py:            self.__dict__.pop('file_permissions_mode', None)\n/testbed/django/core/files/storage.py:    def file_permissions_mode(self):\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/core/files/storage.py:                # for consistency with file_permissions_mode behavior.\n/testbed/django/core/files/storage.py:        if self.file_permissions_mode is not None:\n/testbed/django/core/files/storage.py:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_E3R6QqNlATZKqNW4hBHBqncQ']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_qGjSkLbXXIs66dWiPY0grfHe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_qGjSkLbXXIs66dWiPY0grfHe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_0tZWDFGyJm8gfZyftEgVuJOW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_0tZWDFGyJm8gfZyftEgVuJOW']}, {'role': 'assistant', 'content': 'The relevant code for file upload permissions is in the FileSystemStorage class in django/core/files/storage.py. The file_permissions_mode attribute is set from the constructor argument or from the FILE_UPLOAD_PERMISSIONS setting. The file permissions are applied with os.chmod after the file is saved.\n\nThe problem described in the PR is that when a file is uploaded, the temporary file created by tempfile.NamedTemporaryFile has restrictive permissions (0o600), and when it is renamed to the final location, the permissions remain restrictive. The PR wants to set a default FILE_UPLOAD_PERMISSIONS to 0o644 to avoid this issue.\n\nCurrently, in django/conf/global_settings.py, FILE_UPLOAD_PERMISSIONS is set to None by default.\n\nPlan:\n1. Change the default value of FILE_UPLOAD_PERMISSIONS in django/conf/global_settings.py from None to 0o644.\n2. Add a warning or note in the documentation about the permission inconsistency issue when FILE_UPLOAD_PERMISSIONS is not set explicitly.\n\nI will first edit django/conf/global_settings.py to set FILE_UPLOAD_PERMISSIONS = 0o644.', 'thought': 'The relevant code for file upload permissions is in the FileSystemStorage class in django/core/files/storage.py. The file_permissions_mode attribute is set from the constructor argument or from the FILE_UPLOAD_PERMISSIONS setting. The file permissions are applied with os.chmod after the file is saved.\n\nThe problem described in the PR is that when a file is uploaded, the temporary file created by tempfile.NamedTemporaryFile has restrictive permissions (0o600), and when it is renamed to the final location, the permissions remain restrictive. The PR wants to set a default FILE_UPLOAD_PERMISSIONS to 0o644 to avoid this issue.\n\nCurrently, in django/conf/global_settings.py, FILE_UPLOAD_PERMISSIONS is set to None by default.\n\nPlan:\n1. Change the default value of FILE_UPLOAD_PERMISSIONS in django/conf/global_settings.py from None to 0o644.\n2. Add a warning or note in the documentation about the permission inconsistency issue when FILE_UPLOAD_PERMISSIONS is not set explicitly.\n\nI will first edit django/conf/global_settings.py to set FILE_UPLOAD_PERMISSIONS = 0o644.', 'action': "str_replace_editor str_replace /testbed/django/conf/global_settings.py   --old_str 'FILE_UPLOAD_PERMISSIONS = None' --new_str 'FILE_UPLOAD_PERMISSIONS = 0o644'", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/django/conf/global_settings.py","old_str":"FILE_UPLOAD_PERMISSIONS = None","new_str":"FILE_UPLOAD_PERMISSIONS = 0o644"}', 'name': 'str_replace_editor'}, 'id': 'call_z71YEQLDNzhWRWJTHy5EhfSw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nThe file /testbed/django/conf/global_settings.py has been edited. Here\'s the result of running `cat -n` on a snippet of /testbed/django/conf/global_settings.py:\n   302\t# (i.e. "/tmp" on *nix systems).\n   303\tFILE_UPLOAD_TEMP_DIR = None\n   304\t\n   305\t# The numeric mode to set newly-uploaded files to. The value should be a mode\n   306\t# you\'d pass directly to os.chmod; see https://docs.python.org/library/os.html#files-and-directories.\n   307\tFILE_UPLOAD_PERMISSIONS = 0o644\n   308\t\n   309\t# The numeric mode to assign to newly-created directories, when uploading files.\n   310\t# The value should be a mode as you\'d pass to os.chmod;\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_z71YEQLDNzhWRWJTHy5EhfSw']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "str_replace_editor str_replace /testbed/docs/ref/settings.txt   --old_str '.. setting:: FILE_UPLOAD_PERMISSIONS' --new_str '.. setting:: FILE_UPLOAD_PERMISSIONS\n\n    .. warning::\n\n        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\n'", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/docs/ref/settings.txt","old_str":".. setting:: FILE_UPLOAD_PERMISSIONS","new_str":".. setting:: FILE_UPLOAD_PERMISSIONS\\n\\n    .. warning::\\n\\n        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\\n"}', 'name': 'str_replace_editor'}, 'id': 'call_WYOiqDN5Jss5Jfv6gAXYv2It', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/docs/ref/settings.txt has been edited. Here's the result of running `cat -n` on a snippet of /testbed/docs/ref/settings.txt:\n  1477\t:djadmin:`collectstatic` for details on overriding it.\n  1478\t\n  1479\tThis value mirrors the functionality and caveats of the\n  1480\t:setting:`FILE_UPLOAD_PERMISSIONS` setting.\n  1481\t\n  1482\t.. setting:: FILE_UPLOAD_PERMISSIONS\n  1483\t\n  1484\t    .. warning::\n  1485\t\n  1486\t        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\n  1487\t\n  1488\t\n  1489\t``FILE_UPLOAD_PERMISSIONS``\n  1490\t---------------------------\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_WYOiqDN5Jss5Jfv6gAXYv2It']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'cat > /testbed/scripts/reproduce_upload_permission_issue.py << \'EOF\'\nimport os\nimport tempfile\n\n# Simulate file upload saving with tempfile.NamedTemporaryFile and os.rename\n\ndef simulate_file_upload():\n    # Create a temporary file with NamedTemporaryFile\n    with tempfile.NamedTemporaryFile(delete=False) as tmp:\n        tmp.write(b"Test content")\n        tmp_path = tmp.name\n\n    # Check permissions of the temporary file\n    tmp_stat = os.stat(tmp_path)\n    print(f"Temporary file permissions: {oct(tmp_stat.st_mode & 0o777)}")\n\n    # Simulate renaming to final destination\n    final_path = tmp_path + "_final"\n    os.rename(tmp_path, final_path)\n\n    # Check permissions of the final file\n    final_stat = os.stat(final_path)\n    print(f"Final file permissions: {oct(final_stat.st_mode & 0o777)}")\n\n    # Clean up\n    os.remove(final_path)\n\nif __name__ == "__main__":\n    simulate_file_upload()\nEOF', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"cat > /testbed/scripts/reproduce_upload_permission_issue.py << \'EOF\'\\nimport os\\nimport tempfile\\n\\n# Simulate file upload saving with tempfile.NamedTemporaryFile and os.rename\\n\\ndef simulate_file_upload():\\n    # Create a temporary file with NamedTemporaryFile\\n    with tempfile.NamedTemporaryFile(delete=False) as tmp:\\n        tmp.write(b\\"Test content\\")\\n        tmp_path = tmp.name\\n\\n    # Check permissions of the temporary file\\n    tmp_stat = os.stat(tmp_path)\\n    print(f\\"Temporary file permissions: {oct(tmp_stat.st_mode & 0o777)}\\")\\n\\n    # Simulate renaming to final destination\\n    final_path = tmp_path + \\"_final\\"\\n    os.rename(tmp_path, final_path)\\n\\n    # Check permissions of the final file\\n    final_stat = os.stat(final_path)\\n    print(f\\"Final file permissions: {oct(final_stat.st_mode & 0o777)}\\")\\n\\n    # Clean up\\n    os.remove(final_path)\\n\\nif __name__ == \\"__main__\\":\\n    simulate_file_upload()\\nEOF\\n"}', 'name': 'bash'}, 'id': 'call_39r62n9LLklnjClqIyaw3IvF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'Your command ran successfully and did not produce any output.'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_39r62n9LLklnjClqIyaw3IvF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/scripts/reproduce_upload_permission_issue.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/scripts/reproduce_upload_permission_issue.py"}', 'name': 'bash'}, 'id': 'call_McVJw3znpWncbF2vlukScLA9', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nTemporary file permissions: 0o600\nFinal file permissions: 0o600\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_McVJw3znpWncbF2vlukScLA9']}, {'role': 'assistant', 'content': "The reproduce script shows that the temporary file created by tempfile.NamedTemporaryFile has permissions 0o600, and after renaming, the final file also has permissions 0o600. This confirms the issue described in the PR.\n\nNow, with the change made to set FILE_UPLOAD_PERMISSIONS to 0o644 by default in global_settings.py, the FileSystemStorage class should apply these permissions to the saved file using os.chmod.\n\nTo confirm the fix, I will create a small test script that uses Django's FileSystemStorage to save a file and check the permissions of the saved file. This will verify that the file permissions are set to 0o644 by default.\n\nI will create and run this test script next.", 'thought': "The reproduce script shows that the temporary file created by tempfile.NamedTemporaryFile has permissions 0o600, and after renaming, the final file also has permissions 0o600. This confirms the issue described in the PR.\n\nNow, with the change made to set FILE_UPLOAD_PERMISSIONS to 0o644 by default in global_settings.py, the FileSystemStorage class should apply these permissions to the saved file using os.chmod.\n\nTo confirm the fix, I will create a small test script that uses Django's FileSystemStorage to save a file and check the permissions of the saved file. This will verify that the file permissions are set to 0o644 by default.\n\nI will create and run this test script next.", 'action': 'str_replace_editor create /testbed/scripts/test_filesystemstorage_permissions.py --file_text \'import os\nfrom django.core.files.storage import FileSystemStorage\nfrom django.core.files.base import ContentFile\n\n# Setup a FileSystemStorage instance\nstorage = FileSystemStorage()\n\n# Save a file\nfile_name = \'"\'"\'test_file.txt\'"\'"\'\ncontent = ContentFile(b\'"\'"\'Test content\'"\'"\')\nsaved_name = storage.save(file_name, content)\n\n# Get the full path\nfull_path = storage.path(saved_name)\n\n# Check the permissions\nfile_stat = os.stat(full_path)\nprint(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")\n\n# Clean up\nos.remove(full_path)\n\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"create","path":"/testbed/scripts/test_filesystemstorage_permissions.py","file_text":"import os\\nfrom django.core.files.storage import FileSystemStorage\\nfrom django.core.files.base import ContentFile\\n\\n# Setup a FileSystemStorage instance\\nstorage = FileSystemStorage()\\n\\n# Save a file\\nfile_name = \'test_file.txt\'\\ncontent = ContentFile(b\'Test content\')\\nsaved_name = storage.save(file_name, content)\\n\\n# Get the full path\\nfull_path = storage.path(saved_name)\\n\\n# Check the permissions\\nfile_stat = os.stat(full_path)\\nprint(f\\"Saved file permissions: {oct(file_stat.st_mode & 0o777)}\\")\\n\\n# Clean up\\nos.remove(full_path)\\n"}', 'name': 'str_replace_editor'}, 'id': 'call_fpmpDWr8f38w9VOD6CmkrElw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFile created successfully at: /testbed/scripts/test_filesystemstorage_permissions.py\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_fpmpDWr8f38w9VOD6CmkrElw']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/scripts/test_filesystemstorage_permissions.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/scripts/test_filesystemstorage_permissions.py"}', 'name': 'bash'}, 'id': 'call_X0KIFcoR3SYIfWc1JfYNTY2z', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nTraceback (most recent call last):\n  File "/testbed/scripts/test_filesystemstorage_permissions.py", line 11, in <module>\n    saved_name = storage.save(file_name, content)\n  File "/testbed/django/core/files/storage.py", line 51, in save\n    name = self.get_available_name(name, max_length=max_length)\n  File "/testbed/django/core/files/storage.py", line 75, in get_available_name\n    while self.exists(name) or (max_length and len(name) > max_length):\n  File "/testbed/django/core/files/storage.py", line 304, in exists\n    return os.path.exists(self.path(name))\n  File "/testbed/django/core/files/storage.py", line 317, in path\n    return safe_join(self.location, name)\n  File "/testbed/django/utils/functional.py", line 48, in __get__\n    res = instance.__dict__[self.name] = self.func(instance)\n  File "/testbed/django/core/files/storage.py", line 207, in location\n    return os.path.abspath(self.base_location)\n  File "/testbed/django/utils/functional.py", line 48, in __get__\n    res = instance.__dict__[self.name] = self.func(instance)\n  File "/testbed/django/core/files/storage.py", line 203, in base_location\n    return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n  File "/testbed/django/conf/__init__.py", line 76, in __getattr__\n    self._setup(name)\n  File "/testbed/django/conf/__init__.py", line 61, in _setup\n    % (desc, ENVIRONMENT_VARIABLE))\ndjango.core.exceptions.ImproperlyConfigured: Requested setting MEDIA_ROOT, but settings are not configured. You must either define the environment variable DJANGO_SETTINGS_MODULE or call settings.configure() before accessing settings.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_X0KIFcoR3SYIfWc1JfYNTY2z']}, {'role': 'assistant', 'content': 'The test script failed because Django settings are not configured. To run this test script, we need to configure Django settings properly, including setting MEDIA_ROOT to a writable directory.\n\nI will modify the test script to configure Django settings programmatically with a temporary directory as MEDIA_ROOT, then run the test again.', 'thought': 'The test script failed because Django settings are not configured. To run this test script, we need to configure Django settings properly, including setting MEDIA_ROOT to a writable directory.\n\nI will modify the test script to configure Django settings programmatically with a temporary directory as MEDIA_ROOT, then run the test again.', 'action': 'str_replace_editor str_replace /testbed/scripts/test_filesystemstorage_permissions.py   --old_str \'import os\nfrom django.core.files.storage import FileSystemStorage\nfrom django.core.files.base import ContentFile\n\n# Setup a FileSystemStorage instance\nstorage = FileSystemStorage()\n\n# Save a file\nfile_name = \'"\'"\'test_file.txt\'"\'"\'\ncontent = ContentFile(b\'"\'"\'Test content\'"\'"\')\nsaved_name = storage.save(file_name, content)\n\n# Get the full path\nfull_path = storage.path(saved_name)\n\n# Check the permissions\nfile_stat = os.stat(full_path)\nprint(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")\n\n# Clean up\nos.remove(full_path)\n\' --new_str \'import os\nimport tempfile\nfrom django.conf import settings\nfrom django.core.files.storage import FileSystemStorage\nfrom django.core.files.base import ContentFile\n\n# Configure Django settings\nif not settings.configured:\n    settings.configure(\n        MEDIA_ROOT=tempfile.mkdtemp(),\n        FILE_UPLOAD_PERMISSIONS=0o644,\n    )\n\n# Setup a FileSystemStorage instance\nstorage = FileSystemStorage()\n\n# Save a file\nfile_name = \'"\'"\'test_file.txt\'"\'"\'\ncontent = ContentFile(b\'"\'"\'Test content\'"\'"\')\nsaved_name = storage.save(file_name, content)\n\n# Get the full path\nfull_path = storage.path(saved_name)\n\n# Check the permissions\nfile_stat = os.stat(full_path)\nprint(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")\n\n# Clean up\nos.remove(full_path)\n\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/scripts/test_filesystemstorage_permissions.py","old_str":"import os\\nfrom django.core.files.storage import FileSystemStorage\\nfrom django.core.files.base import ContentFile\\n\\n# Setup a FileSystemStorage instance\\nstorage = FileSystemStorage()\\n\\n# Save a file\\nfile_name = \'test_file.txt\'\\ncontent = ContentFile(b\'Test content\')\\nsaved_name = storage.save(file_name, content)\\n\\n# Get the full path\\nfull_path = storage.path(saved_name)\\n\\n# Check the permissions\\nfile_stat = os.stat(full_path)\\nprint(f\\"Saved file permissions: {oct(file_stat.st_mode & 0o777)}\\")\\n\\n# Clean up\\nos.remove(full_path)\\n","new_str":"import os\\nimport tempfile\\nfrom django.conf import settings\\nfrom django.core.files.storage import FileSystemStorage\\nfrom django.core.files.base import ContentFile\\n\\n# Configure Django settings\\nif not settings.configured:\\n    settings.configure(\\n        MEDIA_ROOT=tempfile.mkdtemp(),\\n        FILE_UPLOAD_PERMISSIONS=0o644,\\n    )\\n\\n# Setup a FileSystemStorage instance\\nstorage = FileSystemStorage()\\n\\n# Save a file\\nfile_name = \'test_file.txt\'\\ncontent = ContentFile(b\'Test content\')\\nsaved_name = storage.save(file_name, content)\\n\\n# Get the full path\\nfull_path = storage.path(saved_name)\\n\\n# Check the permissions\\nfile_stat = os.stat(full_path)\\nprint(f\\"Saved file permissions: {oct(file_stat.st_mode & 0o777)}\\")\\n\\n# Clean up\\nos.remove(full_path)\\n"}', 'name': 'str_replace_editor'}, 'id': 'call_okl99E5Cff8LP6cFAvNB4FC2', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nThe file /testbed/scripts/test_filesystemstorage_permissions.py has been edited. Here\'s the result of running `cat -n` on a snippet of /testbed/scripts/test_filesystemstorage_permissions.py:\n     1\timport os\n     2\timport tempfile\n     3\tfrom django.conf import settings\n     4\tfrom django.core.files.storage import FileSystemStorage\n     5\tfrom django.core.files.base import ContentFile\n     6\t\n     7\t# Configure Django settings\n     8\tif not settings.configured:\n     9\t    settings.configure(\n    10\t        MEDIA_ROOT=tempfile.mkdtemp(),\n    11\t        FILE_UPLOAD_PERMISSIONS=0o644,\n    12\t    )\n    13\t\n    14\t# Setup a FileSystemStorage instance\n    15\tstorage = FileSystemStorage()\n    16\t\n    17\t# Save a file\n    18\tfile_name = \'test_file.txt\'\n    19\tcontent = ContentFile(b\'Test content\')\n    20\tsaved_name = storage.save(file_name, content)\n    21\t\n    22\t# Get the full path\n    23\tfull_path = storage.path(saved_name)\n    24\t\n    25\t# Check the permissions\n    26\tfile_stat = os.stat(full_path)\n    27\tprint(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")\n    28\t\n    29\t# Clean up\n    30\tos.remove(full_path)\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_okl99E5Cff8LP6cFAvNB4FC2']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/scripts/test_filesystemstorage_permissions.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/scripts/test_filesystemstorage_permissions.py"}', 'name': 'bash'}, 'id': 'call_G4KjSpBM3IwlHq1zV6pUcIqi', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nSaved file permissions: 0o644\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_G4KjSpBM3IwlHq1zV6pUcIqi'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'submit', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{}', 'name': 'submit'}, 'id': 'call_esuNGrVxBDlsfFBbpOUcMhG1', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nThank you for your work on this issue. Please carefully follow the steps below to help review your changes.\n\n1. If you made any changes to your code after running the reproduction script, please run the reproduction script again.\n  If the reproduction script is failing, please revisit your changes and make sure they are correct.\n  If you have already removed your reproduction script, please ignore this step.\n2. Remove your reproduction script (if you haven\'t done so already).\n3. If you have modified any TEST files, please revert them to the state they had before you started fixing the issue.\n  You can do this with `git checkout -- /path/to/test/file.py`. Use below <diff> to find the files you need to revert.\n4. Run the submit command again to confirm.\n\nHere is a list of all of your changes:\n\n<diff>\ndiff --git a/django/conf/global_settings.py b/django/conf/global_settings.py\nindex acee9887d2..bdeec80610 100644\n--- a/django/conf/global_settings.py\n+++ b/django/conf/global_settings.py\n@@ -304,7 +304,7 @@ FILE_UPLOAD_TEMP_DIR = None\n \n # The numeric mode to set newly-uploaded files to. The value should be a mode\n # you\'d pass directly to os.chmod; see https://docs.python.org/library/os.html#files-and-directories.\n-FILE_UPLOAD_PERMISSIONS = None\n+FILE_UPLOAD_PERMISSIONS = 0o644\n \n # The numeric mode to assign to newly-created directories, when uploading files.\n # The value should be a mode as you\'d pass to os.chmod;\ndiff --git a/docs/ref/settings.txt b/docs/ref/settings.txt\nindex 46e99af993..f965269215 100644\n--- a/docs/ref/settings.txt\n+++ b/docs/ref/settings.txt\n@@ -1481,6 +1481,11 @@ This value mirrors the functionality and caveats of the\n \n .. setting:: FILE_UPLOAD_PERMISSIONS\n \n+    .. warning::\n+\n+        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\n+\n+\n ``FILE_UPLOAD_PERMISSIONS``\n ---------------------------\n \ndiff --git a/scripts/reproduce_upload_permission_issue.py b/scripts/reproduce_upload_permission_issue.py\nnew file mode 100644\nindex 0000000000..84b7668055\n--- /dev/null\n+++ b/scripts/reproduce_upload_permission_issue.py\n@@ -0,0 +1,28 @@\n+import os\n+import tempfile\n+\n+# Simulate file upload saving with tempfile.NamedTemporaryFile and os.rename\n+\n+def simulate_file_upload():\n+    # Create a temporary file with NamedTemporaryFile\n+    with tempfile.NamedTemporaryFile(delete=False) as tmp:\n+        tmp.write(b"Test content")\n+        tmp_path = tmp.name\n+\n+    # Check permissions of the temporary file\n+    tmp_stat = os.stat(tmp_path)\n+    print(f"Temporary file permissions: {oct(tmp_stat.st_mode & 0o777)}")\n+\n+    # Simulate renaming to final destination\n+    final_path = tmp_path + "_final"\n+    os.rename(tmp_path, final_path)\n+\n+    # Check permissions of the final file\n+    final_stat = os.stat(final_path)\n+    print(f"Final file permissions: {oct(final_stat.st_mode & 0o777)}")\n+\n+    # Clean up\n+    os.remove(final_path)\n+\n+if __name__ == "__main__":\n+    simulate_file_upload()\ndiff --git a/scripts/test_filesystemstorage_permissions.py b/scripts/test_filesystemstorage_permissions.py\nnew file mode 100644\nindex 0000000000..3eba3390de\n--- /dev/null\n+++ b/scripts/test_filesystemstorage_permissions.py\n@@ -0,0 +1,30 @@\n+import os\n+import tempfile\n+from django.conf import settings\n+from django.core.files.storage import FileSystemStorage\n+from django.core.files.base import ContentFile\n+\n+# Configure Django settings\n+if not settings.configured:\n+    settings.configure(\n+        MEDIA_ROOT=tempfile.mkdtemp(),\n+        FILE_UPLOAD_PERMISSIONS=0o644,\n+    )\n+\n+# Setup a FileSystemStorage instance\n+storage = FileSystemStorage()\n+\n+# Save a file\n+file_name = \'test_file.txt\'\n+content = ContentFile(b\'Test content\')\n+saved_name = storage.save(file_name, content)\n+\n+# Get the full path\n+full_path = storage.path(saved_name)\n+\n+# Check the permissions\n+file_stat = os.stat(full_path)\n+print(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")\n+\n+# Clean up\n+os.remove(full_path)\n\n</diff>\n\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_esuNGrVxBDlsfFBbpOUcMhG1'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:10:46,446 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
Your command ran successfully and did not produce any output.
2025-12-09 13:10:46,495 - INFO - swea-agent-django__django-10914 - ========================= STEP 31 =========================
2025-12-09 13:11:06,030 - WARNING - swea-lm-django__django-10914 - Retrying LM query: attempt 1 (slept for 10.00s) due to RateLimitError: litellm.RateLimitError: RateLimitError: OpenAIException - Rate limit reached for gpt-4.1-mini in organization org-X455j81VhQNdfQv1oTeGAtxa on tokens per min (TPM): Limit 200000, Used 169070, Requested 31340. Please try again in 123ms. Visit https://platform.openai.com/account/rate-limits to learn more.
2025-12-09 13:11:20,404 - WARNING - swea-agent-django__django-10914 - Requerying model after FunctionCallingFormatError (1th requery)
2025-12-09 13:11:20,408 - WARNING - swea-agent-django__django-10914 - Your last output did not use any tool calls!
Please make sure your output includes exactly _ONE_ function call!
You must invoke the function directly using the function call format.
You cannot invoke commands with ```, you have to use the function call format.
If you think you have already resolved the issue, please submit your changes by running the `submit` command.
If you think you cannot solve the problem, please run `exit_forfeit` (if available) or `submit`.
Else, please continue with a new tool call!
2025-12-09 13:11:28,768 - INFO - swea-agent-django__django-10914 - ðŸ’­ THOUGHT


ðŸŽ¬ ACTION
submit
2025-12-09 13:11:29,192 - INFO - swea-agent-django__django-10914 - Found submission: diff --git a/django/conf/global_settings.py b/django/conf/global_settings.py
index acee9887d2..bdeec80610 100644
--- a/django/conf/global_settings.py
+++ b/django/conf/global_settings.py
@@ -304,7 +304,7 @@ FILE_UPLOAD_TEMP_DIR = None
 
 # The numeric mode to set newly-uploaded files to. The value should be a mode
 # you'd pass directly to os.chmod; see https://docs.python.org/library/os.html#files-and-directories.
-FILE_UPLOAD_PERMISSIONS = None
+FILE_UPLOAD_PERMISSIONS = 0o644
 
 # The numeric mode to assign to newly-created directories, when uploading files.
 # The value should be a mode as you'd pass to os.chmod;
diff --git a/docs/ref/settings.txt b/docs/ref/settings.txt
index 46e99af993..f965269215 100644
--- a/docs/ref/settings.txt
+++ b/docs/ref/settings.txt
@@ -1481,6 +1481,11 @@ This value mirrors the functionality and caveats of the
 
 .. setting:: FILE_UPLOAD_PERMISSIONS
 
+    .. warning::
+
+        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.
+
+
 ``FILE_UPLOAD_PERMISSIONS``
 ---------------------------
 

2025-12-09 13:11:29,200 - INFO - swea-agent-django__django-10914 - self.messages:
[{'role': 'system', 'content': 'You are a helpful assistant that can interact with a computer to solve tasks.', 'agent': 'main', 'message_type': 'system_prompt'}, {'role': 'user', 'content': [{'type': 'text', 'text': '<uploaded_files>\n/testbed\n</uploaded_files>\n\nI have attached the below csv format content as history bug fix in order for you to understand the repo architecture:\n\n<hist_bugfix>\nbase_commit,description_of_the_bug_fix,original_script_paths,modification\ne3038897992d1c47f70ffb84ec1109b8d6a68bb9,Fixed #36256 -- Removed unnecessary titles from admin UI elements. Ticket #36256: Issues â€” Opened8 months ago,django/contrib/admin/templates/admin/actions.html; django/contrib/admin/templates/admin/app_list.html; js_tests/tests.html,"django/contrib/admin/templates/admin/actions.html: 1 additions, 1 deletions. Patch preview: -            <a role=""button"" href=""#"" title=""{% translate ""Click here to select the objects across all pages"" %}"">{% blocktranslate with cl.result_count as total_count %}Select all {{ total_count }}  || django/contrib/admin/templates/admin/app_list.html: 1 additions, 1 deletions. Patch preview: -          <a href=""{{ app.app_url }}"" class=""section"" title=""{% blocktranslate with name=app.name %}Models in the {{ name }} application{% endblocktranslate %}"">{{ app.name }}</a> +          <a href= || js_tests/tests.html: 1 additions, 2 deletions. Patch preview: -              <a href=""/admin/auth/"" class=""section"" -                 title=""Models in the Authentication and Authorization application""> +              <a href=""/admin/auth/"" class=""section"">"\n11f9fae0b79651291e89446c367d0d1223abbd20,Fixed #36741 -- Linked to custom save()/delete() caveats in docs/ref/models/querysets.txt. Ticket #36741: Issues â€” Opened4 days ago,docs/ref/models/querysets.txt; docs/topics/db/models.txt,"docs/ref/models/querysets.txt: 13 additions, 10 deletions. Patch preview: -* The model\'s ``save()`` method will not be called, and the ``pre_save`` and +* The model\'s ``save()`` method :ref:`will not be called +  <methods-not-called-on-bulk-operations>`, and the ``pre_save` || docs/topics/db/models.txt: 2 additions, 0 deletions. Patch preview: +.. _methods-not-called-on-bulk-operations: +"\na89183e63844a937aacd3ddb73c4952ef869d2cc,Fixed #36620 -- Added coverage workflow to summarize coverage in pull requests. Ticket #36620: Issues â€” Opened2 months ago,.github/workflows/coverage.yml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; zizmor.yml,".github/workflows/coverage.yml: 104 additions, 0 deletions. Patch preview: +name: Coverage + +on: || docs/internals/contributing/writing-code/submitting-patches.txt: 3 additions, 0 deletions. Patch preview: +* If there is a :ref:`code coverage report <code-coverage-on-pull-requests>` +  comment on the pull request, have you reviewed the missing coverage in +  context (considering database/platform-specif || docs/internals/contributing/writing-code/unit-tests.txt: 43 additions, 0 deletions. Patch preview: +.. _code-coverage-on-pull-requests: + +Code coverage on pull requests || zizmor.yml: 1 additions, 0 deletions. Patch preview: +      - coverage.yml"\n846613e521104fa2f2e1c2023e4a1a9886a2ff48,Configured dangerous-triggers zizmor rule.,.github/workflows/labels.yml; .github/workflows/new_contributor_pr.yml; zizmor.yml,".github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +    branches: +      - main || .github/workflows/new_contributor_pr.yml: 4 additions, 0 deletions. Patch preview: +    branches: +      - main +    # Only trigger on the main Django repository || zizmor.yml: 4 additions, 0 deletions. Patch preview: +  dangerous-triggers: +    ignore: +      - labels.yml"\n86b8058b40145fb5ba4fd859676225f533eca986,Addressed unpinned-uses zizmor finding.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; zizmor.yml,".github/workflows/benchmark.yml: 2 additions, 1 deletions. Patch preview: -        uses: conda-incubator/setup-miniconda@v3 +        # Pinned to v3.2.0. +        uses: conda-incubator/setup-miniconda@835234971496cad1653abb28a638a281cf32541f || .github/workflows/check_commit_messages.yml: 3 additions, 0 deletions. Patch preview: +permissions: +  contents: read + || zizmor.yml: 6 additions, 0 deletions. Patch preview: +rules: +  unpinned-uses: +    config:"\n08f4901b3fd3f352ef9cea830d000aee73152556,Simplified actions after applying zizmor auto-fixes.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 3 additions, 6 deletions. Patch preview: -          GITHUB_EVENT_PULL_REQUEST_BASE_REF: ${{ github.event.pull_request.base.ref }} +          BASE: ${{ github.event.pull_request.base.ref }} -          BASE=""${GITHUB_EVENT_PULL_REQUEST_BASE_RE"\ne8958c4690faef27b6715524ecb5c49c3ecb6a09,Applied auto-fixes from zizmor findings.,.github/workflows/benchmark.yml; .github/workflows/check_commit_messages.yml; .github/workflows/docs.yml; .github/workflows/labels.yml; .github/workflows/linters.yml; .github/workflows/postgis.yml; .github/workflows/python_matrix.yml; .github/workflows/schedule_tests.yml; .github/workflows/screenshots.yml; .github/workflows/selenium.yml; .github/workflows/tests.yml,".github/workflows/benchmark.yml: 1 additions, 0 deletions. Patch preview: +          persist-credentials: false || .github/workflows/check_commit_messages.yml: 10 additions, 3 deletions. Patch preview: +        with: +          persist-credentials: false +        env: || .github/workflows/docs.yml: 6 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/labels.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/linters.yml: 8 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/postgis.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/python_matrix.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/schedule_tests.yml: 12 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/screenshots.yml: 2 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false || .github/workflows/selenium.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with: || .github/workflows/tests.yml: 4 additions, 0 deletions. Patch preview: +        with: +          persist-credentials: false +        with:"\n09d4bf5cd9c95c588d3ec22edea5db1f5f146900,Added GitHub Actions linter (zizmor).,.github/workflows/linters.yml; .pre-commit-config.yaml; docs/internals/contributing/writing-code/submitting-patches.txt; docs/internals/contributing/writing-code/unit-tests.txt; tox.ini,".github/workflows/linters.yml: 11 additions, 0 deletions. Patch preview: + +  zizmor: +    runs-on: ubuntu-latest || .pre-commit-config.yaml: 4 additions, 0 deletions. Patch preview: +  - repo: https://github.com/zizmorcore/zizmor-pre-commit +    rev: v1.16.3  +    hooks: || docs/internals/contributing/writing-code/submitting-patches.txt: 2 additions, 2 deletions. Patch preview: -  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8``, or -  ``isort`` errors? You can install the :ref:`pre-commit +  guidelines? Are there any  ``black``, ``blacken-docs``, ``flake8` || docs/internals/contributing/writing-code/unit-tests.txt: 6 additions, 5 deletions. Patch preview: -SQLite, ``black``, ``blacken-docs``, ``flake8``, ``isort``, ``lint-docs`` and -the documentation spelling checker. In addition to the system dependencies -noted elsewhere in this documentation, the c || tox.ini: 9 additions, 0 deletions. Patch preview: +    zizmor + +[testenv:zizmor]"\na523d5c8336f5f7f5e24a1cc8034ce65aedec3c6,Added scripts for building and releasing Django artifacts.,scripts/backport.sh; scripts/confirm_release.sh; scripts/do_django_release.py; scripts/test_new_version.sh,"scripts/backport.sh: 35 additions, 0 deletions. Patch preview: +#!/bin/bash + +# Backport helper for Django stable branches. || scripts/confirm_release.sh: 57 additions, 0 deletions. Patch preview: +#! /bin/bash + +set -xue || scripts/do_django_release.py: 226 additions, 0 deletions. Patch preview: +#! /usr/bin/env python + +""""""Helper to build and publish Django artifacts. || scripts/test_new_version.sh: 48 additions, 0 deletions. Patch preview: +#! /bin/bash + +# Original author: Tim Graham."\n971c76f735d2d61051d887b62a244d743794699a,Skipped scripts/ folder from built release artifacts.,MANIFEST.in,"MANIFEST.in: 1 additions, 1 deletions. Patch preview: -graft scripts +prune scripts"\n3f15935420c0f45760804b807a78a26f4ffe28e4,Refs #36705 -- Added coverage for multiple types of enclosing punctuation in urlize(). Ticket #36705: Issues â€” Opened3 weeks ago,tests/template_tests/filter_tests/test_urlize.py,"tests/template_tests/filter_tests/test_urlize.py: 7 additions, 0 deletions. Patch preview: +    def test_parenthesis_and_bracket(self): +        self.assertEqual( +            urlize(""[(https://en.wikipedia.org/)]""),"\nbe0620b49fce5ddd179356575603c4160390965e,Refs #36031 -- Added tests of DecimalRangeField __contains lookup with unbounded decimal ranges. Ticket #36031: Issues â€” Opened11 months ago,tests/postgres_tests/test_ranges.py,"tests/postgres_tests/test_ranges.py: 19 additions, 0 deletions. Patch preview: +    def test_decimal_contains_range(self): +        decimals = RangesModel.objects.bulk_create( +            ["\n7e4c4f43f51e829e6378a0305bfda81479a368ab,Fixed #36718 -- Added JSONField support for negative array indexing on Oracle 21c+. Ticket #36718: Issues â€” Opened2 weeks ago,django/db/backends/oracle/features.py; django/db/backends/oracle/operations.py; docs/releases/6.1.txt; docs/topics/db/queries.txt,"django/db/backends/oracle/features.py: 4 additions, 1 deletions. Patch preview: -    supports_json_negative_indexing = False +    @cached_property +    def supports_json_negative_indexing(self): || django/db/backends/oracle/operations.py: 5 additions, 0 deletions. Patch preview: + +    def format_json_path_numeric_index(self, num): +        if num < 0: || docs/releases/6.1.txt: 4 additions, 0 deletions. Patch preview: +* :class:`~django.db.models.JSONField` now supports +  :ref:`negative array indexing <key-index-and-path-transforms>` on Oracle +  21c+. || docs/topics/db/queries.txt: 5 additions, 1 deletions. Patch preview: -.. admonition:: MySQL, MariaDB, and Oracle +.. admonition:: MySQL, MariaDB, and Oracle < 21c +.. versionchanged:: 6.1"\n8ce3e1f9d0cdfdcba91e7e544804fa33f6fa9177,Added missing ticket links in docs/releases/5.2.8.txt.,docs/releases/5.2.8.txt,"docs/releases/5.2.8.txt: 2 additions, 2 deletions. Patch preview: -  of a composite primary key. +  of a composite primary key (:ticket:`36648`). -  incorrectly raised a ``models.E042`` system check error."\n5834643f43a767fe19f2c6d10217b204e7584ec8,Fixed #36748 -- Filtered non-standard placeholders from UNNEST queries. Ticket #36748: Issues â€” Opened40 hours ago,django/db/backends/postgresql/compiler.py; docs/releases/5.2.9.txt; tests/postgres_tests/fields.py; tests/postgres_tests/migrations/0002_create_test_models.py; tests/postgres_tests/models.py; tests/postgres_tests/test_bulk_update.py,"django/db/backends/postgresql/compiler.py: 5 additions, 0 deletions. Patch preview: +            # Field.get_placeholder takes value as an argument, so the +            # resulting placeholder might be dependent on the value. +            # in UNNEST requires a single placeholder to  || docs/releases/5.2.9.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 on PostgreSQL where ``bulk_create()`` did not apply +  a field\'s custom query placeholders (:ticket:`36748`). || tests/postgres_tests/fields.py: 5 additions, 0 deletions. Patch preview: + + +class OffByOneField(models.IntegerField): || tests/postgres_tests/migrations/0002_create_test_models.py: 23 additions, 0 deletions. Patch preview: +    OffByOneField, +        migrations.CreateModel( +            name=""OffByOneModel"", || tests/postgres_tests/models.py: 5 additions, 0 deletions. Patch preview: +    OffByOneField, + + || tests/postgres_tests/test_bulk_update.py: 8 additions, 0 deletions. Patch preview: +    OffByOneModel, + +    def test_bulk_create(self):"\nff843bcbce1f7fc16fcc4d4810c221a2eb11c167,Fixed #36734 -- Clarified the behavior of View.http_method_not_allowed. Ticket #36734: Issues â€” Opened7 days ago,docs/ref/class-based-views/base.txt,"docs/ref/class-based-views/base.txt: 3 additions, 2 deletions. Patch preview: -        The default implementation returns ``HttpResponseNotAllowed`` with a -        list of allowed methods in plain text. +        The default implementation returns ``HttpResponseNotAllowed`` wit"\nb1a65eac7c09250d36e12464fc8fff2a401246b6,Fixed #36321 -- Defaulted suggest_on_error=True in management commands. Ticket #36321: Issues â€” Opened7 months ago,django/core/management/base.py; django/utils/version.py; docs/releases/6.1.txt; tests/admin_scripts/tests.py; tests/user_commands/tests.py,"django/core/management/base.py: 3 additions, 0 deletions. Patch preview: +from django.utils.version import PY314, PY315 +        if PY314 and not PY315: +            kwargs.setdefault(""suggest_on_error"", True) || django/utils/version.py: 1 additions, 0 deletions. Patch preview: +PY315 = sys.version_info >= (3, 15) || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* Management commands now set :class:`~argparse.ArgumentParser`\\\'s +  ``suggest_on_error`` argument to ``True`` by default on Python 3.14, enabling || tests/admin_scripts/tests.py: 11 additions, 5 deletions. Patch preview: -from django.utils.version import PY313, get_docs_version +from django.utils.version import PY313, PY314, get_docs_version -        expected_error = ( || tests/user_commands/tests.py: 16 additions, 0 deletions. Patch preview: +import unittest +from django.utils.version import PY314, PY315 +    @unittest.skipUnless(PY314 and not PY315, ""Only relevant for Python 3.14"")"\nee2e0e202874db31449d3c7c292504652fa87f69,Ensured that Sitemap.items is described as a method in docs/ref/contrib/sitemaps.txt.,docs/ref/contrib/sitemaps.txt,"docs/ref/contrib/sitemaps.txt: 14 additions, 14 deletions. Patch preview: -* :attr:`~Sitemap.items` is a method that returns a :term:`sequence` or +* :meth:`~Sitemap.items` is a method that returns a :term:`sequence` or -    .. attribute:: Sitemap.items"\nd9c94c59835ca2b6569583392bbf5c7f65a8e927,Fixed typo in docs/howto/deployment/wsgi/apache-auth.txt.,docs/howto/deployment/wsgi/apache-auth.txt,"docs/howto/deployment/wsgi/apache-auth.txt: 1 additions, 1 deletions. Patch preview: -returns a list groups the given user belongs to. +returns a list of groups the given user belongs to."\n14fb36e0b083ea963220602d01386cc0fb2c40e4,"Refs #36663, #36739 -- Added release note for running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago Ticket #36739: Issues â€” Opened5 days ago",docs/ref/checks.txt; docs/releases/6.1.txt,"docs/ref/checks.txt: 4 additions, 4 deletions. Patch preview: -  are not run by default because they do more than static code analysis as -  regular checks do. They are only run by the :djadmin:`migrate` command or if -  you specify configured database aliases u || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +System checks +------------- +"\n07419875685997a30cd281396e0dc867e98aefe3,Fixed #36737 -- Escaped further control characters in escapejs. Ticket #36737: Issues â€” Opened6 days ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 6 additions, 2 deletions. Patch preview: +from itertools import chain -# Escape every ASCII character with a value less than 32. -_js_escapes.update((ord(""%c"" % z), ""\\\\u%04X"" % z) for z in range(32)) || tests/utils_tests/test_html.py: 3 additions, 0 deletions. Patch preview: +            (""\\u007f"", ""\\\\u007F""), +            (""\\u0080"", ""\\\\u0080""), +            (""\\u009f"", ""\\\\u009F""),"\n97acd4d2f92eef8c285bac070d437bf0fd52e071,Fixed #26609 -- Extended fields.E004 system check for unordered iterables. Ticket #26609: Issues â€” Opened10 years ago,django/db/models/fields/__init__.py; docs/ref/checks.txt; tests/invalid_models_tests/test_ordinary_fields.py,"django/db/models/fields/__init__.py: 5 additions, 3 deletions. Patch preview: -        if not isinstance(self.choices, Iterable) or isinstance(self.choices, str): +        if not isinstance(self.choices, Iterable) or isinstance( +            self.choices, (str, set, frozenset) || docs/ref/checks.txt: 1 additions, 1 deletions. Patch preview: -  iterable (e.g. a list or tuple). +  ordered iterable (e.g. a list or tuple, but not a set). || tests/invalid_models_tests/test_ordinary_fields.py: 38 additions, 4 deletions. Patch preview: -                    ""\'choices\' must be a mapping (e.g. a dictionary) or an iterable "" -                    ""(e.g. a list or tuple)."", +                    ""\'choices\' must be a mapping (e.g. a diction"\ne05f2a75695b5f5faa7682d4053db4776d4d6f93,Fixed #36733 -- Escaped attributes in Stylesheet.__str__(). Ticket #36733: Issues â€” Opened7 days ago,django/utils/feedgenerator.py; docs/releases/5.2.9.txt; tests/syndication_tests/tests.py; tests/utils_tests/test_feedgenerator.py,"django/utils/feedgenerator.py: 7 additions, 6 deletions. Patch preview: +from django.forms.utils import flatatt -        data = [f\'href=""{self.url}""\'] -        if self.mimetype is not None: || docs/releases/5.2.9.txt: 4 additions, 1 deletions. Patch preview: -* ... +* Fixed a bug in Django 5.2 where +  ``django.utils.feedgenerator.Stylesheet.__str__()`` did not escape || tests/syndication_tests/tests.py: 14 additions, 14 deletions. Patch preview: -            (""/test.xsl"", \'href=""/test.xsl"" type=""text/xsl"" media=""screen""\'), -            (""/test.xslt"", \'href=""/test.xslt"" type=""text/xsl"" media=""screen""\'), -            (""/test.css"", \'href=""/test. || tests/utils_tests/test_feedgenerator.py: 15 additions, 1 deletions. Patch preview: -            str(stylesheet), \'href=""test.css"" type=""text/css"" media=""screen""\' +            str(stylesheet), \'href=""test.css"" media=""screen"" type=""text/css""\' +"\nb07298a73a8d444b3618aad8005055bee5ead8cb,Fixed #36141 -- Checked for applied replaced migrations recursively. Ticket #36141: Issues â€” Opened10 months ago,django/db/migrations/executor.py; django/db/migrations/loader.py; tests/migrations/test_commands.py,"django/db/migrations/executor.py: 1 additions, 2 deletions. Patch preview: -            all_applied = all(m in applied for m in migration.replaces) -            if all_applied and key not in applied: +            if key not in applied and self.loader.all_replaced_applied(key || django/db/migrations/loader.py: 16 additions, 5 deletions. Patch preview: -                    if parent in self.replacements: -                        if all( -                            m in applied for m in self.replacements[parent].replaces || tests/migrations/test_commands.py: 54 additions, 0 deletions. Patch preview: +    def test_double_replaced_migrations_are_checked_correctly(self): +        """""" +        If replaced migrations are already applied and replacing migrations"\n3c005b5f79bf6d71f3f4c3692ed670e1722b0fb6,Fixed #26379 -- Doc\'d that the first filter() on a many-to-many relation is sticky. Ticket #26379: Issues â€” Opened10 years ago,docs/topics/db/queries.txt,"docs/topics/db/queries.txt: 67 additions, 0 deletions. Patch preview: +.. _exclude-implementation: + +Filtering on many-to-many relationships"\n1ce6e78dd4beed702f15fa0be798dd17a15d4ba8,Fixed #24920 -- Added support for DecimalField with no precision. Ticket #24920: Issues â€” Opened10 years ago,django/core/management/commands/inspectdb.py; django/db/backends/base/features.py; django/db/backends/oracle/base.py; django/db/backends/oracle/features.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/features.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/features.py; django/db/models/fields/__init__.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/invalid_models_tests/test_ordinary_fields.py,"django/core/management/commands/inspectdb.py: 9 additions, 15 deletions. Patch preview: -        if field_type == ""DecimalField"": -            if row.precision is None or row.scale is None: -                field_notes.append( || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support numeric columns with no precision? +    supports_no_precision_decimalfield = False + || django/db/backends/oracle/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""NUMBER"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/oracle/introspection.py: 9 additions, 2 deletions. Patch preview: +            if desc[1] == oracledb.NUMBER and desc[5] == -127 and desc[4] == 0: +                # DecimalField with no precision. +                precision = None || django/db/backends/postgresql/base.py: 7 additions, 1 deletions. Patch preview: +def _get_decimal_column(data): +    if data[""max_digits""] is None and data[""decimal_places""] is None: +        return ""numeric"" || django/db/backends/postgresql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/backends/postgresql/introspection.py: 4 additions, 2 deletions. Patch preview: -                line.precision, -                line.scale, +                # precision and scale are always 2^16 - 1 on psycopg2 for || django/db/backends/sqlite3/features.py: 1 additions, 0 deletions. Patch preview: +    supports_no_precision_decimalfield = True || django/db/models/fields/__init__.py: 72 additions, 42 deletions. Patch preview: -        try: -            decimal_places = int(self.decimal_places) -            if decimal_places < 0: || docs/ref/checks.txt: 2 additions, 0 deletions. Patch preview: +* **fields.E135**: ``DecimalField``â€™s ``max_digits`` and ``decimal_places`` +  must both be defined or both omitted. || docs/ref/models/fields.txt: 14 additions, 3 deletions. Patch preview: -Has the following **required** arguments: +Has the following arguments: -    must be greater than or equal to ``decimal_places``. || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* :attr:`DecimalField.max_digits <django.db.models.DecimalField.max_digits>` +  and :attr:`DecimalField.decimal_places +  <django.db.models.DecimalField.decimal_places>` are no longer required to be || tests/inspectdb/models.py: 9 additions, 0 deletions. Patch preview: +class DecimalFieldNoPrec(models.Model): +    decimal_field_no_precision = models.DecimalField( +        max_digits=None, decimal_places=None || tests/inspectdb/tests.py: 9 additions, 7 deletions. Patch preview: +    @skipUnlessDBFeature(""supports_no_precision_decimalfield"") +    def test_decimal_field_no_precision(self): +        out = StringIO() || tests/invalid_models_tests/test_ordinary_fields.py: 52 additions, 5 deletions. Patch preview: -class DecimalFieldTests(SimpleTestCase): -    def test_required_attributes(self): +class DecimalFieldTests(TestCase):"\n5c60763561c67924eff1069e1516b60a59d068d5,Fixed #36723 -- Removed logic for repositioning FilteredSelectMultiple help text. Ticket #36723: Issues â€” Opened11 days ago,django/contrib/admin/static/admin/js/SelectFilter2.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 0 additions, 12 deletions. Patch preview: -            for (const p of from_box.parentNode.getElementsByTagName(\'p\')) { -                if (p.classList.contains(""info"")) { -                    // Remove <p class=""info"">, because it just gets"\n35f86b641a4eb26fa2b7c3842b6d374834a4ea6b,Refs #24928 -- Added introspection support for PostgreSQL HStoreField. Ticket #24928: Issues â€” Opened10 years ago,django/contrib/postgres/apps.py; django/db/backends/postgresql/base.py; django/db/backends/postgresql/introspection.py; docs/releases/6.1.txt; tests/backends/postgresql/tests.py; tests/postgres_tests/test_introspection.py,"django/contrib/postgres/apps.py: 5 additions, 0 deletions. Patch preview: +                        # PostgreSQL OIDs may vary depending on the +                        # installation, especially for datatypes from +                        # extensions, e.g. ""hstore"". In suc || django/db/backends/postgresql/base.py: 2 additions, 0 deletions. Patch preview: +from functools import lru_cache +@lru_cache || django/db/backends/postgresql/introspection.py: 11 additions, 1 deletions. Patch preview: +from django.db.backends.postgresql.base import psycopg_version + +        # PostgreSQL OIDs may vary depending on the installation, especially || docs/releases/6.1.txt: 3 additions, 1 deletions. Patch preview: -* ... +* :djadmin:`inspectdb` now introspects +  :class:`~django.contrib.postgres.fields.HStoreField` when ``psycopg`` 3.2+ is || tests/backends/postgresql/tests.py: 3 additions, 0 deletions. Patch preview: +        psycopg_version.cache_clear() +            self.addCleanup(psycopg_version.cache_clear) +        psycopg_version.cache_clear() || tests/postgres_tests/test_introspection.py: 13 additions, 0 deletions. Patch preview: + +    def test_hstore_field(self): +        from django.db.backends.postgresql.base import psycopg_version"\n0eec2a163a4b2ea4e82c53ae1d7b71bf43ac911d,"Fixed #36724 -- Removed invalid ""for"" attribute on <legend> tags. Ticket #36724: Issues â€” Opened11 days ago",django/forms/boundfield.py; tests/forms_tests/tests/test_forms.py; tests/forms_tests/tests/test_i18n.py; tests/forms_tests/widget_tests/test_clearablefileinput.py; tests/forms_tests/widget_tests/test_selectdatewidget.py; tests/model_forms/tests.py; tests/model_formsets/tests.py,"django/forms/boundfield.py: 3 additions, 1 deletions. Patch preview: -                attrs = {**(attrs or {}), ""for"": id_for_label} +                attrs = attrs or {} +                if tag != ""legend"": || tests/forms_tests/tests/test_forms.py: 38 additions, 22 deletions. Patch preview: -            \'<legend for=""id_field"" class=""required"">Field:</legend>\', +            \'<legend class=""required"">Field:</legend>\', -            \'<legend for=""id_field"" class=""foo required"">Field:</legen || tests/forms_tests/tests/test_i18n.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_field_1"">field_1:</legend>\', +            ""<legend>field_1:</legend>"", -            \'<legend for=""field_2_id"">field_2:</legend>\', || tests/forms_tests/widget_tests/test_clearablefileinput.py: 3 additions, 3 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" -            \'<div><fieldset><legend for=""id_with_file"">With file:</legend>Cu || tests/forms_tests/widget_tests/test_selectdatewidget.py: 1 additions, 1 deletions. Patch preview: -            \'<div><fieldset><legend for=""id_field_month"">Field:</legend>\' +            ""<div><fieldset><legend>Field:</legend>"" || tests/model_forms/tests.py: 3 additions, 3 deletions. Patch preview: -            \'<legend for=""id_name"">Title:</legend>\', +            ""<legend>Title:</legend>"", -            \'<legend for=""id_url"">The URL:</legend>\', || tests/model_formsets/tests.py: 2 additions, 2 deletions. Patch preview: -            \'<legend for=""id_title"">Name:</legend>\', +            ""<legend>Name:</legend>"", -            \'<legend for=""id_title"">Name:</legend>\',"\n7e765a68598b2b798e49bf1f4b431a7bcac085a4,Fixed #36686 -- Clarified Meta.ordering is ignored in GROUP BY queries. Ticket #36686: Issues â€” Opened4 weeks ago,docs/ref/models/options.txt; docs/topics/db/aggregation.txt,"docs/ref/models/options.txt: 6 additions, 0 deletions. Patch preview: +.. admonition:: Default ordering and GROUP BY + +    In :ref:`GROUP BY queries <aggregation-ordering-interaction>` (for example, || docs/topics/db/aggregation.txt: 9 additions, 2 deletions. Patch preview: -    specified (and we can\'t change those other methods\' behavior, as that -    would violate our :doc:`/misc/api-stability` policy). +    specified *explicitly with* ``order_by()`` (and we can\'t chan"\n3aba1fced8254435b947467739721ec6b4fb865c,Fixed #36663 -- Defaulted to running checks against all databases. Ticket #36663: Issues â€” Opened6 weeks ago,django/core/checks/registry.py; tests/check_framework/tests.py,"django/core/checks/registry.py: 9 additions, 0 deletions. Patch preview: +from django.db import connections +        elif not databases: +            # By default, \'database\'-tagged checks are not run if an alias || tests/check_framework/tests.py: 30 additions, 7 deletions. Patch preview: +    def test_run_checks_database_exclusion(self): +        registry = CheckRegistry() +"\n96ee097bd68a93e0f360326271ebe78553fae15b,Refs #31055 -- Adjusted passing of Field.check kwargs to ArrayField.base_field. Ticket #31055: Issues â€” Opened6 years ago,django/contrib/postgres/fields/array.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 1 additions, 1 deletions. Patch preview: -            base_checks = self.base_field.check() +            base_checks = self.base_field.check(**kwargs) || tests/postgres_tests/test_array.py: 19 additions, 0 deletions. Patch preview: +    def test_base_field_check_kwargs(self): +        passed_kwargs = None +"\n1b539ef27e776bd6112e8f22e653feca5279c4fb,Refs #31055 -- Augmented regression tests for database system checks. Ticket #31055: Issues â€” Opened6 years ago,tests/check_framework/tests.py; tests/migrations/test_commands.py,"tests/check_framework/tests.py: 14 additions, 2 deletions. Patch preview: -from unittest import skipIf +from unittest import mock, skipIf -from django.core.checks import Error, Warning || tests/migrations/test_commands.py: 20 additions, 1 deletions. Patch preview: -        mocked_check.assert_called_once() +        mocked_check.assert_called_once_with(databases=[""default""]) +    @override_settings("\nabfa4619fb818ff694c22e962a280673e085239e,Fixed #36730 -- Fixed constraint validation crash for excluded FK attnames. Ticket #36730: Issues â€” Opened9 days ago,django/db/models/constraints.py; tests/model_forms/models.py; tests/model_forms/tests.py,"django/db/models/constraints.py: 5 additions, 2 deletions. Patch preview: -            if field_name in exclude: +            if field_name == ""pk"": +                field = model._meta.pk || tests/model_forms/models.py: 19 additions, 0 deletions. Patch preview: + + +class AttnameConstraintsModel(models.Model): || tests/model_forms/tests.py: 15 additions, 0 deletions. Patch preview: +    AttnameConstraintsModel, + +    def test_check_constraint_refs_excluded_field_attname(self):"\n5401b125abca53200eacb62c8a10e602359b76d4,Fixed #36717 -- Redirect authenticated users on admin login view to next URL. Ticket #36717: Issues â€” Opened2 weeks ago,AUTHORS; django/contrib/admin/sites.py; django/contrib/auth/views.py; docs/releases/6.1.txt; tests/admin_views/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Benedict Etzel <developer@beheh.de> || django/contrib/admin/sites.py: 8 additions, 10 deletions. Patch preview: -        if request.method == ""GET"" and self.has_permission(request): -            # Already logged-in, redirect to admin index -            index_path = reverse(""admin:index"", current_app=self.name) || django/contrib/auth/views.py: 16 additions, 8 deletions. Patch preview: -    def get_redirect_url(self): -        """"""Return the user-originating redirect URL if it\'s safe."""""" -        redirect_to = self.request.POST.get( || docs/releases/6.1.txt: 2 additions, 1 deletions. Patch preview: -* ... +* The admin site login view now redirects authenticated users to the next URL, +  if available, instead of always redirecting to the admin index page. || tests/admin_views/tests.py: 26 additions, 0 deletions. Patch preview: +    def test_login_redirect_when_logged_in(self): +        self.client.force_login(self.superuser) +        response = self.client.get(reverse(""admin:login""))"\n66b5a6de78ac3bcdf586844eac61663fece10ab5,Refs #35381 -- Made JSONNull deconstruct using convenient import path. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; tests/model_fields/test_jsonfield.py,"django/db/models/fields/json.py: 2 additions, 0 deletions. Patch preview: +from django.utils.deconstruct import deconstructible +@deconstructible(path=""django.db.models.JSONNull"") || tests/model_fields/test_jsonfield.py: 7 additions, 0 deletions. Patch preview: +    def test_deconstruct(self): +        jsonnull = JSONNull() +        path, args, kwargs = jsonnull.deconstruct()"\na1ce852e52f45da7528446cef3a1f02416531771,Refs #35844 -- Ran further selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/schedule_tests.yml; .github/workflows/selenium.yml,".github/workflows/schedule_tests.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro || .github/workflows/selenium.yml: 2 additions, 2 deletions. Patch preview: -          python -Wall runtests.py --verbosity 2 --noinput --selenium=chrome --headless --settings=test_sqlite --parallel 2 +          python -Wall runtests.py --verbosity 2 --noinput --selenium=chro"\nc0d7fbe5021b0d2aaa5bb1196a6b43afcecec4d0,Refs #35844 -- Ran selenium tests with --parallel=1. Ticket #35844: Issues â€” Opened13 months ago,.github/workflows/screenshots.yml,".github/workflows/screenshots.yml: 1 additions, 1 deletions. Patch preview: -        run: python -Wall runtests.py --verbosity=2 --noinput --selenium=chrome --headless --screenshots --settings=test_sqlite --parallel=2 +        run: python -Wall runtests.py --verbosity=2 --noi"\nc60a708b58d6c8725f2e9dc46ac43d38250989b8,Refs #35844 -- Checked for forkserver mode when running runtests.py with --selenium and --parallel. Ticket #35844: Issues â€” Opened13 months ago,tests/runtests.py,"tests/runtests.py: 4 additions, 1 deletions. Patch preview: -        if multiprocessing.get_start_method() == ""spawn"" and options.parallel != 1: +        if ( +            multiprocessing.get_start_method() in {""spawn"", ""forkserver""}"\n6821a7c9904861bf1381383b95ed85ff49d9ee5d,Fixed #36053 -- Fixed placement of FilteredSelectMultiple widget label. Ticket #36053: Issues â€” Opened11 months ago,django/contrib/admin/static/admin/js/SelectFilter2.js; js_tests/admin/SelectFilter2.test.js,"django/contrib/admin/static/admin/js/SelectFilter2.js: 2 additions, 3 deletions. Patch preview: -            // Make sure the selector div is at the beginning so that the -            // add link would be displayed to the right of the widget. -            from_box.parentNode.prepend(selector_div || js_tests/admin/SelectFilter2.test.js: 5 additions, 2 deletions. Patch preview: -    assert.equal($(\'#test\').children().first().prop(""tagName""), ""DIV""); -    assert.equal($(\'#test\').children().first().attr(""class""), ""selector""); +    assert.deepEqual("\n2b0f24e6223bf7e294fba63741f58eb7b0bf49ff,Fixed typo in docs/ref/databases.txt.,docs/ref/databases.txt,"docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -database backends to modify its behavior, features, or configuration. +database backend to modify its behavior, features, or configuration."\nfffa64abc3870989d62659453cb302857c539956,Fixed #36715 -- Handled non-finite Decimals in intcomma filter. Ticket #36715: Issues â€” Opened2 weeks ago,django/utils/numberformat.py; tests/humanize_tests/tests.py,"django/utils/numberformat.py: 3 additions, 0 deletions. Patch preview: +        if not number.is_finite(): +            return str(number) + || tests/humanize_tests/tests.py: 6 additions, 0 deletions. Patch preview: +            Decimal(""Infinity""), +            Decimal(""-Infinity""), +            Decimal(""NaN""),"\ne78420c2b8ef62acb6b7a37b71e3aa6833d630fb,Refs #36680 -- Avoided manipulating PATH in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 28 additions, 45 deletions. Patch preview: -from django.core.management.utils import find_formatters -from django.utils.functional import cached_property +HAS_BLACK = shutil.which(""black"")"\n01c70ba14899409e86dc3f6c6bcae0afc48094e7,Fixed unsafe variable interpolation in GitHub Action workflow.,.github/workflows/check_commit_messages.yml,".github/workflows/check_commit_messages.yml: 2 additions, 1 deletions. Patch preview: +        env: +          TITLE: ${{ github.event.pull_request.title }} -          TITLE=""${{ github.event.pull_request.title }}"""\nc135be349ddd9fd71b15d4b20e7fc46814e4ca7c,"Clarified ""get_db_prep_value"" default result in docs/ref/models/fields.txt.",docs/ref/models/fields.txt,"docs/ref/models/fields.txt: 2 additions, 2 deletions. Patch preview: -        ``value`` if ``prepared=True`` and :meth:`~Field.get_prep_value` if is -        ``False``. +        ``value`` if ``prepared=True``, and :meth:`get_prep_value(value)"\na4f76741340fb23566795e83f830a3f2d49acce0,Clarified EmailValidator docs to specify it validates an email address.,docs/ref/validators.txt,"docs/ref/validators.txt: 2 additions, 2 deletions. Patch preview: -    An :class:`EmailValidator` ensures that a value looks like an email, and -    raises a :exc:`~django.core.exceptions.ValidationError` with +    An :class:`EmailValidator` ensures that a value loo"\nc4e07f94ebc1f9eaa3dae7b3dc6a2b9832182a10,Fixed #36420 -- Used actual SQLite limits in last_executed_query() quoting. Ticket #36420: Issues â€” Opened6 months ago,django/db/backends/sqlite3/operations.py; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/operations.py: 9 additions, 9 deletions. Patch preview: +import sqlite3 -        # This function is limited both by SQLITE_LIMIT_VARIABLE_NUMBER (the -        # number of parameters, default = 999) and SQLITE_MAX_COLUMN (the || tests/backends/sqlite/tests.py: 23 additions, 9 deletions. Patch preview: +import sqlite3 -    def test_large_number_of_parameters(self): -        # If SQLITE_MAX_VARIABLE_NUMBER (default = 999) has been changed to be"\n1c7db70e79dce82f50d5958da64ab8e2807a31df,Fixed #36705 -- Avoided string concatenation in utils. Ticket #36705: Issues â€” Opened3 weeks ago,django/utils/html.py; django/utils/http.py; django/utils/numberformat.py; django/utils/text.py; docs/topics/performance.txt,"django/utils/html.py: 7 additions, 5 deletions. Patch preview: +from collections import deque -        trail = """" +        trail = deque() || django/utils/http.py: 3 additions, 3 deletions. Patch preview: -    b36 = """" +    b36_parts = [] -        b36 = char_set[n] + b36 || django/utils/numberformat.py: 4 additions, 4 deletions. Patch preview: -        int_part_gd = """" +        int_part_gd = [] -                int_part_gd += thousand_sep[::-1] || django/utils/text.py: 10 additions, 10 deletions. Patch preview: -        self.output = """" +        self.output = [] -        self.output += self.get_starttag_text() || docs/topics/performance.txt: 6 additions, 0 deletions. Patch preview: +That said, a lot of a web framework\'s work is done by concatenating +strings, and PyPy has an issue with that (see +`this PyPy blog"\n27687475265f88bc0a0bcbfe2ba26da306bbfc20,Fixed #36315 -- Used TaskGroup instead of asyncio.gather(). Ticket #36315: Issues â€” Opened8 months ago,django/dispatch/dispatcher.py; docs/topics/signals.txt,"django/dispatch/dispatcher.py: 32 additions, 10 deletions. Patch preview: +async def _gather(*coros): +    if len(coros) == 0: +        return [] || docs/topics/signals.txt: 5 additions, 1 deletions. Patch preview: -``asyncio.gather()``. +:class:`asyncio.TaskGroup`. +.. versionchanged:: 6.1"\n2501958b5127020411df6271445ccfd0906df70e,Refs #36315 -- Replaced manual task and cancellation handling with TaskGroup in ASGIHandler. Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 16 additions, 40 deletions. Patch preview: -            async def process_request(request, send): -                response = await self.run_get_response(request) +            class RequestProcessed(Exception):"\n796cf3d325b4a1b9d9b5361c2c8c28a5edcfe89b,Refs #36315 -- Used contextlib.closing() in ASGIHandler.handle(). Ticket #36315: Issues â€” Opened8 months ago,django/core/handlers/asgi.py,"django/core/handlers/asgi.py: 54 additions, 54 deletions. Patch preview: -from contextlib import aclosing +from contextlib import aclosing, closing -        # Request is complete and can be served."\n5ef870fbc5a65cce65b42a8f9cdb208a32d3dd31,Removed community packages admonition from settings docs.,docs/ref/settings.txt,"docs/ref/settings.txt: 0 additions, 9 deletions. Patch preview: -.. admonition:: There are community maintained solutions too! - -    Django has a vibrant ecosystem. There are storage backends"\n47ac64ed8bba4de98376b961c739036b3199394b,Added community package email backends mention to docs.,docs/topics/email.txt,"docs/topics/email.txt: 10 additions, 0 deletions. Patch preview: +.. admonition:: There are community-maintained solutions too! + +    Django has a vibrant ecosystem. There are email backends"\n6d4d99b3cef4a6d931de02f89a493fb345dc438e,Fixed #36702 -- Made bulk_create() return pk values set by an expression. Ticket #36702: Issues â€” Opened3 weeks ago,django/db/models/query.py; tests/bulk_create/tests.py,"django/db/models/query.py: 1 additions, 2 deletions. Patch preview: -                        if field != opts.pk: -                            setattr(obj_with_pk, field.attname, result) +                        setattr(obj_with_pk, field.attname, result) || tests/bulk_create/tests.py: 9 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature( +        ""can_return_rows_from_bulk_insert"", ""supports_expression_defaults"" +    )"\n125b63ca745bace1e098ed3c7362d59136f68a8b,Fixed #36710 -- Fixed a regression in urlize for multipart domain names. Ticket #36710: Issues â€” Opened2 weeks ago,django/utils/html.py; tests/utils_tests/test_html.py,"django/utils/html.py: 1 additions, 0 deletions. Patch preview: +        rf""(?:{DomainNameValidator.domain_re})"" || tests/utils_tests/test_html.py: 4 additions, 0 deletions. Patch preview: +            ( +                ""host.djangoproject.com"", +                \'<a href=""https://host.djangoproject.com"">host.djangoproject.com</a>\',"\ndfcc662cf8fd7f897ddcdfeaf5cb4ae6c963ebf8,Fixed #36709 -- Included static methods in system check for UserModel.is_anonymous/is_authenticated methods. Ticket #36709: Issues â€” Opened2 weeks ago,django/contrib/auth/checks.py; tests/auth_tests/test_checks.py,"django/contrib/auth/checks.py: 2 additions, 3 deletions. Patch preview: -from types import MethodType -    if isinstance(cls().is_anonymous, MethodType): +    if callable(cls().is_anonymous): || tests/auth_tests/test_checks.py: 39 additions, 0 deletions. Patch preview: +    @override_settings(AUTH_USER_MODEL=""auth_tests.VulnerableStaticUser"") +    def test_is_anonymous_authenticated_static_methods(self): +        """""""\nc5a107e8248813f07325ae65232b5e53e9ac4238,Added CVE-2025-64458 and CVE-2025-64459 to security archive.,docs/releases/security.txt,"docs/releases/security.txt: 24 additions, 0 deletions. Patch preview: +November 5, 2025 - :cve:`2025-64458` +------------------------------------ +"\n6e18c078d5c044a1d22dd6a64ace11d9e5f6d0bc,Added stub release notes for 5.2.9.,docs/releases/5.2.9.txt; docs/releases/index.txt,"docs/releases/5.2.9.txt: 12 additions, 0 deletions. Patch preview: +========================== +Django 5.2.9 release notes +========================== || docs/releases/index.txt: 1 additions, 0 deletions. Patch preview: +   5.2.9"\n3c3f46357718166069948625354b8315a8505262,Refs CVE-2025-64459 -- Avoided propagating invalid arguments to Q on dictionary expansion.,django/db/models/query.py; tests/queries/tests.py,"django/db/models/query.py: 5 additions, 0 deletions. Patch preview: +PROHIBITED_FILTER_KWARGS = frozenset([""_connector"", ""_negated""]) + +        if invalid_kwargs := PROHIBITED_FILTER_KWARGS.intersection(kwargs): || tests/queries/tests.py: 8 additions, 0 deletions. Patch preview: +class TestInvalidFilterArguments(TestCase): +    def test_filter_rejects_invalid_arguments(self): +        school = School.objects.create()"\n98e642c69181c942d60a10ca0085d48c6b3068bb,Fixed CVE-2025-64459 -- Prevented SQL injections in Q/QuerySet via the _connector kwarg.,django/db/models/query_utils.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/queries/test_q.py,"django/db/models/query_utils.py: 4 additions, 0 deletions. Patch preview: +    connectors = (None, AND, OR, XOR) +        if _connector not in self.connectors: +            connector_reprs = "", "".join(f""{conn!r}"" for conn in self.connectors[1:]) || docs/releases/4.2.26.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.1.14.txt: 7 additions, 0 deletions. Patch preview: + +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== || docs/releases/5.2.8.txt: 7 additions, 0 deletions. Patch preview: +CVE-2025-64459: Potential SQL injection via ``_connector`` keyword argument +=========================================================================== + || tests/queries/test_q.py: 5 additions, 0 deletions. Patch preview: +    def test_connector_validation(self): +        msg = f""_connector must be one of {Q.AND!r}, {Q.OR!r}, {Q.XOR!r}, or None."" +        with self.assertRaisesMessage(ValueError, msg):"\nc880530ddd4fabd5939bab0e148bebe36699432a,Fixed CVE-2025-64458 -- Mitigated potential DoS in HttpResponseRedirect/HttpResponsePermanentRedirect on Windows.,django/http/response.py; docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; tests/httpwrappers/tests.py,"django/http/response.py: 7 additions, 2 deletions. Patch preview: -from django.utils.http import content_disposition_header, http_date +from django.utils.http import MAX_URL_LENGTH, content_disposition_header, http_date -        parsed = urlsplit(str(redirect_to)) || docs/releases/4.2.26.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.1.14.txt: 9 additions, 1 deletions. Patch preview: -... +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +========================================================== || docs/releases/5.2.8.txt: 10 additions, 0 deletions. Patch preview: +CVE-2025-64458: Potential denial-of-service vulnerability in ``HttpResponseRedirect`` and ``HttpResponsePermanentRedirect`` on Windows +=============================================================== || tests/httpwrappers/tests.py: 2 additions, 0 deletions. Patch preview: +from django.utils.http import MAX_URL_LENGTH +            ""Ã©"" * (MAX_URL_LENGTH + 1),"\n74564946c3b42a2ef7d087047e49873847a7e1d9,Fixed #36704 -- Fixed system check error for proxy model with a composite pk. Ticket #36704: Issues â€” Opened3 weeks ago,django/db/models/base.py; docs/releases/5.2.8.txt; tests/composite_pk/test_checks.py,"django/db/models/base.py: 1 additions, 1 deletions. Patch preview: -        if not isinstance(pk, CompositePrimaryKey): +        if meta.proxy or not isinstance(pk, CompositePrimaryKey): || docs/releases/5.2.8.txt: 3 additions, 0 deletions. Patch preview: + +* Fixed a bug in Django 5.2 where proxy models having a ``CompositePrimaryKey`` +  incorrectly raised a ``models.E042`` system check error. || tests/composite_pk/test_checks.py: 35 additions, 0 deletions. Patch preview: + +    def test_proxy_model_can_subclass_model_with_composite_pk(self): +        class Foo(models.Model):"\ne27cff68a32a0183c6b8d110b359c1c858f68cd7,Fixed #36652 -- Increased determinism when loading migrations from disk. Ticket #36652: Issues â€” Opened6 weeks ago,django/db/migrations/loader.py; tests/migrations/test_loader.py; tests/migrations/test_migrations_squashed_replaced_order/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py; tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py,"django/db/migrations/loader.py: 2 additions, 2 deletions. Patch preview: -            migration_names = { +            migration_names = [ -            } || tests/migrations/test_loader.py: 69 additions, 0 deletions. Patch preview: +import subprocess +import sys +import tempfile || tests/migrations/test_migrations_squashed_replaced_order/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_initial.py: 9 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/0002_squashed_initial.py: 16 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app1/__init__.py: 0 additions, 0 deletions. Patch preview:  || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_initial.py: 11 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/0001_squashed_initial.py: 13 additions, 0 deletions. Patch preview: +from django.db import migrations + + || tests/migrations/test_migrations_squashed_replaced_order/app2/__init__.py: 0 additions, 0 deletions. Patch preview: "\neaf7b563a5d3861026242fdb503a58f71acf17f6,Updated ticket triage process diagram and contributing docs.,docs/internals/_images/contribution_process.svg; docs/internals/_images/triage_process.graffle; docs/internals/_images/triage_process.pdf; docs/internals/_images/triage_process.svg; docs/internals/contributing/new-contributors.txt; docs/internals/contributing/triaging-tickets.txt,"docs/internals/_images/contribution_process.svg: 4 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.graffle: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.pdf: 0 additions, 0 deletions. Patch preview:  || docs/internals/_images/triage_process.svg: 0 additions, 282 deletions. Patch preview: -<?xml version=""1.0"" encoding=""UTF-8"" standalone=""no""?> -<!DOCTYPE svg PUBLIC ""-//W3C//DTD SVG 1.1//EN"" ""http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd""> -<svg xmlns=""http://www.w3.org/2000/svg"" ver || docs/internals/contributing/new-contributors.txt: 1 additions, 1 deletions. Patch preview: -you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging` +you don\'t fix the bug itself. See more at :ref:`how-can-i-help-with-triaging`. || docs/internals/contributing/triaging-tickets.txt: 46 additions, 36 deletions. Patch preview: -.. image:: /internals/_images/triage_process.* -   :height: 750 -   :width: 600"\n8af79e2c0c5608196369600268756772a6343525,Fixed #36695 -- Fixed handling of parameterized generics in migration serialization. Ticket #36695: Issues â€” Opened3 weeks ago,django/db/migrations/serializer.py; tests/migrations/test_writer.py,"django/db/migrations/serializer.py: 12 additions, 0 deletions. Patch preview: +class GenericAliasSerializer(BaseSerializer): +    def serialize(self): +        imports = set() || tests/migrations/test_writer.py: 6 additions, 0 deletions. Patch preview: +    def test_serialize_generic_alias(self): +        self.assertSerializedEqual(dict[str, float]) +"\n05ba1a9228128614fb3c475f1c4bdf0160f44dba,Fixed #36661 -- Added introspection of database-level delete options. Ticket #36661: Issues â€” Opened6 weeks ago,django/core/management/commands/inspectdb.py; django/db/backends/base/introspection.py; django/db/backends/mysql/base.py; django/db/backends/mysql/introspection.py; django/db/backends/oracle/introspection.py; django/db/backends/postgresql/introspection.py; django/db/backends/sqlite3/introspection.py; docs/releases/6.1.txt; tests/inspectdb/models.py; tests/inspectdb/tests.py; tests/introspection/models.py; tests/introspection/tests.py,"django/core/management/commands/inspectdb.py: 11 additions, 2 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete -                        ref_db_column, ref_db_table = relations[column_name] +                        ref_db_column, ref_db_table, db_on_delete || django/db/backends/base/introspection.py: 14 additions, 2 deletions. Patch preview: +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING + +    on_delete_types = { || django/db/backends/mysql/base.py: 1 additions, 0 deletions. Patch preview: +                    _, || django/db/backends/mysql/introspection.py: 23 additions, 11 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/oracle/introspection.py: 13 additions, 4 deletions. Patch preview: -        Return a dictionary of {field_name: (field_name_other_table, -        other_table)} representing all foreign keys in the given table. +        Return a dictionary of || django/db/backends/postgresql/introspection.py: 19 additions, 5 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    on_delete_types = { || django/db/backends/sqlite3/introspection.py: 13 additions, 3 deletions. Patch preview: -        Return a dictionary of {column_name: (ref_column_name, ref_table_name)} +        Return a dictionary of +            {column_name: (ref_column_name, ref_table_name, db_on_delete)} || docs/releases/6.1.txt: 5 additions, 0 deletions. Patch preview: +* The ``DatabaseIntrospection.get_relations()`` should now return a dictionary +  with 3-tuples containing (``field_name_other_table``, ``other_table``, +  ``db_on_delete``) as values. ``db_on_delete || tests/inspectdb/models.py: 8 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/inspectdb/tests.py: 21 additions, 0 deletions. Patch preview: +    @skipUnlessDBFeature(""can_introspect_foreign_keys"") +    def test_foreign_key_db_on_delete(self): +        out = StringIO() || tests/introspection/models.py: 15 additions, 0 deletions. Patch preview: + + +class DbOnDeleteModel(models.Model): || tests/introspection/tests.py: 42 additions, 4 deletions. Patch preview: -from django.db.models import Index +from django.db.models import DB_CASCADE, DB_SET_DEFAULT, DB_SET_NULL, DO_NOTHING, Index +    DbOnDeleteModel,"\n601914722956cc41f1f2c53972d669ddee6ffc04,Fixed #36696 -- Fixed NameError when inspecting functions with deferred annotations. Ticket #36696: Issues â€” Opened3 weeks ago,django/utils/inspect.py; tests/utils_tests/test_inspect.py,"django/utils/inspect.py: 15 additions, 1 deletions. Patch preview: +from django.utils.version import PY314 + +if PY314: || tests/utils_tests/test_inspect.py: 15 additions, 0 deletions. Patch preview: +from typing import TYPE_CHECKING +from django.utils.version import PY314 +"\n340e4f832e1ea74a27770e38635bbc781979f2e0,Added community package storage backends mention to docs.,docs/ref/files/storage.txt; docs/ref/settings.txt,"docs/ref/files/storage.txt: 9 additions, 0 deletions. Patch preview: + +.. admonition:: There are community-maintained solutions too! + || docs/ref/settings.txt: 9 additions, 0 deletions. Patch preview: +.. admonition:: There are community maintained solutions too! + +    Django has a vibrant ecosystem. There are storage backends"\n3939cd279569fde44f557d79f20bb5b1a02440af,Refs #36680 -- Fixed admin_scripts tests crash when black is not installed. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 2 additions, 1 deletions. Patch preview: -                if os.path.commonpath([path_component, formatter_path]) == os.sep +                if formatter_path +                and os.path.commonpath([path_component, formatter_path]) == os.se"\n7fc9db1c6a3a4865d85338f26812ce80f076ebec,Refs #35381 -- Clarified key and index lookup handling of None in exact lookup docs. Ticket #35381: Issues â€” Opened19 months ago,docs/ref/models/querysets.txt,"docs/ref/models/querysets.txt: 2 additions, 0 deletions. Patch preview: +:lookup:`Key and index lookups <jsonfield.key>` are exceptions: they +interpret ``None`` as JSON ``null`` instead."\n348ca845385beaddc7c862ff8ec369f041a5088d,Refs #35381 -- Deprecated using None in JSONExact rhs to mean JSON null. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/fields/json.py; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/test_jsonfield.py; tests/postgres_tests/test_array.py,"django/db/models/fields/json.py: 20 additions, 0 deletions. Patch preview: +import warnings +from django.utils.deprecation import RemovedInDjango70Warning, django_file_prefixes +    # RemovedInDjango70Warning: When the deprecation period is over, remove || docs/releases/6.1.txt: 7 additions, 0 deletions. Patch preview: +* The use of ``None`` to represent a top-level JSON scalar ``null`` when +  querying :class:`~django.db.models.JSONField` is now deprecated in favor of +  the new :class:`~django.db.models.JSONNull`  || docs/topics/db/queries.txt: 14 additions, 0 deletions. Patch preview: +.. deprecated:: 6.1 + +    Exact-matching ``None`` in a query to mean JSON ``null`` is deprecated. || tests/model_fields/test_jsonfield.py: 46 additions, 1 deletions. Patch preview: -from django.test import SimpleTestCase, TestCase, skipIfDBFeature, skipUnlessDBFeature +from django.test import ( +    SimpleTestCase, || tests/postgres_tests/test_array.py: 12 additions, 0 deletions. Patch preview: +from django.utils.deprecation import RemovedInDjango70Warning +        # RemovedInDjango70Warning. +        msg = ("\nbe7f68422d4c6ae568a17f1fa91aac67d284df82,Refs #35381 -- Delegated ArrayField element prepping to base_field.get_db_prep_save. Ticket #35381: Issues â€” Opened19 months ago,django/contrib/postgres/fields/array.py; docs/releases/6.1.txt; tests/postgres_tests/models.py; tests/postgres_tests/test_array.py,"django/contrib/postgres/fields/array.py: 5 additions, 0 deletions. Patch preview: +    def get_db_prep_save(self, value, connection): +        if isinstance(value, (list, tuple)): +            return [self.base_field.get_db_prep_save(i, connection) for i in value] || docs/releases/6.1.txt: 9 additions, 0 deletions. Patch preview: +:mod:`django.contrib.postgres` +------------------------------ + || tests/postgres_tests/models.py: 1 additions, 1 deletions. Patch preview: -    json = ArrayField(models.JSONField(default=dict), default=list) +    json = ArrayField(models.JSONField(default=dict), default=list, null=True) || tests/postgres_tests/test_array.py: 27 additions, 0 deletions. Patch preview: +from django.db.models import JSONNull + +"\nadc25a9a6696f7e2ab6181aabce3a23e027d6703,Fixed #35381 -- Added JSONNull() expression. Ticket #35381: Issues â€” Opened19 months ago,django/db/models/__init__.py; django/db/models/fields/json.py; docs/ref/models/expressions.txt; docs/releases/6.1.txt; docs/topics/db/queries.txt; tests/model_fields/models.py; tests/model_fields/test_jsonfield.py,"django/db/models/__init__.py: 2 additions, 1 deletions. Patch preview: -from django.db.models.fields.json import JSONField +from django.db.models.fields.json import JSONField, JSONNull +    ""JSONNull"", || django/db/models/fields/json.py: 22 additions, 1 deletions. Patch preview: +class JSONNull(expressions.Value): +    """"""Represent JSON `null` primitive."""""" + || docs/ref/models/expressions.txt: 12 additions, 0 deletions. Patch preview: +``JSONNull()`` expression +------------------------- + || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +* The new :class:`~django.db.models.JSONNull` expression provides an explicit +  way to represent the JSON scalar ``null``. It can be used when saving a +  top-level :class:`~django.db.models.JSONFie || docs/topics/db/queries.txt: 31 additions, 8 deletions. Patch preview: +.. _storing-and-querying-for-none: + -``null`` instead of SQL ``NULL`` by using :class:`Value(None, JSONField()) || tests/model_fields/models.py: 16 additions, 0 deletions. Patch preview: +class JSONNullCustomEncoder(json.JSONEncoder): +    def default(self, o): +        if isinstance(o, models.JSONNull): || tests/model_fields/test_jsonfield.py: 124 additions, 0 deletions. Patch preview: +    Case, +    CheckConstraint, +    JSONNull,"\nab108bf94dfc06c311d7dc81866b848fe5b5ee6c,"Added stub release notes and release date for 5.2.8, 5.1.14, and 4.2.26.",docs/releases/4.2.26.txt; docs/releases/5.1.14.txt; docs/releases/5.2.8.txt; docs/releases/index.txt,"docs/releases/4.2.26.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 4.2.26 release notes +=========================== || docs/releases/5.1.14.txt: 10 additions, 0 deletions. Patch preview: +=========================== +Django 5.1.14 release notes +=========================== || docs/releases/5.2.8.txt: 4 additions, 3 deletions. Patch preview: -*Expected November 5, 2025* +*November 5, 2025* -Django 5.2.8 fixes several bugs in 5.2.7 and adds compatibility with Python || docs/releases/index.txt: 2 additions, 0 deletions. Patch preview: +   5.1.14 +   4.2.26"\n01f8460653e73a8f60c98d3a37a74b28818744b6,Fixed #36329 -- Removed non-code custom link text when cross-referencing Python objects. Ticket #36329: Issues â€” Opened7 months ago,docs/faq/install.txt; docs/howto/error-reporting.txt; docs/howto/logging.txt; docs/intro/tutorial07.txt; docs/ref/contrib/auth.txt; docs/ref/contrib/contenttypes.txt; docs/ref/contrib/postgres/search.txt; docs/ref/django-admin.txt; docs/ref/models/expressions.txt; docs/ref/models/fields.txt; docs/ref/models/indexes.txt; docs/ref/models/instances.txt; docs/ref/models/meta.txt; docs/ref/models/querysets.txt; docs/ref/settings.txt; docs/topics/auth/default.txt; docs/topics/class-based-views/mixins.txt; docs/topics/composite-primary-key.txt; docs/topics/db/models.txt; docs/topics/db/optimization.txt; docs/topics/db/queries.txt; docs/topics/forms/formsets.txt; docs/topics/forms/modelforms.txt; docs/topics/http/shortcuts.txt; docs/topics/i18n/translation.txt; docs/topics/testing/tools.txt,"docs/faq/install.txt: 4 additions, 4 deletions. Patch preview: -Django comes with its own :djadmin:`lightweight development server<runserver>`. -For a production environment, Django follows the WSGI spec, :pep:`3333`, which -means it can run on a variety of web s || docs/howto/error-reporting.txt: 1 additions, 1 deletions. Patch preview: -    with :attr:`POST parameters<django.http.HttpRequest.POST>` susceptible to +    with :attr:`~django.http.HttpRequest.POST` parameters susceptible to || docs/howto/logging.txt: 3 additions, 3 deletions. Patch preview: -By default, the final log output contains the message part of each :class:`log -record <logging.LogRecord>`. Use a formatter if you want to include additional -data. First name and define your format || docs/intro/tutorial07.txt: 10 additions, 7 deletions. Patch preview: -default is to display 100 items per page. :attr:`Change list pagination -<django.contrib.admin.ModelAdmin.list_per_page>`, :attr:`search boxes -<django.contrib.admin.ModelAdmin.search_fields>`, :attr || docs/ref/contrib/auth.txt: 2 additions, 4 deletions. Patch preview: -        behavior of :class:`~django.contrib.auth.forms.AuthenticationForm` -        which :meth:`prohibits inactive users from logging in -        <django.contrib.auth.forms.AuthenticationForm.confir || docs/ref/contrib/contenttypes.txt: 5 additions, 7 deletions. Patch preview: -    represents, and does -    :meth:`a get() lookup <django.db.models.query.QuerySet.get>` +    represents, and does a :meth:`~django.db.models.query.QuerySet.get` lookup || docs/ref/contrib/postgres/search.txt: 3 additions, 3 deletions. Patch preview: -:class:`GIN <django.contrib.postgres.indexes.GinIndex>` or -:class:`GiST <django.contrib.postgres.indexes.GistIndex>` index which matches -the search vector you wish to use. For example:: || docs/ref/django-admin.txt: 3 additions, 3 deletions. Patch preview: -The :class:`template context <django.template.Context>` used for all matching -files is: +The template context (see :class:`~django.template.Context`) used for all || docs/ref/models/expressions.txt: 3 additions, 1 deletions. Patch preview: +.. _f-expressions: + -The ``filter`` argument takes a :class:`Q object <django.db.models.Q>` that\'s || docs/ref/models/fields.txt: 6 additions, 6 deletions. Patch preview: -The primary key field is set to ``None`` when -:meth:`deleting <django.db.models.Model.delete>` an object. +The primary key field is set to ``None`` when calling a model instanceâ€™s || docs/ref/models/indexes.txt: 4 additions, 4 deletions. Patch preview: -.. admonition:: Restrictions on PostgreSQL +.. admonition:: PostgreSQL-specific indexes -    PostgreSQL supports covering B-Tree, :class:`GiST indexes || docs/ref/models/instances.txt: 5 additions, 7 deletions. Patch preview: -assignment of a new value. Django provides :class:`F expressions -<django.db.models.F>` for performing this kind of relative update. Using -:class:`F expressions <django.db.models.F>`, the previous e || docs/ref/models/meta.txt: 9 additions, 8 deletions. Patch preview: -    :attr:`Hidden fields <django.db.models.Field.hidden>` cannot be retrieved -    by name. +    Hidden fields, fields with :attr:`hidden=True || docs/ref/models/querysets.txt: 20 additions, 19 deletions. Patch preview: -statements), you can use :class:`Q objects <django.db.models.Q>` (``*args``). +statements), you can use :ref:`q-objects` (``*args``). -expressions </ref/models/expressions>` or :class:`~django.db.mod || docs/ref/settings.txt: 7 additions, 6 deletions. Patch preview: -For a :meth:`secure <django.http.HttpRequest.is_secure>` unsafe -request that doesn\'t include the ``Origin`` header, the request must have a -``Referer`` header that matches the origin present in the || docs/topics/auth/default.txt: 6 additions, 6 deletions. Patch preview: -See the :class:`full API documentation <django.contrib.auth.models.User>` for -full reference, the documentation that follows is more task oriented. +See the :class:`~django.contrib.auth.models.User` || docs/topics/class-based-views/mixins.txt: 7 additions, 6 deletions. Patch preview: -:class:`~django.views.generic.list.MultipleObjectTemplateResponseMixin`; as -with :class:`~django.views.generic.detail.SingleObjectTemplateResponseMixin` -above, this overrides ``get_template_names() || docs/topics/composite-primary-key.txt: 5 additions, 6 deletions. Patch preview: -:attr:`primary key <django.db.models.Field.primary_key>` attribute of its -fields: +:attr:`~django.db.models.Field.primary_key` attribute of its fields: || docs/topics/db/models.txt: 2 additions, 2 deletions. Patch preview: -    QuerySet <topics-db-queries-delete>` or as a result of a :attr:`cascading -    delete <django.db.models.ForeignKey.on_delete>`. To ensure customized +    QuerySet <topics-db-queries-delete>` or a || docs/topics/db/optimization.txt: 12 additions, 14 deletions. Patch preview: -* Use :class:`F expressions <django.db.models.F>` to filter -  based on other fields within the same model. +* Use :ref:`f-expressions` to filter based on other fields within the same || docs/topics/db/queries.txt: 16 additions, 16 deletions. Patch preview: -It works backwards, too. While it :attr:`can be customized -<.ForeignKey.related_query_name>`, by default you refer to a ""reverse"" -relationship in a lookup using the lowercase name of the model. || docs/topics/forms/formsets.txt: 3 additions, 2 deletions. Patch preview: -:meth:`iteration <object.__iter__>` and -:meth:`indexing <object.__getitem__>` behavior if needed. +:meth:`~object.__iter__` and :meth:`~object.__getitem__` methods if needed. || docs/topics/forms/modelforms.txt: 6 additions, 6 deletions. Patch preview: -Error messages defined at the -:attr:`form field <django.forms.Field.error_messages>` level or at the +Error messages defined at the form field level ( || docs/topics/http/shortcuts.txt: 2 additions, 2 deletions. Patch preview: -    :class:`Q objects <django.db.models.Q>`. +    :ref:`q-objects`. -    :class:`Q objects <django.db.models.Q>`. || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -        A list of :attr:`application names <django.apps.AppConfig.name>` among +        A list of application names (:attr:`.AppConfig.name`) among the || docs/topics/testing/tools.txt: 23 additions, 27 deletions. Patch preview: -  * Checking that a callable :meth:`raises a certain exception -    <SimpleTestCase.assertRaisesMessage>`. -  * Checking that a callable :meth:`triggers a certain warning"\n1aa69a7491ce7f7f1f164a26a3dfaaa1aeeab217,Fixed #36678 -- Limited retries in ParallelTestRunner. Ticket #36678: Issues â€” Opened4 weeks ago,django/test/runner.py; tests/test_runner/tests.py,"django/test/runner.py: 17 additions, 2 deletions. Patch preview: +import functools +def _safe_init_worker(init_worker, counter, *args, **kwargs): +    try: || tests/test_runner/tests.py: 5 additions, 2 deletions. Patch preview: +import functools -        # Initializer must be a function. -        self.assertIs(mocked_pool.call_args.kwargs[""initializer""], _init_worker)"\n787cc96ef6197d73c7d4ad96f25500910c399603,Refs #35972 -- Returned params in a tuple in further lookups. Ticket #35972: Issues â€” Opened12 months ago,django/contrib/gis/db/models/lookups.py; django/db/models/fields/json.py; django/db/models/lookups.py; django/db/models/sql/compiler.py; tests/custom_lookups/tests.py,"django/contrib/gis/db/models/lookups.py: 1 additions, 1 deletions. Patch preview: -        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else [rhs] +        rhs, *self.rhs_params = rhs if isinstance(rhs, (list, tuple)) else (rhs,) || django/db/models/fields/json.py: 3 additions, 3 deletions. Patch preview: -        if rhs == ""%s"" and rhs_params == [None]: -            rhs_params = [""null""] +        if rhs == ""%s"" and (*rhs_params,) == (None,): || django/db/models/lookups.py: 3 additions, 3 deletions. Patch preview: -        return lhs_sql, list(params) +        return lhs_sql, tuple(params) -        params.extend(rhs_params) || django/db/models/sql/compiler.py: 2 additions, 2 deletions. Patch preview: -        # needs to yield \'NULL\' and [] as its placeholder and params instead -        # of \'%s\' and [None]. The \'NULL\' placeholder is produced earlier by +        # needs to yield \'NULL\' and () as it || tests/custom_lookups/tests.py: 1 additions, 1 deletions. Patch preview: -        params.extend(rhs_params) +        params = (*params, *rhs_params)"\n43933a1dca07047e95ec990d9289d0212668009e,"Reverted ""Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping."" Ticket #26434: Issues â€” Opened10 years ago",django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 1 additions, 7 deletions. Patch preview: -            self.is_sliced -            or self.distinct_fields -            or self.select_for_update || tests/aggregation_regress/tests.py: 0 additions, 19 deletions. Patch preview: -    def test_count_preserve_group_by(self): -        # new release of the same book -        Book.objects.create("\n9ba3f74a46d15f9f2f45ad4ef8cdd245a888e58e,Fixed #36596 -- Made parallel test runner respect django_test_skips and django_test_expected_failures. Ticket #36596: Issues â€” Opened3 months ago,django/db/backends/sqlite3/creation.py; django/test/runner.py,"django/db/backends/sqlite3/creation.py: 0 additions, 2 deletions. Patch preview: -            if os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"": -                self.mark_expected_failures_and_skips() || django/test/runner.py: 5 additions, 0 deletions. Patch preview: +        if ( +            is_spawn_or_forkserver +            and os.environ.get(""RUNNING_DJANGOS_TEST_SUITE"") == ""true"""\n6436ec321073bf0622af815e0af08f54c97f9b30,Fixed #36680 -- Parametrized formatter discovery in AdminScriptTestCase. Ticket #36680: Issues â€” Opened4 weeks ago,tests/admin_scripts/tests.py,"tests/admin_scripts/tests.py: 41 additions, 21 deletions. Patch preview: +from django.core.management.utils import find_formatters +from django.utils.functional import cached_property -HAS_BLACK = shutil.which(""black"")"\nea3a71c2d09f8281d8a50ed20e40e1fb13db5cd9,Fixed #26434 -- Removed faulty clearing of ordering field when missing from explicit grouping. Ticket #26434: Issues â€” Opened10 years ago,django/db/models/sql/query.py; tests/aggregation_regress/tests.py,"django/db/models/sql/query.py: 7 additions, 1 deletions. Patch preview: -            self.is_sliced or self.distinct_fields or self.select_for_update +            self.is_sliced +            or self.distinct_fields || tests/aggregation_regress/tests.py: 19 additions, 0 deletions. Patch preview: +    def test_count_preserve_group_by(self): +        # new release of the same book +        Book.objects.create("\n0ea01101c3a35568bc43e9707ac058b9874bd425,Fixed #36681 -- Removed English pluralization bias from example in docs/topics/i18n/translation.txt. Ticket #36681: Issues â€” Opened4 weeks ago,AUTHORS; docs/topics/i18n/translation.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Varun Kasyap Pentamaraju <varunkasyap@hotmail.com> || docs/topics/i18n/translation.txt: 1 additions, 1 deletions. Patch preview: -    There is only one {{ name }} object. +    There is {{ counter }} {{ name }} object."\nc87daabbf32779f5421a846dd33a7dd46cc27d54,Fixed #36624 -- Dropped support for MySQL < 8.4. Ticket #36624: Issues â€” Opened8 weeks ago,django/contrib/gis/db/backends/mysql/operations.py; django/contrib/gis/db/backends/mysql/schema.py; django/db/backends/mysql/base.py; django/db/backends/mysql/features.py; django/db/backends/mysql/operations.py; django/db/backends/mysql/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/indexes.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/mysql/tests.py; tests/queries/test_explain.py,"django/contrib/gis/db/backends/mysql/operations.py: 0 additions, 2 deletions. Patch preview: -        elif self.connection.mysql_version < (8, 0, 24): -            disallowed_aggregates.insert(0, models.Collect) || django/contrib/gis/db/backends/mysql/schema.py: 0 additions, 10 deletions. Patch preview: -    def skip_default(self, field): -        # Geometry fields are stored as BLOB/TEXT, for which MySQL < 8.0.13 -        # doesn\'t support defaults. || django/db/backends/mysql/base.py: 2 additions, 5 deletions. Patch preview: -    # For these data types: -    # - MySQL < 8.0.13 doesn\'t accept default values and implicitly treats them -    #   as nullable || django/db/backends/mysql/features.py: 2 additions, 64 deletions. Patch preview: -            return (8, 0, 11) +            return (8, 4) -        if not self.supports_explain_analyze: || django/db/backends/mysql/operations.py: 5 additions, 9 deletions. Patch preview: -        if analyze and self.connection.features.supports_explain_analyze: +        if analyze: -            # The use of VALUES() is deprecated in MySQL 8.0.20+. Instead, use || django/db/backends/mysql/schema.py: 2 additions, 16 deletions. Patch preview: -        if not self._supports_limited_data_type_defaults: -            return self._is_limited_data_type(field) -        default_is_empty = self.effective_default(field) in ("""", b"""") || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -MySQL               GEOS, GDAL                      8.0.11+             :ref:`Limited functionality <mysql-spatial-limitations>`. +MySQL               GEOS, GDAL                      8.4+             || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports MySQL 8.0.11 and higher. +Django supports MySQL 8.4 and higher. || docs/ref/models/indexes.txt: 2 additions, 3 deletions. Patch preview: -.. admonition:: MySQL and MariaDB +.. admonition:: MariaDB -    Functional indexes are ignored with MySQL < 8.0.13 and MariaDB as neither || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -by MariaDB, MySQL 8.0.18+, and PostgreSQL could result in changes to data if -there are triggers or if a function is called, even for a ``SELECT`` query. +by MariaDB, MySQL, and PostgreSQL could resu || docs/releases/6.1.txt: 6 additions, 0 deletions. Patch preview: +Dropped support for MySQL < 8.4 +------------------------------- + || tests/backends/mysql/tests.py: 2 additions, 2 deletions. Patch preview: -            mocked_get_database_version.return_value = (8, 0, 4) -            msg = ""MySQL 8.0.11 or later is required (found 8.0.4)."" +            mocked_get_database_version.return_value = (8, 0, 3 || tests/queries/test_explain.py: 1 additions, 3 deletions. Patch preview: -    @unittest.skipUnless( -        connection.vendor == ""mysql"", ""MariaDB and MySQL >= 8.0.18 specific."" -    )"\n4744e9939b65d168c531e5e23d1ac8a4445ac7f9,Fixed #36683 -- Added error message on QuerySet.update() following distinct(*fields). Ticket #36683: Issues â€” Opened4 weeks ago,AUTHORS; django/db/models/query.py; tests/distinct_on_fields/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Matthew Shirley <matt@mattshirley.net> || django/db/models/query.py: 2 additions, 0 deletions. Patch preview: +        if self.query.distinct_fields: +            raise TypeError(""Cannot call update() after .distinct(*fields)."") || tests/distinct_on_fields/tests.py: 6 additions, 0 deletions. Patch preview: + +    def test_disallowed_update_distinct_on(self): +        qs = Staff.objects.distinct(""organisation"").order_by(""organisation"")"\n3ff32c50d143d8a498f9a5dfef1a31b16a7456fe,Fixed #36674 -- Fixed memory leak in select_related(). Ticket #36674: Issues â€” Opened5 weeks ago,django/db/models/sql/compiler.py; tests/select_related/tests.py,"django/db/models/sql/compiler.py: 8 additions, 9 deletions. Patch preview: +    @classmethod +    def get_select_from_parent(cls, klass_info): +        for ki in klass_info[""related_klass_infos""]: || tests/select_related/tests.py: 19 additions, 0 deletions. Patch preview: +import gc + +from django.test.utils import garbage_collect"\n6fcbbe0b855d8701a4da1b65772ccf326f996b9e,Fixed IntegrityError in bulk_create.tests.BulkCreateTransactionTests due to duplicate primary keys.,tests/bulk_create/tests.py,"tests/bulk_create/tests.py: 10 additions, 2 deletions. Patch preview: +    def get_unused_country_id(self): +        # Find a serial ID that hasn\'t been used already and has enough of a +        # buffer for the following `bulk_create` call without an explicit pk"\n74239181252ca73bebb84789856f5d8937d421b4,Fixed #35095 -- Clarified Swiss number formatting in docs/topics/i18n/formatting.txt. Ticket #35095: Issues â€” Opened23 months ago,AUTHORS; django/conf/locale/de_CH/formats.py; django/conf/locale/fr_CH/formats.py; docs/topics/i18n/formatting.txt,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Annabelle Wiegart || django/conf/locale/de_CH/formats.py: 3 additions, 5 deletions. Patch preview: -# these are the separators for non-monetary numbers. For monetary numbers, -# the DECIMAL_SEPARATOR is a . (decimal point) and the THOUSAND_SEPARATOR is a -# \' (single quote). || django/conf/locale/fr_CH/formats.py: 4 additions, 0 deletions. Patch preview: + +# Swiss number formatting can vary based on context (e.g. Fr. 23.50 vs 22,5 m). +# Django does not support context-specific formatting and uses generic || docs/topics/i18n/formatting.txt: 10 additions, 9 deletions. Patch preview: -Switzerland (German) --------------------- -"\n42d6e20feba81fb1182c8111d0c18e492fbe4e87,Made cosmetic edits to docs/releases/6.0.txt.,docs/releases/6.0.txt,"docs/releases/6.0.txt: 2 additions, 2 deletions. Patch preview: -Django handles task creation and queuing but does not provide a worker +Django handles task creation and queuing, but does not provide a worker -* The default scheme for ``forms.URLField`` changed fr"\n5e2bbebed9f36bb9d15f168444e7982287761877,Refs #36664 -- Added Python 3.15 to daily builds. Ticket #36664: Issues â€” Opened6 weeks ago,.github/workflows/schedule_tests.yml; tests/requirements/py3.txt,".github/workflows/schedule_tests.yml: 1 additions, 0 deletions. Patch preview: +          - \'3.15-dev\' || tests/requirements/py3.txt: 2 additions, 2 deletions. Patch preview: -numpy >= 1.26.0 -Pillow >= 10.1.0 +numpy >= 1.26.0; sys.platform != \'win32\' or python_version < \'3.15\'"\n185b049e9e72a5ff4b07e33605e10eb4f52ca74c,Refs #36499 -- Made TestUtilsHtml.test_strip_tags() assume behavior change in X.Y.0 version for Python 3.14+. Ticket #36499: Issues â€” Opened5 months ago,tests/utils_tests/test_html.py,"tests/utils_tests/test_html.py: 9 additions, 10 deletions. Patch preview: -        # Python fixed a quadratic-time issue in HTMLParser in 3.13.6, 3.12.12, -        # 3.11.14, 3.10.19, and 3.9.24. The fix slightly changes HTMLParser\'s -        # output, so tests for particul"\nb6c9246d0a3ef5f9a40b15cc289b495351eae109,Fixed #36677 -- Fixed scheduling of system checks in ParallelTestSuite workers. Ticket #36677: Issues â€” Opened5 weeks ago,django/test/runner.py,"django/test/runner.py: 5 additions, 3 deletions. Patch preview: -        call_command( -            ""check"", stdout=io.StringIO(), stderr=io.StringIO(), databases=used_aliases -        )"\n548209e620b3ca34396a360453f07c8dbb8aa6c7,Made RemoteTestResultTest.test_pickle_errors_detection() compatible with tblib 3.2+. Ticket #27301: Issues â€” Opened9 years ago Ticket #320: Issues â€” Opened20 years ago,tests/test_runner/test_parallel.py,"tests/test_runner/test_parallel.py: 8 additions, 0 deletions. Patch preview: +    def __reduce__(self): +        # tblib 3.2+ makes exception subclasses picklable by default. +        # Return (cls, ()) so the constructor fails on unpickle, preserving"\na0323a0c44135c28134672e6e633e5f4a7a68d5d,Fixed #36656 -- Avoided truncating async streaming responses in GZipMiddleware. Ticket #36656: Issues â€” Opened6 weeks ago,django/middleware/gzip.py; django/utils/text.py; tests/middleware/tests.py,"django/middleware/gzip.py: 5 additions, 13 deletions. Patch preview: -from django.utils.text import compress_sequence, compress_string +from django.utils.text import acompress_sequence, compress_sequence, compress_string -                # pull to lexical scope to capt || django/utils/text.py: 16 additions, 0 deletions. Patch preview: +async def acompress_sequence(sequence, *, max_random_bytes=None): +    buf = StreamingBuffer() +    filename = _get_random_filename(max_random_bytes) if max_random_bytes else None || tests/middleware/tests.py: 3 additions, 2 deletions. Patch preview: +import zlib -        with gzip.GzipFile(mode=""rb"", fileobj=BytesIO(gzipped_string)) as f: -            return f.read()"\n9bb83925d6c231e964f8b54efbc982fb1333da27,Fixed #36470 -- Prevented log injection in runserver when handling NOT FOUND. Ticket #36470: Issues â€” Opened5 months ago,django/core/servers/basehttp.py; django/utils/log.py; tests/servers/test_basehttp.py,"django/core/servers/basehttp.py: 19 additions, 26 deletions. Patch preview: +from django.utils.log import log_message -        extra = { -            ""request"": self.request, || django/utils/log.py: 47 additions, 20 deletions. Patch preview: +def log_message( +    logger, +    message, || tests/servers/test_basehttp.py: 15 additions, 0 deletions. Patch preview: +    def test_log_message_escapes_control_sequences(self): +        request = WSGIRequest(self.request_factory.get(""/"").environ) +        request.makefile = lambda *args, **kwargs: BytesIO()"\n5625bd590766e5ca8c2c76ba2307b98f7450ff83,Removed duplicate display_raw key in expected data in GeometryWidgetTests.,tests/gis_tests/test_geoforms.py,"tests/gis_tests/test_geoforms.py: 0 additions, 1 deletions. Patch preview: -                        ""display_raw"": False,"\n344ae16e1e21ab7c0b594d755519738f7f16eaf1,Fixed RelatedGeoModelTest.test_related_union_aggregate() test on Oracle and GEOS 3.12+.,tests/gis_tests/relatedapp/tests.py,"tests/gis_tests/relatedapp/tests.py: 9 additions, 4 deletions. Patch preview: -        # implementation-dependent (DB backend, GEOS version) -        self.assertEqual({p.ewkt for p in ref_u1}, {p.ewkt for p in u1}) -        self.assertEqual({p.ewkt for p in ref_u2}, {p.ewkt for"\nca3e0484ef31d13053af6a9d50667813e22fc282,Refs #36005 -- Bumped minimum supported versions of docutils to 0.22. Ticket #36005: Issues â€” Opened11 months ago,docs/internals/contributing/writing-code/unit-tests.txt; docs/ref/contrib/admin/admindocs.txt; docs/releases/6.0.txt; tests/admin_docs/test_utils.py; tests/requirements/py3.txt,"docs/internals/contributing/writing-code/unit-tests.txt: 1 additions, 1 deletions. Patch preview: -* :pypi:`docutils` 0.19+ +* :pypi:`docutils` 0.22+ || docs/ref/contrib/admin/admindocs.txt: 1 additions, 1 deletions. Patch preview: -* Install the :pypi:`docutils` 0.19+ package. +* Install the :pypi:`docutils` 0.22+ package. || docs/releases/6.0.txt: 1 additions, 0 deletions. Patch preview: +* ``docutils`` 0.22 || tests/admin_docs/test_utils.py: 1 additions, 1 deletions. Patch preview: -        parts = docutils.core.publish_parts(source=source, writer_name=""html4css1"") +        parts = docutils.core.publish_parts(source=source, writer=""html4css1"") || tests/requirements/py3.txt: 1 additions, 1 deletions. Patch preview: -docutils >= 0.19 +docutils >= 0.22"\nd506e4a52847ed4fb80754175d76b6b83ff90929,Fixed #36671 -- Dropped support for SQLite < 3.37. Ticket #36671: Issues â€” Opened5 weeks ago,django/db/backends/sqlite3/features.py; django/db/backends/sqlite3/introspection.py; django/db/backends/sqlite3/schema.py; docs/ref/contrib/gis/install/index.txt; docs/ref/databases.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/backends/sqlite/tests.py,"django/db/backends/sqlite3/features.py: 6 additions, 17 deletions. Patch preview: -    minimum_database_version = (3, 31) +    minimum_database_version = (3, 37) -    # Is ""ALTER TABLE ... DROP COLUMN"" supported? || django/db/backends/sqlite3/introspection.py: 1 additions, 2 deletions. Patch preview: -            # SQLite 3.8.9+ has 5 columns, however older versions only give 3 -            # columns. Discard last 2 columns if there. +            # Discard last 2 columns. || django/db/backends/sqlite3/schema.py: 1 additions, 2 deletions. Patch preview: -            self.connection.features.can_alter_table_drop_column -            and not field.primary_key +            not field.primary_key || docs/ref/contrib/gis/install/index.txt: 1 additions, 1 deletions. Patch preview: -SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.31.0+             Requires SpatiaLite 4.3+ +SQLite              GEOS, GDAL, PROJ, SpatiaLite    3.37.0+             Requires SpatiaLite 4.3+ || docs/ref/databases.txt: 1 additions, 1 deletions. Patch preview: -Django supports SQLite 3.31.0 and later. +Django supports SQLite 3.37.0 and later. || docs/ref/models/querysets.txt: 2 additions, 2 deletions. Patch preview: -  databases (currently PostgreSQL, MariaDB, and SQLite 3.35+). On other -  databases, it will not be set. +  databases (currently PostgreSQL, MariaDB, and SQLite). On other databases, it || docs/releases/6.1.txt: 2 additions, 0 deletions. Patch preview: +* The minimum supported version of SQLite is increased from 3.31.0 to 3.37.0. + || tests/backends/sqlite/tests.py: 2 additions, 2 deletions. Patch preview: -    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 30)) +    @mock.patch.object(connection, ""get_database_version"", return_value=(3, 36)) -        msg = ""SQLite 3.31 or later"\n0c487aa3a7b2417481bf48c1e5355c855873e210,Fixed #21961 -- Added support for database-level delete options for ForeignKey. Ticket #21961: Issues â€” Opened12 years ago,AUTHORS; django/contrib/admin/utils.py; django/contrib/contenttypes/fields.py; django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py; django/db/backends/base/features.py; django/db/backends/base/operations.py; django/db/backends/base/schema.py; django/db/backends/mysql/features.py; django/db/backends/mysql/schema.py; django/db/backends/oracle/features.py; django/db/backends/oracle/schema.py; django/db/backends/postgresql/schema.py; django/db/backends/sqlite3/schema.py; django/db/migrations/serializer.py; django/db/models/__init__.py; django/db/models/base.py; django/db/models/deletion.py; django/db/models/fields/__init__.py; django/db/models/fields/related.py; docs/ref/checks.txt; docs/ref/models/fields.txt; docs/ref/models/instances.txt; docs/ref/models/querysets.txt; docs/releases/6.1.txt; tests/admin_utils/models.py; tests/admin_utils/tests.py; tests/contenttypes_tests/test_checks.py; tests/delete/models.py; tests/delete/tests.py; tests/invalid_models_tests/test_models.py; tests/invalid_models_tests/test_relative_fields.py; tests/migrations/test_writer.py; tests/schema/tests.py,"AUTHORS: 1 additions, 0 deletions. Patch preview: +    Nick Stefan <https://github.com/nickstefan> || django/contrib/admin/utils.py: 2 additions, 9 deletions. Patch preview: -    def __init__(self, *args, **kwargs): -        super().__init__(*args, **kwargs) +    def __init__(self, *args, force_collection=True, **kwargs): || django/contrib/contenttypes/fields.py: 11 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +            elif isinstance(field.remote_field.on_delete, DatabaseOnDelete): +                return [ || django/contrib/contenttypes/management/commands/remove_stale_contenttypes.py: 3 additions, 9 deletions. Patch preview: -                        collector = NoFastDeleteCollector(using=using, origin=ct) +                        collector = Collector( +                            using=using, origin=ct, force_collection || django/db/backends/base/features.py: 3 additions, 0 deletions. Patch preview: +    # Does the backend support DEFAULT as delete option? +    supports_on_delete_db_default = True + || django/db/backends/base/operations.py: 10 additions, 0 deletions. Patch preview: +    def fk_on_delete_sql(self, operation): +        """""" +        Return the SQL to make an ON DELETE statement. || django/db/backends/base/schema.py: 11 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s)%(deferrable)s"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s%(deferrable)s"" +                        ""on_delete_db"": self._create_ || django/db/backends/mysql/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/mysql/schema.py: 1 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s(%(to_column)s)"" +        ""REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)s"" || django/db/backends/oracle/features.py: 1 additions, 0 deletions. Patch preview: +    supports_on_delete_db_default = False || django/db/backends/oracle/schema.py: 2 additions, 1 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(on_delete_db)"" +        ""s%(deferrable)s"" || django/db/backends/postgresql/schema.py: 2 additions, 2 deletions. Patch preview: -        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(%(to_column)s)%(deferrable)s"" -        ""; SET CONSTRAINTS %(namespace)s%(name)s IMMEDIATE"" +        ""CONSTRAINT %(name)s REFERENCES %(to_table)s(% || django/db/backends/sqlite3/schema.py: 2 additions, 1 deletions. Patch preview: -        ""REFERENCES %(to_table)s (%(to_column)s) DEFERRABLE INITIALLY DEFERRED"" +        ""REFERENCES %(to_table)s (%(to_column)s)%(on_delete_db)s DEFERRABLE INITIALLY "" +        ""DEFERRED"" || django/db/migrations/serializer.py: 8 additions, 0 deletions. Patch preview: +from django.db.models.deletion import DatabaseOnDelete +class DatabaseOnDeleteSerializer(BaseSerializer): +    def serialize(self): || django/db/models/__init__.py: 6 additions, 0 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_DEFAULT, +    DB_SET_NULL, || django/db/models/base.py: 25 additions, 1 deletions. Patch preview: -from django.db.models.deletion import CASCADE, Collector +from django.db.models.deletion import CASCADE, DO_NOTHING, Collector, DatabaseOnDelete +                *cls._check_related_fields(), || django/db/models/deletion.py: 35 additions, 4 deletions. Patch preview: +class DatabaseOnDelete: +    def __init__(self, operation, name, forced_collector=None): +        self.operation = operation || django/db/models/fields/__init__.py: 0 additions, 2 deletions. Patch preview: -        # Database-level options are not supported, see #21961. -        ""on_delete"", || django/db/models/fields/related.py: 86 additions, 13 deletions. Patch preview: -from django.db import connection, router +from django.db import connection, connections, router -from django.db.models import Q || docs/ref/checks.txt: 13 additions, 3 deletions. Patch preview: -* **fields.E320**: Field specifies ``on_delete=SET_NULL``, but cannot be null. -* **fields.E321**: The field specifies ``on_delete=SET_DEFAULT``, but has no -  default value. || docs/ref/models/fields.txt: 46 additions, 7 deletions. Patch preview: -    When an object referenced by a :class:`ForeignKey` is deleted, Django will -    emulate the behavior of the SQL constraint specified by the -    :attr:`on_delete` argument. For example, if you ha || docs/ref/models/instances.txt: 9 additions, 1 deletions. Patch preview: -object type. +object type. The return value will count instances from related models if +Django is emulating cascade behavior via Python :attr:`~ForeignKey.on_delete` || docs/ref/models/querysets.txt: 22 additions, 7 deletions. Patch preview: -deletions per object type. +deletions per object type. The return value will count instances from related +models if Django is emulating cascade behavior via Python || docs/releases/6.1.txt: 15 additions, 0 deletions. Patch preview: +Database-level delete options for ``ForeignKey.on_delete`` +---------------------------------------------------------- + || tests/admin_utils/models.py: 9 additions, 1 deletions. Patch preview: -class Count(models.Model): +class Cascade(models.Model): +class DBCascade(models.Model): || tests/admin_utils/tests.py: 23 additions, 2 deletions. Patch preview: -from .models import Article, Car, Count, Event, EventGuide, Location, Site, Vehicle +from .models import ( +    Article, || tests/contenttypes_tests/test_checks.py: 21 additions, 0 deletions. Patch preview: +    def test_content_type_db_on_delete(self): +        class Model(models.Model): +            content_type = models.ForeignKey(ContentType, models.DB_CASCADE) || tests/delete/models.py: 49 additions, 0 deletions. Patch preview: +class RelatedDbOptionGrandParent(models.Model): +    pass + || tests/delete/tests.py: 51 additions, 0 deletions. Patch preview: +    RelatedDbOption, +    RelatedDbOptionGrandParent, +    RelatedDbOptionParent, || tests/invalid_models_tests/test_models.py: 61 additions, 0 deletions. Patch preview: + + +@isolate_apps(""invalid_models_tests"") || tests/invalid_models_tests/test_relative_fields.py: 197 additions, 1 deletions. Patch preview: -from django.test.testcases import SimpleTestCase +from django.test import skipUnlessDBFeature +from django.test.testcases import SimpleTestCase, TestCase || tests/migrations/test_writer.py: 17 additions, 0 deletions. Patch preview: +    def test_database_on_delete_serializer_value(self): +        db_level_on_delete_options = [ +            models.DB_CASCADE, || tests/schema/tests.py: 95 additions, 1 deletions. Patch preview: +    DB_CASCADE, +    DB_SET_NULL, +    @skipUnlessDBFeature(""can_create_inline_fk"")"\nb1e0262c9f9d11eae6230b51c5aa5d71122d5f05,Fixed #36665 -- Improved manager usage guidance in docs/topics/db/optimization.txt. Ticket #36665: Issues â€” Opened5 weeks ago,docs/topics/db/optimization.txt,"docs/topics/db/optimization.txt: 3 additions, 2 deletions. Patch preview: -</topics/db/managers>`. Be aware when your manager is and is not used; -sometimes this is tricky so don\'t make assumptions. +</topics/db/managers>`. Be aware when your manager is and is not used; for"\n</hist_bugfix>\n\nI\'ve uploaded a python code repository in the directory /testbed. Consider the following PR description:\n<pr_description>\nSet default FILE_UPLOAD_PERMISSION to 0o644.\nDescription\n\t\nHello,\nAs far as I can see, the \u200bFile Uploads documentation page does not mention any permission issues.\nWhat I would like to see is a warning that in absence of explicitly configured FILE_UPLOAD_PERMISSIONS, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data (which, with the default FILE_UPLOAD_HANDLERS, in turn depends on the uploaded data size).\nThe tempfile.NamedTemporaryFile + os.rename sequence causes the resulting file permissions to be 0o0600 on some systems (I experience it here on CentOS 7.4.1708 and Python 3.6.5). In all probability, the implementation of Python\'s built-in tempfile module explicitly sets such permissions for temporary files due to security considerations.\nI found mentions of this issue \u200bon GitHub, but did not manage to find any existing bug report in Django\'s bug tracker.\n\n</pr_description>\n\nCan you help me implement the necessary changes to the repository so that the requirements specified in the <pr_description> are met?\nI\'ve already taken care of all changes to any of the test files described in the <pr_description>. This means you DON\'T have to modify the testing logic or any of the tests in any way!\nYour task is to make the minimal changes to non-tests files in the /testbed directory to ensure the <pr_description> is satisfied.\nFollow these steps to resolve the issue:\n1. As a first step, it might be a good idea to find and read code relevant to the <pr_description>\n2. Create a script to reproduce the error and execute it with `python <filename.py>` using the bash tool, to confirm the error\n3. Edit the sourcecode of the repo to resolve the issue\n4. Rerun your reproduce script and confirm that the error is fixed!\n5. Think about edgecases and make sure your fix handles them as well\nYour thinking should be thorough and so it\'s fine if it\'s very long.'}], 'agent': 'main', 'message_type': 'observation'}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains("FILE_UPLOAD_PERMISSIONS")\' /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg --json-path \'.data.lines[0].text\' --json-seq --json-seq-path \'.data.lines[0].text | contains(\\"FILE_UPLOAD_PERMISSIONS\\")\' /testbed"}', 'name': 'bash'}, 'id': 'call_9Y5ZscqEmpvDC2ZLhf4cRuy0', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9Y5ZscqEmpvDC2ZLhf4cRuy0']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r FILE_UPLOAD_PERMISSIONS /testbed', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r FILE_UPLOAD_PERMISSIONS /testbed"}', 'name': 'bash'}, 'id': 'call_HxJTMIFxLYJZWWrm66l0sMoe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/docs/ref/settings.txt::setting:`FILE_UPLOAD_PERMISSIONS` setting.\n/testbed/docs/ref/settings.txt:.. setting:: FILE_UPLOAD_PERMISSIONS\n/testbed/docs/ref/settings.txt:``FILE_UPLOAD_PERMISSIONS``\n/testbed/docs/ref/settings.txt:* :setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/ref/files/storage.txt:        saved. Defaults to :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/ref/contrib/staticfiles.txt::setting:`FILE_UPLOAD_PERMISSIONS` and collected directories receive permissions\n/testbed/docs/releases/1.11.txt:  (often ``0o6644``). Set the :setting:`FILE_UPLOAD_PERMISSIONS` if you need\n/testbed/docs/releases/1.5.txt:  them to be executable change :setting:`FILE_UPLOAD_PERMISSIONS` to your\n/testbed/docs/releases/1.7.txt:  :setting:`FILE_UPLOAD_PERMISSIONS` does for the files themselves.\n/testbed/docs/howto/deployment/checklist.txt::setting:`FILE_UPLOAD_PERMISSIONS`\n/testbed/docs/howto/deployment/checklist.txt:than larger files as described in :setting:`FILE_UPLOAD_PERMISSIONS`.\n/testbed/docs/howto/deployment/checklist.txt:Setting :setting:`FILE_UPLOAD_PERMISSIONS` ensures all files are uploaded with\n/testbed/django/core/files/storage.py:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/conf/global_settings.py:FILE_UPLOAD_PERMISSIONS = None\n/testbed/tests/test_utils/tests.py:        Overriding the FILE_UPLOAD_PERMISSIONS setting should be reflected in\n/testbed/tests/test_utils/tests.py:        with self.settings(FILE_UPLOAD_PERMISSIONS=0o777):\n/testbed/tests/file_storage/tests.py:        FILE_UPLOAD_PERMISSIONS=0o777,\n/testbed/tests/file_storage/tests.py:            'FILE_UPLOAD_PERMISSIONS': 0o333,\n/testbed/tests/file_storage/tests.py:            self.assertEqual(defaults_storage.file_permissions_mode, settings['FILE_UPLOAD_PERMISSIONS'])\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=0o654)\n/testbed/tests/file_storage/tests.py:    @override_settings(FILE_UPLOAD_PERMISSIONS=None)\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=None,\n/testbed/tests/staticfiles_tests/test_storage.py:        FILE_UPLOAD_PERMISSIONS=0o655,\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_HxJTMIFxLYJZWWrm66l0sMoe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_u3mka4ifvHWwv4pCEgbxvh2u', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n"""\nDefault Django settings. Override these with settings in the module pointed to\nby the DJANGO_SETTINGS_MODULE environment variable.\n"""\n\n\n# This is defined here as a do-nothing function because we can\'t import\n# django.utils.translation -- that module depends on the settings.\ndef gettext_noop(s):\n    return s\n\n\n####################\n# CORE             #\n####################\n\nDEBUG = False\n\n# Whether the framework should propagate raw exceptions rather than catching\n# them. This is useful under some testing situations and should never be used\n# on a live site.\nDEBUG_PROPAGATE_EXCEPTIONS = False\n\n# People who get code error notifications.\n# In the format [(\'Full Name\', \'email@example.com\'), (\'Full Name\', \'anotheremail@example.com\')]\nADMINS = []\n\n# List of IP addresses, as strings, that:\n#   * See debug comments, when DEBUG is true\n#   * Receive x-headers\nINTERNAL_IPS = []\n\n# Hosts/domain names that are valid for this site.\n# "*" matches anything, ".example.com" matches example.com and all subdomains\nALLOWED_HOSTS = []\n\n# Local time zone for this installation. All choices can be found here:\n# https://en.wikipedia.org/wiki/List_of_tz_zones_by_name (although not all\n# systems may support all possibilities). When USE_TZ is True, this is\n# interpreted as the default user time zone.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_u3mka4ifvHWwv4pCEgbxvh2u']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py -p /testbed -w -j 1"}', 'name': 'bash'}, 'id': 'call_1bHAgQOw4BIndsUQ1z9eWnnD', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_1bHAgQOw4BIndsUQ1z9eWnnD']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -w FILE_UPLOAD_PERMISSIONS /testbed/django/conf/global_settings.py"}', 'name': 'bash'}, 'id': 'call_T9Jy9L2QLGVmlAxqNgFAhiIx', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFILE_UPLOAD_PERMISSIONS = None\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_T9Jy9L2QLGVmlAxqNgFAhiIx']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_M8Ofci4OqrdrMjzuK5G8gKvX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_M8Ofci4OqrdrMjzuK5G8gKvX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_KT8KSpfOsD7OAtjbxhtQgid6', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_KT8KSpfOsD7OAtjbxhtQgid6']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n FILE_UPLOAD_PERMISSIONS /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_uUwM82lrbSPkD1CovRUg95fF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n193:        elif setting == 'FILE_UPLOAD_PERMISSIONS':\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_uUwM82lrbSPkD1CovRUg95fF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 -n 40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 -n 40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_Hr4Btg38nkLy1v8N1BffgUal', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Hr4Btg38nkLy1v8N1BffgUal']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 180,220p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 180,220p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_mytKsnCpzP9Fg8vyGKiRGJcW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n        elif setting == \'MEDIA_URL\':\n            self.__dict__.pop(\'base_url\', None)\n        elif setting == \'FILE_UPLOAD_PERMISSIONS\':\n            self.__dict__.pop(\'file_permissions_mode\', None)\n        elif setting == \'FILE_UPLOAD_DIRECTORY_PERMISSIONS\':\n            self.__dict__.pop(\'directory_permissions_mode\', None)\n\n    def _value_or_setting(self, value, setting):\n        return setting if value is None else value\n\n    @cached_property\n    def base_location(self):\n        return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n\n    @cached_property\n    def location(self):\n        return os.path.abspath(self.base_location)\n\n    @cached_property\n    def base_url(self):\n        if self._base_url is not None and not self._base_url.endswith(\'/\'):\n            self._base_url += \'/\'\n        return self._value_or_setting(self._base_url, settings.MEDIA_URL)\n\n    @cached_property\n    def file_permissions_mode(self):\n        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n\n    @cached_property\n    def directory_permissions_mode(self):\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_mytKsnCpzP9Fg8vyGKiRGJcW']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w -j 1", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w -j 1"}', 'name': 'bash'}, 'id': 'call_9OMGnmqRUoiQ7umCBOMsT1NC', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_9OMGnmqRUoiQ7umCBOMsT1NC']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -n file_permissions_mode /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -n file_permissions_mode /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_lrIsYmEFlRXo3J9U9DSiAR1r', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n178:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n182:        self._file_permissions_mode = file_permissions_mode\n194:            self.__dict__.pop('file_permissions_mode', None)\n216:    def file_permissions_mode(self):\n217:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n234:                # for consistency with file_permissions_mode behavior.\n283:        if self.file_permissions_mode is not None:\n284:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_lrIsYmEFlRXo3J9U9DSiAR1r']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 170,190p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 170,190p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_iJcLRaUXMVr0ks33JFKxW9iX', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nclass FileSystemStorage(Storage):\n    """\n    Standard filesystem storage\n    """\n    # The combination of O_CREAT and O_EXCL makes os.open() raise OSError if\n    # the file already exists before it\'s opened.\n    OS_OPEN_FLAGS = os.O_WRONLY | os.O_CREAT | os.O_EXCL | getattr(os, \'O_BINARY\', 0)\n\n    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n                 directory_permissions_mode=None):\n        self._location = location\n        self._base_url = base_url\n        self._file_permissions_mode = file_permissions_mode\n        self._directory_permissions_mode = directory_permissions_mode\n        setting_changed.connect(self._clear_cached_properties)\n\n    def _clear_cached_properties(self, setting, **kwargs):\n        """Reset setting based property values."""\n        if setting == \'MEDIA_ROOT\':\n            self.__dict__.pop(\'base_location\', None)\n            self.__dict__.pop(\'location\', None)\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_iJcLRaUXMVr0ks33JFKxW9iX']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'sed -n 270,290p /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"sed -n 270,290p /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_A6fcKyZ2N1gnEJ8DLQel59IH', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\n                        locks.unlock(fd)\n                        if _file is not None:\n                            _file.close()\n                        else:\n                            os.close(fd)\n            except FileExistsError:\n                # A new name is needed if the file exists.\n                name = self.get_available_name(name)\n                full_path = self.path(name)\n            else:\n                # OK, the file save worked. Break out of the loop.\n                break\n\n        if self.file_permissions_mode is not None:\n            os.chmod(full_path, self.file_permissions_mode)\n\n        # Store filenames with forward slashes, even on Windows.\n        return name.replace(\'\\\\\', \'/\')\n\n    def delete(self, name):\n        assert name, "The name argument is not allowed to be empty."\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_A6fcKyZ2N1gnEJ8DLQel59IH']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_AOyoZmjwZoQnZPmGRGXylvgA', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_AOyoZmjwZoQnZPmGRGXylvgA']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'grep -r file_permissions_mode /testbed/django/core/files/', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"grep -r file_permissions_mode /testbed/django/core/files/"}', 'name': 'bash'}, 'id': 'call_E3R6QqNlATZKqNW4hBHBqncQ', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\n/testbed/django/core/files/storage.py:    def __init__(self, location=None, base_url=None, file_permissions_mode=None,\n/testbed/django/core/files/storage.py:        self._file_permissions_mode = file_permissions_mode\n/testbed/django/core/files/storage.py:            self.__dict__.pop('file_permissions_mode', None)\n/testbed/django/core/files/storage.py:    def file_permissions_mode(self):\n/testbed/django/core/files/storage.py:        return self._value_or_setting(self._file_permissions_mode, settings.FILE_UPLOAD_PERMISSIONS)\n/testbed/django/core/files/storage.py:                # for consistency with file_permissions_mode behavior.\n/testbed/django/core/files/storage.py:        if self.file_permissions_mode is not None:\n/testbed/django/core/files/storage.py:            os.chmod(full_path, self.file_permissions_mode)\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_E3R6QqNlATZKqNW4hBHBqncQ']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'head -40 /testbed/django/core/files/storage.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"head -40 /testbed/django/core/files/storage.py"}', 'name': 'bash'}, 'id': 'call_qGjSkLbXXIs66dWiPY0grfHe', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nimport os\nfrom datetime import datetime\nfrom urllib.parse import urljoin\n\nfrom django.conf import settings\nfrom django.core.exceptions import SuspiciousFileOperation\nfrom django.core.files import File, locks\nfrom django.core.files.move import file_move_safe\nfrom django.core.signals import setting_changed\nfrom django.utils import timezone\nfrom django.utils._os import safe_join\nfrom django.utils.crypto import get_random_string\nfrom django.utils.deconstruct import deconstructible\nfrom django.utils.encoding import filepath_to_uri\nfrom django.utils.functional import LazyObject, cached_property\nfrom django.utils.module_loading import import_string\nfrom django.utils.text import get_valid_filename\n\n__all__ = (\n    \'Storage\', \'FileSystemStorage\', \'DefaultStorage\', \'default_storage\',\n    \'get_storage_class\',\n)\n\n\nclass Storage:\n    """\n    A base storage class, providing some default behaviors that all other\n    storage systems can inherit or override, as necessary.\n    """\n\n    # The following methods represent a public interface to private methods.\n    # These shouldn\'t be overridden by subclasses unless absolutely necessary.\n\n    def open(self, name, mode=\'rb\'):\n        """Retrieve the specified file from storage."""\n        return self._open(name, mode)\n\n    def save(self, name, content, max_length=None):\n        """\n        Save new content to the file specified by name. The content should be\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_qGjSkLbXXIs66dWiPY0grfHe']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "rg 'file_permissions_mode' -p /testbed/django/core/files/storage.py -w", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rg \'file_permissions_mode\' -p /testbed/django/core/files/storage.py -w"}', 'name': 'bash'}, 'id': 'call_0tZWDFGyJm8gfZyftEgVuJOW', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nbash: rg: command not found\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_0tZWDFGyJm8gfZyftEgVuJOW']}, {'role': 'assistant', 'content': 'The relevant code for file upload permissions is in the FileSystemStorage class in django/core/files/storage.py. The file_permissions_mode attribute is set from the constructor argument or from the FILE_UPLOAD_PERMISSIONS setting. The file permissions are applied with os.chmod after the file is saved.\n\nThe problem described in the PR is that when a file is uploaded, the temporary file created by tempfile.NamedTemporaryFile has restrictive permissions (0o600), and when it is renamed to the final location, the permissions remain restrictive. The PR wants to set a default FILE_UPLOAD_PERMISSIONS to 0o644 to avoid this issue.\n\nCurrently, in django/conf/global_settings.py, FILE_UPLOAD_PERMISSIONS is set to None by default.\n\nPlan:\n1. Change the default value of FILE_UPLOAD_PERMISSIONS in django/conf/global_settings.py from None to 0o644.\n2. Add a warning or note in the documentation about the permission inconsistency issue when FILE_UPLOAD_PERMISSIONS is not set explicitly.\n\nI will first edit django/conf/global_settings.py to set FILE_UPLOAD_PERMISSIONS = 0o644.', 'thought': 'The relevant code for file upload permissions is in the FileSystemStorage class in django/core/files/storage.py. The file_permissions_mode attribute is set from the constructor argument or from the FILE_UPLOAD_PERMISSIONS setting. The file permissions are applied with os.chmod after the file is saved.\n\nThe problem described in the PR is that when a file is uploaded, the temporary file created by tempfile.NamedTemporaryFile has restrictive permissions (0o600), and when it is renamed to the final location, the permissions remain restrictive. The PR wants to set a default FILE_UPLOAD_PERMISSIONS to 0o644 to avoid this issue.\n\nCurrently, in django/conf/global_settings.py, FILE_UPLOAD_PERMISSIONS is set to None by default.\n\nPlan:\n1. Change the default value of FILE_UPLOAD_PERMISSIONS in django/conf/global_settings.py from None to 0o644.\n2. Add a warning or note in the documentation about the permission inconsistency issue when FILE_UPLOAD_PERMISSIONS is not set explicitly.\n\nI will first edit django/conf/global_settings.py to set FILE_UPLOAD_PERMISSIONS = 0o644.', 'action': "str_replace_editor str_replace /testbed/django/conf/global_settings.py   --old_str 'FILE_UPLOAD_PERMISSIONS = None' --new_str 'FILE_UPLOAD_PERMISSIONS = 0o644'", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/django/conf/global_settings.py","old_str":"FILE_UPLOAD_PERMISSIONS = None","new_str":"FILE_UPLOAD_PERMISSIONS = 0o644"}', 'name': 'str_replace_editor'}, 'id': 'call_z71YEQLDNzhWRWJTHy5EhfSw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nThe file /testbed/django/conf/global_settings.py has been edited. Here\'s the result of running `cat -n` on a snippet of /testbed/django/conf/global_settings.py:\n   302\t# (i.e. "/tmp" on *nix systems).\n   303\tFILE_UPLOAD_TEMP_DIR = None\n   304\t\n   305\t# The numeric mode to set newly-uploaded files to. The value should be a mode\n   306\t# you\'d pass directly to os.chmod; see https://docs.python.org/library/os.html#files-and-directories.\n   307\tFILE_UPLOAD_PERMISSIONS = 0o644\n   308\t\n   309\t# The numeric mode to assign to newly-created directories, when uploading files.\n   310\t# The value should be a mode as you\'d pass to os.chmod;\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_z71YEQLDNzhWRWJTHy5EhfSw']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': "str_replace_editor str_replace /testbed/docs/ref/settings.txt   --old_str '.. setting:: FILE_UPLOAD_PERMISSIONS' --new_str '.. setting:: FILE_UPLOAD_PERMISSIONS\n\n    .. warning::\n\n        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\n'", 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/docs/ref/settings.txt","old_str":".. setting:: FILE_UPLOAD_PERMISSIONS","new_str":".. setting:: FILE_UPLOAD_PERMISSIONS\\n\\n    .. warning::\\n\\n        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\\n"}', 'name': 'str_replace_editor'}, 'id': 'call_WYOiqDN5Jss5Jfv6gAXYv2It', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': "OBSERVATION:\nThe file /testbed/docs/ref/settings.txt has been edited. Here's the result of running `cat -n` on a snippet of /testbed/docs/ref/settings.txt:\n  1477\t:djadmin:`collectstatic` for details on overriding it.\n  1478\t\n  1479\tThis value mirrors the functionality and caveats of the\n  1480\t:setting:`FILE_UPLOAD_PERMISSIONS` setting.\n  1481\t\n  1482\t.. setting:: FILE_UPLOAD_PERMISSIONS\n  1483\t\n  1484\t    .. warning::\n  1485\t\n  1486\t        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\n  1487\t\n  1488\t\n  1489\t``FILE_UPLOAD_PERMISSIONS``\n  1490\t---------------------------\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n"}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_WYOiqDN5Jss5Jfv6gAXYv2It']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'cat > /testbed/scripts/reproduce_upload_permission_issue.py << \'EOF\'\nimport os\nimport tempfile\n\n# Simulate file upload saving with tempfile.NamedTemporaryFile and os.rename\n\ndef simulate_file_upload():\n    # Create a temporary file with NamedTemporaryFile\n    with tempfile.NamedTemporaryFile(delete=False) as tmp:\n        tmp.write(b"Test content")\n        tmp_path = tmp.name\n\n    # Check permissions of the temporary file\n    tmp_stat = os.stat(tmp_path)\n    print(f"Temporary file permissions: {oct(tmp_stat.st_mode & 0o777)}")\n\n    # Simulate renaming to final destination\n    final_path = tmp_path + "_final"\n    os.rename(tmp_path, final_path)\n\n    # Check permissions of the final file\n    final_stat = os.stat(final_path)\n    print(f"Final file permissions: {oct(final_stat.st_mode & 0o777)}")\n\n    # Clean up\n    os.remove(final_path)\n\nif __name__ == "__main__":\n    simulate_file_upload()\nEOF', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"cat > /testbed/scripts/reproduce_upload_permission_issue.py << \'EOF\'\\nimport os\\nimport tempfile\\n\\n# Simulate file upload saving with tempfile.NamedTemporaryFile and os.rename\\n\\ndef simulate_file_upload():\\n    # Create a temporary file with NamedTemporaryFile\\n    with tempfile.NamedTemporaryFile(delete=False) as tmp:\\n        tmp.write(b\\"Test content\\")\\n        tmp_path = tmp.name\\n\\n    # Check permissions of the temporary file\\n    tmp_stat = os.stat(tmp_path)\\n    print(f\\"Temporary file permissions: {oct(tmp_stat.st_mode & 0o777)}\\")\\n\\n    # Simulate renaming to final destination\\n    final_path = tmp_path + \\"_final\\"\\n    os.rename(tmp_path, final_path)\\n\\n    # Check permissions of the final file\\n    final_stat = os.stat(final_path)\\n    print(f\\"Final file permissions: {oct(final_stat.st_mode & 0o777)}\\")\\n\\n    # Clean up\\n    os.remove(final_path)\\n\\nif __name__ == \\"__main__\\":\\n    simulate_file_upload()\\nEOF\\n"}', 'name': 'bash'}, 'id': 'call_39r62n9LLklnjClqIyaw3IvF', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'Your command ran successfully and did not produce any output.'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_39r62n9LLklnjClqIyaw3IvF']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/scripts/reproduce_upload_permission_issue.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/scripts/reproduce_upload_permission_issue.py"}', 'name': 'bash'}, 'id': 'call_McVJw3znpWncbF2vlukScLA9', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nTemporary file permissions: 0o600\nFinal file permissions: 0o600\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_McVJw3znpWncbF2vlukScLA9']}, {'role': 'assistant', 'content': "The reproduce script shows that the temporary file created by tempfile.NamedTemporaryFile has permissions 0o600, and after renaming, the final file also has permissions 0o600. This confirms the issue described in the PR.\n\nNow, with the change made to set FILE_UPLOAD_PERMISSIONS to 0o644 by default in global_settings.py, the FileSystemStorage class should apply these permissions to the saved file using os.chmod.\n\nTo confirm the fix, I will create a small test script that uses Django's FileSystemStorage to save a file and check the permissions of the saved file. This will verify that the file permissions are set to 0o644 by default.\n\nI will create and run this test script next.", 'thought': "The reproduce script shows that the temporary file created by tempfile.NamedTemporaryFile has permissions 0o600, and after renaming, the final file also has permissions 0o600. This confirms the issue described in the PR.\n\nNow, with the change made to set FILE_UPLOAD_PERMISSIONS to 0o644 by default in global_settings.py, the FileSystemStorage class should apply these permissions to the saved file using os.chmod.\n\nTo confirm the fix, I will create a small test script that uses Django's FileSystemStorage to save a file and check the permissions of the saved file. This will verify that the file permissions are set to 0o644 by default.\n\nI will create and run this test script next.", 'action': 'str_replace_editor create /testbed/scripts/test_filesystemstorage_permissions.py --file_text \'import os\nfrom django.core.files.storage import FileSystemStorage\nfrom django.core.files.base import ContentFile\n\n# Setup a FileSystemStorage instance\nstorage = FileSystemStorage()\n\n# Save a file\nfile_name = \'"\'"\'test_file.txt\'"\'"\'\ncontent = ContentFile(b\'"\'"\'Test content\'"\'"\')\nsaved_name = storage.save(file_name, content)\n\n# Get the full path\nfull_path = storage.path(saved_name)\n\n# Check the permissions\nfile_stat = os.stat(full_path)\nprint(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")\n\n# Clean up\nos.remove(full_path)\n\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"create","path":"/testbed/scripts/test_filesystemstorage_permissions.py","file_text":"import os\\nfrom django.core.files.storage import FileSystemStorage\\nfrom django.core.files.base import ContentFile\\n\\n# Setup a FileSystemStorage instance\\nstorage = FileSystemStorage()\\n\\n# Save a file\\nfile_name = \'test_file.txt\'\\ncontent = ContentFile(b\'Test content\')\\nsaved_name = storage.save(file_name, content)\\n\\n# Get the full path\\nfull_path = storage.path(saved_name)\\n\\n# Check the permissions\\nfile_stat = os.stat(full_path)\\nprint(f\\"Saved file permissions: {oct(file_stat.st_mode & 0o777)}\\")\\n\\n# Clean up\\nos.remove(full_path)\\n"}', 'name': 'str_replace_editor'}, 'id': 'call_fpmpDWr8f38w9VOD6CmkrElw', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nFile created successfully at: /testbed/scripts/test_filesystemstorage_permissions.py\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_fpmpDWr8f38w9VOD6CmkrElw']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/scripts/test_filesystemstorage_permissions.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/scripts/test_filesystemstorage_permissions.py"}', 'name': 'bash'}, 'id': 'call_X0KIFcoR3SYIfWc1JfYNTY2z', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nTraceback (most recent call last):\n  File "/testbed/scripts/test_filesystemstorage_permissions.py", line 11, in <module>\n    saved_name = storage.save(file_name, content)\n  File "/testbed/django/core/files/storage.py", line 51, in save\n    name = self.get_available_name(name, max_length=max_length)\n  File "/testbed/django/core/files/storage.py", line 75, in get_available_name\n    while self.exists(name) or (max_length and len(name) > max_length):\n  File "/testbed/django/core/files/storage.py", line 304, in exists\n    return os.path.exists(self.path(name))\n  File "/testbed/django/core/files/storage.py", line 317, in path\n    return safe_join(self.location, name)\n  File "/testbed/django/utils/functional.py", line 48, in __get__\n    res = instance.__dict__[self.name] = self.func(instance)\n  File "/testbed/django/core/files/storage.py", line 207, in location\n    return os.path.abspath(self.base_location)\n  File "/testbed/django/utils/functional.py", line 48, in __get__\n    res = instance.__dict__[self.name] = self.func(instance)\n  File "/testbed/django/core/files/storage.py", line 203, in base_location\n    return self._value_or_setting(self._location, settings.MEDIA_ROOT)\n  File "/testbed/django/conf/__init__.py", line 76, in __getattr__\n    self._setup(name)\n  File "/testbed/django/conf/__init__.py", line 61, in _setup\n    % (desc, ENVIRONMENT_VARIABLE))\ndjango.core.exceptions.ImproperlyConfigured: Requested setting MEDIA_ROOT, but settings are not configured. You must either define the environment variable DJANGO_SETTINGS_MODULE or call settings.configure() before accessing settings.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_X0KIFcoR3SYIfWc1JfYNTY2z']}, {'role': 'assistant', 'content': 'The test script failed because Django settings are not configured. To run this test script, we need to configure Django settings properly, including setting MEDIA_ROOT to a writable directory.\n\nI will modify the test script to configure Django settings programmatically with a temporary directory as MEDIA_ROOT, then run the test again.', 'thought': 'The test script failed because Django settings are not configured. To run this test script, we need to configure Django settings properly, including setting MEDIA_ROOT to a writable directory.\n\nI will modify the test script to configure Django settings programmatically with a temporary directory as MEDIA_ROOT, then run the test again.', 'action': 'str_replace_editor str_replace /testbed/scripts/test_filesystemstorage_permissions.py   --old_str \'import os\nfrom django.core.files.storage import FileSystemStorage\nfrom django.core.files.base import ContentFile\n\n# Setup a FileSystemStorage instance\nstorage = FileSystemStorage()\n\n# Save a file\nfile_name = \'"\'"\'test_file.txt\'"\'"\'\ncontent = ContentFile(b\'"\'"\'Test content\'"\'"\')\nsaved_name = storage.save(file_name, content)\n\n# Get the full path\nfull_path = storage.path(saved_name)\n\n# Check the permissions\nfile_stat = os.stat(full_path)\nprint(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")\n\n# Clean up\nos.remove(full_path)\n\' --new_str \'import os\nimport tempfile\nfrom django.conf import settings\nfrom django.core.files.storage import FileSystemStorage\nfrom django.core.files.base import ContentFile\n\n# Configure Django settings\nif not settings.configured:\n    settings.configure(\n        MEDIA_ROOT=tempfile.mkdtemp(),\n        FILE_UPLOAD_PERMISSIONS=0o644,\n    )\n\n# Setup a FileSystemStorage instance\nstorage = FileSystemStorage()\n\n# Save a file\nfile_name = \'"\'"\'test_file.txt\'"\'"\'\ncontent = ContentFile(b\'"\'"\'Test content\'"\'"\')\nsaved_name = storage.save(file_name, content)\n\n# Get the full path\nfull_path = storage.path(saved_name)\n\n# Check the permissions\nfile_stat = os.stat(full_path)\nprint(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")\n\n# Clean up\nos.remove(full_path)\n\'', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"str_replace","path":"/testbed/scripts/test_filesystemstorage_permissions.py","old_str":"import os\\nfrom django.core.files.storage import FileSystemStorage\\nfrom django.core.files.base import ContentFile\\n\\n# Setup a FileSystemStorage instance\\nstorage = FileSystemStorage()\\n\\n# Save a file\\nfile_name = \'test_file.txt\'\\ncontent = ContentFile(b\'Test content\')\\nsaved_name = storage.save(file_name, content)\\n\\n# Get the full path\\nfull_path = storage.path(saved_name)\\n\\n# Check the permissions\\nfile_stat = os.stat(full_path)\\nprint(f\\"Saved file permissions: {oct(file_stat.st_mode & 0o777)}\\")\\n\\n# Clean up\\nos.remove(full_path)\\n","new_str":"import os\\nimport tempfile\\nfrom django.conf import settings\\nfrom django.core.files.storage import FileSystemStorage\\nfrom django.core.files.base import ContentFile\\n\\n# Configure Django settings\\nif not settings.configured:\\n    settings.configure(\\n        MEDIA_ROOT=tempfile.mkdtemp(),\\n        FILE_UPLOAD_PERMISSIONS=0o644,\\n    )\\n\\n# Setup a FileSystemStorage instance\\nstorage = FileSystemStorage()\\n\\n# Save a file\\nfile_name = \'test_file.txt\'\\ncontent = ContentFile(b\'Test content\')\\nsaved_name = storage.save(file_name, content)\\n\\n# Get the full path\\nfull_path = storage.path(saved_name)\\n\\n# Check the permissions\\nfile_stat = os.stat(full_path)\\nprint(f\\"Saved file permissions: {oct(file_stat.st_mode & 0o777)}\\")\\n\\n# Clean up\\nos.remove(full_path)\\n"}', 'name': 'str_replace_editor'}, 'id': 'call_okl99E5Cff8LP6cFAvNB4FC2', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nThe file /testbed/scripts/test_filesystemstorage_permissions.py has been edited. Here\'s the result of running `cat -n` on a snippet of /testbed/scripts/test_filesystemstorage_permissions.py:\n     1\timport os\n     2\timport tempfile\n     3\tfrom django.conf import settings\n     4\tfrom django.core.files.storage import FileSystemStorage\n     5\tfrom django.core.files.base import ContentFile\n     6\t\n     7\t# Configure Django settings\n     8\tif not settings.configured:\n     9\t    settings.configure(\n    10\t        MEDIA_ROOT=tempfile.mkdtemp(),\n    11\t        FILE_UPLOAD_PERMISSIONS=0o644,\n    12\t    )\n    13\t\n    14\t# Setup a FileSystemStorage instance\n    15\tstorage = FileSystemStorage()\n    16\t\n    17\t# Save a file\n    18\tfile_name = \'test_file.txt\'\n    19\tcontent = ContentFile(b\'Test content\')\n    20\tsaved_name = storage.save(file_name, content)\n    21\t\n    22\t# Get the full path\n    23\tfull_path = storage.path(saved_name)\n    24\t\n    25\t# Check the permissions\n    26\tfile_stat = os.stat(full_path)\n    27\tprint(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")\n    28\t\n    29\t# Clean up\n    30\tos.remove(full_path)\nReview the changes and make sure they are as expected. Edit the file again if necessary.\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_okl99E5Cff8LP6cFAvNB4FC2']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'python3 /testbed/scripts/test_filesystemstorage_permissions.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"python3 /testbed/scripts/test_filesystemstorage_permissions.py"}', 'name': 'bash'}, 'id': 'call_G4KjSpBM3IwlHq1zV6pUcIqi', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nSaved file permissions: 0o644\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_G4KjSpBM3IwlHq1zV6pUcIqi']}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'submit', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{}', 'name': 'submit'}, 'id': 'call_esuNGrVxBDlsfFBbpOUcMhG1', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'OBSERVATION:\nThank you for your work on this issue. Please carefully follow the steps below to help review your changes.\n\n1. If you made any changes to your code after running the reproduction script, please run the reproduction script again.\n  If the reproduction script is failing, please revisit your changes and make sure they are correct.\n  If you have already removed your reproduction script, please ignore this step.\n2. Remove your reproduction script (if you haven\'t done so already).\n3. If you have modified any TEST files, please revert them to the state they had before you started fixing the issue.\n  You can do this with `git checkout -- /path/to/test/file.py`. Use below <diff> to find the files you need to revert.\n4. Run the submit command again to confirm.\n\nHere is a list of all of your changes:\n\n<diff>\ndiff --git a/django/conf/global_settings.py b/django/conf/global_settings.py\nindex acee9887d2..bdeec80610 100644\n--- a/django/conf/global_settings.py\n+++ b/django/conf/global_settings.py\n@@ -304,7 +304,7 @@ FILE_UPLOAD_TEMP_DIR = None\n \n # The numeric mode to set newly-uploaded files to. The value should be a mode\n # you\'d pass directly to os.chmod; see https://docs.python.org/library/os.html#files-and-directories.\n-FILE_UPLOAD_PERMISSIONS = None\n+FILE_UPLOAD_PERMISSIONS = 0o644\n \n # The numeric mode to assign to newly-created directories, when uploading files.\n # The value should be a mode as you\'d pass to os.chmod;\ndiff --git a/docs/ref/settings.txt b/docs/ref/settings.txt\nindex 46e99af993..f965269215 100644\n--- a/docs/ref/settings.txt\n+++ b/docs/ref/settings.txt\n@@ -1481,6 +1481,11 @@ This value mirrors the functionality and caveats of the\n \n .. setting:: FILE_UPLOAD_PERMISSIONS\n \n+    .. warning::\n+\n+        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\n+\n+\n ``FILE_UPLOAD_PERMISSIONS``\n ---------------------------\n \ndiff --git a/scripts/reproduce_upload_permission_issue.py b/scripts/reproduce_upload_permission_issue.py\nnew file mode 100644\nindex 0000000000..84b7668055\n--- /dev/null\n+++ b/scripts/reproduce_upload_permission_issue.py\n@@ -0,0 +1,28 @@\n+import os\n+import tempfile\n+\n+# Simulate file upload saving with tempfile.NamedTemporaryFile and os.rename\n+\n+def simulate_file_upload():\n+    # Create a temporary file with NamedTemporaryFile\n+    with tempfile.NamedTemporaryFile(delete=False) as tmp:\n+        tmp.write(b"Test content")\n+        tmp_path = tmp.name\n+\n+    # Check permissions of the temporary file\n+    tmp_stat = os.stat(tmp_path)\n+    print(f"Temporary file permissions: {oct(tmp_stat.st_mode & 0o777)}")\n+\n+    # Simulate renaming to final destination\n+    final_path = tmp_path + "_final"\n+    os.rename(tmp_path, final_path)\n+\n+    # Check permissions of the final file\n+    final_stat = os.stat(final_path)\n+    print(f"Final file permissions: {oct(final_stat.st_mode & 0o777)}")\n+\n+    # Clean up\n+    os.remove(final_path)\n+\n+if __name__ == "__main__":\n+    simulate_file_upload()\ndiff --git a/scripts/test_filesystemstorage_permissions.py b/scripts/test_filesystemstorage_permissions.py\nnew file mode 100644\nindex 0000000000..3eba3390de\n--- /dev/null\n+++ b/scripts/test_filesystemstorage_permissions.py\n@@ -0,0 +1,30 @@\n+import os\n+import tempfile\n+from django.conf import settings\n+from django.core.files.storage import FileSystemStorage\n+from django.core.files.base import ContentFile\n+\n+# Configure Django settings\n+if not settings.configured:\n+    settings.configure(\n+        MEDIA_ROOT=tempfile.mkdtemp(),\n+        FILE_UPLOAD_PERMISSIONS=0o644,\n+    )\n+\n+# Setup a FileSystemStorage instance\n+storage = FileSystemStorage()\n+\n+# Save a file\n+file_name = \'test_file.txt\'\n+content = ContentFile(b\'Test content\')\n+saved_name = storage.save(file_name, content)\n+\n+# Get the full path\n+full_path = storage.path(saved_name)\n+\n+# Check the permissions\n+file_stat = os.stat(full_path)\n+print(f"Saved file permissions: {oct(file_stat.st_mode & 0o777)}")\n+\n+# Clean up\n+os.remove(full_path)\n\n</diff>\n\n'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_esuNGrVxBDlsfFBbpOUcMhG1'], 'cache_control': {'type': 'ephemeral'}}, {'role': 'assistant', 'content': '', 'thought': '', 'action': 'rm /testbed/scripts/reproduce_upload_permission_issue.py /testbed/scripts/test_filesystemstorage_permissions.py', 'agent': 'main', 'tool_calls': [{'function': {'arguments': '{"command":"rm /testbed/scripts/reproduce_upload_permission_issue.py /testbed/scripts/test_filesystemstorage_permissions.py"}', 'name': 'bash'}, 'id': 'call_Onr5Jmvr6rQCFp9Yimq5y2wt', 'type': 'function'}], 'message_type': 'action', 'thinking_blocks': []}, {'role': 'tool', 'content': [{'type': 'text', 'text': 'Your command ran successfully and did not produce any output.'}], 'agent': 'main', 'message_type': 'observation', 'tool_call_ids': ['call_Onr5Jmvr6rQCFp9Yimq5y2wt'], 'cache_control': {'type': 'ephemeral'}}]
2025-12-09 13:11:29,201 - INFO - swea-agent-django__django-10914 - ðŸ¤– MODEL INPUT
OBSERVATION:
diff --git a/django/conf/global_settings.py b/django/conf/global_settings.py
index acee9887d2..bdeec80610 100644
--- a/django/conf/global_settings.py
+++ b/django/conf/global_settings.py
@@ -304,7 +304,7 @@ FILE_UPLOAD_TEMP_DIR = None
 
 # The numeric mode to set newly-uploaded files to. The value should be a mode
 # you'd pass directly to os.chmod; see https://docs.python.org/library/os.html#files-and-directories.
-FILE_UPLOAD_PERMISSIONS = None
+FILE_UPLOAD_PERMISSIONS = 0o644
 
 # The numeric mode to assign to newly-created directories, when uploading files.
 # The value should be a mode as you'd pass to os.chmod;
diff --git a/docs/ref/settings.txt b/docs/ref/settings.txt
index 46e99af993..f965269215 100644
--- a/docs/ref/settings.txt
+++ b/docs/ref/settings.txt
@@ -1481,6 +1481,11 @@ This value mirrors the functionality and caveats of the
 
 .. setting:: FILE_UPLOAD_PERMISSIONS
 
+    .. warning::
+
+        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.
+
+
 ``FILE_UPLOAD_PERMISSIONS``
 ---------------------------
 

2025-12-09 13:11:29,268 - INFO - swea-agent-django__django-10914 - Trajectory saved to /home/tianpei/IdeaProjects/SWE-agent/trajectories/tianpei/default__gpt-4.1-mini__t-0.00__p-1.00__c-0.50___swe_bench_lite_test/django__django-10914/django__django-10914.traj
2025-12-09 13:11:29,290 - INFO - swea-env-django__django-10914 - Beginning environment shutdown...
