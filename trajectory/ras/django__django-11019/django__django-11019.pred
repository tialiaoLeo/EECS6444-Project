{"model_name_or_path": "default__gpt-4.1-mini__t-0.00__p-1.00__c-0.50___swe_bench_lite_test", "instance_id": "django__django-11019", "model_patch": "diff --git a/django/forms/widgets.py b/django/forms/widgets.py\nindex 02aa32b207..0b0a9468e7 100644\n--- a/django/forms/widgets.py\n+++ b/django/forms/widgets.py\n@@ -125,30 +125,68 @@ class Media:\n         in a certain order. In JavaScript you may not be able to reference a\n         global or in CSS you might want to override a style.\n         \"\"\"\n-        # Start with a copy of list_1.\n         combined_list = list(list_1)\n-        last_insert_index = len(list_1)\n-        # Walk list_2 in reverse, inserting each element into combined_list if\n-        # it doesn't already exist.\n-        for path in reversed(list_2):\n+\n+        def index_in_list(lst, item):\n             try:\n-                # Does path already exist in the list?\n-                index = combined_list.index(path)\n+                return lst.index(item)\n             except ValueError:\n-                # Add path to combined_list since it doesn't exist.\n-                combined_list.insert(last_insert_index, path)\n+                return None\n+\n+        for path in list_2:\n+            if path not in combined_list:\n+                # Find the earliest position to insert path without violating order in list_1 and list_2\n+                insert_pos = len(combined_list)\n+                for i, existing_path in enumerate(combined_list):\n+                    if existing_path in list_2:\n+                        idx_existing = index_in_list(list_2, existing_path)\n+                        idx_path = index_in_list(list_2, path)\n+                        if idx_existing is not None and idx_path is not None and idx_existing > idx_path:\n+                            insert_pos = i\n+                            break\n+                    if existing_path in list_1:\n+                        idx_existing = index_in_list(list_1, existing_path)\n+                        idx_path = index_in_list(list_1, path)\n+                        if idx_existing is not None and idx_path is not None and idx_existing > idx_path:\n+                            insert_pos = i\n+                            break\n+                combined_list.insert(insert_pos, path)\n             else:\n-                if index > last_insert_index:\n-                    warnings.warn(\n-                        'Detected duplicate Media files in an opposite order:\\n'\n-                        '%s\\n%s' % (combined_list[last_insert_index], combined_list[index]),\n-                        MediaOrderConflictWarning,\n-                    )\n-                # path already exists in the list. Update last_insert_index so\n-                # that the following elements are inserted in front of this one.\n-                last_insert_index = index\n+                # Check if the order is reversed compared to list_2 and list_1\n+                index_in_combined = combined_list.index(path)\n+                index_in_list_2 = list_2.index(path)\n+                index_in_list_1 = list_1.index(path) if path in list_1 else None\n+\n+                def is_reversed(prev_path, current_path, lst):\n+                    try:\n+                        return lst.index(prev_path) > lst.index(current_path)\n+                    except ValueError:\n+                        return False\n+\n+                for prev_path in list_2[:index_in_list_2]:\n+                    if prev_path in combined_list:\n+                        if is_reversed(prev_path, path, combined_list):\n+                            warnings.warn(\n+                                'Detected duplicate Media files in an opposite order:\\n'\n+                                '%s\\n%s' % (prev_path, path),\n+                                MediaOrderConflictWarning,\n+                            )\n+                            break\n+\n+                if index_in_list_1 is not None:\n+                    for prev_path in list_1[:index_in_list_1]:\n+                        if prev_path in combined_list:\n+                            if is_reversed(prev_path, path, combined_list):\n+                                warnings.warn(\n+                                    'Detected duplicate Media files in an opposite order:\\n'\n+                                    '%s\\n%s' % (prev_path, path),\n+                                    MediaOrderConflictWarning,\n+                                )\n+                                break\n+\n         return combined_list\n \n+\n     def __add__(self, other):\n         combined = Media()\n         combined._css_lists = self._css_lists + other._css_lists\ndiff --git a/reproduce_media_warning.py b/reproduce_media_warning.py\nnew file mode 100644\nindex 0000000000..2d4610d334\n--- /dev/null\n+++ b/reproduce_media_warning.py\n@@ -0,0 +1,33 @@\n+import django\n+from django.conf import settings\n+\n+settings.configure(\n+    DEBUG=True,\n+    USE_I18N=True,\n+    INSTALLED_APPS=[\n+        'django.contrib.contenttypes',\n+        'django.contrib.auth',\n+    ],\n+)\n+django.setup()\n+\n+from django import forms\n+class ColorPicker(forms.Widget):\n+    class Media:\n+        js = ['color-picker.js']\n+\n+class SimpleTextWidget(forms.Widget):\n+    class Media:\n+        js = ['text-editor.js']\n+\n+class FancyTextWidget(forms.Widget):\n+    class Media:\n+        js = ['text-editor.js', 'text-editor-extras.js', 'color-picker.js']\n+\n+class MyForm(forms.Form):\n+    background_color = forms.CharField(widget=ColorPicker())\n+    intro = forms.CharField(widget=SimpleTextWidget())\n+    body = forms.CharField(widget=FancyTextWidget())\n+\n+print(MyForm().media)\n+\n"}