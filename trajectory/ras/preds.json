{
    "django__django-10914": {
        "model_name_or_path": "default__gpt-4.1-mini__t-0.00__p-1.00__c-0.50___swe_bench_lite_test",
        "instance_id": "django__django-10914",
        "model_patch": "diff --git a/django/conf/global_settings.py b/django/conf/global_settings.py\nindex acee9887d2..bdeec80610 100644\n--- a/django/conf/global_settings.py\n+++ b/django/conf/global_settings.py\n@@ -304,7 +304,7 @@ FILE_UPLOAD_TEMP_DIR = None\n \n # The numeric mode to set newly-uploaded files to. The value should be a mode\n # you'd pass directly to os.chmod; see https://docs.python.org/library/os.html#files-and-directories.\n-FILE_UPLOAD_PERMISSIONS = None\n+FILE_UPLOAD_PERMISSIONS = 0o644\n \n # The numeric mode to assign to newly-created directories, when uploading files.\n # The value should be a mode as you'd pass to os.chmod;\ndiff --git a/docs/ref/settings.txt b/docs/ref/settings.txt\nindex 46e99af993..f965269215 100644\n--- a/docs/ref/settings.txt\n+++ b/docs/ref/settings.txt\n@@ -1481,6 +1481,11 @@ This value mirrors the functionality and caveats of the\n \n .. setting:: FILE_UPLOAD_PERMISSIONS\n \n+    .. warning::\n+\n+        If this setting is not explicitly configured, the permissions for a file uploaded to FileSystemStorage might not be consistent depending on whether a MemoryUploadedFile or a TemporaryUploadedFile was used for temporary storage of the uploaded data. This can cause uploaded files to have restrictive permissions (e.g., 0o600) on some systems.\n+\n+\n ``FILE_UPLOAD_PERMISSIONS``\n ---------------------------\n \n"
    },
    "django__django-10924": {
        "model_name_or_path": "default__gpt-4.1-mini__t-0.00__p-1.00__c-0.50___swe_bench_lite_test",
        "instance_id": "django__django-10924",
        "model_patch": "diff --git a/django/db/models/fields/__init__.py b/django/db/models/fields/__init__.py\nindex 0c64748ccd..1006eaa78b 100644\n--- a/django/db/models/fields/__init__.py\n+++ b/django/db/models/fields/__init__.py\n@@ -1663,6 +1663,7 @@ class FilePathField(Field):\n \n     def __init__(self, verbose_name=None, name=None, path='', match=None,\n                  recursive=False, allow_files=True, allow_folders=False, **kwargs):\n+        # Accept callable for path to support dynamic path resolution\n         self.path, self.match, self.recursive = path, match, recursive\n         self.allow_files, self.allow_folders = allow_files, allow_folders\n         kwargs.setdefault('max_length', 100)\n@@ -1708,8 +1709,10 @@ class FilePathField(Field):\n         return str(value)\n \n     def formfield(self, **kwargs):\n+        # If path is callable, call it to get the actual path\n+        path = self.path() if callable(self.path) else self.path\n         return super().formfield(**{\n-            'path': self.path,\n+            'path': path,\n             'match': self.match,\n             'recursive': self.recursive,\n             'form_class': forms.FilePathField,\n"
    },
    "django__django-11001": {
        "model_name_or_path": "default__gpt-4.1-mini__t-0.00__p-1.00__c-0.50___swe_bench_lite_test",
        "instance_id": "django__django-11001",
        "model_patch": "diff --git a/django/db/models/sql/compiler.py b/django/db/models/sql/compiler.py\nindex 7649c39262..edb93d9319 100644\n--- a/django/db/models/sql/compiler.py\n+++ b/django/db/models/sql/compiler.py\n@@ -353,7 +353,8 @@ class SQLCompiler:\n             # not taken into account so we strip it. When this entire method\n             # is refactored into expressions, then we can check each part as we\n             # generate it.\n-            without_ordering = self.ordering_parts.search(sql).group(1)\n+            sql_oneline = ' '.join(sql.splitlines())\n+            without_ordering = self.ordering_parts.search(sql_oneline).group(1)\n             params_hash = make_hashable(params)\n             if (without_ordering, params_hash) in seen:\n                 continue\n@@ -366,7 +367,8 @@ class SQLCompiler:\n         if self.query.distinct and not self.query.distinct_fields:\n             select_sql = [t[1] for t in select]\n             for expr, (sql, params, is_ref) in order_by:\n-                without_ordering = self.ordering_parts.search(sql).group(1)\n+                sql_oneline = ' '.join(sql.splitlines())\n+                without_ordering = self.ordering_parts.search(sql_oneline).group(1)\n                 if not is_ref and (without_ordering, params) not in select_sql:\n                     extra_select.append((expr, (without_ordering, params), None))\n         return extra_select\n"
    },
    "django__django-11019": {
        "model_name_or_path": "default__gpt-4.1-mini__t-0.00__p-1.00__c-0.50___swe_bench_lite_test",
        "instance_id": "django__django-11019",
        "model_patch": "diff --git a/django/forms/widgets.py b/django/forms/widgets.py\nindex 02aa32b207..0b0a9468e7 100644\n--- a/django/forms/widgets.py\n+++ b/django/forms/widgets.py\n@@ -125,30 +125,68 @@ class Media:\n         in a certain order. In JavaScript you may not be able to reference a\n         global or in CSS you might want to override a style.\n         \"\"\"\n-        # Start with a copy of list_1.\n         combined_list = list(list_1)\n-        last_insert_index = len(list_1)\n-        # Walk list_2 in reverse, inserting each element into combined_list if\n-        # it doesn't already exist.\n-        for path in reversed(list_2):\n+\n+        def index_in_list(lst, item):\n             try:\n-                # Does path already exist in the list?\n-                index = combined_list.index(path)\n+                return lst.index(item)\n             except ValueError:\n-                # Add path to combined_list since it doesn't exist.\n-                combined_list.insert(last_insert_index, path)\n+                return None\n+\n+        for path in list_2:\n+            if path not in combined_list:\n+                # Find the earliest position to insert path without violating order in list_1 and list_2\n+                insert_pos = len(combined_list)\n+                for i, existing_path in enumerate(combined_list):\n+                    if existing_path in list_2:\n+                        idx_existing = index_in_list(list_2, existing_path)\n+                        idx_path = index_in_list(list_2, path)\n+                        if idx_existing is not None and idx_path is not None and idx_existing > idx_path:\n+                            insert_pos = i\n+                            break\n+                    if existing_path in list_1:\n+                        idx_existing = index_in_list(list_1, existing_path)\n+                        idx_path = index_in_list(list_1, path)\n+                        if idx_existing is not None and idx_path is not None and idx_existing > idx_path:\n+                            insert_pos = i\n+                            break\n+                combined_list.insert(insert_pos, path)\n             else:\n-                if index > last_insert_index:\n-                    warnings.warn(\n-                        'Detected duplicate Media files in an opposite order:\\n'\n-                        '%s\\n%s' % (combined_list[last_insert_index], combined_list[index]),\n-                        MediaOrderConflictWarning,\n-                    )\n-                # path already exists in the list. Update last_insert_index so\n-                # that the following elements are inserted in front of this one.\n-                last_insert_index = index\n+                # Check if the order is reversed compared to list_2 and list_1\n+                index_in_combined = combined_list.index(path)\n+                index_in_list_2 = list_2.index(path)\n+                index_in_list_1 = list_1.index(path) if path in list_1 else None\n+\n+                def is_reversed(prev_path, current_path, lst):\n+                    try:\n+                        return lst.index(prev_path) > lst.index(current_path)\n+                    except ValueError:\n+                        return False\n+\n+                for prev_path in list_2[:index_in_list_2]:\n+                    if prev_path in combined_list:\n+                        if is_reversed(prev_path, path, combined_list):\n+                            warnings.warn(\n+                                'Detected duplicate Media files in an opposite order:\\n'\n+                                '%s\\n%s' % (prev_path, path),\n+                                MediaOrderConflictWarning,\n+                            )\n+                            break\n+\n+                if index_in_list_1 is not None:\n+                    for prev_path in list_1[:index_in_list_1]:\n+                        if prev_path in combined_list:\n+                            if is_reversed(prev_path, path, combined_list):\n+                                warnings.warn(\n+                                    'Detected duplicate Media files in an opposite order:\\n'\n+                                    '%s\\n%s' % (prev_path, path),\n+                                    MediaOrderConflictWarning,\n+                                )\n+                                break\n+\n         return combined_list\n \n+\n     def __add__(self, other):\n         combined = Media()\n         combined._css_lists = self._css_lists + other._css_lists\ndiff --git a/reproduce_media_warning.py b/reproduce_media_warning.py\nnew file mode 100644\nindex 0000000000..2d4610d334\n--- /dev/null\n+++ b/reproduce_media_warning.py\n@@ -0,0 +1,33 @@\n+import django\n+from django.conf import settings\n+\n+settings.configure(\n+    DEBUG=True,\n+    USE_I18N=True,\n+    INSTALLED_APPS=[\n+        'django.contrib.contenttypes',\n+        'django.contrib.auth',\n+    ],\n+)\n+django.setup()\n+\n+from django import forms\n+class ColorPicker(forms.Widget):\n+    class Media:\n+        js = ['color-picker.js']\n+\n+class SimpleTextWidget(forms.Widget):\n+    class Media:\n+        js = ['text-editor.js']\n+\n+class FancyTextWidget(forms.Widget):\n+    class Media:\n+        js = ['text-editor.js', 'text-editor-extras.js', 'color-picker.js']\n+\n+class MyForm(forms.Form):\n+    background_color = forms.CharField(widget=ColorPicker())\n+    intro = forms.CharField(widget=SimpleTextWidget())\n+    body = forms.CharField(widget=FancyTextWidget())\n+\n+print(MyForm().media)\n+\n"
    },
    "django__django-11039": {
        "model_name_or_path": "default__gpt-4.1-mini__t-0.00__p-1.00__c-0.50___swe_bench_lite_test",
        "instance_id": "django__django-11039",
        "model_patch": "diff --git a/django/core/management/commands/sqlmigrate.py b/django/core/management/commands/sqlmigrate.py\nindex f0b663222a..a3c9c79c2f 100644\n--- a/django/core/management/commands/sqlmigrate.py\n+++ b/django/core/management/commands/sqlmigrate.py\n@@ -55,8 +55,8 @@ class Command(BaseCommand):\n                 migration_name, app_label))\n         targets = [(app_label, migration.name)]\n \n-        # Show begin/end around output only for atomic migrations\n-        self.output_transaction = migration.atomic\n+        # Show begin/end around output only for atomic migrations and if the database supports rollback of DDL\n+        self.output_transaction = migration.atomic and connection.features.can_rollback_ddl\n \n         # Make a plan that represents just the requested migrations and show SQL\n         # for it\n"
    },
    "django__django-11049": {
        "model_name_or_path": "default__gpt-4.1-mini__t-0.00__p-1.00__c-0.50___swe_bench_lite_test",
        "instance_id": "django__django-11049",
        "model_patch": "diff --git a/django/forms/fields.py b/django/forms/fields.py\nindex a977256525..54ce4cf9b8 100644\n--- a/django/forms/fields.py\n+++ b/django/forms/fields.py\n@@ -468,7 +468,14 @@ class DateTimeField(BaseTemporalField):\n \n class DurationField(Field):\n     default_error_messages = {\n-        'invalid': _('Enter a valid duration.'),\n+        'invalid': _(\n+            'Enter a valid duration. The format is [DD] [[HH:]MM:]ss[.uuuuuu].'\n+        ),\n+    }\n+    default_help_text = _(\n+        'Duration in the format [DD] [[HH:]MM:]ss[.uuuuuu]. Seconds are mandatory, minutes are optional, and hours are optional if minutes are provided.'\n+    )\n+    default_error_messages = {\n         'overflow': _('The number of days must be between {min_days} and {max_days}.')\n     }\n \n"
    },
    "django__django-11099": {
        "model_name_or_path": "default__gpt-4.1-mini__t-0.00__p-1.00__c-0.50___swe_bench_lite_test",
        "instance_id": "django__django-11099",
        "model_patch": "diff --git a/django/contrib/auth/validators.py b/django/contrib/auth/validators.py\nindex b4878cfd45..1304f20a60 100644\n--- a/django/contrib/auth/validators.py\n+++ b/django/contrib/auth/validators.py\n@@ -7,7 +7,7 @@ from django.utils.translation import gettext_lazy as _\n \n @deconstructible\n class ASCIIUsernameValidator(validators.RegexValidator):\n-    regex = r'^[\\w.@+-]+$'\n+    regex = r'\\A[\\w.@+-]+\\Z'\n     message = _(\n         'Enter a valid username. This value may contain only English letters, '\n         'numbers, and @/./+/-/_ characters.'\n@@ -17,7 +17,7 @@ class ASCIIUsernameValidator(validators.RegexValidator):\n \n @deconstructible\n class UnicodeUsernameValidator(validators.RegexValidator):\n-    regex = r'^[\\w.@+-]+$'\n+    regex = r'\\A[\\w.@+-]+\\Z'\n     message = _(\n         'Enter a valid username. This value may contain only letters, '\n         'numbers, and @/./+/-/_ characters.'\n"
    },
    "django__django-11133": {
        "model_name_or_path": "default__gpt-4.1-mini__t-0.00__p-1.00__c-0.50___swe_bench_lite_test",
        "instance_id": "django__django-11133",
        "model_patch": "diff --git a/django/http/response.py b/django/http/response.py\nindex 6a84e193ba..6f25d83b89 100644\n--- a/django/http/response.py\n+++ b/django/http/response.py\n@@ -308,6 +308,10 @@ class HttpResponse(HttpResponseBase):\n \n     @content.setter\n     def content(self, value):\n+        # Handle memoryview objects explicitly\n+        if isinstance(value, memoryview):\n+            value = value.tobytes()\n+\n         # Consume iterators upon assignment to allow repeated iteration.\n         if hasattr(value, '__iter__') and not isinstance(value, (bytes, str)):\n             content = b''.join(self.make_bytes(chunk) for chunk in value)\n"
    },
    "django__django-11179": {
        "model_name_or_path": "default__gpt-4.1-mini__t-0.00__p-1.00__c-0.50___swe_bench_lite_test",
        "instance_id": "django__django-11179",
        "model_patch": "diff --git a/django/db/models/deletion.py b/django/db/models/deletion.py\nindex 92fe4affb9..3a462f1c4c 100644\n--- a/django/db/models/deletion.py\n+++ b/django/db/models/deletion.py\n@@ -277,6 +277,7 @@ class Collector:\n             if self.can_fast_delete(instance):\n                 with transaction.mark_for_rollback_on_error():\n                     count = sql.DeleteQuery(model).delete_batch([instance.pk], self.using)\n+                setattr(instance, model._meta.pk.attname, None)\n                 return count, {model._meta.label: count}\n \n         with transaction.atomic(using=self.using, savepoint=False):\n"
    },
    "django__django-11283": {
        "model_name_or_path": "default__gpt-4.1-mini__t-0.00__p-1.00__c-0.50___swe_bench_lite_test",
        "instance_id": "django__django-11283",
        "model_patch": "diff --git a/django/contrib/auth/migrations/0011_update_proxy_permissions.py b/django/contrib/auth/migrations/0011_update_proxy_permissions.py\nindex 0e66649695..f5f6a4df5c 100644\n--- a/django/contrib/auth/migrations/0011_update_proxy_permissions.py\n+++ b/django/contrib/auth/migrations/0011_update_proxy_permissions.py\n@@ -24,6 +24,12 @@ def update_proxy_model_permissions(apps, schema_editor, reverse=False):\n         proxy_content_type = ContentType.objects.get_for_model(Model, for_concrete_model=False)\n         old_content_type = proxy_content_type if reverse else concrete_content_type\n         new_content_type = concrete_content_type if reverse else proxy_content_type\n+        # Delete existing permissions for the new content type to avoid duplicates\n+        Permission.objects.filter(\n+            permissions_query,\n+            content_type=new_content_type,\n+        ).delete()\n+\n         Permission.objects.filter(\n             permissions_query,\n             content_type=old_content_type,\n"
    },
    "django__django-11422": {
        "model_name_or_path": "default__gpt-4.1-mini__t-0.00__p-1.00__c-0.50___swe_bench_lite_test",
        "instance_id": "django__django-11422",
        "model_patch": "diff --git a/django/utils/autoreload.py b/django/utils/autoreload.py\nindex 7ca0d68fae..4486f2d92b 100644\n--- a/django/utils/autoreload.py\n+++ b/django/utils/autoreload.py\n@@ -236,6 +236,27 @@ class BaseReloader:\n         logger.debug('Watching file %s.', path)\n         self.extra_files.add(path)\n \n+    def add_manage_py(self):\n+        \"\"\"Add manage.py to the watch list if it exists in the current directory.\"\"\"\n+        manage_py_path = Path(os.getcwd()) / 'manage.py'\n+        if manage_py_path.exists():\n+            self.watch_file(manage_py_path)\n+\n+    def watched_files(self, include_globs=True):\n+        \"\"\"\n+        Yield all files that need to be watched, including module files and\n+        files within globs.\n+        \"\"\"\n+        # Add manage.py to watch list\n+        self.add_manage_py()\n+\n+        yield from iter_all_python_module_files()\n+        yield from self.extra_files\n+        if include_globs:\n+            for directory, patterns in self.directory_globs.items():\n+                for pattern in patterns:\n+                    yield from directory.glob(pattern)\n+\n     def watched_files(self, include_globs=True):\n         \"\"\"\n         Yield all files that need to be watched, including module files and\ndiff --git a/manage.py b/manage.py\nnew file mode 100644\nindex 0000000000..82f8b730a1\n--- /dev/null\n+++ b/manage.py\n@@ -0,0 +1,7 @@\n+import time\n+import os\n+\n+if __name__ == '__main__':\n+    print('Starting server...')\n+    while True:\n+        time.sleep(1)\ndiff --git a/test_autoreload_manage_py.py b/test_autoreload_manage_py.py\nnew file mode 100644\nindex 0000000000..41fe4313f6\n--- /dev/null\n+++ b/test_autoreload_manage_py.py\n@@ -0,0 +1,11 @@\n+import time\n+from pathlib import Path\n+from django.utils.autoreload import StatReloader\n+\n+reloader = StatReloader()\n+manage_py_path = str(Path('manage.py').absolute())\n+reloader.watch_file(manage_py_path)\n+\n+print('Watching files...')\n+for _ in reloader.tick():\n+    pass\n"
    }
}